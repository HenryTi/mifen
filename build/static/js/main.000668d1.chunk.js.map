{"version":3,"sources":["tonva-react/index.ts","tonva-react/tool/left0.ts","tonva-react/tool/local.ts","tonva-react/tool/getObjPropIgnoreCase.ts","tonva-react/tool/caseString.ts","tonva-react/components/index.ts","tonva-react/components/nav.tsx","tonva-react/net/netToken.ts","tonva-react/components/fetchErrorView.tsx","tonva-react/components/reloadPage.tsx","stockinfo/GFunc.tsx","tonva-react/uq/build/tools.ts","tonva-react/net/guestApi.ts","tonva-react/net/caller.ts","tonva-react/components/page/page.tsx","tool/render.tsx","tool/renderGroup.tsx","tonva-uqui/list/ListPage.tsx","tonva-uqui/list/CList.ts","tonva-uqui/list/MidList.ts","tonva-react/vm/controller.tsx","tonva-react/vm/view.tsx","tonva-react/vm/vpage.tsx","tonva-react/uq/entity.ts","tonva-react/components/edit/itemEdit.tsx","tonva-react/res/formRes.ts","tonva-react/res/listRes.ts","tonva-react/uq/caller.ts","tonva-uqui/tools/pageItems.ts","tonva-uqui/tools/timeSpan.ts","tonva-uqui/tools/parts.tsx","tonva-uqui/base/index.ts","tonva-react/net/httpChannel.ts","tonva-react/net/httpChannelUI.ts","tonva-react/net/uqApi.ts","tonva-uqui/form/VFormView.tsx","tonva-uqui/form/CFormView.ts","tonva-uqui/form/VFormPage.tsx","tonva-uqui/form/CFormPage.ts","tonva-uqui/form/VDialog.tsx","tonva-uqui/form/CFormDialog.ts","tonva-uqui/form/FormUI.ts","tonva-react/uq/query.ts","tonva-uqui/select/CIDSelect.ts","tonva-uqui/select/parts.tsx","tonva-uqui/select/CIXSelect.ts","tonva-uqui/select/createPickId.ts","tonva-react/tool/uid.ts","tonva-react/net/appBridge.ts","tonva-react/net/wsChannel.ts","tonva-react/components/image.tsx","tonva-react/tool/user.ts","tonva-react/net/host.ts","tonva-react/components/page/scrollView.tsx","tonva-react/res/res.ts","tonva-react/uq/action.ts","tonva-react/components/simple/LMR.tsx","tonva-react/components/simple/Badge.tsx","tonva-react/components/simple/FA.tsx","tonva-react/components/simple/IconText.tsx","tonva-uqui/index.ts","tonva-react/tool/localDb.ts","tonva-react/uq/tuid/reactBoxId.tsx","tonva-react/components/loading.tsx","tonva-react/tool/env.ts","tonva-react/components/login.tsx","tonva-react/uq/index.ts","tonva-react/uq/tuid/index.ts","tonva-react/uq/ID.ts","tonva-uqui/ID/VEdit.tsx","tonva-uqui/ID/VView.tsx","tonva-uqui/ID/res/index.ts","tonva-uqui/ID/res/zh.ts","tonva-uqui/ID/res/en.ts","tonva-uqui/ID/CID.ts","tonva-uqui/ID/MidIDList.ts","tonva-uqui/ID/MidID.ts","stockinfo/SlrForEarning.ts","tonva-react/net/apiBase.ts","tonva-react/uq/uqsMan.ts","tonva-uqui/IX/CIXList.ts","tonva-uqui/IX/CIX.ts","tonva-uqui/IX/CIXEdit.ts","tonva-react/components/edit/imageItemEdit.tsx","stockinfo/ErForEarning.ts","tonva-react/tool/rules.ts","tonva-react/tool/pageItems.ts","tonva-react/tool/62.ts","tonva-react/net/messageHub.ts","tonva-react/components/navigo.ts","tonva-react/components/page/pageHeader.tsx","tonva-react/components/page/tabs.tsx","tonva-react/components/resUploader.tsx","tonva-react/uq/uqMan.ts","tonva-react/uq/sheet.ts","tonva-react/uq/book.ts","tonva-react/uq/history.ts","tonva-react/uq/map.ts","tonva-react/uq/pending.ts","tonva-react/uq/enum.ts","stockinfo/VStockInfo.tsx","tonva-react/app/centerApi.ts","tonva-react/app/vMain.tsx","tonva-react/app/CAppBase.ts","tonva-react/app/start.ts","tonva-react/app/CBase.ts","tonva-react/uq/tag/tagView.tsx","tonva-react/uq/tag/tag.ts","uq-app/CBase.ts","uq-app/bug/tester/test-times-change.ts","uq-app/bug/tester/index.ts","uq-app/bug/tester/test1.ts","uq-app/bug/tester/test2.ts","uq-app/bug/tester/test3.ts","uq-app/bug/tester/test4.ts","uq-app/bug/VBug.tsx","uq-app/bug/VConsole.tsx","uq-app/bug/CBug.ts","uq-app/res/index.ts","uq-app/res/zh.ts","uq-app/res/en.ts","uq-app/VMain.tsx","uq-app/test-uqui/VTest.tsx","uq-app/test-uqui/CTest.tsx","uq-app/uqs/BruceYuMi/$Piecewise.ui.tsx","uq-app/uqs/BruceYuMi/Market.ui.tsx","uq-app/uqs/BruceYuMi/Transaction.ui.tsx","uq-app/uqs/BruceYuMi/Group.ui.tsx","uq-app/uqs/BruceYuMi/Account.ui.tsx","uq-app/uqs/BruceYuMi/Holding.ui.tsx","uq-app/uqs/BruceYuMi/$PiecewiseDetail.ui.tsx","uq-app/uqs/BruceYuMi/Stock.ui.tsx","uq-app/uqs/BruceYuMi/StockValue.ui.tsx","uq-app/uqs/BruceYuMi/AccountValue.ui.tsx","uq-app/uqs/BruceYuMi/Portfolio.ui.tsx","uq-app/uqs/BruceYuMi/UserBlockStock.ui.tsx","uq-app/uqs/BruceYuMi/UserAccount.ui.tsx","uq-app/uqs/BruceYuMi/UserGroup.ui.tsx","uq-app/uqs/BruceYuMi/UserAllStock.ui.tsx","uq-app/uqs/BruceYuMi/AccountHolding.ui.tsx","uq-app/uqs/BruceYuMi/GroupStock.ui.tsx","uq-app/uqs/BruceYuMi/BruceYuMi.ts","uq-app/uqs/index.ts","uq-app/uqs/BruceYuMi/index.ts","me/VEditMe.tsx","uq-app/appConfig.ts","me/VFaq.tsx","me/VAbout.tsx","me/VMe.tsx","me/CMe.ts","store/holdingStock.ts","store/miAccount.ts","store/miAccounts.ts","store/miGroup.ts","store/miGroups.ts","store/market.tsx","store/store.ts","home/VHome.tsx","home/account/VAccount.tsx","home/account/VForm.tsx","home/account/VAccounts.tsx","home/account/VPickStock.tsx","home/account/CAccount.ts","home/CHome.ts","find/stockPageItems.ts","find/VFind.tsx","find/VStocksPage.tsx","find/group/VGroups.tsx","find/group/VStockList.tsx","find/group/CGroup.ts","find/CFind.ts","common/VBlockStock.tsx","common/VKeepStock.tsx","common/VPinStock.tsx","common/VStockInGroup.tsx","common/VStockLink.tsx","common/CCommon.ts","uq-app/CApp.ts","uq-app/App.tsx","tonva-react/uq/build/fieldItem.ts","tonva-react/auth/VLogout.tsx","tonva-react/auth/VLogin.tsx","tonva-react/auth/VChangePassword.tsx","tonva-react/auth/CLogin.tsx","tonva-react/img/logo.svg","tonva-react/auth/tools.tsx","tonva-react/components/page/index.ts","tonva-react/components/schema/index.ts","tonva-react/components/dropDownActions/index.tsx","tonva-react/components/easyDate/index.tsx","tonva-react/components/media.tsx","tonva-react/components/searchBox.tsx","tonva-react/components/userIcon.tsx","tonva-react/components/ax/index.tsx","tonva-react/components/autoHideTips.tsx","tonva-react/uq/tuid/tuidsCache.ts","tonva-react/ui/index.ts","tonva-uqui/base/Mid.ts","tonva-react/components/form/rules/index.ts","tonva-react/components/form/widgets/widget.tsx","tonva-react/components/form/widgets/textWidget.tsx","tonva-react/components/form/widgets/textareaWidget.tsx","tonva-react/components/form/widgets/passwordWidget.tsx","tonva-react/components/form/widgets/numberWidget.tsx","tonva-react/components/form/widgets/updownWidget.tsx","tonva-react/components/form/widgets/dateWidget.tsx","tonva-react/components/form/widgets/checkBoxWidget.tsx","tonva-react/components/form/widgets/selectWidget.tsx","tonva-react/components/form/widgets/radioWidget.tsx","tonva-react/components/form/widgets/rangeWidget.tsx","tonva-react/components/form/widgets/idWidget.tsx","tonva-react/components/form/widgets/unknown.tsx","tonva-react/components/form/widgets/buttonWidget.tsx","tonva-react/components/form/context.tsx","tonva-react/components/form/widgets/arrComponent.tsx","tonva-react/components/form/widgets/imageWidget.tsx","tonva-react/components/form/widgets/tagWidget.tsx","tonva-react/components/form/widgets/factory.tsx","tonva-react/components/form/form.tsx","tonva-react/components/form/field.tsx","tonva-react/components/edit/stringItemEdit.tsx","tonva-react/components/edit/radioItemEdit.tsx","tonva-react/components/edit/selectItemEdit.tsx","tonva-react/components/edit/idItemEdit.tsx","tonva-react/components/edit/tagItemEdit.tsx","tonva-react/components/edit/textAreaItemEdit.tsx","tonva-react/components/edit/checkBoxItemEdit.tsx","tonva-react/components/edit/rangeItemEdit.tsx","tonva-react/components/edit/numberItemEdit.tsx","tonva-react/components/edit/edit.tsx","tonva-uqui/IDX/MidIDXList.ts","tonva-uqui/IDX/res/index.ts","tonva-uqui/IDX/res/zh.ts","tonva-uqui/IDX/res/en.ts","tonva-uqui/IDX/VEdit.tsx","tonva-uqui/IDX/VHistory.tsx","tonva-uqui/IDX/VView.tsx","tonva-uqui/IDX/CIDX.ts","tonva-uqui/IDX/MidIDX.ts","tonva-uqui/tag/MidTag.ts","tonva-uqui/tag/select/VSelect.tsx","tonva-uqui/tag/select/CSelect.ts","tonva-uqui/tag/parts.tsx","tonva-uqui/tag/CIDTagList.ts","tonva-uqui/tag/VTags.tsx","tonva-uqui/tag/CTagIDList.ts","stockinfo/net/consts.ts","stockinfo/net/httpChannel.ts","stockinfo/net/httpChannelUI.ts","stockinfo/net/apiBase.ts","stockinfo/net/miApi.ts","stockinfo/net/miNet.ts","stockinfo/CStockInfo.tsx","tonva-uqui/sheet/MidSheet.ts","tonva-uqui/sheet/CSheet.ts","tonva-uqui/sheet/VSheetEdit.tsx","tonva-uqui/sheet/VSheetView.tsx","tonva-uqui/roles/VRoles.tsx","tonva-uqui/roles/roleAdmin/VAddUser.tsx","tonva-uqui/roles/roleAdmin/VRoleAdmin.tsx","tonva-uqui/roles/roleAdmin/CRoleAdmin.ts","tonva-uqui/roles/CRoles.ts","tonva-react/components/list/base.tsx","tonva-react/components/list/clickable.tsx","tonva-react/components/list/static.tsx","tonva-react/components/list/selectable.tsx","tonva-react/components/list/index.tsx","tonva-react/components/propGrid/row.tsx","tonva-react/components/propGrid/propView.tsx","tonva-react/components/propGrid/PropGrid.tsx","tonva-react/auth/meInfo.tsx","tonva-react/uq/tuid/idCache.ts","tonva-react/uq/tuid/tuid.ts","tonva-react/uq/build/buildTsUqFolder.ts","tonva-react/uq/build/buildUQ.ts","stockinfo/index.ts","reportWebVitals.ts","index.tsx"],"names":["left0","num","fix","undefined","r","toString","len","length","substr","LocalData","user","env","localDb","child","guest","unit","_user","_guest","_unit","this","get","set","forEach","d","remove","getObjPropIgnoreCase","obj","prop","keys","Object","toLowerCase","key","capitalCase","s","split","map","v","firstCharUppercase","join","camelCase","parts","c","charCodeAt","ACode","ZCode","String","fromCharCode","firstCharLowercase","i","aCode","zCode","logMark","netToken","userId","token","setCenterToken","WSChannel","FetchErrorView","reApi","a","props","clearError","channel","url","options","resolve","reject","refetchApi","close","errContent","error","err","push","style","wordWrap","className","type","onClick","React","SystemNotifyPage","message","header","ReloadPage","timerHandler","reload","clearInterval","nav","seconds","state","setInterval","setState","title","msg","ConfirmReloadPage","back","confirm","isMobile","RegExp","test","navigator","userAgent","logs","stackKey","notSupportedBrowsers","NavView","stack","waitCount","waitTimeHandler","upgradeUq","start","isHistoryBack","navBack","tick","Date","now","console","log","window","self","top","postMessage","confirmClose","pop","fetchError","browser","notSupportedBrowser","findIndex","wait","addEventListener","init","setTimeout","clearTimeout","unauthorized","showLogin","uq","version","show","view","disposer","clear","removeCeased","history","pushState","ceased","refresh","item","dispose","level","p","backLevel","popAndDispose","find","elWait","elError","testing","left","zIndex","name","index","visibility","position","navView","wsHost","local","navigo","navSettings","language","culture","resUrl","hashParam","centerHost","arrs","windowOnError","event","source","lineno","colno","windowOnUnhandledRejection","ev","reason","windowOnClick","windowOnMouseMove","x","y","windowOnScroll","forceDevelopment","reloadUser","curUser","id","logined","logout","navLogin","params","navLogout","showLogout","navRegister","showRegister","navForget","showForget","navPageRoutes","doneSysRoutes","sysRoutes","isWebNav","backIcon","closeIcon","pageWebNav","onChangeLogin","showPrivacyPage","privacy","getPrivacyContent","privacyPage","htmlString","content","__html","dangerouslySetInnerHTML","createLogin","login","waiting","Promise","race","serviceWorker","ready","registration","unregister","document","location","plus","webview","webView","resetAll","ok","showReloadPage","localStorage","makeObservable","observable","lang","resOptions","district","g","messageHub","dispatch","unitJsonPath","fetch","unitRes","json","res","el","getElementById","innerText","loadUnitJson","innerHTML","JSON","parse","process","Number","isDevelopment","getPredefinedUnitName","unitName","guestApi","unitFromName","unitId","settings","htmlTitle","html0","getElementsByTagName","getAttribute","oem","origin","pathname","endsWith","host","ws","resHost","resUrlFromHost","setCenterUrl","Error","setGuest","onerror","onunhandledrejection","onfocus","onselectstart","oncontextmenu","startWait","userPassword","ret","userName","password","userApi","pwd","logindUser","notLogined","endWait","Navigo","historyAPIUpdateMethod","on","navigate","navPage","queryStr","routeFromNavPage","internalOnNavRoutes","_","merge","navOns","route","absolute","alert","showPage","isUserLogin","onLogined","roles","me","icon","nick","callback","logoutApis","saveLocalUser","showAppView","internalLogined","defaultTop","loginTop","withBack","getLogin","logoutClear","showChangePassword","onError","showUpgradeUq","replace","topKey","popTo","ceaseTop","regConfirmClose","confirmBox","date","getTime","toTimeString","step","href","indexOf","text","parser","DOMParser","htmlDoc","parseFromString","elHtml","newVersion","GFunc","n","w","toFixed","isNaN","Math","round","precision","toPrecision","parseFloat","t","r2","iRate","e1","e2","e3","r3","z","divyield","pe","e","bonus","price","pow","data","funcz","day","floor","year","month","no","season","begin","end","arr","avg20","avg50","avg100","avg","calcuOne","count","endIndex","sum","caption","value","red","lastBuildTime","saveSrcTsFileIfNotExists","context","fileName","suffix","saveTsFileIfNotExists","uqTsSrcPath","saveTsFile","srcFile","tsFile","fs","existsSync","renameSync","writeFileSync","overrideTsFile","path","tsFilePath","buildTsHeader","entityName","getNameFromUq","uqMan","devPart","uqPart","config","dev","alias","devName","uqOwner","uqName","decodeGuestToken","CenterApiBase","Caller","_params","method","Page","observer","tabsView","tabsProps","TabsView","webNav","right","headerClassName","afterBack","inWebNav","pageHeaderProps","center","rph","renderPageHeader","footer","elFooter","errorInfo","onScroll","onScrollTop","onScrollBottom","children","renderHeader","renderFooter","renderValue","valueType","vStr","_cn","cn","percent1","number","numberToMarketValue","renderStockName","stock","code","$market","smallPercent","renderStockRow","order","onClickName","roe","dvRate","miRate","volumn","ttm","inc1","inc2","inc3","inc4","preInc","smoothness","stars","rows","log2","formatNumber","toLocaleString","nFormat0","minimumFractionDigits","maximumFractionDigits","nFormat1","renderGroup","IDRender","ListPage","listPageProps","renderPage","pageItems","itemClick","renderItem","renderItemContainer","bottom","render","onPageScroll","scroller","onPageScrollTop","onPageScrollBottom","items","CList","midList","selectedItem","setRes","onItemClick","renderRight","first","firstParam","page","openPage","returnCall","onRightClick","listRight","Controller","MidList","createPageItems","Mid","MidIDListBase","IDListPageItems","pageStart","pageSize","loadPageItems","_items","itemId","newItem","unshift","runInAction","assign","ListPageItems","str","internalT","label","isDev","receiveHandlerId","unregisterReceiveHandler","onDispose","onMessageReceive","onMessage","_resolve_$","topPageKey","beforeInit","getPageWebNav","afterInit","$lang","$district","l","timeZone","vp","param","open","replaceOpen","onEvent","registerReceiveHandler","beforeStart","internalStart","afterStart","onClosePage","go","yes","classNames","closePage","buttons","View","controller","isMe","vm","vCall","imageClassName","textClassName","renderUser","src","replacePage","backPage","ceasePage","popToTopPage","VPage","retOnClosePage","_onClosePage","openPageElement","replacePageElement","ln","chars","codeBackSlash","codeN","codeT","codeB","codeF","codeV","codeR","codes","codeBN","codeBT","codeBB","codeBF","codeBV","codeBR","Entity","typeId","jName","schema","ver","sys","cache","uqApi","fields","arrFields","returns","face","fieldMaps","localMap","f","loadEntitySchema","buildSchema","loadValues","setSchema","buildFieldsTuid","setJName","buildFieldTuid","buildArrFieldsTuid","stringify","fieldName","arrName","entities","fn","getTuid","an","fieldArr","tuid","result","buildFieldsParams","arrResult","pa","rowResult","field","val","buildDateTimeParam","getFullYear","getMonth","getDate","_tuid","getIdFromObj","dt","toISOString","packRow","arrData","packArr","row","ch","substring","escape","values","boxId","unpackRow","unpackArr","ch0","fLen","to","reverseNT","p0","vals","ItemEdit","edit","itemSchema","uiItem","_itemSchema","_uiItem","newValue","isChanged","internalEnd","divValue","labelHide","templet","Templet","widget","list","rules","nv","Array","isArray","verifyRule","rule","formRes","required","integer","min","max","zh","listRes","none","EntityCaller","entity","tries","_entity","loadSchema","innerRequest","xcall","innerCall","jsonResult","$uq","$modify","pullModify","xresult","retry","uqVersion","en","rebuildSchema","buildEntities","ActionCaller","QueryQueryCaller","unpackReturns","buildParams","QueryPageCaller","pageLoader","$page","PageItems","HistoryPageItems","far","near","TimeSpan","firstNear","dayValues","days","getDayArray","dv","setMinutes","getMinutes","getTimezoneOffset","span","DaySpan","WeekSpan","MonthSpan","YearSpan","_labels","setHours","toLocaleDateString","enWeek","zhWeek","firstDay","lastDay","getDay","setDate","initFromDate","setMonth","methodsWithBody","HttpChannel","hostUrl","apiToken","ui","timeout","showError","post","urlPrefix","caller","buildOptions","headers","h","encodeURI","body","innerFetch","k","innerFetchResult","buildError","ex","retErr","that","timeOutHandler","statusText","ct","then","retJson","retError","catch","startsWith","buildHeaders","CenterHttpChannel","u","isBridged","bridgeCenterApi","UqHttpChannel","HttpChannelNavUI","channelUIs","channelNoUIs","channels","logoutUqTokens","UqApi","basePath","showWaiting","buildAppUq","channelUI","uqToken","getUqToken","trim","theUser","ApiBase","UnitxApi","buildChannel","centerAppApi","CenterAppApi","unitxUq","db","urlTest","realUrl","getUrlOrTest","centerChannel","centerChannelUI","centerToken","loginedUserId","uqTokensName","uqTokenApi","un","localCache","nowTick","clone","uqParams","callCenterapi","call","appOwner","appName","uqs","decodeUserToken","account","verify","VFormView","onSubmit","setDisabled","submit","uiSchema","fieldLabelSize","formData","onButtonClick","CFormView","formUI","submitCaption","buildItemSchema","buildUISchema","ID","noField","NO","readOnly","defaultValue","uiField","isKey","fieldItem","uiButton","pickId","uiNumber","placeholder","VFormPage","renderForm","CFormPage","openVPage","VDialog","CFormDialog","FormUI","fieldCustoms","fieldCustom","idField","createPickId","proxy","fieldNames","splice","onChanged","onChanging","UqQuery","more","startField","isPaged","size","array","deep","pageCaller","request","queryCaller","query","table","Query","CIDSelect","midIDSelectList","MidIDSelectList","onChange","defaultChecked","renderSelectItem","evt","onSelectChange","currentTarget","checked","$in","IDX","CIXSelect","MidIXSelectList","IX","IDinIX","mid","cIDSelect","CIDSelectInPickId","isSelected","ALPHABET","uid","rtn","charAt","random","uqTokens","parent","subFrameStarted","subWin","setSubAppWindow","hash","hidden","hideFrameBack","initSubWin","onReceiveAppApiMessage","apiName","onAppApiReturn","action","uqTokenActions","onReceive","callCenterApiFromMessage","bridgeCenterApiReturn","at","opener","brideCenterApis","callId","from","directCall","bca","subAppWindow","postWsToSubApp","win","WsBase","wsBaseSeed","wsBaseId","WebSocket","onopen","onmessage","wsMessage","onclose","receive","netThis","connect","send","Image","altImage","alt","jwtDecode","uqDebugHost","hosts","centerhost","reshost","uqhost","unitxhost","httpArr","urlFromHost","isAbsoluteUrl","centerUrlFromHost","centerWsFromHost","https","fetchOptions","mode","tryLocal","getCenterHost","getResHost","promises","hostArr","fetchUrl","debugHostUrl","localCheck","all","results","j","hostValue","includes","debugHost","testProd","getUrlOrDebug","urlDebug","fetchLocalCheck","Scroller","scrollTo","scrollTop","offsetHeight","scrollTimeGap","ScrollViewBase","bottomTime","topTime","div","refDiv","onResize","removeEventListener","target","sh","scrollHeight","direct","Children","_$scroll","eachChild","Component","ScrollView","ref","WebNavScrollView","vHeader","vFooter","navHeader","navRawHeader","navFooter","navRawFooter","resLang","languages","toUpperCase","setResOptions","resGlobal","setGlobalRes","Action","ActionSubmitCaller","SubmitReturnsCaller","SubmitConvertCaller","pack","LMR","b","badge","color","badgeAlign","badgeVertical","cursor","FA","spin","fixWidth","border","pull","pulse","rotate","flip","inverse","IconText","iconClass","textClass","__ls","getItem","setItem","removeItem","LocalCache","removeLocal","Local","caches","locals","keyForGet","keyForSet","sk","LocalArr","LocalMap","keyForRemove","removeAll","ks","saveIndex","ls","TuidContent","tuidName","uqStringify","ReactBoxId","isUndefined","valueFromId","boxName","assureBox","tuidValue","nullUI","ttv","divObj","bi","logContent","boxIdContent","Loading","pl","search","decode","decodeURIComponent","match","exec","sUnit","tc","tt","from62","parseInt","isInteger","initEnv","detectBrowser","tag","ms","args","global","handle","documentMode","importCLogin","CLogin","importCRegister","CRegister","CForget","IDXEntity","VEdit","editHeader","cFormView","VView","midID","itemHeader","renderViewRight","V","VViewRight","onItemEdit","$zh","new","$en","CID","midIDList","valueChanged","saveID","onItemView","createFormView","onItemNew","setNO","createMidIDList","cList","createCList","IDUI","itemProps","update","renderView","MidIDList","listPageItems","MidIXIDList","ix","MidID","listHeader","_uiSchema","_props","Acts","buildGridProps","MidIXID","ActIX","SlrForEarning","slope","intercept","slopeR","endY","regress","score","xSum","ySum","xSquared","xY","numerator","ym","predict","y2","chi2","rmsd","ySquared","yi2","yi","yiyi2","sqrt","getHttpChannel","callFetch","put","delete","UQsMan","tvs","uqMans","collection","buildTVs","uqDataArr","uqConfigs","load","retErrors","setTuidImportsLocal","uqConfig","owner","uqLower","_uqs","buildUQs","uqTVs","lj","uqsData","promiseInits","uqData","uqFullName","UqMan","lower","loadEntities","uqKey","getUqKey","createProxy","Proxy","receiver","showReload","tuidArr","isImport","setInner","tuidImport","fromName","iName","setFrom","appConfig","app","loadUqs","tonvaAppName","uqsMan","UQsManApp","localData","uqAppData","loadAppUqs","buildUqs","getRoles","appUqs","CIXList","midIXList","MidIXList","MidIX","CIX","midIX","idList","CIXEdit","cIXList","onListRightClick","cSelect","idItem","ImageItemEdit","resId","onSaved","ErForEarning","A","B","yx","exp","mobileRegex","emailRegex","itemObservable","loading","beforeLoad","loaded","allLoaded","topDiv","bottomDiv","isFirst","pageItemAction","itemConverter","scrollToTop","scrollIntoView","scrollToBottom","firstSize","appendPosition","sortOrder","changing","computed","divId","getPageId","loadResults","pageList","reset","isAsc","endItem","scrollToEnd","pushItem","startId","pid","setLoaded","onLoad","setPageStart","onLoaded","reverse","digits","c0","c9","Z","NaN","handlerSeed","anyHandlers","msgHandlers","handler","seed","args0","handlerId","$type","useHash","root","_routes","_useHash","_hash","_paused","_destroyed","_lastRouteResolved","_notFoundHandler","_defaultHandler","_usePushState","_genericHooks","_historyUpdateMethod","timout","_onLocationChange","isPushStateAvailable","_cLoc","_listen","updatePageLinks","_getRoot","_historyUpdate","arg0","arg1","hooks","orderedRoutes","sort","compareUrlDepth","uses","_add","reduce","current","GETParameters","extractGETParameters","onlyURL","getOnlyURL","already","matched","manageHooks","_callLeave","isHashedRoot","m","slice","_findLinks","link","hasListenerAttached","ctrlKey","metaKey","tagName","getLinkPath","preventDefault","status","pause","destroy","as","replaceState","cLocRoot","isHashChangeAPIAvailable","cached","check","cleanUrl","querySelectorAll","lastRouteResolved","leave","names","paramNames","regexp","PARAMETER_REGEXP","full","dots","REPLACE_VARIABLE_REGEXP","WILDCARD_REGEXP","REPLACE_WILDCARD","FOLLOWED_BY_SLASH_REGEXP","MATCH_REGEXP_FLAGS","urlA","urlB","getUrlDepth","routes","replaceDynamicURLParts","clean","regExpResultToParams","filter","findMatchedRoutes","colonExp","routeExp","fallbackURL","matched0","cleanGETParam","exHooks","before","shouldRoute","after","onBack","vBack","debugLogout","role","rightView","Tab","selected","contentBuilder","notify","onShown","_content","TabCaptionComponent","tabBg","sep","selectedTab","tabArr","tabClick","tab","shown","tabs","bsCur","bsTab","tabPosition","borderColor","borderStyle","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","notifyCircle","displayNone","pageHeader","pageFooter","tabBack","display","ResUploader","fileInput","upload","buildFormData","Headers","append","onFilesChange","files","maxSize","FormData","file","multiple","formatSize","pointLength","units","shift","xlargeSize","mediumSize","ImageUploader","imgBaseSize","imageTypes","resUploader","desImgWidth","desImgHeight","desImgSize","srcImgWidth","srcImgHeight","enableUploadButton","srcImage","desImage","fileError","uploaded","onFileChange","pos","lastIndexOf","reader","FileReader","readAsDataURL","onload","setSize","compress","img","width","height","scale","canvas","createElement","ctx","getContext","anw","createAttribute","nodeValue","anh","setAttributeNode","drawImage","base64","toDataURL","blob","convertBase64UrlToBlob","showOrgImage","maxWidth","urlData","mime","bstr","atob","u8arr","Uint8Array","Blob","disabled","levelDiv","padding","fileSize","uploading","AudioUploader","audioTypes","createBoxId","enums","actions","queries","ids","idxs","ixs","sheets","books","maps","histories","pendings","tags","tuidsCache","localEntities","localModifyMax","tuids","createBoxIdFromTVs","allRoles","actionArr","queryArr","idArr","idxArr","ixArr","enumArr","sheetArr","bookArr","mapArr","historyArr","pendingArr","tagArr","apiParam","tv","prototype","retArr","retActs","ActIXSort","ActDetail","master","detail","detail2","detail3","postParam","toScalars","IDNO","IDDetailGet","IDXToString","KeyID","IX1","IXr","KeyIX","IDLog","IDSum","IDxID","ID2","IDTree","TuidsCache","centerApi","sheet","access","buildTuids","buildAccess","newTuid","allSchemas","fromType","fromObj","defer","cacheTuids","enm","UqEnum","setEntity","TuidImport","TuidInner","book","Book","Map","Tag","History","pending","Pending","Sheet","lName","idEntity","idx","newID","newIDX","newIX","newAction","newQuery","newBook","newMap","newHistory","newSheet","newPending","newTag","newEnum","buildSheet","build","mainFields","buildTuidBox","ownerField","buildTuidDivBox","modifyMax","lk","states","ops","op","discription","SaveCaller","SaveDirectCaller","flow","ActionDirectCaller","brief","unpackSheet","flows","GetSheetCaller","getArchive","unpack","SheetArchiveCaller","SheetArchivesCaller","StateSheetsCaller","PageStateItems","StateSheetCountCaller","UserSheetsCaller","MySheetsCaller","SheetCaller","resVerify","getStateSheets","queryApiName","BookQueryCaller","schemaFrom","actionSchema","querySchema","AddCaller","DelCaller","AllCaller","PageCaller","qc","QueryCaller","MapCaller","getCaller","MapAddCaller","add","MapDelCaller","MapAllCaller","MapPageCaller","MapQueryCaller","VStockInfo","input","checkLimitShow","ttmLimit","checkShowLater","openMetaView","baseItem","isLogined","headStr","head","pageContent","baseInfo","historyChart","predictInfo","predictSeasonEarning","seasonEarning","capitalEarning","cCommon","cApp","pinStock","renderStockLink","renderPinStock","renderBlockStock","market","symbol","predictData","ypredict","epre","lr2","lpre","chart1","er","chartdata1","labels","datasets","numberToPrecision","backgroundColor","showLine","pointStyle","borderWidth","pointRadius","fill","per","lr","plr","chart2","predictChartFullInfo","chart3","predictChartROE","numberToString","predictSeasonDataFull","esum","SeasonnoToYearMonth","chartdataFull","esumorg","corg","predictSeasonData","eorg","numberToFixString","percentToFixString","seasonData","capitalearning","capital","earning","VErrorsPage","errors","VStartError","CAppBase","onNavRoutes","afterBuiltUQs","resolveRoute","userFromId","userRoles","getUqUserRoles","setUqRoles","isRole","CApp","html","CBase","_cApp","getUqRoles","wn","getWebNav","CSub","_owner","ownerWNs","own","radioStyle","TagView","nameFromId","namesFromIds","renderRadio","renderCheck","wrapClassName","inputs","inputName","onInputChange","coll","_view","lines","line","ext","CUqBase","CUqSub","CUqApp","testTimesChange","debugItems","VBug","openDebugPage","VConsole","divBottom","autoScrollEnd","autoScroll","lastScrollTop","timeHandler","range","createRange","selectNode","objToHtml","createContextualFragment","appendChild","startAutoScrollToBottom","currentItem","pauseAutoScrollToBottom","arrToHtml","indent","objToString","indentVal","objToLine","CBug","home","relation","discover","debug","changePassword","aboutTheApp","pleaseLogin","backend","myAll","myBlack","VMain","cHome","cFind","cMe","VTester","click","uiItems","CTester","mul","offset","asc","currency","holding","quantity","amount","Group","No","Name","resRaw","sec","rawId","miValue","incValue","divident","pvolumn","cash","cost","EnumGroupType","setUI","BruceYuMi","$Piecewise","Market","Transaction","Account","Holding","$PiecewiseDetail","Stock","StockValue","AccountValue","Portfolio","UserBlockStock","UserAccount","UserGroup","UserAllStock","AccountHolding","GroupStock","VEditMe","onItemChanged","preValue","userSetProp","onExit","gridRows","component","bk","noUnit","VFaq","VAbout","VMe","meInfo","showEditMe","userSpan","faq","about","aboutRows","CMe","unitOwner","rootUnits","$","cRoles","CRoles","HoldingStock","holdingId","stockObj","setQuantity","costPrice","MiAccount","store","holdingStocks","loadItems","buyNewHolding","buyHolding","sellHolding","sorter","ao","bo","aMiRate","bMiRate","yumi","noneStocks","stockFromId","loadMyAll","stockId","loadStock","saveHolding","addMyAll","hs","changeCost","orgHs","holdingQuantity","bookHolding","recalc","accountValue","accountHolding","portfolio","transaction","act","setCostPrice","bookSetCost","sumMiValue","sumMarket","sumDivident","cashAct","MiAccounts","accounts","accountName","MiGroup","group","stockCount","stocks","loadGroupStocks","MiGroups","groups","miGroups","calcGroupStockCount","stocksMyAll","groupIXs","groupId","groupStock","userAllStock","addStock","removeStock","marketElements","Store","myAllColl","markets","miAccounts","stocksMyBlock","myAllCaption","myBlockCaption","shallow","buildStockValues","SearchStock","StockUsing","accountsFromIds","groupsFromIds","gs","gStockId","loadMyBlock","loadMarkets","loadGroupIXs","nGroup","inGroup","VHome","cAccount","renderAccounts","manageAccounts","VAccount","actionsElement","renderPageRight","renderHolding","showHolding","showBuy","showSell","showChangeCost","showTransactionDetail","nextSibling","scrollMode","behavior","f1String","f0String","hideActionsElement","miAccount","valueToString","holdings","holdings0","showCashIn","showCashOut","showCashAdjust","mi","containerClass","showCashInit","format","VForm","form","valueSchema","valueLabel","onCheckValue","onFormSubmit","holdingStock","renderQuantity","dec","beforeRender","onEnter","fieldLabelAlign","renderStock","VStock","VBuy","checkCash","VBuyNew","renderStockPick","createPickStockId","submitBuyNew","VBuyExist","submitBuy","VSell","onClickQuantity","formContext","setValue","submitSell","VChangeCost","submitChangeCost","VCash","VCashInit","submitCashInit","VCashIn","submitCashIn","VCashOut","submitCashOut","VCashAdjust","submitCashAdjust","VAccounts","onClickAccount","showAccount","renderAccount","VPickStock","onClickStock","onSearch","onSearchStock","CAccount","miGroup","listCaption","buildCIDUserAccount","showStock","searchStock","cashInit","cashIn","cashOut","cashAdjust","pickStock","CHome","onStockClick","newSub","StockPageItems","$order","smooth","VFind","showA","showHK","showSH","showSZ","showAll","cGroup","renderButton","renderGroups","renderMyAll","renderMyBlock","showStocksAll","renderSpec","showStocksBlock","manageGroups","cnStar","VStocksPage","searchInGroup","searchParam","research","openStock","pageStocks","renderStars","initKey","changeSmooth","VGroups","showMiGroup","VStockList","renderRowRight","CGroup","_listCaption","buildCIDUserGroup","openStocksList","setStocksList","am","bm","CFind","searchOrder","loadSmooth","$orderSwitch","VBlockStock","isMyBlock","toggleBlock","VKeepStock","VPinStock","isMyAll","setStockToGroup","removeMyAll","toggleMyAll","VStockInGroup","setGroup","buildInGroup","VStockLink","mn","rel","CCommon","addStockToGroup","removeStockFromGroup","cID","hiden","mId","cBug","cUI","timer","gapIndex","newC","CStockInfo","App","setSettings","buildFieldItem","$FieldItemType","fieldItemType","VLogout","onLogout","maxLength","VLogin","onLogin","username","sender","getSender","tonvaTop","requiredFlag","privacyEntry","VChangePassword","orgPassword","newPassword","newPassword1","setError","userLogined","vPage","getVChangePassword","logo","senders","regex","DropdownActions","menu","button","handleDocumentClick","dropdownOpen","contains","toggle","isRight","itemIconClass","itemCaptionClass","hasIcon","some","data-toggle","aria-expanded","captionClass","aria-hidden","onTouchStart","timeRes","md","ymd","yesterday","today","tomorrow","renderDate","vDate","withTime","always","nDate","_date","nowYear","hour","getHours","minute","appendTime","dPart","hm","EasyTime","SearchBox","allowEmptySearch","inputSize","inputClassName","onFocus","buttonText","userCache","loader","UserView","noneImage","getValue","idProp","useUser","use","Ax","axProps","aClassName","naClassName","openSysPage","cacheTimer","loadIds","clearCacheTimer","cacheIds","tuidCached","innerPullModify","tuidLists","queueModify","queue","modify","modifyIds","importSelect","setIDUi","noFieldItem","Rule","RuleCustom","func","defy","RulePredefined","RuleRequired","RuleNum","minMsg","maxMsg","template","checkMore","RuleInt","Widget","fieldProps","_ui","contextErrors","visible","isChanging","changeValue","container","inNode","FieldContainer","renderBody","hasError","getUiItem","buildRules","removeErrorWidget","addErrorWidget","initData","fromElement","prev","allowChange","setDataValue","setElementValue","fieldClass","FieldClass","elDiscription","discriptionClassName","uiLabel","errorList","TextWidget","inputType","hasFocus","onKeyDown","internalOnKeyDown","keyCode","blur","onBlur","checkRules","checkContextRules","clearErrors","renderTemplet","renderErrors","TextAreaWidget","PasswordWidget","UrlWidget","EmailWidget","NumberWidget","UpdownWidget","returnValue","isValidKey","DateWidget","DateTimeWidget","TimeWidget","MonthWidget","CheckBoxWidget","trueValue","falseValue","SelectWidget","select","option","RadioWidget","rowKey","isRow","RangeWidget","IdWidget","clearContextError","Unknown","dataType","uiType","dataTypes","ButtonWidget","observerRender","widgetType","ButtonClass","Context","subContexts","widgets","errorWidgets","arrRowContexts","itemName","getDisabled","getReadOnly","setReadOnly","getVisible","setVisible","buttonName","ew","checkFieldRules","rowContext","setContextError","clearWidgetsErrors","checkHasError","clearContextErrors","rowKeySeed","RowContext","parentContext","arrSchema","uiArr","itemSchemas","FormContext","ContextContainer","ArrComponent","selectable","deletable","restorable","getArrRowContexts","onDeleted","onRestored","arrLabel","ArrContainer","RowContainer","RowSeperator","formSelectable","formDeletable","formRestorable","arrSelectable","arrDeletable","arrRestorable","ac","rc","rs","rowContent","typeofTemplet","factory","selectCheck","deleteIcon","$isSelected","$source","isDeleted","$isDeleted","editContainer","Provider","ImageWidget","imageSrc","TagWidget","stringWidget","widgetFactories","string","textarea","datetime","time","email","updown","checkbox","image","checkboxes","radio","tagSingle","valuesView","renderRadios","tagMulti","defaultArr","def","renderChecks","typeWidget","getItemSchema","getTypeWidget","widgetFactory","WidgetClass","Form","Container","watch","calcSelectOrDelete","DefaultContainer","DefaultFieldContainer","labelView","cnAlign","fieldCol","DefaultFieldClass","DefaultButtonClass","DefaultRes","autorun","initDataItem","arrItem","arrItems","arrDict","arrItemOperated","formArrVal","beforeShow","renderContent","contextType","StringItemEdit","verifyValue","onSave","inputOptions","element","RadioItemEdit","SelectItemEdit","IdItemEdit","TagItemEdit","renderInputs","TagSingleItemEdit","TagMultiItemEdit","TextAreaItemEdit","CheckBoxItemEdit","RangeItemEdit","NumberItemEdit","Edit","defaultSepClassName","defaultRowContainerClassName","topBorder","bottomBorder","rowContainerClassName","rowClick","itemEdit","editInRow","stopEdit","topBorderClassName","bottomBorderClassName","sepClassName","ie","createItemEdit","divLabel","requireFlag","MidIDXList","week","midIDX","renderStringProp","renderNumberProp","spanValues","VEditNumberField","dateInput","timeInput","onValueChange","valueAsDate","dateTicks","valueAsNumber","timeTicks","saveFieldValue","vDateTime","defDate","VHistory","historyItems","spans","graphOptions","maintainAspectRatio","currentIndex","timeSpan","prevTimeSpan","nextTimeSpan","toJS","curProp","moveStep","spanStep","canNext","borderBottomStyle","borderBottomColor","onFieldHistory","sv","onFieldClick","setTimeSpan","setCurrentField","VSelect","tagGroups","midTag","typeColl","itemTags","typeArr","midType","checks","tagGroup","sub","tagId","renderType","onTagSelectChanged","CSelect","cIDTagList","defaultRenderTags","ItemTagsListPageItems","VTags","allTags","checkInputs","showID","CShowTagIDList","MidTagIDList","consts","MiApiChannel","MiApi","pbody","proc","MiNet","miApi","miHost","baseURI","rets","baseId","selectedTags","exrightForEarning","exrightInfo","_capitalearning","_bonus","_divideInfo","miNet","initLoad","q_stockallinfo","t_tagstock$query","stockTags","arr1","arr3","barr","派息","loadTTMEarning","seasonlist","minNo","seasonno","lastItem","lastShares","shares","maxNo","sItem","es","yearmonth","GetSeasonnoYearMonth","ci","si","noBegin","endDay","SeasonnoToBeginEnd","exitem","factor","dayFrom","dayIndex","bsum","pricere","factore","SeasonnoFromDay","RestorePrice","VRoles","onRoleAdmin","showRoleAdmin","onAccountant","onManager","roleItems","accountant","manager","renderRoleItem","VContent","VAddUser","newUser","VRoleAdmin","userRole","rightIcon","roleCaptions","ixOfUsers","vUser","restoreUser","deleteUser","vCap","onRoleChange","ixUserBind","VItem","VUserRoles","MeItem","meRoles","iRole","setUserRole","CRoleAdmin","myRolesChanged","roleCaptionMap","ixName","getIX","id2Name","getID","cIXEdit","getAllRoleUsers","allUserRoles","rolesBool","meId","ur","setUserRoles","fireMyRolesChanged","newRoles","roleNames","userFromKey","buildRolesText","deleteUserRoles","cRoleAdmin","getRes","ListBase","Clickable","Static","Selectable","inputItems","buildItems","itemsArray","isItemSelected","selectedItems","compare","retItems","labelId","comp","selectItem","obItem","onSelect","flex","marginBottom","htmlFor","listenArraySplice","isObservableArray","observe","change","removedCount","added","_added","checkAll","anySelected","List","listBase","buildBase","prevProps","prevState","isEqual","forceUpdate","selectAll","unselectAll","waitingMore","tabIndex","isLoading","staticRow","PropRow","PropBorder","borderTop","PropGap","valueAlignStart","valueAlignCenter","valueAlignEnd","LabeledPropRow","gridProps","_prop","col","labelFixLeft","renderLabel","renderProp","align","vAlign","alignValue","renderPropBody","renderPropContent","StringPropRow","NumberPropRow","ListPropRow","borderBottom","ComponentPropRow","PropView","buildRows","isGap","setValues","PropGrid","propView","IdCache","tuidLocal","localArr","waitingIds","tuidInner","initLocalArr","has","moveToHead","_id","useId","tuidValues","cacheIdValues","unpackTuidIds","cacheValue","cacheTuidFieldValues","loadTuidIdsOrLocal","localedValues","loadingIds","netIds","loadTuidIds","netRet","IdDivCache","divName","Tuid","noCache","typeName","idName","unique","TuidBox","id1","idValue","divs","cacheFields","idCache","tuidDiv","TuidDiv","resetCache","assureObj","IdsCaller","GetCaller","cacheFieldsInValue","arrValues","$create","$update","stampOnMain","unpackTuidIdsOfFields","SavePropCaller","searchArr","SearchCaller","LoadArrCaller","SaveArrCaller","ArrPosCaller","TuidNoCaller","TuidCaller","$id","transParams","arrParams","arrValue","buildDateParam","bid","hasDiv","loadMain","save","saveProp","loadArr","saveArr","posArr","TuidBoxDiv","buildTsUqFolder","uqsFolder","uqAlias","uqFolder","mkdirSync","tsUq","buildUQ","saveTsIndexAndRender","imports","sets","cName","tsUI","buildFields","tsFieldArr","buildFieldArr","replaceTsFileFields","tsImportFieldItemsBegin","tsImportFieldItemsEnd","replaceTsFileString","tsIndex","buildIDFields","buildIDXFields","buildIXFields","ts","buildIDFieldArr","buildIDXFieldArr","buildIXFieldArr","readFileSync","startStr","lBrace","rBrace","fieldsText","buildFieldsFromOldText","fieldItemReplaceProps","oldText","setFieldOldProp","buildFieldText","fieldStart","fieldText","eval","tsImport","appendArr","tsBuild","tsLen","uqEntityInterface","buildEnumInterface","buildTuidInterface","buildActionInterface","buildSheetInterface","buildQueryInterface","buildBookInterface","buildMapInterface","buildHistoryInterface","buildPendingInterface","buildTagInterface","buildIDInterface","buildIDXInterface","buildIDXActParamInterface","buildIXInterface","sName","buildActsInterface","uqBlock","buildTuid","buildAction","buildBook","buildQuery","buildMap","buildHistory","buildPending","buildTag","buildID","buildIDX","buildIX","buildInterface","entityCode","isInID","buildField","fieldTypeMap","sysFields","q","repeat","buildArrs","af","buildReturns","retName","schemaKeys","others","exFields","hasTrack","hasMemo","exField","track","memo","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","StrictMode"],"mappings":"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","file":"static/js/main.000668d1.chunk.js","sourcesContent":["export * from './tool';\r\nexport * from './net';\r\nexport * from './components';\r\nexport * from './auth';\r\nexport * from './uq';\r\nexport * from './app';\r\nexport * from './vm';\r\nexport * from './res';\r\nexport * from './ui';\r\n","\r\nconst zero = '00000000000000';\r\nexport function left0(num:number, fix:number) {\r\n    if (num === undefined) return '';\r\n    let r = num.toString();\r\n    let len = fix - r.length;\r\n    if (len <= 0) return r;\r\n    return zero.substr(0, len) + r;\r\n}\r\n","import { env } from './env';\r\n\r\nexport class LocalData {\r\n    user = env.localDb.child('user');\r\n    guest = env.localDb.child('guest');\r\n    unit = env.localDb.child('unit');\r\n\r\n    private _user:string;\r\n    private _guest:string;\r\n    private _unit:string;\r\n    readToMemory() {\r\n        this._user = this.user.get();\r\n        this._guest = this.guest.get();\r\n        this._unit = this.unit.get();\r\n    }\r\n    saveToLocalStorage() {\r\n        this.user.set(this._user);\r\n        this.guest.set(this._guest);\r\n        this.unit.set(this._unit);\r\n    }\r\n\r\n    logoutClear() {\r\n        [\r\n            this.user,\r\n            this.unit,\r\n        ].forEach(d => d.remove());\r\n    }\r\n}\r\n","export function getObjPropIgnoreCase(obj:any, prop:string):any {\r\n\tif (!obj) return;\r\n\tif (!prop) return;\r\n\tlet keys = Object.keys(obj);\r\n\tprop = prop.toLowerCase();\r\n\tfor (let key of keys) {\r\n\t\tif (key.toLowerCase() === prop) return obj[key];\r\n\t}\r\n\treturn;\r\n}\r\n","export function capitalCase(s:string):string {\r\n\tlet parts = s.split(/[-._]/);\r\n\treturn parts.map(v => firstCharUppercase(v)).join('');\r\n}\r\n\r\nexport function camelCase(s:string):string {\r\n\tlet parts = s.split(/[-._]/);\r\n\tlet len = parts.length;\r\n\tparts[0] = firstCharLowercase(parts[0]);\r\n\tfor (let i=1; i<len; i++) {\r\n\t\tparts[1] = firstCharUppercase(parts[1]);\r\n\t}\r\n\treturn parts.join('');\r\n}\r\n\r\nconst aCode = 'a'.charCodeAt(0);\r\nconst zCode = 'z'.charCodeAt(0);\r\nfunction firstCharUppercase(s:string) {\r\n\tif (!s) return '';\r\n\tlet c = s.charCodeAt(0);\r\n\tif (c >= aCode && c <= zCode) {\r\n\t\treturn String.fromCharCode(c - 0x20) + s.substr(1);\r\n\t}\r\n\treturn s;\r\n}\r\nconst ACode = 'A'.charCodeAt(0);\r\nconst ZCode = 'Z'.charCodeAt(0);\r\nfunction firstCharLowercase(s:string) {\r\n\tif (!s) return '';\r\n\tlet c = s.charCodeAt(0);\r\n\tif (c >= ACode && c <= ZCode) {\r\n\t\treturn String.fromCharCode(c + 0x20) + s.substr(1);\r\n\t}\r\n\treturn s;\r\n}\r\n","export * from './navigo';\r\nexport * from './nav';\r\nexport * from './page';\r\nexport * from './schema';\r\nexport * from './form';\r\nexport * from './edit';\r\nexport * from './loading';\r\nexport * from './image';\r\nexport * from './resUploader';\r\nexport * from '../tool/rules';\r\nexport * from './list';\r\nexport * from './dropDownActions';\r\nexport * from './easyDate';\r\nexport * from './propGrid';\r\nexport * from './simple';\r\nexport * from './media';\r\nexport * from './searchBox';\r\nexport * from './userIcon';\r\nexport * from './ax';\r\nexport * from './autoHideTips';\r\nexport * from './login';","import * as React from 'react';\r\nimport {makeObservable, observable} from 'mobx';\r\nimport _ from 'lodash';\r\nimport {User, Guest/*, UserInNav*/} from '../tool/user';\r\nimport {Page} from './page/page';\r\nimport {netToken} from '../net/netToken';\r\nimport FetchErrorView, { SystemNotifyPage } from './fetchErrorView';\r\nimport {FetchError} from '../net/fetchError';\r\nimport {LocalData, env} from '../tool';\r\nimport {guestApi, logoutApis, setCenterUrl, setCenterToken, host, resUrlFromHost, messageHub} from '../net';\r\nimport { resOptions } from '../res/res';\r\nimport { Loading } from './loading';\r\nimport { Navigo, RouteFunc, Hooks, NamedRoute } from './navigo';\r\n\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport '../css/va-form.css';\r\nimport '../css/va.css';\r\nimport '../css/animation.css';\r\nimport { FA } from './simple';\r\nimport { userApi } from '../net';\r\nimport { ReloadPage, ConfirmReloadPage } from './reloadPage';\r\nimport { PageWebNav } from './page';\r\nimport { createLogin, Login, showForget, showRegister } from './login';\r\n//import { createLogin } from '../auth/createLogin';\r\n\r\nconst regEx = new RegExp('Android|webOS|iPhone|iPad|' +\r\n    'BlackBerry|Windows Phone|'  +\r\n    'Opera Mini|IEMobile|Mobile' , \r\n    'i');\r\nconst isMobile = regEx.test(navigator.userAgent);\r\n\r\nlet logMark: number;\r\nconst logs:string[] = [];\r\nexport type NavPage = (params:any) => Promise<void>;\r\n\r\nexport interface Props\r\n{\r\n    onLogined: (isUserLogin?:boolean)=>Promise<void>;\r\n    notLogined?: ()=>Promise<void>;\r\n\tuserPassword?: () => Promise<{user:string; password:string}>;\r\n};\r\nlet stackKey = 1;\r\nexport interface StackItem {\r\n    key: number;\r\n    view: JSX.Element;\r\n    ceased: boolean;\r\n    confirmClose?: ()=>Promise<boolean>;\r\n    disposer?: ()=>void;\r\n}\r\nexport interface NavViewState {\r\n\tnotSupportedBrowser: boolean;\r\n    stack: StackItem[];\r\n    wait: 0|1|2;\r\n    fetchError: FetchError\r\n}\r\n\r\nconst notSupportedBrowsers = ['IE'];\r\n\r\nexport class NavView extends React.Component<Props, NavViewState> {\r\n    private stack: StackItem[];\r\n    private waitCount: number = 0;\r\n    private waitTimeHandler?: NodeJS.Timer;\r\n\r\n    constructor(props:Props) {\r\n        super(props);\r\n        this.stack = [];\r\n\t\tlet {browser} = env;\r\n\t\tlet notSupportedBrowser = notSupportedBrowsers.findIndex(v => v === browser) >= 0;\r\n        this.state = {\r\n\t\t\tnotSupportedBrowser,\r\n            stack: this.stack,\r\n            wait: 0,\r\n            fetchError: undefined\r\n        };\r\n        nav.set(this);\r\n    }\r\n    async componentDidMount()\r\n    {\r\n\t\tif (this.state.notSupportedBrowser === true) return;\r\n\t\twindow.addEventListener('popstate', this.navBack);\r\n\t\tawait nav.init();\r\n        await nav.start();\r\n    }\r\n\r\n    get level(): number {\r\n        return this.stack.length;\r\n    }\r\n\r\n    startWait() {\r\n        if (this.waitCount === 0) {\r\n            this.setState({wait: 1});\r\n            this.waitTimeHandler = env.setTimeout(\r\n                'NavView.startWait',\r\n                () => {\r\n                    this.waitTimeHandler = undefined;\r\n                    this.setState({wait: 2});\r\n                },\r\n                1000) as NodeJS.Timer;\r\n        }\r\n        ++this.waitCount;\r\n        this.setState({\r\n            fetchError: undefined,\r\n        });\r\n    }\r\n\r\n    endWait() {\r\n        env.setTimeout(\r\n            undefined, //'NavView.endWait',\r\n            () => {\r\n            /*\r\n            this.setState({\r\n                fetchError: undefined,\r\n            });*/\r\n            --this.waitCount;\r\n            if (this.waitCount === 0) {\r\n                if (this.waitTimeHandler !== undefined) {\r\n                    env.clearTimeout(this.waitTimeHandler);\r\n                    this.waitTimeHandler = undefined;\r\n                }\r\n                this.setState({wait: 0});\r\n            }\r\n        },100);\r\n    }\r\n\r\n    async onError(fetchError: FetchError)\r\n    {\r\n        let err = fetchError.error;\r\n        if (err !== undefined) {\r\n            if (err.unauthorized === true) {\r\n\t\t\t\tawait nav.showLogin(undefined);\r\n\t\t\t\t//nav.navigateToLogin();\r\n                return;\r\n            }\r\n            switch (err.type) {\r\n                case 'unauthorized':\r\n                    await nav.showLogin(undefined);\r\n\t\t\t\t\t//nav.navigateToLogin();\r\n                    return;\r\n                case 'sheet-processing':\r\n                    nav.push(<SystemNotifyPage message=\"单据正在处理中。请重新操作！\" />);\r\n                    return;\r\n            }\r\n        }\r\n        this.setState({\r\n            fetchError,\r\n        });\r\n    }\r\n\r\n    private upgradeUq = () => {\r\n        nav.start();\r\n    }\r\n\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        this.show(<Page header={false}>\r\n            <div>\r\n                UQ升级了，请点击按钮升级 <br />\r\n                <small className=\"text-muted\">{uq} ver-{version}</small>\r\n                <button className=\"btn btn-primary\" onClick={this.upgradeUq}>升级</button>\r\n            </div>\r\n        </Page>)\r\n    }\r\n\r\n    show(view: JSX.Element, disposer?: ()=>void): number {\r\n        this.clear();\r\n        return this.push(view, disposer);\r\n    }\r\n\r\n    push(view: JSX.Element, disposer?: ()=>void): number {\r\n        this.removeCeased();\r\n        if (this.stack.length > 0) {\r\n            window.history.pushState('forward', null, null);\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key,\r\n            view: view, \r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        this.refresh();\r\n        //console.log('push: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    replace(view: JSX.Element, disposer?: ()=>void): number {\r\n        let item:StackItem = undefined;\r\n        let stack = this.stack;\r\n        if (stack.length > 0) {\r\n            item = stack.pop();\r\n            //this.popAndDispose();\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key, \r\n            view: view, \r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        if (item !== undefined) this.dispose(item.disposer);\r\n        this.refresh();\r\n        //console.log('replace: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    ceaseTop(level:number = 1) {\r\n        let p = this.stack.length - 1;\r\n        for (let i=0; i<level; i++, p--) {\r\n            if (p < 0) break;\r\n            let item = this.stack[p];\r\n            item.ceased = true;\r\n        }\r\n    }\r\n\r\n    pop(level:number = 1) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        //console.log('pop start: %s pages level=%s', len, level);\r\n        if (level <= 0 || len <= 1) return;\r\n        if (len < level) level = len;\r\n        let backLevel = 0;\r\n        for (let i = 0; i < level; i++) {\r\n            if (stack.length === 0) break;\r\n            //stack.pop();\r\n            this.popAndDispose();\r\n            ++backLevel;\r\n        }\r\n        if (backLevel >= len) backLevel--;\r\n        this.refresh();\r\n        if (this.isHistoryBack !== true) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(backLevel);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n        //console.log('pop: %s pages', stack.length);\r\n    }\r\n\r\n    popTo(key: number) {\r\n        if (key === undefined) return;\r\n        if (this.stack.find(v => v.key === key) === undefined) return;\r\n        while (this.stack.length >0) {\r\n            let len = this.stack.length;\r\n            let top = this.stack[len-1];\r\n            if (top.key === key) break;\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    topKey():number {\r\n        let len = this.stack.length;\r\n        if (len === 0) return undefined;\r\n        return this.stack[len-1].key;\r\n    }\r\n\r\n    removeCeased() {\r\n        for (;;) {\r\n            let p=this.stack.length-1;\r\n            if (p < 0) break;\r\n            let top = this.stack[p];\r\n            if (top.ceased === false) break;\r\n            let item = this.stack.pop();\r\n            let {disposer} = item;\r\n            this.dispose(disposer);\r\n        }\r\n        this.refresh();\r\n    }\r\n\r\n    private popAndDispose() {\r\n        this.removeCeased();\r\n        let item = this.stack.pop();\r\n\t\tif (item === undefined) return;\r\n\t\t//if (nav.isRouting) {\r\n\t\t//\twindow.history.back();\r\n\t\t//}\r\n        let {disposer} = item;\r\n        this.dispose(disposer);\r\n        this.removeCeased();\r\n        return item;\r\n    }\r\n\r\n    private dispose(disposer:()=>void) {\r\n        if (disposer === undefined) return;\r\n        let item = this.stack.find(v => v.disposer === disposer);\r\n        if (item === undefined) disposer();\r\n    }\r\n\r\n    clear() {\r\n        let len = this.stack.length;\r\n        while (this.stack.length > 0) this.popAndDispose();\r\n        //this.refresh();\r\n        if (len > 1) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(len-1);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n    }\r\n\r\n    regConfirmClose(confirmClose:()=>Promise<boolean>) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        let top = stack[len-1];\r\n        top.confirmClose = confirmClose;\r\n    }\r\n\r\n    private isHistoryBack:boolean = false;\r\n    navBack = () => {\r\n        //nav.log('backbutton pressed - nav level: ' + this.stack.length);\r\n        let tick = Date.now();\r\n        this.isHistoryBack = true;\r\n        this.back(true);\r\n        this.isHistoryBack = false;\r\n        console.log(`///\\\\\\\\ ${Date.now()-tick}ms backbutton pressed - nav level: ${this.stack.length}`);\r\n    }\r\n\r\n    back = async (confirm:boolean = true) => {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        if (len === 1) {\r\n            if (window.self !== window.top) {\r\n                window.top.postMessage({type:'pop-app'}, '*');\r\n            }\r\n            return;\r\n        }\r\n        let top = stack[len-1];\r\n        if (confirm===true && top.confirmClose) {\r\n            if (await top.confirmClose()===true) this.pop();\r\n        }\r\n        else {\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    confirmBox(message?:string): boolean {\r\n        return window.confirm(message);\r\n    }\r\n    clearError = () => {\r\n        this.setState({fetchError: undefined});\r\n    }\r\n    render() {\r\n        const {notSupportedBrowser, wait, fetchError} = this.state;\r\n\t\tif (notSupportedBrowser === true) {\r\n\t\t\treturn <div className=\"p-3 text-danger\">\r\n\t\t\t\t{env.browser} not supported !\r\n\t\t\t</div>;\r\n\t\t}\r\n        let {stack} = this.state;\r\n        let top = stack.length - 1;\r\n        let elWait = null, elError = null;\r\n        switch (wait) {\r\n            case 1:\r\n                elWait = <div className=\"va-wait va-wait1\">\r\n                </div>;\r\n                break;\r\n            case 2:\r\n                elWait = <div className=\"va-wait va-wait2\">\r\n                    <Loading />\r\n                </div>;\r\n                break;\r\n        }\r\n        if (fetchError) {\r\n            elError = <FetchErrorView clearError={this.clearError} {...fetchError} />;\r\n\t\t\t++top;\r\n\t\t}\r\n        let test = nav.testing===true && \r\n\t\t\t<span className=\"cursor-pointer position-fixed\" style={{top:0,left:'0.2rem',zIndex:90001}}>\r\n                <FA className=\"text-warning\" name=\"info-circle\" />\r\n\t\t\t</span>;\r\n        return <>\r\n\t\t\t{stack.map((item, index) => {\r\n\t\t\t\tlet {key, view} = item;\r\n\t\t\t\treturn <div key={key} style={index<top? {visibility: 'hidden', position: 'absolute'}:undefined}>\r\n\t\t\t\t\t{view}\r\n\t\t\t\t</div>\r\n\t\t\t})}\r\n\t\t\t{elWait}\r\n\t\t\t{elError}\r\n\t\t\t{test}\r\n\t\t</>;\r\n    }\r\n\r\n    private refresh() {\r\n        this.setState({stack: this.stack });\r\n    }\r\n}\r\n\r\nexport interface NavSettings {\r\n    oem?: string;\r\n    loginTop?: JSX.Element;\r\n    privacy?: string;\r\n\thtmlTitle?: string;\r\n}\r\n\r\nexport class Nav {\r\n    private navView:NavView;\r\n\tprivate wsHost: string;\r\n    private local: LocalData = new LocalData();\r\n\tprivate navigo: Navigo;\r\n\tnavSettings: NavSettings;\r\n    user: User = null;\r\n    testing: boolean;\r\n    language: string;\r\n    culture: string;\r\n    resUrl: string;\r\n\r\n    constructor() {\r\n\t\tmakeObservable(this, {\r\n\t\t\tuser: observable,\r\n\t\t});\r\n        let {lang, district} = resOptions;\r\n        this.language = lang;\r\n        this.culture = district;\r\n\t\tthis.testing = false;\r\n    }\r\n\r\n    get guest(): number {\r\n        let guest = this.local.guest;\r\n        if (guest === undefined) return 0;\r\n        let g = guest.get();\r\n        if (g === undefined) return 0;\r\n        return g.guest;\r\n    }\r\n\r\n    set(navView:NavView) {\r\n        //this.logo = logo;\r\n        this.navView = navView;\r\n\t}\r\n\t/*\r\n    registerReceiveHandler(handler: (message:any)=>Promise<void>):number {\r\n        //if (this.ws === undefined) return;\r\n        return messageHub.onReceiveAny(handler);\r\n    }\r\n\r\n    unregisterReceiveHandler(handlerId:number) {\r\n        //if (this.ws === undefined) return;\r\n        if (handlerId === undefined) return;\r\n        messageHub.endReceive(handlerId);\r\n    }\r\n\t*/\r\n    async onReceive(msg:any) {\r\n        //if (this.ws === undefined) return;\r\n        await messageHub.dispatch(msg);\r\n    }\r\n\r\n\tprivate async loadUnitJson() {\r\n\t\ttry {\r\n\t\t\tlet unitJsonPath = this.unitJsonPath();\r\n\t\t\tlet unitRes = await fetch(unitJsonPath, {});\r\n\t\t\tlet res = await unitRes.json();\r\n\t\t\treturn res.unit;\r\n\t\t}\r\n\t\tcatch (err1) {\r\n\t\t\tthis.local.unit.remove();\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n    private async getPredefinedUnitName() {\t\t\r\n\t\tlet el = document.getElementById('unit');\r\n\t\tif (el) {\r\n\t\t\treturn el.innerText;\r\n\t\t}\r\n\t\tel = document.getElementById('unit.json');\r\n\t\tif (!el) {\r\n\t\t\treturn await this.loadUnitJson();\r\n\t\t}\r\n\t\ttry {\r\n            let json = el.innerHTML;\r\n            let res = JSON.parse(json);\r\n            return res.unit;\r\n        }\r\n        catch (err) {\r\n\t\t\treturn await this.loadUnitJson();\r\n        }\r\n    }\r\n\r\n    private async loadPredefinedUnit() {\r\n        let envUnit = process.env.REACT_APP_UNIT;\r\n        if (envUnit !== undefined) {\r\n            return Number(envUnit);\r\n        }\r\n        let unitName:string;\r\n        let unit = this.local.unit.get();\r\n        if (unit !== undefined) {\r\n            if (env.isDevelopment !== true) return unit.id;\r\n            unitName = await this.getPredefinedUnitName();\r\n            if (unitName === undefined) return;\r\n            if (unit.name === unitName) return unit.id;\r\n        }\r\n        else {\r\n            unitName = await this.getPredefinedUnitName();\r\n            if (unitName === undefined) return;\r\n        }\r\n        let unitId = await guestApi.unitFromName(unitName);\r\n        if (unitId !== undefined) {\r\n            this.local.unit.set({id: unitId, name: unitName});\r\n        }\r\n        return unitId;\r\n    }\r\n\r\n    setSettings(settings?: NavSettings) {\r\n        this.navSettings = settings;\r\n\t\tlet {htmlTitle} = settings;\r\n\t\tif (htmlTitle) {\r\n\t\t\tdocument.title = htmlTitle;\r\n\t\t}\r\n\t\tlet html = document.getElementsByTagName('html');\r\n\t\tlet html0 = html[0];\r\n\t\tif (html0) {\r\n\t\t\tlet version = html0?.getAttribute('data-version');\r\n\t\t\tif (version) {\r\n\t\t\t\t//appConfig.version = version;\r\n\t\t\t}\r\n\t\t}\t\t\r\n\t}\r\n\r\n    get oem():string {\r\n        return this.navSettings && this.navSettings.oem;\r\n    }\r\n\r\n    hashParam: string;\r\n    private centerHost: string;\r\n    private arrs = ['/test', '/test/'];\r\n    private unitJsonPath():string {\r\n        let {origin, pathname} = document.location;\r\n\t\tpathname = pathname.toLowerCase();\r\n        for (let item of this.arrs) {\r\n            if (pathname.endsWith(item) === true) {\r\n                pathname = pathname.substr(0, pathname.length - item.length);\r\n                break;\r\n            }\r\n        }\r\n        if (pathname.endsWith('/') === true || pathname.endsWith('\\\\') === true) {\r\n            pathname = pathname.substr(0, pathname.length-1);\r\n        }\r\n        return origin + pathname + '/unit.json';\r\n    }\r\n    private windowOnError = (event: Event | string, source?: string, lineno?: number, colno?: number, error?: Error) => {\r\n\t\tdebugger;\r\n        console.error('windowOnError');\r\n        console.error(error);\r\n    }\r\n    private windowOnUnhandledRejection = (ev: PromiseRejectionEvent) => {\r\n\t\tdebugger;\r\n        console.error('windowOnUnhandledRejection');\r\n        console.error(ev.reason);\r\n    }\r\n    private windowOnClick = (ev: MouseEvent) => {\r\n        console.error('windowOnClick');\r\n    }\r\n    private windowOnMouseMove = (ev: MouseEvent) => {\r\n        console.log('navigator.userAgent: ' + navigator.userAgent);\r\n        console.log('mouse move (%s, %s)', ev.x, ev.y);\r\n    }\r\n    private windowOnScroll = (ev: Event) => {\r\n        console.log('scroll event');\r\n\t}\r\n\r\n\tforceDevelopment:boolean;\r\n\t\r\n\tasync init() {\r\n\t\tthis.testing = env.testing;\r\n\t\tif (this.forceDevelopment === true) {\r\n\t\t\tenv.isDevelopment = true;\r\n\t\t}\r\n\t\tawait host.start(this.testing);\r\n\t\t/*\r\n\t\tlet hash = document.location.hash;\r\n\t\tif (hash !== undefined && hash.length > 0) {\r\n\t\t\tlet pos = getExHashPos();\r\n\t\t\tif (pos < 0) pos = undefined;\r\n\t\t\tthis.hashParam = hash.substring(1, pos);\r\n\t\t}\r\n\t\t*/\r\n\t\tlet {url, ws, resHost} = host;\r\n\t\tthis.centerHost = url;\r\n\t\tthis.resUrl = resUrlFromHost( resHost);\r\n\t\tthis.wsHost = ws;\r\n\t\tsetCenterUrl(url);\r\n\r\n\t\tlet guest:Guest = this.local.guest.get();\r\n\t\tif (guest === undefined) {\r\n\t\t\tguest = await guestApi.guest();\r\n\t\t}\r\n\t\tif (!guest) {\r\n\t\t\tdebugger;\r\n\t\t\tthrow Error('guest can not be undefined');\r\n\t\t}\r\n\t\tnav.setGuest(guest);\r\n\t}\r\n\r\n\treloadUser = () => {\r\n\t\tlet user: User = this.local.user.get();\r\n\t\tlet curUser = nav.user;\r\n\t\tif (user === undefined && curUser === undefined) return;\r\n\t\tif (user && curUser && user.id === curUser.id) return;\r\n\t\tif (!user) nav.logout();\r\n\t\telse nav.logined(user)\r\n\t}\r\n\r\n    async start() {\r\n        try {\r\n\t\t\twindow.onerror = this.windowOnError;\r\n            window.onunhandledrejection = this.windowOnUnhandledRejection;\r\n\t\t\twindow.onfocus = this.reloadUser;\r\n            if (isMobile === true) {\r\n                document.onselectstart = function() {return false;}\r\n                document.oncontextmenu = function() {return false;}\r\n            }\r\n            //window.setInterval(()=>console.error('tick every 5 seconds'), 5000);\r\n\t\t\tnav.clear();\r\n\t\t\t//nav.onSysNavRoutes();\r\n\t\t\tthis.startWait();\r\n            \r\n            let user: User = this.local.user.get();\r\n            if (user === undefined) {\r\n                let {userPassword} = this.navView.props;\r\n\t\t\t\tif (userPassword) {\r\n\t\t\t\t\tlet ret = await userPassword();\r\n\t\t\t\t\tif (ret) {\r\n\t\t\t\t\t\tlet {user:userName, password} = ret;\r\n\t\t\t\t\t\tlet logindUser = await userApi.login({\r\n\t\t\t\t\t\t\tuser: userName,\r\n\t\t\t\t\t\t\tpwd: password,\r\n\t\t\t\t\t\t\tguest: nav.guest,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tuser = logindUser;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (user === undefined) {\r\n\t\t\t\t\tlet {notLogined} = this.navView.props;\r\n\t\t\t\t\tif (notLogined !== undefined) {\r\n\t\t\t\t\t\tawait notLogined();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tawait nav.showLogin(undefined);\r\n\t\t\t\t\t\t//nav.navigateToLogin();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n            }\r\n\r\n            await nav.logined(user);\r\n        }\r\n        catch (err) {\r\n\t\t\tconsole.error(err);\r\n\t\t\tdebugger;\r\n        }\r\n        finally {\r\n            this.endWait();\r\n        }\r\n\t}\r\n\r\n\tresolveRoute() {\r\n\t\t//if (this.isRouting === false) return;\r\n\t\tif (this.navigo === undefined) return;\r\n\t\tthis.navigo.resolve();\r\n\t}\r\n\r\n\ton(routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(url:string, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(regex:RegExp, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(options: {[url:string]: RouteFunc|NamedRoute}):Navigo;\r\n\ton(...args:any[]):Navigo {\r\n\t\tif (this.navigo === undefined) {\r\n\t\t\tthis.navigo = new Navigo();\r\n\t\t\tif (this.isWebNav !== true) this.navigo.historyAPIUpdateMethod('replaceState');\r\n\t\t}\r\n\t\treturn this.navigo.on(args[0], args[1], args[2]);\r\n\t}\r\n\r\n\tprivate navLogin:NavPage = async (params:any) => {\r\n\t\tnav.showLogin(async (user: User) => window.history.back(), false);\r\n\t}\r\n\r\n\tprivate navLogout:NavPage = async (params:any) => {\r\n\t\tnav.showLogout(async () => window.history.back());\r\n\t}\r\n\r\n\tprivate navRegister:NavPage = async (params:any) => {\r\n\t\tnav.showRegister();\r\n\t}\r\n\r\n\tprivate navForget:NavPage = async (params:any) => {\r\n\t\tnav.showForget();\r\n\t}\r\n\r\n\tnavigateToLogin() {\r\n\t\tnav.navigate('/login');\r\n\t}\r\n\r\n\topenSysPage(url: string):boolean {\r\n\t\tlet navPage: NavPage = this.sysRoutes[url];\r\n\t\tif (navPage === undefined) {\r\n\t\t\t//alert(url + ' is not defined in sysRoutes');\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tnavPage(undefined);\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprivate navPageRoutes: {[url:string]: NavPage};\r\n\tprivate routeFromNavPage(navPage: NavPage) {\r\n\t\treturn (params: any, queryStr: any) => {\r\n\t\t\tif (navPage) {\r\n\t\t\t\tif (this.isWebNav) nav.clear();\r\n\t\t\t\tnavPage(params);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tonNavRoute(navPage: NavPage) {\r\n\t\tthis.on(this.routeFromNavPage(navPage));\r\n\t}\r\n\tprivate doneSysRoutes:boolean = false;\r\n\tprivate sysRoutes: { [route: string]: NavPage } = {\r\n\t\t'/login': this.navLogin,\r\n\t\t'/logout': this.navLogout,\r\n\t\t'/register': this.navRegister,\r\n\t\t'/forget': this.navForget,\r\n\t}\r\n\t/*\r\n\tonSysNavRoutes() {\r\n\t\tthis.onNavRoutes(this.sysRoutes);\r\n\t}\r\n\t*/\r\n\tonNavRoutes(navPageRoutes: {[url:string]: NavPage}) {\r\n\t\tif (this.doneSysRoutes === false) {\r\n\t\t\tthis.doneSysRoutes = true;\r\n\t\t\tthis.internalOnNavRoutes(this.sysRoutes);\r\n\t\t}\r\n\t\tthis.internalOnNavRoutes(navPageRoutes);\r\n\t}\r\n\r\n\tprivate internalOnNavRoutes(navPageRoutes: {[url:string]: NavPage}) {\r\n\t\tif (!navPageRoutes) return;\r\n\t\tthis.navPageRoutes = _.merge(this.navPageRoutes, navPageRoutes);\r\n\t\tlet navOns: { [route: string]: (params: any, queryStr: any) => void } = {};\r\n\t\tfor (let route in navPageRoutes) {\r\n\t\t\tlet navPage = navPageRoutes[route];\r\n\t\t\tnavOns[route] = this.routeFromNavPage(navPage);\r\n\t\t}\r\n\t\tthis.on(navOns);\r\n\t}\r\n\r\n\t/*\r\n\tget isWebNav():boolean { \r\n\t\tif (!this.navigo) return false;\r\n\t\treturn !isMobile;\r\n\t}\r\n\t*/\r\n\tisWebNav:boolean = false;\r\n\tbackIcon = <i className=\"fa fa-angle-left\" />;\r\n\tcloseIcon = <i className=\"fa fa-close\" />;\r\n\tsetIsWebNav() {\r\n\t\tthis.isWebNav = true;\r\n\t\tthis.backIcon = <i className=\"fa fa-arrow-left\" />;\r\n\t\tthis.closeIcon = <i className=\"fa fa-close\" />;\r\n\t}\r\n\r\n\tpageWebNav: PageWebNav;\r\n\r\n\tget isMobile():boolean {return isMobile;}\r\n\r\n\tnavigate(url:string, absolute?:boolean) {\r\n\t\tif (!this.navigo) {\r\n\t\t\talert('Is not in webnav state, cannot navigate to url \"' + url + '\"');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.testing === true) {\r\n\t\t\turl += '#test';\r\n\t\t}\r\n\t\treturn this.navigo.navigate(url, absolute);\r\n\t}\r\n\r\n\tgo(showPage:()=>void, url:string, absolute?:boolean) {\r\n\t\tif (this.navigo !== undefined) {\r\n\t\t\tthis.navigate(url, absolute);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tshowPage();\r\n\t\t}\r\n\t}\r\n\r\n    async showAppView(isUserLogin?: boolean) {\r\n        let {onLogined} = this.navView.props;\r\n        if (onLogined === undefined) {\r\n            nav.push(<div>NavView has no prop onLogined</div>);\r\n            return;\r\n        }\r\n        nav.clear();\r\n        await onLogined(isUserLogin);\r\n    }\r\n\r\n    setGuest(guest: Guest) {\r\n        this.local.guest.set(guest);\r\n        netToken.set(0, guest.token);\r\n    }\r\n\r\n    saveLocalUser() {\r\n        this.local.user.set(this.user);\r\n    }\r\n\r\n\tsetUqRoles(uq:string, roles:string[]) {\r\n\t\tlet {roles:userRoles} = this.user;\r\n\t\tif (!userRoles) {\r\n\t\t\tthis.user.roles = {};\r\n\t\t}\r\n\t\tthis.user.roles[uq] = roles;\r\n\t\tthis.local.user.set(this.user);\r\n\t}\r\n\r\n    async loadMe() {\r\n        let me = await userApi.me();\r\n        this.user.icon = me.icon;\r\n        this.user.nick = me.nick;\r\n    }\r\n\r\n\tprivate async internalLogined(user: User, callback: (user:User)=>Promise<void>, isUserLogin:boolean) {\r\n        logoutApis();\r\n        this.user = user;\r\n        this.saveLocalUser();\r\n\t\tnetToken.set(user.id, user.token);\r\n\t\tnav.clear();\r\n\r\n        if (callback !== undefined) //this.loginCallbacks.has)\r\n            callback(user);\r\n            //this.loginCallbacks.call(user);\r\n        else if (this.isWebNav === true) {\r\n\t\t\tthis.navigate('/index');\r\n\t\t}\r\n\t\telse {\r\n            await this.showAppView(isUserLogin);\r\n        }\r\n\t\tawait this.onChangeLogin?.(this.user);\r\n\t}\r\n\r\n\tonChangeLogin: (user:User) => Promise<void>;\r\n\r\n\t// 缓冲登录\r\n    async logined(user: User, callback?: (user:User)=>Promise<void>) {\r\n\t\tawait this.internalLogined(user, callback, false);\r\n    }\r\n\r\n\t// 用户操作之后登录\r\n    async userLogined(user: User, callback?: (user:User)=>Promise<void>) {\r\n\t\tawait this.internalLogined(user, callback, true);\r\n    }\r\n\r\n    //wsConnect() {\r\n        //let ws:WSChannel = this.ws = new WSChannel(this.wsHost, this.user.token);\r\n        //ws.connect();\r\n    //}\r\n\r\n    loginTop(defaultTop:JSX.Element) {\r\n        return (this.navSettings && this.navSettings.loginTop) || defaultTop;\r\n    }\r\n\r\n    privacyEntry() {\r\n        if (!this.getPrivacyContent()) return;\r\n        return <div className=\"text-center\">\r\n            <button className=\"btn btn-sm btn-link\"\r\n                onClick={this.showPrivacyPage}>\r\n                <small className=\"text-muted\">隐私政策</small>\r\n            </button>\r\n        </div>;\r\n    }\r\n\r\n    private getPrivacyContent():string {\r\n        if (!this.navSettings) return;\r\n        let {privacy} = this.navSettings;\r\n        return privacy;\r\n    }\r\n\r\n    showPrivacyPage = () => {\r\n        let privacy = this.getPrivacyContent();\r\n        if (privacy) {\r\n            this.privacyPage(privacy);\r\n        }\r\n        else {\r\n            nav.push(<Page header=\"隐私政策\">\r\n                <div className=\"p-3\">AppConfig 中没有定义 privacy。可以定义为字符串，或者url。markdown格式</div>\r\n            </Page>);\r\n        }\r\n    }\r\n\r\n    private privacyPage = async (htmlString: string) => {\r\n        //let html = await this.getPrivacy(privacy);\r\n\t\t//let content = {__html: marked(html)};\r\n\t\tlet content = {__html: htmlString};\r\n        nav.push(<Page header=\"隐私政策\">\r\n            <div className=\"p-3\" dangerouslySetInnerHTML={content} />\r\n        </Page>);\r\n    }\r\n\r\n\tprivate createLogin = createLogin;\r\n\tsetCreateLogin(createLogin: ()=>Promise<Login>) {\r\n\t\tthis.createLogin = createLogin;\r\n\t}\r\n\r\n\tprivate login: Login;\r\n\tprivate async getLogin():Promise<Login> {\r\n\t\tif (this.login) return this.login;\r\n\t\treturn this.login = await this.createLogin();\r\n\t}\r\n\tasync showLogin(callback?: (user:User)=>Promise<void>, withBack?:boolean) {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showLogin(callback, withBack);\r\n    }\r\n\r\n    async showLogout(callback?: ()=>Promise<void>) {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showLogout(callback);\r\n\t}\r\n\t\r\n\tasync showRegister() {\r\n\t\tshowRegister();\r\n\t}\r\n\r\n\tasync showForget() {\r\n\t\tshowForget();\r\n\t}\r\n\r\n    async logout(callback?:()=>Promise<void>) { //notShowLogin?:boolean) {\r\n        //appInFrame.unit = undefined;\r\n        this.local.logoutClear();\r\n        this.user = undefined; //{} as User;\r\n        logoutApis();\r\n        let guest = this.local.guest.get();\r\n        setCenterToken(0, guest && guest.token);\r\n\t\t//this.ws = undefined;\r\n\t\tthis.clear();\r\n        if (callback === undefined)\r\n            await nav.start();\r\n        else\r\n            await callback();\r\n\t\tthis.onChangeLogin?.(undefined);\r\n\t}\r\n\r\n    async changePassword() {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showChangePassword();\r\n    }\r\n\r\n    get level(): number {\r\n        return this.navView.level;\r\n    }\r\n    startWait() {\r\n        this.navView?.startWait();\r\n    }\r\n    endWait() {\r\n        this.navView?.endWait();\r\n    }\r\n    async onError(error: FetchError) {\r\n        await this.navView.onError(error);\r\n    }\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        await this.navView.showUpgradeUq(uq, version);\r\n    }\r\n\r\n    show (view: JSX.Element, disposer?: ()=>void): void {\r\n        this.navView.show(view, disposer);\r\n    }\r\n    push(view: JSX.Element, disposer?: ()=>void): void {\r\n        this.navView.push(view, disposer);\r\n    }\r\n    replace(view: JSX.Element, disposer?: ()=>void): void {\r\n        this.navView.replace(view, disposer);\r\n    }\r\n    pop(level:number = 1) {\r\n        this.navView.pop(level);\r\n    }\r\n    topKey():number {\r\n        return this.navView.topKey();\r\n    }\r\n    popTo(key:number) {\r\n        this.navView.popTo(key);\r\n    }\r\n    clear() {\r\n        this.navView?.clear();\r\n    }\r\n    navBack() {\r\n        this.navView.navBack();\r\n    }\r\n    ceaseTop(level?:number) {\r\n        this.navView.ceaseTop(level);\r\n    }\r\n    removeCeased() {\r\n        this.navView.removeCeased();\r\n    }\r\n    async back(confirm:boolean = true) {\r\n        await this.navView.back(confirm);\r\n    }\r\n    regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        this.navView.regConfirmClose(confirmClose);\r\n    }\r\n    confirmBox(message?:string): boolean {\r\n        return this.navView.confirmBox(message);\r\n\t}\r\n\t/*\r\n    async navToApp(url: string, unitId: number, apiId?:number, sheetType?:number, sheetId?:number):Promise<void> {\r\n        return new Promise<void>((resolve, reject) => {\r\n            let sheet = this.centerHost.includes('http://localhost:') === true? 'sheet_debug':'sheet'\r\n            let uh = sheetId === undefined?\r\n                    appUrl(url, unitId) :\r\n                    appUrl(url, unitId, sheet, [apiId, sheetType, sheetId]);\r\n            console.log('navToApp: %s', JSON.stringify(uh));\r\n            nav.push(<article className='app-container'>\r\n                <span id={uh.hash} onClick={()=>this.back()}/>\r\n                    <i className=\"fa fa-arrow-left\" />\r\n                </span>\r\n                {\r\n                    // eslint-disable-next-line \r\n                    <iframe src={uh.url} title={String(sheetId)} />\r\n                }\r\n            </article>, \r\n            ()=> {\r\n                resolve();\r\n            });\r\n        });\r\n    }\r\n\r\n    navToSite(url: string) {\r\n        // show in new window\r\n        window.open(url);\r\n\t}\r\n\t*/\r\n\r\n    get logs() {return logs};\r\n    log(msg:string) {\r\n        logs.push(msg);\r\n    }\r\n    logMark() {\r\n        let date = new Date();\r\n        logMark = date.getTime();\r\n        logs.push('log-mark: ' + date.toTimeString());\r\n    }\r\n    logStep(step:string) {\r\n        logs.push(step + ': ' + (new Date().getTime() - logMark));\r\n    }\r\n\r\n    showReloadPage(msg: string) {\r\n        let seconds = -1;\r\n\t\tthis.push(<ReloadPage message={msg} seconds={seconds} />);\r\n\t\t/*\r\n\t\tif (seconds > 0) {\r\n\t\t\tenv.setTimeout(undefined, this.reload, seconds*1000);\r\n\t\t}\r\n\t\t*/\r\n    }\r\n\r\n    reload = async () => {\r\n        let waiting:Promise<void> = new Promise<void>((resolve, reject) => {\r\n            setTimeout(resolve, 100);\r\n        });\r\n\r\n        if ('serviceWorker' in navigator) {\r\n            let registration =await Promise.race([waiting, navigator.serviceWorker.ready]);\r\n            if (registration) registration.unregister();\r\n        }\r\n\t\twindow.document.location.reload();\r\n\t\t// dcloud hbuilder里面的app自动升级，需要清webview的缓存\r\n\t\tlet plus = (window as any).plus;\r\n\t\tif (plus) {\r\n\t\t\tlet webview = plus.webview;\r\n\t\t\tif (webview) {\r\n\t\t\t\tif (webview.reload) webview.reload(true);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet webView = plus.webView;\r\n\t\t\t\tif (webView) {\r\n\t\t\t\t\tif (webView.reload) webView.reload(true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//plus.webview.reload(true)\r\n\t\t}\r\n    }\r\n\r\n    resetAll = () => {\r\n        this.push(<ConfirmReloadPage confirm={(ok:boolean):Promise<void> => {\r\n            if (ok === true) {\r\n                this.showReloadPage('彻底升级');\r\n\t\t\t\tlocalStorage.clear();\r\n\t\t\t\t/*\r\n                this.local.readToMemory();\r\n                env.localDb.removeAll();\r\n\t\t\t\tthis.local.saveToLocalStorage();\r\n\t\t\t\t*/\r\n            }\r\n            else {\r\n                this.pop();\r\n            }\r\n            return;\r\n        }} />);\r\n    }\r\n\r\n    async checkVersion():Promise<string> {\r\n        let {href} = document.location;\r\n        href += (href.indexOf('?')>=0? '&':'?') + '_t_t_=' + new Date().getTime();\r\n        let ret = await fetch(href);\r\n        let r = await ret.text();\r\n        let parser = new DOMParser();\r\n        let htmlDoc = parser.parseFromString(r, 'text/html');\r\n        let elHtml = htmlDoc.getElementsByTagName('html');\r\n        let newVersion = elHtml[0].getAttribute('data-version');\r\n        return newVersion;\r\n    }\r\n}\r\nexport const nav: Nav = new Nav();\r\n\r\nexport class TonvaView extends NavView {\r\n\r\n}\r\n","\r\nimport {setCenterToken} from './uqApi';\r\nimport {WSChannel} from './wsChannel';\r\n\r\nexport const netToken = {\r\n    set(userId:number, token:string) {\r\n        setCenterToken(userId, token);\r\n        WSChannel.setCenterToken(token);\r\n    },\r\n    clear() {\r\n        setCenterToken(0, undefined);\r\n        WSChannel.setCenterToken(undefined);\r\n    }\r\n};\r\n","import * as React from 'react';\r\nimport {FetchError} from '../net/fetchError';\r\nimport { refetchApi } from '../net';\r\nimport { Page } from './page/page';\r\n\r\nexport interface FetchErrorProps extends FetchError {\r\n    clearError: ()=>void\r\n}\r\n\r\nexport default class FetchErrorView extends React.Component<FetchErrorProps, null> {\r\n    private reApi = async () => {\r\n        this.props.clearError();\r\n        const {channel, url, options, resolve, reject} = this.props;\r\n        await refetchApi(channel, url, options, resolve, reject);\r\n    }\r\n    private close = async () => {\r\n        this.props.clearError();\r\n    }\r\n    render() {\r\n        let {error, url} = this.props;\r\n        let errContent:any;\r\n        if (typeof error === 'object') {\r\n            let err = [];\r\n            for (let i in error) {\r\n                err.push(<li key={i}><label>{i}</label><div style={{wordWrap:\"break-word\"}}>{error[i]}</div></li>);\r\n            }\r\n            errContent = <ul>{err}</ul>;\r\n        }\r\n        else {\r\n            errContent = <div>{error}</div>;\r\n        }\r\n        return <div className=\"tv-page\">\r\n            <article>\r\n\t\t\t\t<main className=\"va-error p-3\">\r\n\t\t\t\t\t<div>网络出现问题</div>\r\n\t\t\t\t\t<div>点击重新访问</div>\r\n\t\t\t\t\t<div style={{wordWrap:\"break-word\"}}>url: {url}</div>\r\n\t\t\t\t\t{errContent}\r\n\t\t\t\t\t<div className=\"p-3 text-center\">\r\n\t\t\t\t\t<button className=\"btn btn-primary mr-3\" type='button' onClick={this.close}>关闭</button>\r\n\t\t\t\t\t\t<button className=\"btn btn-outline-primary\" type='button' onClick={this.reApi}>重试</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</main>\r\n            </article>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport const SystemNotifyPage = ({message}:{message:string}):JSX.Element => {\r\n    return <Page header=\"系统提醒\">\r\n        <div className=\"px-3\">{message}</div>\r\n    </Page>;\r\n}","import * as React from 'react';\r\nimport { nav } from './nav';\r\nimport { Page } from './page/page';\r\n\r\ninterface Props {\r\n    message: string,\r\n    seconds: number\r\n}\r\n\r\ninterface State {\r\n    seconds: number\r\n}\r\n\r\nexport class ReloadPage extends React.Component<Props, State> {\r\n    private timerHandler:any;\r\n    constructor(props:Props) {\r\n\t\tsuper(props);\r\n\t\tlet {seconds} = props;\r\n\t\tif (seconds===undefined) return;\r\n        this.state = {seconds};\r\n\t\tif (seconds <= 0) return;\r\n        this.timerHandler = setInterval(() => {\r\n\t\t\tlet {seconds} = this.state;\r\n            seconds--;\r\n            if (seconds <= 0) {\r\n                this.reload();\r\n            }\r\n            else {\r\n                this.setState({seconds: seconds});\r\n            }\r\n        }, 1000);\r\n    }\r\n    private reload = () => {\r\n        clearInterval(this.timerHandler);\r\n        nav.reload();\r\n    }\r\n    render() {\r\n\t\tlet {seconds} = this.state;\r\n\t\tlet title:string, msg:string;\t\t\r\n\t\tif (seconds > 0) {\r\n\t\t\ttitle = '程序升级中...';\r\n\t\t\tmsg = this.state.seconds + '秒钟之后自动重启动';\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttitle = '程序需要升级';\r\n\t\t\tmsg = '请点击下面按钮重启';\r\n\t\t}\r\n        return <Page header={false}>\r\n            <div className=\"text-center p-5\">\r\n                <div className=\"text-info py-5\">\r\n\t\t\t\t\t<span className=\"text-danger\">{title}</span>\r\n\t\t\t\t\t<br/>\r\n\t\t\t\t\t{msg}\r\n                    <br/>\r\n                    <span className=\"small text-muted\">{this.props.message}</span>\r\n                </div>\r\n                <button className=\"btn btn-danger\" onClick={this.reload}>立刻重启</button>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\ninterface ConfirmReloadPageProps {\r\n    confirm: (ok: boolean)=>Promise<void>;\r\n}\r\nexport const ConfirmReloadPage = (props: ConfirmReloadPageProps):JSX.Element => {\r\n    return <Page header=\"升级软件\" back=\"close\">\r\n        <div className=\"py-5 px-3 my-5 mx-2 border bg-white rounded\">\r\n            <div className=\"text-center text-info\">\r\n                升级将清除所有本机缓冲区内容，并从服务器重新安装程序！\r\n            </div>\r\n            <div className=\"text-center mt-5\">\r\n                <button className=\"btn btn-danger mr-3\" onClick={()=>props.confirm(true)}>确认升级</button>\r\n            </div>\r\n        </div>\r\n    </Page>;\r\n    // <button className=\"btn btn-outline-danger\" onClick={()=>props.confirm(false)}>暂不</button>\r\n}\r\n","import * as React from 'react';\r\n\r\nexport class GFunc {\r\n    public static numberToFixString(n: number, w = 2) {\r\n        return n === undefined ? '' : n.toFixed(w);\r\n    }\r\n    public static number(n: number, w = 2) {\r\n        return n === undefined ? '' : n.toFixed(w);\r\n    }\r\n\r\n    public static numberToMarketValue(n: number) {\r\n        return n === undefined || isNaN(n) ? '' : Math.round(n / 10000).toString(); // + '亿';\r\n    }\r\n\r\n    public static numberToString(n: number, precision = 2) {\r\n        return n === undefined ? '' : n.toPrecision(precision);\r\n    }\r\n\r\n    public static numberToPrecision(n: number, precision = 4) {\r\n        return n === undefined ? undefined : Number.parseFloat(n.toPrecision(precision));\r\n    }\r\n\r\n    public static percentToFixString(n: number) {\r\n        return n === undefined || isNaN(n) ? '' : (n * 100).toFixed(2) + '%';\r\n    }\r\n\r\n    public static percent0(n: number) {\r\n        return n === undefined || isNaN(n) ? '' : (n * 100).toFixed(0) + '%';\r\n    }\r\n    public static percent1(n: number) {\r\n        return n === undefined || isNaN(n) ? '' : (n * 100).toFixed(1) + '%';\r\n    }\r\n\r\n    public static warningTypeString(t: string) {\r\n        switch (t) {\r\n            case 'gt': return '大于';\r\n            case 'lt': return '小于';\r\n            default: return t;\r\n        }\r\n    }\r\n\r\n    public static predictCutRatio(r2: number) {\r\n        return r2 * 2 - r2 * r2;\r\n    }\r\n\r\n    public static evaluatePricePrice(iRate: number, e1: number, e2: number, e3: number) {\r\n        let r = 1 + iRate;\r\n        let r2 = r * r;\r\n        let r3 = r2 * r;\r\n        return (e1 / r + e2 / r2 + e3 / r3 + e3 / iRate / r3) / 2;\r\n    }\r\n\r\n    public static calculateV(z: number, divyield: number, pe: number) {\r\n        if (pe === undefined || isNaN(pe)) {\r\n            return undefined;\r\n        }\r\n\r\n        let r = 0;\r\n        if (z !== undefined) {\r\n            if (z > 0.25) {\r\n                z = 0.25;\r\n            }\r\n            r += z * 100;\r\n        }\r\n        if (divyield !== undefined) {\r\n            r += divyield * 100;\r\n        }\r\n        return r / pe;\r\n    }\r\n\r\n    public static calculateVN(z: number, e: number, bonus: number, price: number) {\r\n        if (price === undefined || isNaN(price) || e === undefined || isNaN(e)) {\r\n            return undefined;\r\n        }\r\n\r\n        let r = 0;\r\n        if (z !== undefined && e > 0) {\r\n            if (z > 0.25) {\r\n                z = 0.24 + Math.pow((z - 0.24) * 100, 0.6667) / 100;\r\n            }\r\n            z = 1 + z;\r\n            z = z * z * z - 1;\r\n            r += z * e * 100;\r\n        }\r\n        if (bonus !== undefined && !isNaN(bonus)) {\r\n            r += bonus * 100;\r\n        }\r\n        return r / price;\r\n    }\r\n\r\n    public static calculateVS(ev: number, bonus: number, price: number) {\r\n        if (price === undefined || isNaN(price)) {\r\n            return undefined;\r\n        }\r\n\r\n        if (ev === undefined || isNaN(ev)) {\r\n            if (bonus === undefined || isNaN(bonus)) {\r\n                return undefined;\r\n            }\r\n            else {\r\n                return bonus * 100 / price;\r\n            }\r\n        }\r\n        else {\r\n            if (bonus === undefined || isNaN(bonus)) {\r\n                return ev * 100 / price;\r\n            }\r\n            else {\r\n                return (bonus + ev) * 100 / price;\r\n            }\r\n        }\r\n    }\r\n\r\n    public static calculateZZ3(data: number[]) {\r\n        let ret: number[] = [undefined, undefined, undefined, undefined];\r\n        if (data === undefined)\r\n            return ret;\r\n        let len = data.length;\r\n        if (len < 5)\r\n            return ret;\r\n\r\n        let funcz = (n: number, p: number) => {\r\n            if (p <= 0 || n <= 0)\r\n                return undefined;\r\n            return ((n / p) - 1);\r\n        }\r\n        for (let i = 0; i < 4; ++i) {\r\n            ret[i] = funcz(data[i + 1], data[i]);\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    public static caption = (value: string) => <span className=\"text-muted small\">{value}</span>;\r\n\r\n    public static MonthnoFromDay(day: number) {\r\n        let year = Math.floor(day / 10000);\r\n        let month = Math.floor((day % 10000) / 100) - 1;\r\n        return (year - 1995) * 12 + month;\r\n    }\r\n\r\n    public static SeasonnoFromDay(day: number) {\r\n        let year = Math.floor(day / 10000);\r\n        let month = Math.floor((day % 10000) / 100) - 1;\r\n        let season = Math.floor(month / 3);\r\n        return (year - 1995) * 4 + season;\r\n    }\r\n\r\n    public static SeasonnoFromYearMonth(year: number, month: number) {\r\n        let season = Math.floor((month - 1) / 3);\r\n        return (year - 1995) * 4 + season;\r\n    }\r\n\r\n    public static SeasonnoToYearMonth(no: number) {\r\n        let year = Math.floor(no / 4) + 1995;\r\n        let month = (Math.floor(no % 4) + 1) * 3;\r\n        return year * 100 + month;\r\n    }\r\n\r\n    public static GetSeasonnoYearMonth(no: number) {\r\n        let year = Math.floor(no / 4) + 1995;\r\n        let month = (Math.floor(no % 4) + 1) * 3;\r\n        return {year: year, month: month};\r\n    }\r\n\r\n    public static SeasonnoToBeginEnd(season: number) {\r\n        let year = (1995 + Math.floor(season / 4)) * 10000;\r\n        let s = season % 4;\r\n        if (s === 0) {\r\n            return { begin: year + 101, end: year + 331 };\r\n        }\r\n        else if (s === 1) {\r\n            return { begin: year + 401, end: year + 630 };\r\n        }\r\n        else if (s === 2) {\r\n            return { begin: year + 701, end: year + 930 };\r\n        }\r\n        return { begin: year + 1001, end: year + 1231 };\r\n    }\r\n\r\n    public static CalculateValueAvg(arr: { v: number }[]) {\r\n        let ret: { avg20: number, avg50: number, avg100: number, avg: number } = { avg20: undefined, avg50: undefined, avg100: undefined, avg: undefined };\r\n\r\n        let length = arr.length;\r\n        let calcuOne = (count: number): number => {\r\n            let endIndex = count;\r\n            if (count === 0 || endIndex > length)\r\n                endIndex = length;\r\n            if (endIndex >= 10) {\r\n                let sum = 0;\r\n                for (let i = 3; i < endIndex; ++i) {\r\n                    sum += arr[i].v;\r\n                }\r\n                return sum / (endIndex - 3);\r\n            }\r\n            else {\r\n                return undefined;\r\n            }\r\n        }\r\n\r\n        ret.avg20 = calcuOne(20);\r\n        ret.avg50 = calcuOne(50);\r\n        ret.avg100 = calcuOne(100);\r\n        ret.avg = calcuOne(0);\r\n        return ret;\r\n    }\r\n}\r\n","import fs from 'fs';\r\nimport { capitalCase } from \"../../tool\";\r\nimport { UqMan } from \"../uqMan\";\r\nimport { BuildContext } from './context';\r\n\r\nexport const red = '\\x1b[41m%s\\x1b[0m';\r\nexport let lastBuildTime:number = 0;\r\n//export const uqTsSrcPath = 'src/UqApp';\r\n\r\nexport function saveSrcTsFileIfNotExists(context:BuildContext, fileName:string, suffix:string, content:string) {\r\n\tlet tsFilePath = `${context.uqTsSrcPath}/${fileName}.${suffix}`;\r\n\tsaveTsFileIfNotExists(tsFilePath, content);\r\n\t//if (fs.existsSync(tsFile) === true) return;\r\n\t//saveTsFile(fileName, content, suffix);\r\n}\r\nexport function saveTsFile(context:BuildContext, fileName:string, content:string, suffix:string = 'ts') {\r\n\tlet {uqTsSrcPath} = context;\r\n\tlet srcFile = `${uqTsSrcPath}/${fileName}.${suffix}.txt`;\r\n\tlet tsFile = `${uqTsSrcPath}/${fileName}.${suffix}`;\r\n\tif (!fs.existsSync(srcFile)) {\r\n\t\tif (fs.existsSync(tsFile)) {\r\n\t\t\tfs.renameSync(tsFile, srcFile);\r\n\t\t}\r\n\t}\r\n\tfs.writeFileSync(tsFile, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${tsFile} is built`);\r\n}\r\nexport function overrideTsFile(path:string, content:string) {\r\n\t//let tsFile = `${path}/${fileName}.${suffix}`;\r\n\tfs.writeFileSync(path, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${path} is built`);\r\n}\r\n//fileName:string, \r\n//, suffix:string = 'ts'\r\nexport function saveTsFileIfNotExists(tsFilePath:string, content:string) {\r\n\t//let tsFilePath = `${path}/${fileName}.${suffix}`;\r\n\tif (fs.existsSync(tsFilePath) === true) return;\r\n\toverrideTsFile(tsFilePath, content);\r\n}\r\n\r\n/*\r\nfunction createTsFile(path:string, fileName:string, content:string, suffix:string = 'ts') {\r\n\tlet tsFile = `${path}/${fileName}.${suffix}`;\r\n\tif (fs.existsSync(tsFile) === true) return;\r\n\tfs.writeFileSync(tsFile, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${tsFile} is built`);\r\n}\r\n*/\r\nexport function buildTsHeader() {\r\n\treturn `//=== UqApp builder created on ${new Date()} ===//`;\r\n}\r\n\r\nexport function entityName(s:string):string {\r\n\treturn capitalCase(s);\r\n}\r\n\r\nexport function getNameFromUq(uqMan:UqMan):{devName:string; uqName:string} {\r\n\tlet {config} = uqMan;\r\n\tlet devPart:string, uqPart:string;\r\n\tif (config) {\r\n\t\tlet {dev, name, alias} = config;\r\n\t\tlet {name:devName, alias:devAlias} = dev;\r\n\t\tdevPart = devAlias || devName;\r\n\t\tuqPart = alias || name;\r\n\t}\r\n\telse {\r\n\t\tlet {uqOwner, uqName} = uqMan;\r\n\t\tdevPart = uqOwner;\r\n\t\tuqPart = uqName;\r\n\t}\r\n\treturn {\r\n\t\tdevName: capitalCase(devPart),\r\n\t\tuqName: capitalCase(uqPart),\r\n\t};\r\n}\r\n","import { decodeGuestToken } from '../tool/user';\r\nimport { CenterApiBase } from './uqApi';\r\n\r\nexport class GuestApi extends CenterApiBase {\r\n    async guest(): Promise<any> {\r\n        //let guest = nav.local.guest.get();\r\n        let ret = await this.get('', {});\r\n        switch (typeof ret) {\r\n            default: return;\r\n            case 'string': return decodeGuestToken(ret);\r\n            case 'object':\r\n                let guest = decodeGuestToken(ret.token);\r\n                return guest;\r\n        }\r\n    }\r\n\r\n    async unitFromName(unitName:string): Promise<number> {\r\n        let ret = await this.get(unitName);\r\n        return ret && ret.unit;\r\n    }\r\n}\r\n\r\nexport const guestApi = new GuestApi('tv/guest/', undefined);\r\n","export abstract class Caller<T> {\r\n    protected readonly _params: T;\r\n    constructor(params: T, waiting: boolean) {\r\n        this._params = params;\r\n        this.waiting = waiting;\r\n    }\r\n    protected get params():any {return this._params;}\r\n    buildParams():any {return this.params;}\r\n    method: string  = 'POST';\r\n    abstract get path(): string;\r\n    get headers(): {[header:string]: string} {return undefined}\r\n    waiting: boolean;\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {PageHeaderProps, renderPageHeader} from './pageHeader';\r\nimport { TabsProps, TabsView } from './tabs';\r\nimport { ScrollProps, ScrollView, PageWebNav, WebNavScrollView } from './scrollView';\r\nimport { nav } from '../nav';\r\n\r\nexport interface IVPage {\r\n\tcontent():JSX.Element;\r\n\theader():JSX.Element|string;\r\n\tfooter():JSX.Element;\r\n}\r\n\r\nexport interface PageProps extends ScrollProps {\r\n    back?: 'close' | 'back' | 'none';\r\n    header?: boolean | string | JSX.Element;\r\n    right?: JSX.Element;\r\n    footer?: JSX.Element;\r\n    logout?: boolean | (()=>Promise<void>);\r\n\theaderClassName?: string;\r\n\tclassName?: string;\r\n\tafterBack?: () => void;\r\n\ttabsProps?: TabsProps;\r\n\twebNav?: PageWebNav;\r\n}\r\n\r\n@observer\r\nexport class Page extends React.Component<PageProps> {\r\n\tprivate tabsView: TabsView;\r\n    constructor(props: PageProps) {\r\n\t\tsuper(props);\r\n\t\tlet {tabsProps} = props;\r\n\t\tif (tabsProps) {\r\n\t\t\tthis.tabsView = new TabsView(tabsProps);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate renderHeader(webNav?: PageWebNav) {\r\n\t\tconst {back, header, right, headerClassName, afterBack, logout} = this.props;\r\n\t\tif (header === false) return;\r\n\t\t//const {webNav} = this.props;\r\n\t\tlet inWebNav = false;\r\n\t\tlet pageHeaderProps:PageHeaderProps = {\r\n\t\t\tback,\r\n\t\t\tcenter: header as any,\r\n\t\t\tright,\r\n\t\t\tlogout,\r\n\t\t\tclassName: headerClassName,\r\n\t\t\tafterBack,\r\n\t\t};\r\n\t\tif (webNav !== undefined) {\r\n\t\t\tinWebNav = true;\r\n\t\t\tlet {renderPageHeader: rph} = webNav;\r\n\t\t\tif (rph) return rph(pageHeaderProps);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tinWebNav = false;\r\n\t\t}\r\n\t\treturn renderPageHeader(pageHeaderProps, inWebNav);\r\n\t\t/*\r\n\t\tlet pageHeader = header !== false && <PageHeader \r\n\t\t\tback={back} \r\n\t\t\tcenter={header as any}\r\n\t\t\tright={right}\r\n\t\t\tlogout={this.props.logout}\r\n\t\t\tclassName={headerClassName}\r\n\t\t\tafterBack={afterBack}\r\n\t\t\t/>;\r\n\t\treturn pageHeader;\r\n\t\t*/\r\n\t}\r\n\r\n\tprivate renderFooter(webNav?: PageWebNav) {\r\n\t\tconst {footer} = this.props;\r\n\t\tif (!footer) return;\r\n\t\tlet elFooter = <footer>{footer}</footer>;\r\n\t\tif (webNav) return elFooter;\r\n\t\treturn <>\r\n\t\t\t<section className=\"tv-page-footer\">{elFooter}</section>\r\n\t\t\t{elFooter}\r\n\t\t</>;\r\n\t}\r\n\r\n\tcomponentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\r\n\t\t// You can also log the error to an error reporting service\r\n\t\t//logErrorToMyService(error, errorInfo);\r\n\t\tdebugger;\r\n\t}\r\n\t\r\n    render() {\r\n\t\tif (this.tabsView) {\r\n\t\t\treturn React.createElement(this.tabsView.content);\r\n\t\t}\r\n\t\tconst {onScroll, onScrollTop, onScrollBottom, children, className, webNav} = this.props;\r\n\t\tlet pageWebNav:PageWebNav;\r\n\t\tif (!webNav) {\r\n\t\t\tpageWebNav = nav.pageWebNav;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tpageWebNav = webNav;\r\n\t\t}\r\n\t\tlet content = <>\r\n\t\t\t{this.renderHeader(pageWebNav)}\r\n\t\t\t<main>{children}</main>\r\n\t\t\t{this.renderFooter(pageWebNav)}\r\n\t\t</>;\r\n\t\tif (pageWebNav) {\r\n\t\t\treturn <WebNavScrollView\r\n\t\t\t\tonScroll={onScroll}\r\n\t\t\t\tonScrollTop={onScrollTop}\r\n\t\t\t\tonScrollBottom={onScrollBottom}\r\n\t\t\t\tclassName={className}\r\n\t\t\t\twebNav={pageWebNav}\r\n\t\t\t>\r\n\t\t\t\t{content}\r\n\t\t\t</WebNavScrollView>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn <ScrollView\r\n\t\t\t\tonScroll={onScroll}\r\n\t\t\t\tonScrollTop={onScrollTop}\r\n\t\t\t\tonScrollBottom={onScrollBottom}\r\n\t\t\t\tclassName={className}\r\n\t\t\t>\r\n\t\t\t\t{content}\r\n\t\t\t</ScrollView>;\r\n\t\t}\r\n\t}\r\n}\r\n","/*eslint @typescript-eslint/no-unused-vars: [\"off\", { \"vars\": \"all\" }]*/\r\nimport { FA } from 'tonva-react';\r\nimport { Stock, StockValue } from 'uq-app/uqs/BruceYuMi';\r\nimport { NStockInfo } from '../stockinfo';\r\n\r\nfunction renderValue(caption:string, value:number, valueType:'p0'|'p1'|'n1'|'n2'|'yi'):JSX.Element {\r\n\tconst _cn = 'px-2 px-sm-3 mb-1 text-right '; \r\n\tlet cn = _cn + 'c5';\r\n\tlet cnYI = _cn + 'c5'\r\n\tlet vStr:string;\r\n\tif (isNaN(value) === true) {\r\n\t\tvStr = '-'\r\n\t}\r\n\telse {\r\n\t\tswitch (valueType) {\r\n\t\t\tcase 'p0': vStr = percent0(value); break;\r\n\t\t\tcase 'p1': vStr = percent1(value); break;\r\n\t\t\tcase 'n1': vStr = number(value, 1); break;\r\n\t\t\tcase 'n2': vStr = number(value, 2); break;\r\n\t\t\tcase 'yi': \r\n\t\t\t\tvStr = numberToMarketValue(value);\r\n\t\t\t\tcn = cnYI;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\treturn <div key={caption} className={cn}>\r\n\t\t<span className=\"text-muted small\">{caption}</span><br />\r\n\t\t{vStr}\r\n\t</div>;\r\n}\r\n\r\nexport function renderStockName(stock: Stock):JSX.Element {\r\n\tlet { name, code } = stock;\r\n\tlet $market = (stock as any).$market;\r\n\treturn <>\r\n\t\t{$market && <>{$market.el}&nbsp;</>}\r\n\t\t<span className=\"text-primary\">{name}</span>\r\n\t\t&nbsp; \r\n\t\t<span className=\"text-info\">{code}</span>\r\n\t\t&nbsp;\r\n\t</>;\r\n}\r\n\r\nexport const smallPercent = <small>%</small>;\r\n\r\nexport function renderStockRow(order: number, stock: Stock&StockValue, onClickName: (stock:Stock&StockValue) => void, right:JSX.Element):JSX.Element {\r\n\tlet { roe, price, dvRate, miRate, volumn, ttm, inc1, inc2, inc3, inc4, preInc, smoothness } = stock;\r\n\tlet stars = [0,0,0,0];\r\n\tfor (let i=2; i<=smoothness; i++) stars[i-2] = 1;\r\n\tlet left = <div className=\"cursor-pointer align-self-center flex-grow-1\" onClick={()=>onClickName?.(stock)}>\r\n\t\t{order && <><small className=\"mr-2 text-danger\">{order}</small>&nbsp;</>}\r\n\t\t{renderStockName(stock)}\r\n\t\t<div className=\"bg-light px-3 small d-block d-sm-inline-block\">\r\n\t\t\t{\r\n\t\t\t\tstars.map((v, index) => v===1?\r\n\t\t\t\t\t<FA key={index} \r\n\t\t\t\t\t\tname='star-o' \r\n\t\t\t\t\t\tclassName={'small px-1 ' + (v===1? 'text-warning':'text-muted')} />\r\n\t\t\t\t\t:\r\n\t\t\t\t\tnull )\r\n\t\t\t}\r\n\t\t</div>\r\n\t</div>;\r\n\tlet rows:[string,number,'p0'|'p1'|'n1'|'n2'|'yi'][] = [\r\n\t\t['米息分', Math.log2(miRate), 'n1'],\r\n\t\t['米息率', miRate, 'n1'],\r\n\t\t['TTM', ttm, 'n1'],\r\n\t\t['股息率', dvRate/100, 'p1'],\r\n\t\t['价格', price, 'n2'],\r\n\t\t['ROE', roe, 'n1'],\r\n\t\t['均增', preInc/100, 'p0'],\r\n\t\t['现增', inc4/100, 'p0'],\r\n\t\t['增 1', inc3/100, 'p0'],\r\n\t\t['增 2', inc2/100, 'p0'],\r\n\t\t['增 3', inc1/100, 'p0'],\r\n\t\t['市值', volumn * price, 'yi'],\r\n\t];\r\n\treturn <div className=\"d-block border-top\">\r\n\t\t<div className=\"d-flex px-2 py-1 bg-light\">\r\n\t\t\t{left}\r\n\t\t\t{right}\r\n\t\t</div>\r\n\t\t<div className=\"d-flex flex-wrap p-1\" onClick={()=>onClickName?.(stock)}>\r\n\t\t\t{rows.map(v => renderValue(v[0], v[1], v[2]))}\r\n\t\t</div>\r\n\t</div>;\r\n}\r\n\r\n//const nFormat = { maximumSignificantDigits: 3 };\r\nexport function formatNumber(num: number): string {\r\n\treturn num.toLocaleString(undefined, nFormat0); // nFormat.format(num);\r\n}\r\nexport const nFormat0 = {\r\n\tminimumFractionDigits: 0,\r\n\tmaximumFractionDigits: 0,\r\n};\r\nexport const nFormat1 = { \r\n\tminimumFractionDigits: 1,\r\n\tmaximumFractionDigits: 1,\r\n};\r\n\r\nexport function renderStockUrl(row: NStockInfo) {\r\n    let { symbol, market, code } = row;\r\n    let url = market === 'HK' ? `https://xueqiu.com/S/${code}` : `https://finance.sina.com.cn/realstock/company/${symbol}/nc.shtml`;\r\n\treturn <a className=\"text-info\" href={url} target=\"_blank\" rel=\"noopener noreferrer\" onClick={(e)=>{e.stopPropagation();}}>\r\n\t\t<FA name=\"angle-double-right\" />\r\n\t</a>;\r\n}\r\n\r\nfunction number(n: number, w = 2) {\r\n    return n === undefined ? '' : n.toFixed(w);\r\n}\r\n\r\nfunction numberToMarketValue(n: number) {\r\n    return n === undefined || isNaN(n) ? '' : Math.round(n / 10000).toString(); // + '亿';\r\n}\r\n\r\nfunction percent0(n: number) {\r\n    return n === undefined || isNaN(n) ? '' : (n * 100).toFixed(0) + '%';\r\n}\r\n\r\nfunction percent1(n: number) {\r\n    return n === undefined || isNaN(n) ? '' : (n * 100).toFixed(1) + '%';\r\n}\r\n","import { Group } from \"uq-app/uqs/BruceYuMi\";\r\n\r\nexport function renderGroup(item: Group, index:number, IDRender: (item: Group, index:number)=>JSX.Element) {\r\n\tlet cn:string = '';\r\n\treturn <span className={cn}>{IDRender(item, index)}</span>;\r\n}\r\n","import { List, Page, PageItems, Scroller } from \"tonva-react\";\r\n\r\nexport interface ListPageProps {\r\n\tpageItems: PageItems<any>;\r\n\titemClick: (item:any) => any;\r\n\trenderItem?: (item:any, index:number) => JSX.Element;\r\n\trenderItemContainer?: (content:any) => JSX.Element;\r\n\tkey: (item:any) => number|string;\r\n\theader: JSX.Element | string;\r\n\tright?: JSX.Element;\r\n\tfooter?: JSX.Element;\r\n\ttop?: JSX.Element;\r\n\tbottom?: JSX.Element;\r\n\tback?: 'close' | 'back' | 'none';\r\n\tclassName?: string;\r\n\theaderClassName?: string;\r\n}\r\n\r\nexport class ListPage extends Page {\r\n\tprotected listPageProps: ListPageProps;\r\n\tconstructor(listPageProps: ListPageProps) {\r\n\t\tsuper({});\r\n\t\tthis.listPageProps = listPageProps;\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn this.renderPage();\r\n\t}\r\n\r\n\tprivate renderPage():JSX.Element {\r\n\t\tlet {pageItems, itemClick, renderItem, renderItemContainer\r\n\t\t\t, key, header, footer, right\r\n\t\t\t, top, bottom, back, className, headerClassName} = this.listPageProps;\r\n\t\tif (!header) header = false as any;\r\n\t\tlet renderRow = (item:any, index:number) => {\r\n\t\t\treturn renderItemContainer(renderItem(item, index));\r\n\t\t}\r\n\t\tlet item = {\r\n\t\t\trender: renderRow,\r\n\t\t\tonClick: itemClick,\r\n\t\t\tkey,\r\n\t\t}\r\n\t\treturn <Page\r\n\t\t\theader={header} right={right} footer={footer}\r\n\t\t\tonScroll={(e:any)=>this.onPageScroll(e)}\r\n\t\t\tonScrollTop={(scroller: Scroller) => this.onPageScrollTop(scroller)}\r\n\t\t\tonScrollBottom={(scroller: Scroller) => this.onPageScrollBottom(scroller)}\r\n\t\t\tback={back}\r\n\t\t\theaderClassName={headerClassName}\r\n\t\t\tclassName={className}\r\n\t\t\tafterBack={()=>this.afterBack()}\r\n\t\t>\r\n\t\t\t{top}\r\n\t\t\t<List items={pageItems} item={item} />\r\n\t\t\t{bottom}\r\n\t\t</Page>;\r\n\t}\r\n\r\n\tprotected onPageScroll(e:any) {}\r\n\tprotected async onPageScrollTop(scroller: Scroller): Promise<boolean> {return false;}\r\n\tprotected async onPageScrollBottom(scroller: Scroller): Promise<void> {return;}\r\n\tprotected afterBack():void {}\r\n}\r\n","import { Controller } from \"tonva-react\";\r\nimport { renderItem, listRight, renderItemContainer } from \"../tools\";\r\nimport { ListPage, ListPageProps } from \"./ListPage\";\r\nimport { MidList } from \"./MidList\";\r\n\r\nexport class CList<T> extends Controller {\r\n\tprotected readonly midList: MidList<T>;\r\n\tprotected selectedItem: T;\r\n\tconstructor(midList: MidList<T>) {\r\n\t\tsuper();\r\n\t\tthis.setRes(midList.res);\r\n\t\tthis.midList = midList;\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tawait this.midList.init();\r\n\t\tlet pageItems = this.midList.pageItems;\r\n\t\tlet props:ListPageProps = {\r\n\t\t\theader: this.header,\r\n\t\t\tpageItems,\r\n\t\t\tkey: this.midList.key,\r\n\t\t\titemClick: (item:any) => this.onItemClick(item),\r\n\t\t\tright: this.renderRight(),\r\n\t\t\trenderItem: (item:any, index) => this.renderItem(item, index),\r\n\t\t\trenderItemContainer: (content:any) => this.renderItemContainer(content),\r\n\t\t};\r\n\t\tpageItems.first(this.firstParam);\r\n\t\tlet page = new ListPage(props);\r\n\t\tthis.openPage(page.render(), () => this.returnCall(this.selectedItem));\r\n\t}\r\n\r\n\tprotected get firstParam():any {return undefined;}\r\n\tprotected get header():string|JSX.Element {return this.midList.header ?? 'List'}\r\n\tprotected renderItemContainer(content:any):JSX.Element {\r\n\t\treturn renderItemContainer(content);\r\n\t}\r\n\tprotected onItemClick(item:any):void {\r\n\t\tthis.midList.onItemClick(item);\r\n\t}\r\n\r\n\tprotected renderRight():JSX.Element {\t\t\r\n\t\tlet {renderRight, onRightClick} = this.midList;\r\n\t\tif (!onRightClick) return null;\r\n\t\treturn (renderRight ?? listRight)(onRightClick);\r\n\t}\r\n\r\n\tprotected renderItem(item:any, index:number):JSX.Element {\r\n\t\treturn (this.midList.renderItem ?? renderItem)(item, index);\r\n\t}\r\n\r\n}\r\n","import { runInAction } from \"mobx\";\r\nimport { PageItems, Uq } from \"tonva-react\";\r\nimport { ListPageItems } from \"../tools\";\r\nimport { IDBase, Mid } from \"../base\";\r\n\r\nexport abstract class MidList<T> extends Mid {\r\n\treadonly pageItems: PageItems<T>;\r\n\tconstructor(uq:Uq, res?:any) {\r\n\t\tsuper(uq, res);\r\n\t\tthis.pageItems = this.createPageItems();\r\n\t}\r\n\r\n\tprotected abstract createPageItems():PageItems<T>;\r\n\tasync init():Promise<void> {}\r\n\tprotected abstract loadPageItems(pageStart:any, pageSize:number):Promise<T[]>;\r\n\tkey:((item:T) => number|string);\r\n\r\n\tonRightClick: ()=>any;\r\n\trenderItem: (item:T, index:number)=>JSX.Element;\r\n\tonItemClick: (item:T)=>any;\r\n\trenderRight: ()=>JSX.Element;\r\n\theader: string|JSX.Element;\r\n}\r\n\r\nexport abstract class MidIDListBase<T extends IDBase> extends MidList<T> {\r\n\tprotected get listPageItems(): IDListPageItems<T> {return this.pageItems as IDListPageItems<T>}\r\n\tkey:((item:T) => number|string) = item => {\r\n\t\treturn item.id;\r\n\t}\r\n\tcreatePageItems():PageItems<T> {\r\n\t\tlet loader = (pageStart:any, pageSize:number) => this.loadPageItems(pageStart, pageSize);\r\n\t\treturn new IDListPageItems<T>(loader);\r\n\t}\r\n}\r\n\r\nexport class IDListPageItems<T extends IDBase> extends ListPageItems<T> {\r\n\titemId(item:T):number {return item.id}\r\n\tnewItem(id:number, item:T):T {return {...item, id}}\r\n\r\n\tupdate(item:T): Promise<void> {\r\n\t\tlet id = item.id;\r\n\t\tlet ret = this._items.find(v => this.itemId(v) === id);\r\n\t\tif (ret === undefined) {\r\n\t\t\tlet data = this.newItem(id, item);\r\n\t\t\tthis._items.unshift(data);\r\n\t\t}\r\n\t\telse {\r\n\t\t\trunInAction(() => {\r\n\t\t\t\tObject.assign(ret, item);\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn;\r\n\t}\r\n}\r\n","import _ from 'lodash';\r\nimport {nav, Page, PageHeaderProps, PageWebNav} from '../components';\r\nimport {resOptions, t} from '../res';\r\nimport { User, env } from '../tool';\r\nimport { VPage } from './vpage';\r\nimport { View } from './view';\r\nimport { messageHub } from '../net';\r\n\r\nexport interface ConfirmOptions {\r\n    caption?: string;\r\n    message: string | JSX.Element;\r\n    classNames?: string;\r\n    ok?: string;\r\n    yes?: string;\r\n    no?: string;\r\n}\r\n\r\nexport interface WebNav<C extends Controller> {\r\n\tVNavHeader?: new (controller: C) => View<C>;\r\n\tVNavRawHeader?: new (controller: C) => View<C>;\r\n\tVNavFooter?: new (controller: C) => View<C>;\r\n\tVNavRawFooter?: new (controller: C) => View<C>;\r\n\trenderPageHeader?: (props: PageHeaderProps) => JSX.Element;\r\n}\r\n\r\nexport abstract class Controller {\r\n\tprotected res: any = {};\r\n\tt = (str: string): string|JSX.Element => this.internalT(str) || str;\r\n    icon: string|JSX.Element;\r\n    label:string|JSX.Element;\r\n\treadonly isDev:boolean = env.isDevelopment;\r\n\tpageWebNav: PageWebNav;\r\n    get user():User {return nav.user}\r\n    get isLogined():boolean {\r\n        let {user} = nav;\r\n        if (user === undefined) return false;\r\n        return user.id > 0;\r\n    }\r\n\r\n\tprotected beforeInit() {}\r\n\tprotected afterInit() {}\r\n\r\n\tinit(...param: any[]) {\r\n\t\tthis.beforeInit();\r\n\t\tthis.pageWebNav = this.getPageWebNav();\r\n\t\tthis.afterInit();\r\n\t}\r\n\r\n\tinternalT(str:string):any {\r\n\t\treturn this.res?.[str] ?? t(str);\r\n\t}\r\n\r\n\tget webNav(): WebNav<any> {return undefined;}\r\n\r\n\tgetWebNav(): WebNav<any> {return this.webNav;}\r\n\r\n\tgetPageWebNav(): PageWebNav {return undefined;}\r\n\r\n\tget isWebNav(): boolean {return nav.isWebNav}\r\n\tnavigate(url:string) {\r\n\t\tnav.navigate(url);\r\n\t}\r\n\t\r\n\tsetRes(res: any) {\r\n\t\tif (res === undefined) return;\r\n\t\tlet {$lang, $district} = resOptions;\r\n\t\t_.merge(this.res, res);\r\n\t\tif ($lang !== undefined) {\r\n\t\t\tlet l = res[$lang];\r\n\t\t\tif (l !== undefined) {\r\n\t\t\t\t_.merge(this.res, l);\r\n\t\t\t\tlet d = l[$district];\r\n\t\t\t\tif (d !== undefined) {\r\n\t\t\t\t\t_.merge(this.res, d);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\t\t\r\n\t}\r\n\tgetRes():any {return this.res;}\r\n\r\n    private receiveHandlerId:number;\r\n    //private disposer:()=>void;\r\n\r\n    protected dispose = () => {\r\n        // message listener的清理\r\n\t\t//nav.unregisterReceiveHandler(this.receiveHandlerId);\r\n\t\tmessageHub.unregisterReceiveHandler(this.receiveHandlerId);\r\n        this.onDispose();\r\n    }\r\n\r\n    protected onDispose() {\r\n\t}\r\n\t\r\n\tget timeZone():number { return env.timeZone; }\r\n\r\n\tisMe(id:any):boolean {\r\n\t\tif (id === null) return false;\r\n\t\tlet {user} = this;\r\n\t\tlet userId = user.id;\r\n\t\tswitch (typeof id) {\r\n\t\t\tdefault: return false;\r\n\t\t\tcase 'string': return Number(id) === userId;\r\n\t\t\tcase 'number': return id === userId;\r\n\t\t\tcase 'object': return id.id === userId;\r\n\t\t}\r\n\t}\r\n\r\n    protected async openVPage<C extends Controller, P extends VPage<C>>(vp: new (controller: C)=>P, param?:any, afterBack?:(ret:any)=>void):Promise<P> {\r\n\t\tlet ret = new vp((this as any) as C);\r\n\t\tawait ret.open(param, afterBack);\r\n\t\treturn ret;\r\n    }\r\n\r\n    protected async replaceVPage<C extends Controller, P extends VPage<C>>(vp: new (controller: C)=>P, param?:any, afterBack?:(ret:any)=>void):Promise<P> {\r\n\t\tlet ret = new vp((this as any) as C);\r\n\t\tawait ret.replaceOpen(param, afterBack);\r\n\t\treturn ret;\r\n    }\r\n\r\n    protected renderView<C extends Controller, V extends View<C>>(view: new (controller: C)=>V, param?:any):JSX.Element {\r\n\t\tlet v = new view((this as any) as C);\r\n\t\treturn v.render(param);\r\n    }\r\n\r\n    async event(type:string, value:any) {\r\n        await this.onEvent(type, value);\r\n    }\r\n\r\n    protected async onEvent(type:string, value:any) {\r\n    }\r\n\r\n    protected msg(text:string) {\r\n        alert(text);\r\n    }\r\n    protected errorPage(header:string, err:any) {\r\n        this.openPage(<Page header=\"App error!\">\r\n            <pre>\r\n                {typeof err === 'string'? err : err.message}\r\n            </pre>\r\n        </Page>);\r\n    }\r\n\r\n    protected onMessage(message:any):Promise<void> {\r\n        return;\r\n    }\r\n\r\n    private onMessageReceive = async (message:any):Promise<void> => {\r\n        await this.onMessage(message);\r\n    }\r\n\r\n    protected async beforeStart():Promise<boolean> {\r\n        return true;\r\n\t}\r\n\tprotected async afterStart():Promise<void> {\r\n\t}\r\n    protected registerReceiveHandler() {\r\n        this.receiveHandlerId = messageHub.registerReceiveHandler(this.onMessageReceive);\r\n    }\r\n\r\n    protected abstract internalStart(param?:any, ...params:any[]):Promise<void>;\r\n    async start(param?:any, ...params:any[]):Promise<void> {\r\n\t\tthis.registerReceiveHandler();\r\n        let ret = await this.beforeStart();\r\n        if (ret === false) return;\r\n\t\tawait this.internalStart(param, ...params);\r\n\t\tawait this.afterStart();\r\n    }\r\n\r\n    get isCalling():boolean {return this._resolve_$ !== undefined}\r\n\r\n    private _resolve_$:((value:any) => void)[];\r\n    async call<T>(param?:any, ...params:any[]):Promise<T> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<T> (async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await this.start(param, ...params);\r\n        });\r\n    }\r\n\r\n    async vCall<C extends Controller>(vp: new (controller: C)=>VPage<C>, param?:any):Promise<any> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<any> (async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await (new vp(this as any)).open(param);\r\n        });\r\n    }\r\n\r\n    returnCall(value:any) {\r\n        if (this._resolve_$ === undefined) return;\r\n        let resolve = this._resolve_$.pop();\r\n        if (resolve === undefined) {\r\n            alert('the Controller call already returned, or not called');\r\n            return;\r\n        }\r\n        resolve(value);\r\n    }\r\n\r\n    openPage(page:JSX.Element, onClosePage?: (ret:any)=>void) {\r\n\t\tlet disposer: ()=>void;\r\n\t\tif (onClosePage !== undefined) {\r\n\t\t\tdisposer = () => {\r\n\t\t\t\t//if (this.disposer) this.disposer();\r\n\t\t\t\tonClosePage(undefined);\r\n\t\t\t}\r\n\t\t}\r\n\r\n        nav.push(page, disposer);\r\n        //this.disposer = undefined;\r\n    }\r\n\r\n    replacePage(page:JSX.Element, onClosePage?: ()=>void) {\r\n        nav.replace(page, onClosePage);\r\n        //this.disposer = undefined;\r\n    }\r\n\r\n    backPage() {\r\n        nav.back();\r\n    }\r\n\r\n    closePage(level?:number) {\r\n        nav.pop(level);\r\n    }\r\n\r\n    ceasePage(level?:number) {\r\n        nav.ceaseTop(level);\r\n\t}\r\n\t\r\n\tgo(showPage:()=>void, url:string, absolute?:boolean) {\r\n\t\tnav.go(showPage, url, absolute);\r\n\t}\r\n\r\n    removeCeased() {\r\n        nav.removeCeased();\r\n    }\r\n\r\n    regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        nav.regConfirmClose(confirmClose);\r\n\t}\r\n\r\n\tprivate topPageKey:any;\r\n\tprotected startAction() {\r\n\t\tthis.topPageKey = nav.topKey();\r\n    }\r\n    get TopKey() {\r\n        return this.topPageKey;\r\n    }\r\n    SetTopKey(key:any) {\r\n        this.topPageKey = key;\r\n    }\r\n\tpublic popToTopPage() {\r\n\t\tnav.popTo(this.topPageKey);\r\n\t}\r\n\r\n    async confirm(options: ConfirmOptions): Promise<'ok'|'yes'|'no'|undefined> {\r\n        return new Promise<'ok'|'yes'|'no'|undefined> (async (resolve, reject) => {\r\n            let {caption, message, ok, yes, no, classNames} = options;\r\n            let close = (res:'ok'|'yes'|'no'|undefined) => {\r\n                this.closePage();\r\n                resolve(res);\r\n            }\r\n            let buttons:any[] = [];\r\n            if (ok !== undefined) {\r\n                buttons.push(<button key=\"ok\" className=\"btn btn-primary mr-3\" onClick={()=>close('ok')}>{ok}</button>);\r\n            }\r\n            if (yes !== undefined) {\r\n                buttons.push(<button key=\"yes\" className=\"btn btn-success mr-3\" onClick={()=>close('yes')}>{yes}</button>);\r\n            }\r\n            if (no !== undefined) {\r\n                buttons.push(<button key=\"no\" className=\"btn btn-outline-danger mr-3\" onClick={()=>close('no')}>{no}</button>);\r\n            }\r\n            this.openPage(<Page header={caption || '请确认'} back=\"close\">\r\n                <div className={classNames || \"rounded bg-white m-5 p-3 border\"}>\r\n                    <div className=\"d-flex align-items-center justify-content-center\">\r\n                        {message}\r\n                    </div>\r\n                    <div className=\"mt-3 d-flex align-items-center justify-content-center\">\r\n                        {buttons}\r\n                    </div>\r\n                </div>\r\n            </Page>);\r\n            nav.regConfirmClose(async ():Promise<boolean> => {\r\n                resolve(undefined);\r\n                return true;\r\n            });\r\n        });\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Page, Image, UserView } from '../components';\r\nimport { env, User } from '../tool';\r\nimport { Controller } from './controller';\r\nimport { VPage } from './vpage';\r\n\r\nexport abstract class View<C extends Controller> {\r\n    protected controller: C;\r\n    protected readonly res: any;\r\n\tprotected readonly x: any;\r\n\tprotected readonly t: (str:string)=>any;\r\n\r\n    constructor(controller: C) {\r\n        this.controller = controller;\r\n\t\tthis.t = controller.t;\r\n    }\r\n\r\n\tprotected get isDev() {return  env.isDevelopment}\r\n\tget isWebNav(): boolean {return this.controller.isWebNav}\r\n\tnavigate(url:string) {this.controller.navigate(url)}\r\n\tprotected isMe(id:any) {return this.controller.isMe(id)}\r\n    abstract render(param?:any): JSX.Element;\r\n\r\n    protected renderVm(vm: new (controller: C)=>View<C>, param?:any) {\r\n        return (new vm(this.controller)).render(param);\r\n    }\r\n\r\n    protected async openVPage(vp: new (controller: C)=>VPage<C>, param?:any, afterBack?:()=>Promise<void>):Promise<void> {\r\n        await (new vp(this.controller)).open(param, afterBack);\r\n    }\r\n\r\n    protected async event(type:string, value?:any) {\r\n        await this.controller.event(type, value);\r\n\t}\r\n\t\r\n\tprotected go(showPage:()=>void, url:string, absolute?:boolean) {\r\n\t\tthis.controller.go(showPage, url, absolute);\r\n\t}\r\n\r\n    async vCall<C extends Controller>(vp: new (controller: C)=>VPage<C>, param?:any):Promise<any> {\r\n        return await this.controller.vCall(vp, param);\r\n    }\r\n\r\n    protected returnCall(value:any) {\r\n        this.controller.returnCall(value);\r\n    }\r\n\r\n\tprotected renderUser(user:any, imageClassName?:string, textClassName?:string) {\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {name, nick, icon} = user;\r\n\t\t\treturn <>\r\n\t\t\t\t<Image src={icon} className={imageClassName || 'w-1c h-1c mr-2'} />\r\n\t\t\t\t<span className={textClassName}>{nick || name}</span>\r\n\t\t\t</>;\r\n\t\t}\r\n\t\treturn <UserView user={user} render={renderUser} />\r\n\t}\r\n\r\n\tprotected renderUserText(user:any) {\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {name, nick} = user;\r\n\t\t\treturn <>{nick || name}</>;\r\n\t\t}\r\n\t\treturn <UserView user={user} render={renderUser} />\r\n\t}\r\n\r\n\tprotected renderMe(imageClassName?:string, textClassName?:string) {\r\n\t\tlet {user} = this.controller;\r\n\t\tif (!user) return;\r\n\t\treturn this.renderUser(user.id, imageClassName, textClassName);\r\n\t}\r\n\r\n    protected openPage(view: React.StatelessComponent<any>, param?:any, onClosePage?:(ret:any)=>void) {\r\n        let type = typeof param;\r\n        if (type === 'object' || type === 'undefined') {\r\n            this.controller.openPage(React.createElement(view, param), onClosePage);\r\n        }\r\n        else {\r\n            this.controller.openPage(<Page header=\"param type error\">\r\n                View.openPage param must be object, but here is {type}\r\n            </Page>, onClosePage);\r\n        }\r\n    }\r\n\r\n    protected replacePage(view: React.StatelessComponent<any>, param?:any) {\r\n        this.controller.replacePage(React.createElement(view, param));\r\n    }\r\n\r\n    protected openPageElement(page: JSX.Element, onClosePage?: ()=>void) {\r\n        this.controller.openPage(page, onClosePage);\r\n    }\r\n\r\n    protected replacePageElement(page: JSX.Element, onClosePage?: ()=>void) {\r\n        this.controller.replacePage(page, onClosePage);\r\n    }\r\n\r\n    protected backPage() {\r\n        this.controller.backPage();\r\n    }\r\n\r\n    protected closePage(level?:number) {\r\n        this.controller.closePage(level);\r\n    }\r\n\r\n    protected ceasePage(level?:number) {\r\n        this.controller.ceasePage(level);\r\n    }\r\n\r\n    protected removeCeased() {\r\n        this.controller.removeCeased();\r\n    }\r\n\r\n    protected regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        this.controller.regConfirmClose(confirmClose);\r\n\t}\r\n\r\n\tprotected popToTopPage() {\r\n\t\tthis.controller.popToTopPage();\r\n\t}\r\n}\r\n","import { Page, Scroller, TabsProps } from \"../components\";\r\nimport { View } from \"./view\";\r\nimport { Controller } from \"./controller\";\r\n\r\nexport abstract class VPage<C extends Controller> extends View<C> {\r\n\tprotected retOnClosePage: any;\r\n\r\n    open(param?:any, onClosePage?:(ret:any)=>void):Promise<void> {\r\n\t\tthis.init(param);\r\n\t\tlet _onClosePage: ()=>void;\r\n\t\tif (onClosePage !== undefined) _onClosePage = () => onClosePage(this.retOnClosePage);\r\n\t\tthis.openPageElement(this.renderPage(), _onClosePage);\r\n\t\treturn;\r\n\t}\r\n\r\n    replaceOpen(param?:any, onClosePage?:(ret:any)=>void):Promise<void> {\r\n\t\tthis.init(param);\r\n\t\tlet _onClosePage: ()=>void;\r\n\t\tif (onClosePage !== undefined) _onClosePage = () => onClosePage(this.retOnClosePage);\r\n\t\tthis.replacePageElement(this.renderPage(), _onClosePage);\r\n\t\treturn;\r\n\t}\r\n\r\n\trender(param?:any):JSX.Element {\r\n\t\tthis.init(param);\r\n\t\treturn this.renderPage();\r\n\t}\r\n\r\n\tinit(param?:any):void {return;}\r\n\r\n\theader():string|boolean|JSX.Element {return null;}\r\n\tright():JSX.Element {return null;}\r\n\tcontent():JSX.Element {return null;}\r\n\tfooter():JSX.Element {return null;}\r\n\tlogout(): boolean | (()=>Promise<void>) {return false;}\r\n\tprotected renderPage():JSX.Element {\r\n\t\tlet header = this.header();\r\n\t\tif (!header) header = false;\r\n\t\tlet logout = this.logout();\r\n\t\treturn <Page\r\n\t\t\theader={header} right={this.right()} footer={this.footer()}\r\n\t\t\tonScroll={(e:any)=>this.onPageScroll(e)}\r\n\t\t\tonScrollTop={(scroller: Scroller) => this.onPageScrollTop(scroller)}\r\n\t\t\tonScrollBottom={(scroller: Scroller) => this.onPageScrollBottom(scroller)}\r\n\t\t\tback={this.back}\r\n\t\t\theaderClassName={this.headerClassName}\r\n\t\t\tclassName={this.className}\r\n\t\t\tafterBack={()=>this.afterBack()}\r\n\t\t\ttabsProps={this.tabsProps}\r\n\t\t\tlogout={logout}\r\n\t\t\twebNav={this.controller.pageWebNav}\r\n\t\t>\r\n\t\t\t{this.content()}\r\n\t\t</Page>;\r\n\t}\r\n\r\n\tprotected onPageScroll(e:any) {}\r\n\tprotected async onPageScrollTop(scroller: Scroller): Promise<boolean> {return false;}\r\n\tprotected async onPageScrollBottom(scroller: Scroller): Promise<void> {return;}\r\n\tprotected afterBack():void {}\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'back'}\r\n\tprotected get headerClassName(): string {return null;}\r\n\tprotected get className(): string {return null;}\r\n\tprotected get tabsProps(): TabsProps {return null;}\r\n}\r\n","import { UqApi } from '../net';\r\nimport { LocalCache } from '../tool';\r\nimport { UqMan, Field, ArrFields, FieldMap } from './uqMan';\r\nimport { Tuid } from './tuid';\r\nimport { getObjPropIgnoreCase } from '../tool';\r\n\r\nconst tab = '\\t';\r\nconst ln = '\\n';\r\nconst chars = '\\\\ntbfvr';\r\nconst codeBackSlash = chars.charCodeAt(0);\r\nconst codeN = chars.charCodeAt(1);\r\nconst codeT = chars.charCodeAt(2);\r\nconst codeB = chars.charCodeAt(3);\r\nconst codeF = chars.charCodeAt(4);\r\nconst codeV = chars.charCodeAt(5);\r\nconst codeR = chars.charCodeAt(6);\r\n\r\nconst codes = '\\n\\t\\b\\f\\v\\r';\r\nconst codeBN = codes.charCodeAt(0);\r\nconst codeBT = codes.charCodeAt(1);\r\nconst codeBB = codes.charCodeAt(2);\r\nconst codeBF = codes.charCodeAt(3);\r\nconst codeBV = codes.charCodeAt(4);\r\nconst codeBR = codes.charCodeAt(5);\r\n\r\nexport abstract class Entity {\r\n    private jName: string;\r\n    schema: any;\r\n    ver: number = 0;\r\n    sys?: boolean;\r\n    readonly uq: UqMan;\r\n    readonly name: string;\r\n    readonly typeId: number;\r\n    readonly cache: LocalCache;\r\n    readonly uqApi: UqApi;\r\n    abstract get typeName(): string;\r\n    get sName():string {return this.jName || this.name}\r\n    fields: Field[];\r\n    arrFields: ArrFields[];\r\n    returns: ArrFields[];\r\n\r\n    constructor(uq:UqMan, name:string, typeId:number) {\r\n        this.uq = uq;\r\n        this.name = name;\r\n        this.typeId = typeId;\r\n        this.sys = this.name.indexOf('$') >= 0;\r\n        this.cache = this.uq.localMap.item(this.name); // new EntityCache(this);\r\n        this.uqApi = this.uq.uqApi;\r\n    }\r\n\r\n    public face: any;           // 对应字段的label, placeHolder等等的中文，或者语言的翻译\r\n\r\n    //getApiFrom() {return this.entities.uqApi;}\r\n\r\n    private fieldMaps: {[arr:string]: FieldMap} = {};\r\n    fieldMap(arr?:string): FieldMap {\r\n        if (arr === undefined) arr = '$';\r\n        let ret = this.fieldMaps[arr];\r\n        if (ret === undefined) {\r\n            let fields:Field[];\r\n            if (arr === '$') fields = this.fields;\r\n            else if (this.arrFields !== undefined) {\r\n                let arrFields = this.arrFields.find(v => v.name === arr);\r\n                if (arrFields !== undefined) fields = arrFields.fields;\r\n            }\r\n            else if (this.returns !== undefined) {\r\n                let arrFields = this.returns.find(v => v.name === arr);\r\n                if (arrFields !== undefined) fields = arrFields.fields;\r\n            }\r\n            if (fields === undefined) return {};\r\n            ret = {};\r\n            for (let f of fields) ret[f.name] = f;\r\n            this.fieldMaps[arr] = ret;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    public async loadSchema():Promise<void> {\r\n        if (this.schema !== undefined) return;\r\n        let schema = this.cache.get();\r\n        if (!schema) {\r\n            schema = await this.uq.loadEntitySchema(this.name);\r\n        }\r\n        //this.setSchema(schema);\r\n\t\t//this.buildFieldsTuid();\r\n\t\tthis.buildSchema(schema);\r\n\t\tawait this.loadValues();\r\n\t}\r\n\r\n\tbuildSchema(schema: any) {\r\n        this.setSchema(schema);\r\n\t\tthis.buildFieldsTuid();\r\n\t\t//await this.loadValues();\r\n\t}\r\n\t\r\n\tprotected async loadValues():Promise<any> {}\r\n\r\n    // 如果要在setSchema里面保存cache，必须先调用clearSchema\r\n    public clearSchema() {\r\n        this.schema = undefined;\r\n    }\r\n\r\n    public setSchema(schema:any) {\r\n        if (schema === undefined) return;\r\n        let {name, version} = schema;\r\n        this.ver = version || 0;\r\n\t\tthis.setJName(name);\r\n        this.cache.set(schema);\r\n\t\tthis.schema = schema;\r\n\t\tthis.buildFieldsTuid();\r\n\t}\r\n\t\r\n\tprotected setJName(name:string) {\r\n        if (name !== this.name) this.jName = name;\r\n\t}\r\n\r\n    public buildFieldsTuid() {\r\n        let {fields, arrs, returns} = this.schema;\r\n        this.uq.buildFieldTuid(this.fields = fields);\r\n        this.uq.buildArrFieldsTuid(this.arrFields = arrs, fields);\r\n        this.uq.buildArrFieldsTuid(this.returns = returns, fields);\r\n    }\r\n\r\n    schemaStringify():string {\r\n        return JSON.stringify(this.schema, (key:string, value:any) => {\r\n            if (key === '_tuid') return undefined;\r\n            return value;\r\n        }, 4);\r\n    }\r\n\r\n    tuidFromName(fieldName:string, arrName?:string):Tuid {\r\n        if (this.schema === undefined) return;\r\n        let {fields, arrs} = this.schema;\r\n        let entities = this.uq;\r\n        function getTuid(fn:string, fieldArr:Field[]) {\r\n            if (fieldArr === undefined) return;\r\n            let f = fieldArr.find(v => v.name === fn);\r\n            if (f === undefined) return;\r\n            return entities.getTuid(f.tuid);\r\n        }\r\n        let fn = fieldName.toLowerCase();\r\n        if (arrName === undefined) return getTuid(fn, fields);\r\n        if (arrs === undefined) return;\r\n        let an = arrName.toLowerCase();\r\n        let arr = (arrs as ArrFields[]).find(v => v.name === an);\r\n        if (arr === undefined) return;\r\n        return getTuid(fn, arr.fields);\r\n    }\r\n\r\n    buildParams(params:any):any {\r\n        let result:any = {};\r\n        let fields = this.fields;\r\n        if (fields !== undefined) this.buildFieldsParams(result, fields, params);\r\n        let arrs = this.arrFields;\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let {name, fields} = arr;\r\n                let paramsArr:any[] = params[name];\r\n                if (paramsArr === undefined) continue;\r\n                let arrResult:any[] = [];\r\n                result[name] = arrResult;\r\n                for (let pa of params) {\r\n                    let rowResult = {};\r\n                    this.buildFieldsParams(rowResult, fields, pa);\r\n                    arrResult.push(rowResult);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private buildFieldsParams(result:any, fields:Field[], params:any) {\r\n        for (let field of fields) {\r\n            let {name, type} = field;            \r\n            let d = params[name];\r\n            let val:any;\r\n            switch (type) {\r\n\t\t\t\tcase 'datetime':\r\n                \tval = this.buildDateTimeParam(d);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'date':\r\n\t\t\t\t\tif (d instanceof Date) {\r\n\t\t\t\t\t\tval = `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tval = d;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tswitch (typeof d) {\r\n\t\t\t\t\t\tdefault: val = d; break;\r\n\t\t\t\t\t\tcase 'object':\r\n\t\t\t\t\t\t\tif (d instanceof Date) {\r\n\t\t\t\t\t\t\t\tval = d;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tlet tuid = field._tuid;\r\n\t\t\t\t\t\t\tif (tuid === undefined) val = d.id;\r\n\t\t\t\t\t\t\telse val = tuid.getIdFromObj(d);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n            }\r\n            result[name] = val;\r\n        }\r\n    }\r\n\r\n    buildDateTimeParam(val:any) {\r\n        let dt: Date;\r\n        switch (typeof val) {\r\n            default: debugger; throw new Error('escape datetime field in pack data error: value=' + val);\r\n            case 'undefined': return undefined;\r\n            case 'object': dt = (val as Date); break;\r\n            case 'string':\r\n            case 'number': dt = new Date(val); break;\r\n        }\r\n        return Math.floor(dt.getTime()/1000);\r\n    }\r\n\r\n    buildDateParam(val:any) {\r\n        let dt: Date;\r\n        switch (typeof val) {\r\n            default: debugger; throw new Error('escape datetime field in pack data error: value=' + val);\r\n            case 'undefined': return '';\r\n            case 'string': return val;\r\n            case 'object': dt = (val as Date); break;\r\n            case 'number': dt = new Date(val); break;\r\n        }\r\n        let ret = dt.toISOString();\r\n        let p = ret.indexOf('T');\r\n        return p>0? ret.substr(0, p) : ret;\r\n    }\r\n\r\n    pack(data:any):string {\r\n        let ret:string[] = [];\r\n        let fields = this.fields;\r\n        if (fields !== undefined) this.packRow(ret, fields, data);\r\n        let arrs = this.arrFields; \r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n\t\t\t\tlet {name, fields} = arr;\r\n\t\t\t\tlet arrData = getObjPropIgnoreCase(data, name);\r\n\t\t\t\t//if (!arrData) arrData = data[name.toLowerCase()];\r\n                this.packArr(ret, fields, arrData);\r\n            }\r\n        }\r\n        return ret.join('');\r\n    }\r\n\r\n    private escape(row:any, field:Field):any {\r\n        let d = row[field.name];\r\n        switch (field.type) {\r\n            case 'datetime':\r\n                return this.buildDateTimeParam(d);\r\n            default:\r\n                switch (typeof d) {\r\n                    default: return d;\r\n                    case 'object':\r\n                        let tuid = field._tuid;\r\n                        if (tuid === undefined) return d.id;\r\n                        return tuid.getIdFromObj(d);\r\n                    case 'string':\r\n                        let len = d.length;\r\n                        let r = '', p = 0;\r\n                        for (let i=0;i<len;i++) {\r\n                            let c:number = d.charCodeAt(i), ch:string;\r\n                            switch(c) {\r\n\t\t\t\t\t\t\t\tdefault: continue;\r\n\t\t\t\t\t\t\t\tcase codeBackSlash: ch = '\\\\\\\\'; break;\r\n                                case codeBT: ch = '\\\\t'; break;\r\n\t\t\t\t\t\t\t\tcase codeBN: ch = '\\\\n'; break;\r\n\t\t\t\t\t\t\t\tcase codeBF: ch = '\\\\f'; break;\r\n\t\t\t\t\t\t\t\tcase codeBV: ch = '\\\\v'; break;\r\n\t\t\t\t\t\t\t\tcase codeBB: ch = '\\\\b'; break;\r\n\t\t\t\t\t\t\t\tcase codeBR: ch = '\\\\r'; break;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tr += d.substring(p, i) + ch;\r\n\t\t\t\t\t\t\tp = i+1;\r\n                        }\r\n                        return r + d.substring(p);\r\n                    case 'undefined': return '';\r\n                }\r\n        }\r\n    }\r\n\r\n    private packRow(result:string[], fields:Field[], data:any) {\r\n        let len = fields.length;\r\n        if (len === 0) return;\r\n        let ret = '';\r\n        ret += this.escape(data, fields[0]);\r\n        for (let i=1;i<len;i++) {\r\n            let f = fields[i];\r\n            ret += tab + this.escape(data, f);\r\n        }\r\n        result.push(ret + ln);\r\n    }\r\n\r\n    private packArr(result:string[], fields:Field[], data:any[]) {\r\n        if (data !== undefined) {\r\n\t\t\tif (data.length === 0) {\r\n\t\t\t\tresult.push(ln);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfor (let row of data) {\r\n\t\t\t\t\tthis.packRow(result, fields, row);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tresult.push(ln);\r\n\t\t}\r\n        result.push(ln);\r\n    }\r\n    protected cacheFieldsInValue(values:any, fields:Field[]) {\r\n        for (let f of fields as Field[]) {\r\n            let {name, _tuid} = f;\r\n            if (_tuid === undefined) continue;\r\n            let id = values[name];\r\n            //_tuid.useId(id);\r\n            values[name] = _tuid.boxId(id);\r\n        }\r\n    }\r\n\r\n    protected unpackTuidIdsOfFields(values:string[], fields: Field[]):any[] {\r\n        if (fields === undefined) return values as any[];\r\n        //if (this.fields === undefined) return values as any[];\r\n        let ret:any[] = []\r\n        for (let ln of values) {\r\n            if (!ln) continue;\r\n            let len = ln.length;\r\n            let p = 0;\r\n            while (p<len) {\r\n                let ch = ln.charCodeAt(p);\r\n                if (ch === 10) {\r\n                    ++p;\r\n                    break;\r\n                }\r\n                let row = {};\r\n                p = this.unpackRow(row, fields, ln, p);\r\n                ret.push(row);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    unpackSheet(data:string):any {\r\n        let ret = {} as any; //new this.newMain();\r\n        //if (schema === undefined || data === undefined) return;\r\n        let fields = this.fields;\r\n        let p = 0;\r\n        if (fields !== undefined) p = this.unpackRow(ret, fields, data, p);\r\n        let arrs = this.arrFields; //schema['arrs'];\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                p = this.unpackArr(ret, arr, data, p);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n\tunpackReturns(data:string, returns?:ArrFields[]):{[name:string]:any[]} {\r\n\t\tif (data === undefined) debugger;\r\n\t\tlet ret = {} as any;\r\n\t\tlet p = 0;\r\n\t\tlet arrs = returns || this.returns;\r\n\t\tif (arrs !== undefined) {\r\n\t\t\tfor (let arr of arrs) {\r\n\t\t\t\tp = this.unpackArr(ret, arr, data, p);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n    protected unpackRow(ret:any, fields:Field[], data:string, p:number):number {\r\n        let ch0 = 0, ch = 0, c = p, i = 0, len = data.length, fLen = fields.length;\r\n        for (;p<len;p++) {\r\n            ch0 = ch;\r\n            ch = data.charCodeAt(p);\r\n            if (ch === 9) {\r\n                let f = fields[i];\r\n                let {name} = f;\r\n                if (ch0 !== 8) {\r\n                    if (p>c) {\r\n                        let v = data.substring(c, p);\r\n                        ret[name] = this.to(ret, v, f);\r\n                    }\r\n                }\r\n                else {\r\n                    ret[name] = null;\r\n                }\r\n                c = p+1;\r\n                ++i;\r\n                if (i>=fLen) {\r\n                    p = data.indexOf('\\n', c);\r\n                    if (p >= 0) ++p;\r\n                    else p = len;\r\n                    return p;\r\n                }\r\n            }\r\n            else if (ch === 10) {\r\n                let f = fields[i];\r\n                let {name} = f;\r\n                if (ch0 !== 8) {\r\n                    if (p>c) {\r\n                        let v = data.substring(c, p);\r\n                        ret[name] = this.to(ret, v, f);\r\n                    }\r\n                }\r\n                else {\r\n                    ret[name] = null;\r\n                }\r\n                ++p;\r\n                ++i;\r\n                return p;\r\n            }\r\n        }\r\n        let f = fields[i];\r\n        let {name} = f;\r\n        if (ch0 !== 8) {\r\n            let v = data.substring(c);\r\n            ret[name] = this.to(ret, v, f);\r\n        }\r\n        return len;\r\n    }\r\n\r\n    private to(ret:any, v:string, f:Field):any {\r\n        switch (f.type) {\r\n\t\t\tdefault: return v;\r\n\t\t\tcase 'text':\r\n\t\t\tcase 'char':\r\n\t\t\t\treturn this.reverseNT(v);\r\n            case 'datetime':\r\n            case 'time':\r\n\t\t\tcase 'timestamp':\r\n                let n = Number(v);\r\n                let date = isNaN(n) === true? new Date(v) : new Date(n*1000);\r\n                return date;\r\n            case 'date':\r\n                let parts = v.split('-');\r\n                return new Date(Number(parts[0]), Number(parts[1])-1, Number(parts[2]));\r\n            case 'tinyint':\r\n            case 'smallint':\r\n            case 'int':\r\n            case 'bigint':\r\n            case 'dec':\r\n\t\t\tcase 'float':\r\n\t\t\tcase 'double':\r\n                return Number(v);\r\n            case 'id':\r\n                let id = Number(v);\r\n                let {_tuid} = f;\r\n                if (_tuid === undefined) return id;\r\n                return _tuid.boxId(id);\r\n        }\r\n\t}\r\n\t\r\n\tprivate reverseNT(text:string):string {\r\n\t\tif (text === undefined) return;\r\n\t\tif (text === null) return;\r\n\t\tlet len = text.length;\r\n\t\tlet r = '';\r\n\t\tlet p = 0;\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet c = text.charCodeAt(i);\r\n\t\t\tif (c === codeBackSlash) {\r\n\t\t\t\tif (i===len-1) break;\r\n\t\t\t\tlet c1 = text.charCodeAt(i+1);\r\n\t\t\t\tlet ch:string;\r\n\t\t\t\tswitch (c1) {\r\n\t\t\t\t\tdefault: continue;\r\n\t\t\t\t\tcase codeBackSlash: ch = '\\\\'; break;\r\n\t\t\t\t\tcase codeN: ch = '\\n'; break;\r\n\t\t\t\t\tcase codeT: ch = '\\t'; break;\r\n\t\t\t\t\tcase codeB: ch = '\\b'; break;\r\n\t\t\t\t\tcase codeF: ch = '\\f'; break;\r\n\t\t\t\t\tcase codeV: ch = '\\v'; break;\r\n\t\t\t\t\tcase codeR: ch = '\\r'; break;\r\n\t\t\t\t}\r\n\t\t\t\tr += text.substring(p, i) + ch;\r\n\t\t\t\tp = i+2;\r\n\t\t\t\t++i;\r\n\t\t\t}\r\n\t\t}\r\n\t\tr += text.substring(p, len);\r\n\t\treturn r;\r\n\t}\r\n\r\n    private unpackArr(ret:any, arr:ArrFields, data:string, p:number):number {\r\n\t\tlet p0 = p;\r\n        let vals:any[] = [], len = data.length;\r\n        let {name, fields} = arr;\r\n        while (p<len) {\r\n            let ch = data.charCodeAt(p);\r\n            if (ch === 10) {\r\n\t\t\t\tif (p === p0) {\r\n\t\t\t\t\tch = data.charCodeAt(p);\r\n\t\t\t\t\tif (ch !== 10) {\r\n\t\t\t\t\t\tthrow new Error('upackArr: arr第一个字符是10，则必须紧跟一个10，表示整个arr的结束')\r\n\t\t\t\t\t}\r\n\t\t\t\t\t++p;\r\n\t\t\t\t}\r\n                ++p;\r\n                break;\r\n            }\r\n            let val = {} as any; //new creater();\r\n            vals.push(val);\r\n            p = this.unpackRow(val, fields, data, p);\r\n        }\r\n        ret[name] = vals;\r\n        return p;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { ItemSchema, UiItem, UiSelectBase } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { FieldRule } from '../form/rules';\r\nimport { Image } from '../image';\r\nimport { Edit } from './edit';\r\n\r\nexport abstract class ItemEdit {\r\n\tprotected edit: Edit;\r\n\tprotected name: string;\r\n\tprotected _itemSchema: ItemSchema;\r\n    get itemSchema(): ItemSchema {return this._itemSchema}\r\n    protected _uiItem:UiItem;\r\n    get uiItem():UiItem {return this._uiItem}\r\n    value: any;\r\n\tlabel: string|JSX.Element;\r\n\tget editInRow(): boolean {return false;}\r\n    protected newValue: any;\r\n\r\n    error: string = null;\r\n    isChanged: boolean = false;\r\n\r\n    constructor(edit:Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string|JSX.Element, value: any) {\r\n\t\tmakeObservable(this, {\r\n\t\t\terror: observable,\r\n\t\t\tisChanged: observable,\r\n\t\t});\r\n\t\tthis.edit = edit;\r\n        this._itemSchema = itemSchema;\r\n        this._uiItem = uiItem\r\n        this.value = value;\r\n        let {name} = itemSchema;\r\n        this.name = name;\r\n        this.label = label;\r\n\t}\r\n\t\r\n\tinit() {\t\t\r\n\t}\r\n\r\n    async start():Promise<any> {\r\n        return await this.internalStart();\r\n    }\r\n\r\n    protected abstract internalStart():Promise<any>;\r\n\r\n    async end():Promise<any> {\r\n        await this.internalEnd()\r\n    }\r\n\r\n\trenderContent() {\r\n        let {name, type} = this._itemSchema;\r\n        let divValue:any;\r\n        let uiItem = this._uiItem;\r\n        let label:string|JSX.Element, labelHide:boolean;\r\n        if (uiItem === undefined) {\r\n            label = name;\r\n        }\r\n        else {\r\n\t\t\tlabel = uiItem.label;\r\n\t\t\tlabelHide = uiItem.labelHide;\r\n            let templet = uiItem.Templet;\r\n            if (templet !== undefined) {\r\n                if (typeof templet === 'function') {\r\n\t\t\t\t\tif (this.value !== undefined) divValue = templet(this.value);\r\n\t\t\t\t}\r\n                else {\r\n\t\t\t\t\tdivValue = {templet};\r\n\t\t\t\t}\r\n            }\r\n            else if (this.value !== undefined) {\r\n                switch (uiItem.widget) {\r\n                    case 'radio':\r\n                    case 'select':\r\n                        let {list} = uiItem as UiSelectBase;\r\n                        divValue = <b>{list.find(v => v.value === this.value).title}</b>;\r\n                        break;\r\n                    case 'id':\r\n                        divValue = <b>no templet for {name}={this.value}</b>\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        if (divValue === undefined) {\r\n            switch (type) {\r\n                default:\r\n                    divValue = this.value? \r\n\t\t\t\t\t\t<b>{this.value}</b> \r\n\t\t\t\t\t\t:\r\n\t\t\t\t\t\t<small className=\"text-muted\">[{labelHide===true? label:'无'}]</small>;\r\n                    break;\r\n                case 'image':\r\n                    divValue = <Image className=\"w-4c h-4c\" src={this.value} />;\r\n                    break;\r\n            }\r\n\t\t}\r\n\t\treturn divValue;\r\n\t}\r\n\r\n    protected async internalEnd():Promise<void> {nav.pop()}\r\n\r\n    protected verifyValue() {\r\n        if (this.uiItem === undefined) return;\r\n        let {rules} = this.uiItem;\r\n        if (rules === undefined) return;\r\n        let nv = this.newValue;\r\n        function verifyRule(rule:FieldRule, value: any):string {\r\n            let error = rule(nv);\r\n            if (error !== undefined) {\r\n                if (typeof error !== 'object')\r\n                    return error;\r\n                else\r\n                    return JSON.stringify(error);\r\n            }\r\n        }\r\n        if (Array.isArray(rules)) {\r\n            for (let rule of rules) {\r\n                let error = verifyRule(rule as FieldRule, nv);\r\n                if (error !== undefined) {\r\n                    this.error = error;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this.error = verifyRule(rules as FieldRule, nv);\r\n        }\r\n    }\r\n}\r\n","//import _ from 'lodash';\r\nimport { KeyValueRes, Res } from './res';\r\n\r\nexport interface FormRes extends KeyValueRes {\r\n    required: string;\r\n    number: string;\r\n    integer: string;\r\n    min: string;\r\n    max: string;\r\n}\r\n\r\n/*eslint no-template-curly-in-string: 0*/\r\nexport const formRes:Res<FormRes> = {\r\n    _: {\r\n        required: 'required',\r\n        number: 'not valid number',\r\n        integer: 'not valid integer',\r\n        min: 'min value is ${min}',\r\n        max: 'max value is ${max}',\r\n    },\r\n    zh: {\r\n        _: {\r\n            required: '必须填',\r\n            number: '需要数字',\r\n            integer: '需要整数',\r\n            min: '不能小于${min}',\r\n            max: '不能大于${max}',\r\n        }\r\n    },\r\n}\r\n","import { KeyValueRes, Res } from './res';\r\n\r\nexport interface ListRes extends KeyValueRes {\r\n    none: string;\r\n}\r\n\r\n/*eslint no-template-curly-in-string: 0*/\r\nexport const listRes:Res<ListRes> = {\r\n    _: {\r\n        none: '[none]',\r\n    },\r\n    zh: {\r\n        _: {\r\n            none: '[无]',\r\n        }\r\n    },\r\n}\r\n","//import _ from 'lodash';\r\nimport { Caller } from '../net';\r\nimport { Entity } from './entity';\r\nimport { Action } from './action';\r\nimport { Query } from './query';\r\n\r\ninterface UqResponseSchema {\r\n    uq: any;\r\n    entity: any;\r\n}\r\n\r\nexport abstract class EntityCaller<T> extends Caller<T> {\r\n    private tries: number;\r\n    protected _entity: Entity;\r\n\r\n    constructor(entity: Entity, params:T, waiting: boolean = true) {\r\n        super(params, waiting);\r\n        this.tries = 0;\r\n        this._entity = entity;\r\n    }\r\n\r\n    protected get entity(): Entity {return this._entity;}\r\n\r\n    //大多的entityCaller都不需要这个\r\n    //buildParams() {return this.entity.buildParams(this.params);}\r\n    \r\n    async request(): Promise<any> {\r\n        await this.entity.loadSchema();\r\n        let ret = await this.innerRequest();\r\n        return ret;\r\n    }\r\n\r\n    protected async innerCall(): Promise<any> {\r\n        return await this.entity.uqApi.xcall(this);\r\n    }\r\n\r\n    async innerRequest(): Promise<any> {\r\n        let jsonResult = await this.innerCall();\r\n        let {$uq, $modify, res} = jsonResult;\r\n        this.entity.uq.pullModify($modify);\r\n        if ($uq === undefined) {\r\n            //if (res === undefined) debugger;\r\n            let ret = this.xresult(res);\r\n            //if (ret === undefined) debugger;\r\n            return ret;\r\n        }\r\n        return await this.retry($uq);\r\n    }\r\n\r\n    xresult(res:any):any {return res}\r\n\r\n    get headers(): {[header:string]: string} {\r\n        let {ver, uq} = this.entity;\r\n        let {uqVersion} = uq;\r\n        return {\r\n            uq: `${uqVersion}`,\r\n            en: `${ver}`,\r\n        }\r\n    }\r\n\r\n    private async retry(schema: UqResponseSchema) {\r\n        ++this.tries;\r\n        if (this.tries > 5) throw new Error('can not get right uq response schema, 5 tries');\r\n        this.rebuildSchema(schema);\r\n        return await this.innerRequest();\r\n    }\r\n\r\n    private rebuildSchema(schema: UqResponseSchema) {\r\n        let {uq, entity} = schema;\r\n        if (uq !== undefined) {\r\n\t\t\tthis.entity.uq.buildEntities(uq);\r\n\t\t}\r\n        if (entity !== undefined) {\r\n\t\t\tthis.entity.setSchema(entity);\r\n\t\t}\r\n    }\r\n}\r\n\r\nexport abstract class ActionCaller extends EntityCaller<any> {\r\n    protected get entity(): Action {return this._entity as Action;}\r\n}\r\n\r\nexport class QueryQueryCaller extends EntityCaller<any> {\r\n    protected get entity(): Query {return this._entity as Query};\r\n    get path():string {return `query/${this.entity.name}`;}\r\n    xresult(res:any) {\r\n        let data = this.entity.unpackReturns(res);\r\n        return data;\r\n    }\r\n    buildParams() {return this.entity.buildParams(this.params);}\r\n}\r\n\r\nexport class QueryPageCaller extends EntityCaller<any> {\r\n    protected get params(): {pageStart:any; pageSize:number, params:any} {return this._params};\r\n\tprotected get entity(): Query {return this._entity as Query};\r\n\t//results: {[name:string]:any[]};\r\n\tget path():string {return `query-page/${this.entity.name}`;}\t\r\n    buildParams() {\r\n        let {pageStart, pageSize, params} = this.params;\r\n        let p:any;\r\n        if (params === undefined) {\r\n            p = {key: ''};\r\n        }\r\n        else {\r\n            p = this.entity.buildParams(params);\r\n        }\r\n        /*\r\n        switch (typeof params) {\r\n            case 'undefined': p = {key: ''}; break;\r\n            default: p = _.clone(params); break;\r\n        }\r\n        */\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        return p;\r\n    };\r\n    xresult(res:any): {[name:string]:any[]} {\r\n        let ret = this.entity.unpackReturns(res);\r\n\t\t//return this.results.$page;// as any[];\r\n\t\treturn ret;\r\n    }\r\n}\r\n","import { PageItems } from \"tonva-react\";\r\nimport { IDBase } from \"../base\";\r\n\r\nexport type IDItemsPageLoader<T> = (pageStart:any, pageSize:number) => Promise<T[]>;\r\nexport type HistoryPageLoader<T> = (id:number, field:string, far:number, near:number, pageStart:any, pageSize:number) => Promise<T[]>;\r\n\r\nexport abstract class ListPageItems<T> extends PageItems<T> {\r\n\tprivate pageLoader: IDItemsPageLoader<T>;\r\n\tconstructor(pageLoader: IDItemsPageLoader<T>) {\r\n\t\tsuper(true);\r\n\t\tthis.pageLoader = pageLoader;\r\n\t}\r\n\r\n\tasync loadResults(param:any, pageStart:any, pageSize:number): Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.pageLoader(pageStart, pageSize);\r\n\t\treturn {$page:ret};\r\n\t}\r\n\r\n\tabstract update(item: T): Promise<void>;\r\n}\r\n\r\nexport class HistoryPageItems<T extends IDBase> extends PageItems<T> {\r\n\tprivate pageLoader: HistoryPageLoader<T>;\r\n\tconstructor(pageLoader: HistoryPageLoader<T>) {\r\n\t\tsuper(true);\r\n\t\tthis.pageLoader = pageLoader;\r\n\t}\r\n\r\n\tasync loadResults(param:any, pageStart:any, pageSize:number): Promise<{[name:string]:any[]}> {\r\n\t\tlet {id, field, far, near} = param;\r\n\t\tlet ret = await this.pageLoader(id, field, far, near, pageStart, pageSize);\r\n\t\treturn {$page:ret};\r\n\t}\r\n\r\n\tupdate(item: T): Promise<void> {return;}\r\n}\r\n","import { env } from \"tonva-react\";\r\n\r\nexport abstract class TimeSpan {\r\n\tstatic create(span: 'day' | 'week' | 'month' | 'year'):TimeSpan {\r\n\t\tlet ret:TimeSpan;\r\n\t\tswitch (span) {\r\n\t\t\tcase 'day': ret = new DaySpan(); break;\r\n\t\t\tcase 'week': ret = new WeekSpan(); break;\r\n\t\t\tcase 'month': ret = new MonthSpan(); break;\r\n\t\t\tcase 'year': ret = new YearSpan(); break;\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\tprotected firstNear: number;\r\n\tfar: number;\r\n\tnear: number;\r\n\ttype: string;\r\n\r\n\tabstract prev():void;\r\n\tabstract next():void;\r\n\tabstract get title():string;\r\n\tabstract get labels():string[];\r\n\tprotected abstract getDayArray(): Date[];\r\n\r\n\tget canNext():boolean {\r\n\t\treturn this.near < this.firstNear;\r\n\t}\r\n\tget canPrev():boolean {return true;}\r\n\r\n\tgetDayValues(dayValues:{t:string;v:number}[]): number[] {\r\n\t\tlet days = this.getDayArray();\r\n\t\tlet ret:number[] = [];\r\n\t\tlet i = 0;\r\n\t\tlet dv = dayValues[i++];\r\n\t\tfor (let day of days) {\r\n\t\t\tif (dv) {\r\n\t\t\t\tlet {t, v} = dv;\r\n\t\t\t\tlet d = new Date(t);\r\n\t\t\t\td.setMinutes(d.getMinutes() + d.getTimezoneOffset());\r\n\t\t\t\tif (d.getTime() === day.getTime()) {\r\n\t\t\t\t\tret.push(v);\r\n\t\t\t\t\tdv = dayValues[i++];\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tret.push(0);\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n}\r\n\r\nclass DaySpan extends TimeSpan {\r\n\tprivate date: Date;\r\n\tprivate readonly _labels:string[] = [];\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.type = 'day';\r\n\t\tthis.date = new Date();\r\n\t\tthis.date.setHours(0, 0, 0, 0);\r\n\t\tthis.far = this.date.getTime();\r\n\t\tthis.firstNear = this.near = this.far + 24 * 3600 * 1000;\r\n\t\tfor (let i=0; i<24; i++) this._labels.push(i + ':00');\r\n\t}\r\n\tprev():void {\r\n\t\tthis.far -= 24 * 3600 * 1000;\r\n\t\tthis.near -= 24 * 3600 * 1000;\r\n\t}\r\n\tnext():void {\r\n\t\tthis.far += 24 * 3600 * 1000;\r\n\t\tthis.near += 24 * 3600 * 1000;\r\n\t}\r\n\tget title():string {\r\n\t\treturn this.date.toLocaleDateString();\r\n\t}\r\n\tget labels():string[] {return this._labels}\r\n\tprotected getDayArray(): Date[] {return [this.date]};\r\n}\r\n\r\n\r\nconst enWeek = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];\r\nconst zhWeek = ['一', '二', '三', '四', '五', '六', '日', ];\r\nclass WeekSpan extends TimeSpan {\r\n\tprivate firstDay: Date;\r\n\tprivate lastDay: Date;\r\n\tprivate readonly _labels:string[];\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.type = 'week';\r\n\t\tthis.firstDay = new Date();\r\n\t\tthis.firstDay.setHours(0, 0, 0, 0);\r\n\t\tlet day = this.firstDay.getDay() || 7; // Get current day number, converting Sun. to 7\r\n\t\tif (day !== 1) {                // Only manipulate the date if it isn't Mon.\r\n\t\t\tthis.firstDay.setHours(-24 * (day - 1));   // Set the hours to day number minus 1\r\n\t\t}\r\n\t\tthis.far = this.firstDay.getTime();\r\n\t\tthis.firstNear = this.near = this.far + 7 * 24 * 3600 * 1000;\r\n\t\tthis.lastDay = new Date();\r\n\t\tthis.lastDay.setDate(this.firstDay.getDate()+7);\r\n\t\tswitch (env.lang) {\r\n\t\t\tdefault:\r\n\t\t\tcase 'en': this._labels = enWeek; break;\r\n\t\t\tcase 'zh': this._labels = zhWeek; break;\r\n\t\t}\r\n\t}\r\n\tprev():void {\r\n\t\tthis.firstDay.setDate(this.firstDay.getDate()-7);\r\n\t\tthis.lastDay.setDate(this.lastDay.getDate()-7);\r\n\t\tthis.far -= 7 * 24 * 3600 * 1000;\r\n\t\tthis.near -= 7 * 24 * 3600 * 1000;\r\n\t}\r\n\tnext():void {\r\n\t\tthis.firstDay.setDate(this.firstDay.getDate()+7);\r\n\t\tthis.lastDay.setDate(this.lastDay.getDate()+7);\r\n\t\tthis.far += 7 * 24 * 3600 * 1000;\r\n\t\tthis.near += 7 * 24 * 3600 * 1000;\r\n\t}\r\n\tget title():string {\r\n\t\treturn this.firstDay.toLocaleDateString();\r\n\t}\r\n\tget labels():string[] {return this._labels}\r\n\tprotected getDayArray(): Date[] {\r\n\t\tlet d = new Date(this.firstDay);\r\n\t\tlet ret: Date[] = [this.firstDay];\r\n\t\tfor (;;) {\r\n\t\t\td.setDate(d.getDate() + 1);\r\n\t\t\tif (d >= this.lastDay) break;\r\n\t\t\tret.push(new Date(d));\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n}\r\n\r\nclass MonthSpan extends TimeSpan {\r\n\tprivate firstDay: Date;\r\n\tprivate lastDay: Date;\r\n\tprivate _labels:string[];\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.type = 'month';\r\n\t\tlet date = new Date();\r\n\t\tthis.initFromDate(date);\r\n\t\tthis.firstNear = this.near;\r\n\t}\r\n\tprivate initFromDate(date: Date) {\r\n\t\tlet year = date.getFullYear(), month = date.getMonth();\r\n\t\tthis.firstDay = new Date(year, month, 1);\r\n\t\tthis.lastDay = new Date(year, month + 1, 0);\r\n\t\tthis.far = this.firstDay.getTime();\r\n\t\tthis.near = new Date(year, month+1, 1).getTime();\r\n\t\tthis._labels = [];\r\n\t\tlet count = this.lastDay.getDate();\r\n\t\tfor (let i=1; i<=count; i++) this._labels.push(String(i));\r\n\t}\r\n\tprev():void {\r\n\t\tlet date = new Date(this.firstDay.setMonth(this.firstDay.getMonth() - 1));\r\n\t\tthis.initFromDate(date);\r\n\t}\r\n\tnext():void {\r\n\t\tlet date = new Date(this.firstDay.setMonth(this.firstDay.getMonth() + 1));\r\n\t\tthis.initFromDate(date);\r\n\t}\r\n\tget title():string {\r\n\t\treturn this.firstDay.toLocaleDateString();\r\n\t}\r\n\tget labels():string[] {return this._labels}\r\n\tprotected getDayArray(): Date[] {\r\n\t\tlet d = new Date(this.firstDay);\r\n\t\tlet ret: Date[] = [this.firstDay];\r\n\t\tfor (;;) {\r\n\t\t\td.setDate(d.getDate() + 1);\r\n\t\t\tif (d >= this.lastDay) break;\r\n\t\t\tret.push(new Date(d));\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n}\r\n\r\nclass YearSpan extends TimeSpan {\r\n\tprivate firstDay: Date;\r\n\tprivate lastDay: Date;\r\n\tprivate readonly _labels:string[] = [];\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.type = 'year';\r\n\t\tlet date = new Date();\r\n\t\tthis.initFromDate(date);\r\n\t\tthis.firstNear = this.near;\r\n\t\tfor (let i=0; i<=12; i++) this._labels.push(String(i));\r\n\t}\r\n\tprivate initFromDate(date: Date) {\r\n\t\tlet year = date.getFullYear(), month = 0;\r\n\t\tthis.firstDay = new Date(year, month, 1);\r\n\t\tthis.lastDay = new Date(year, month + 1, 0);\r\n\t\tthis.far = this.firstDay.getTime();\r\n\t\tthis.near = new Date(year, month+1, 1).getTime();\r\n\t}\r\n\tprev():void {\r\n\t\tlet date = new Date(this.firstDay.setMonth(this.firstDay.getMonth() - 1));\r\n\t\tthis.initFromDate(date);\r\n\t}\r\n\tnext():void {\r\n\t\tlet date = new Date(this.firstDay.setMonth(this.firstDay.getMonth() + 1));\r\n\t\tthis.initFromDate(date);\r\n\t}\r\n\tget title():string {\r\n\t\treturn this.firstDay.toLocaleDateString();\r\n\t}\r\n\tget labels():string[] {return this._labels}\r\n\tprotected getDayArray(): Date[] {\r\n\t\tlet d = new Date(this.firstDay);\r\n\t\tlet ret: Date[] = [this.firstDay];\r\n\t\tfor (;;) {\r\n\t\t\td.setDate(d.getDate() + 1);\r\n\t\t\tif (d >= this.lastDay) break;\r\n\t\t\tret.push(new Date(d));\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import { FA } from \"tonva-react\";\r\n\r\nexport function listRight(onClick: () => any): JSX.Element {\r\n\treturn <button className=\"btn btn-sm btn-success mr-2\" onClick={onClick}>\r\n\t\t<FA name=\"plus\" />\r\n\t</button>\r\n}\r\n\r\nexport function renderItem(item:any, index:number) {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n}\r\n\r\nexport function renderItemContainer(content:any) {\r\n\treturn <div className=\"px-3 py-2\">\r\n\t\t{content}\r\n\t</div>;\r\n}\r\n","export * from './Mid';\r\nexport * from './IDBase';\r\n","import {bridgeCenterApi, isBridged} from './appBridge';\r\nimport {FetchError} from './fetchError';\r\nimport {HttpChannelUI} from './httpChannelUI';\r\nimport {nav} from '../components/nav';\r\nimport { Caller } from './caller';\r\nimport { env } from '../tool';\r\n\r\n/*\r\nexport async function httpGet(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.get('', params);\r\n    return ret;\r\n}\r\n\r\nexport async function httpPost(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.post('', params);\r\n    return ret;\r\n}\r\n*/\r\n\r\nconst methodsWithBody = ['POST', 'PUT'];\r\n\r\nexport abstract class HttpChannel {\r\n    private timeout: number;\r\n    protected ui?: HttpChannelUI;\r\n    protected hostUrl: string;\r\n    protected apiToken: string;\r\n\r\n    constructor(hostUrl: string, apiToken:string, ui?: HttpChannelUI) {\r\n        this.hostUrl = hostUrl;\r\n        this.apiToken = apiToken;\r\n        this.ui = ui;\r\n        this.timeout = env.isDevelopment === true? 500000:50000;\r\n    }\r\n\r\n    private startWait = (waiting: boolean) => {\r\n        if (waiting === true) {\r\n            if (this.ui !== undefined) this.ui.startWait();\r\n        }\r\n    }\r\n\r\n    private endWait = (url?:string, reject?:(reason?:any)=>void) => {\r\n        if (this.ui !== undefined) this.ui.endWait();\r\n        if (reject !== undefined) reject('访问webapi超时 ' + url);\r\n    }\r\n\r\n    private showError = async (error:FetchError) => {\r\n        if (this.ui !== undefined) await this.ui.showError(error);\r\n    }\r\n\r\n    used() {\r\n        this.post('', {});\r\n    }\r\n\r\n    async xcall(urlPrefix:string, caller:Caller<any>): Promise<void> {\r\n        let options = this.buildOptions();\r\n        let {headers, path, method} = caller;\r\n        if (headers !== undefined) {\r\n            let h = options.headers;\r\n            for (let i in headers) {\r\n\t\t\t\t//h.append(i, encodeURI(headers[i]));\r\n\t\t\t\th[i] = encodeURI(headers[i]);\r\n            }\r\n        }\r\n        options.method = method;\r\n        let p = caller.buildParams();\r\n        if (methodsWithBody.indexOf(method) >= 0 && p !== undefined) {\r\n            options.body = JSON.stringify(p)\r\n        }\r\n        return await this.innerFetch(urlPrefix + path, options, caller.waiting);\r\n    }\r\n\r\n    private async innerFetchResult(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let ret = await this.innerFetch(url, options, waiting);\r\n        return ret.res;\r\n    }\r\n\r\n    async get(url: string, params: any = undefined, waiting?: boolean): Promise<any> {\r\n        if (params) {\r\n            let keys = Object.keys(params);\r\n            if (keys.length > 0) {\r\n                let c = '?';\r\n                for (let k of keys) {\r\n                    let v = params[k];\r\n                    if (v === undefined) continue;\r\n                    url += c + k + '=' + params[k];\r\n                    c = '&';\r\n                }\r\n            }\r\n        }\r\n        let options = this.buildOptions();\r\n        options.method = 'GET';\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async post(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'POST';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async put(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'PUT';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async delete(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'DELETE';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n    async fetch(url: string, options: any, waiting: boolean, resolve:(value?:any)=>any, reject:(reason?:any)=>void):Promise<void> {\r\n        let that = this;\r\n        this.startWait(waiting);\r\n        let path = url;\r\n        function buildError(err: any, ex?: string) {\r\n            switch (typeof err) {\r\n                case 'string':\r\n                    if (ex !== undefined) err += ' ' + ex;\r\n                    break;\r\n                case 'object':\r\n                    let keys = Object.keys(err);\r\n                    let retErr:any = {\r\n                        ex: ex,\r\n                    };\r\n                    for (let key of keys) {\r\n                        retErr[key] = err[key];\r\n                    }\r\n                    err = retErr;\r\n                    break;\r\n            }\r\n            return {\r\n                channel: that,\r\n                url: path,\r\n                options: options,\r\n                resolve: resolve,\r\n                reject: reject,\r\n                error: err,\r\n            }\r\n        }\r\n        try {\r\n            console.log('%s-%s %s', options.method, path, options.body || '');\r\n            let now = Date.now();\r\n            let timeOutHandler = env.setTimeout(\r\n                undefined, //'httpChannel.fetch',\r\n                () => {\r\n                    that.endWait(url + ' timeout endWait: ' + (Date.now() - now) + 'ms', reject);\r\n                },\r\n                this.timeout);\r\n            let res = await fetch(encodeURI(path), options);\r\n            if (res.ok === false) {\r\n                env.clearTimeout(timeOutHandler);\r\n                console.log('ok false endWait');       \r\n                that.endWait();\r\n                console.log('call error %s', res.statusText);\r\n                throw res.statusText;\r\n            }\r\n            let ct = res.headers.get('content-type');\r\n            if (ct && ct.indexOf('json')>=0) {\r\n                return res.json().then(async retJson => {\r\n                    env.clearTimeout(timeOutHandler);\r\n                    that.endWait();\r\n                    if (retJson.ok === true) {\r\n                        if (typeof retJson !== 'object') {\r\n                            debugger;\r\n                        }\r\n                        else if (Array.isArray(retJson) === true) {\r\n                            debugger;\r\n                        }\r\n                        return resolve(retJson);\r\n                    }\r\n                    let retError = retJson.error;\r\n                    if (retError === undefined) {\r\n                        await that.showError(buildError('not valid tonva json'));\r\n                    }\r\n                    else {\r\n                        await that.showError(buildError(retError, 'retJson.error'));\r\n                        reject(retError);\r\n                    }\r\n                }).catch(async error => {\r\n                    await that.showError(buildError(error, 'catch res.json()'));\r\n                });\r\n            }\r\n            else {\r\n                let text = await res.text();\r\n                env.clearTimeout(timeOutHandler);\r\n                console.log('text endWait');\r\n                that.endWait();\r\n                resolve(text);\r\n            }\r\n        }\r\n        catch(error) {\r\n            this.endWait(url, reject);\r\n            if (typeof error === 'string') {\r\n                let err = error.toLowerCase();\r\n                if (err.startsWith('unauthorized') === true || err.startsWith('$roles') === true) {\r\n                    nav.logout();\r\n                    return;\r\n                }\r\n            }\r\n            console.error('fecth error (no nav.showError): ' + url);\r\n        };\r\n    }\r\n\r\n    protected abstract innerFetch(url: string, options: any, waiting: boolean): Promise<any>;\r\n\r\n    async callFetch(url:string, method:string, body:any):Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = method;\r\n        options.body = body;\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(url, options, true, resolve, reject);\r\n        });\r\n    }\r\n\r\n    //private buildOptions(): {method:string; headers:Headers; body:any} {\r\n\t\tprivate buildOptions(): {method:string; headers:{[name:string]: string}; body:any} {\r\n        let headers = this.buildHeaders();\r\n        let options = {\r\n            headers: headers,\r\n            method: undefined as any,\r\n            body: undefined as any,\r\n            // cache: 'no-cache',\r\n        };\r\n        return options;\r\n    }\r\n\r\n\t/*\r\n    protected buildHeaders():Headers {\r\n        let {language, culture} = nav;\r\n        let headers = new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n        headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n        headers.append('Accept-Language', lang);\r\n        if (this.apiToken) { \r\n            headers.append('Authorization', this.apiToken); \r\n        }\r\n        return headers;\r\n\t}\r\n\t*/\r\n\tprotected buildHeaders():{[name:string]: string} { \r\n        let {language, culture} = nav;\r\n        let headers:{[name:string]: string} = {}; //new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n\t\t//headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n\t\theaders['Content-Type'] = 'application/json;charset=UTF-8';\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n\t\t//headers.append('Accept-Language', lang);\r\n\t\theaders['Accept-Language'] = lang;\r\n        if (this.apiToken) { \r\n\t\t\t//headers.append('Authorization', this.apiToken); \r\n\t\t\theaders['Authorization'] = this.apiToken;\r\n        }\r\n        return headers;\r\n\t}\r\n}\r\n\r\nexport class CenterHttpChannel extends HttpChannel {\r\n    protected async innerFetch(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        if (this.apiToken === undefined && isBridged())\r\n            return await bridgeCenterApi(u, options.method, options.body);\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, waiting, resolve, reject);\r\n        });\r\n    }\r\n}\r\n\r\nexport class UqHttpChannel extends HttpChannel {\r\n    protected async innerFetch(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, waiting, resolve, reject);\r\n        });\r\n    }\r\n}\r\n","import {nav} from '../components/nav';\r\nimport {FetchError} from './fetchError';\r\n\r\nexport interface HttpChannelUI {\r\n    startWait():void;\r\n    endWait():void;\r\n    showError(error:FetchError):Promise<void>;\r\n    showUpgradeUq(uq:string, version:number):Promise<void>;\r\n}\r\n\r\nexport class HttpChannelNavUI implements HttpChannelUI {\r\n    startWait() {\r\n        nav.startWait();\r\n    }\r\n    endWait() {\r\n        nav.endWait();\r\n    }\r\n    async showError(error:FetchError):Promise<void> {\r\n        nav.endWait();\r\n        /*\r\n        if (error.name === 'SyntaxError') {\r\n            error = {\r\n                name: error.name,\r\n                message: error.message,\r\n            }\r\n        }*/\r\n        await nav.onError(error);\r\n    }\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        await nav.showUpgradeUq(uq, version);\r\n    }\r\n}\r\n\r\n","import _ from 'lodash';\r\nimport {HttpChannel, CenterHttpChannel, UqHttpChannel} from './httpChannel';\r\nimport {HttpChannelNavUI} from './httpChannelUI';\r\nimport {getUqToken, logoutUqTokens, buildAppUq} from './appBridge';\r\nimport {ApiBase} from './apiBase';\r\nimport { host } from './host';\r\nimport { LocalMap, env } from '../tool';\r\nimport {decodeUserToken} from '../tool/user';\r\n\r\ninterface PromiseValue<T> {\r\n\tresolve: (value?: T | PromiseLike<T>) => void;\r\n\treject: (reason?: any) => void;\r\n}\r\nlet channelUIs:{[name:string]: HttpChannel|(PromiseValue<any>[])} = {};\r\nlet channelNoUIs:{[name:string]: HttpChannel|(PromiseValue<any>[])} = {};\r\n\r\nexport function logoutApis() {\r\n    channelUIs = {};\r\n    channelNoUIs = {};\r\n    logoutUnitxApis();\r\n    logoutUqTokens();\r\n}\r\n\r\ninterface UqLocal {\r\n    user: number;\r\n    unit: number;\r\n    value: any;\r\n    tick?: number;\r\n    isNet?: boolean;\r\n}\r\n\r\nexport class UqApi extends ApiBase {\r\n    //private access:string[];\r\n    //appOwner:string;\r\n    //appName:string;\r\n    uqOwner: string;\r\n    uqName: string;\r\n    uq: string;\r\n\r\n    constructor(basePath:string, /*appOwner:string, appName:string, */uqOwner:string, uqName:string/*, access:string[]*/, showWaiting?: boolean) {\r\n        super(basePath, showWaiting);\r\n        //this.appOwner = appOwner;\r\n        //this.appName = appName;\r\n        if (uqName) {\r\n            this.uqOwner = uqOwner;\r\n            this.uqName = uqName;\r\n            this.uq = uqOwner + '/' + uqName;\r\n        }\r\n        //this.access = access;\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    //setUqVersion(uqVersion:number) {this.uqVersion = undefined}\r\n\r\n    async init() {\r\n        await buildAppUq(this.uq, this.uqOwner, this.uqName);\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channels: {[name:string]: HttpChannel|(PromiseValue<any>[])};\r\n        let channelUI: HttpChannelNavUI;\r\n        if (this.showWaiting === true || this.showWaiting === undefined) {\r\n            channels = channelUIs;\r\n            channelUI = new HttpChannelNavUI();\r\n        }\r\n        else {\r\n            channels = channelNoUIs;\r\n        }\r\n        let channel = channels[this.uq];\r\n\t\tif (channel !== undefined) {\r\n\t\t\tif (Array.isArray(channel) === false) return channel as HttpChannel;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tchannel = channels[this.uq] = [];\r\n\t\t}\r\n\t\tlet arr = channel as PromiseValue<any>[];\r\n\t\treturn new Promise(async (resolve, reject) => {\r\n\t\t\tarr.push({resolve, reject});\r\n\t\t\tif (arr.length !== 1) return;\r\n\t\t\tlet uqToken = getUqToken(this.uq); //, this.uqOwner, this.uqName);\r\n\t\t\tif (!uqToken) {\r\n\t\t\t\t//debugger;\r\n\t\t\t\tawait this.init();\r\n\t\t\t\tuqToken = getUqToken(this.uq);\r\n\t\t\t}\r\n\t\t\tlet {url, token} = uqToken;\r\n\t\t\tthis.token = token;\r\n\t\t\tchannel = new UqHttpChannel(url, token, channelUI);\r\n\t\t\tchannels[this.uq] = channel;\r\n\t\t\tfor (let pv of arr) {\r\n\t\t\t\tpv.resolve(channel);\r\n\t\t\t}\r\n\r\n\t\t});\r\n    }\r\n\r\n    /*async update():Promise<string> {\r\n        return await this.get('update');\r\n    }*/\r\n\r\n    /*\r\n    async __loadAccess():Promise<any> {\r\n        let acc = this.access === undefined?\r\n            '' :\r\n            this.access.join('|');\r\n        let ret = await this.get('access', {acc:acc});\r\n        return ret;\r\n    }\r\n    */\r\n    async loadEntities():Promise<any> {\r\n        //return await localUqs.loadAccess(this);\r\n        //let acc = this.access === undefined?\r\n        //    '' :\r\n        //    this.access.join('|');\r\n\t\t//let ret = await this.get('access', {acc:acc});\r\n\t\tlet ret = await this.get('entities');\r\n        return ret;\r\n\t}\r\n\tasync getRoles():Promise<string[]> {\r\n\t\tlet ret = await this.get('get-roles',);\r\n\t\tif (!ret) return null;\r\n\t\tlet parts:string[] = (ret as string).split('|');\r\n\t\tlet s:string[] = [];\r\n\t\tfor (let p of parts) {\r\n\t\t\tp = p.trim();\r\n\t\t\tif (!p) continue;\r\n\t\t\ts.push(p);\r\n\t\t}\r\n\t\tif (s.length === 0) return null;\r\n\t\treturn s;\r\n\t}\r\n\tasync getAllRoleUsers():Promise<{user:number, admin:number, roles:string}[]> {\r\n\t\tlet ret = await this.get('get-all-role-users');\r\n\t\treturn ret;\r\n\t}\r\n\tasync setUserRoles(theUser:number, roles:string):Promise<void> {\r\n\t\tawait this.post('set-user-roles', {theUser, roles});\r\n\t}\r\n\tasync deleteUserRoles(theUser:number):Promise<void> {\r\n\t\tawait this.get('delete-user-roles', {theUser});\r\n\t}\r\n\r\n\tasync allSchemas(): Promise<any> {\r\n\t\treturn await this.get('all-schemas');\r\n\t}\r\n\r\n    async schema(name:string):Promise<any> {\r\n        return await this.get('schema/' + name);\r\n    }\r\n\r\n    async queueModify(start:number, page:number, entities:string) {\r\n        return await this.post('queue-modify', {start:start, page:page, entities:entities});\r\n    }\r\n}\r\n\r\nlet channels:{[unitId:number]: HttpChannel} = {};\r\n\r\nexport function logoutUnitxApis() {\r\n    channels = {};\r\n}\r\n\r\nexport class UnitxApi extends UqApi {\r\n    private unitId:number;\r\n    constructor(unitId:number) {\r\n        super('tv/', /*undefined, undefined, */undefined, undefined/*, undefined*/, true);\r\n        this.unitId = unitId;\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channel = channels[this.unitId];\r\n        if (channel !== undefined) return channel;\r\n        return channels[this.unitId] = await this.buildChannel();\r\n    }\r\n\r\n    private async buildChannel():Promise<HttpChannel> {\r\n        let channelUI = new HttpChannelNavUI();\r\n        let centerAppApi = new CenterAppApi('tv/', undefined);\r\n        let ret = await centerAppApi.unitxUq(this.unitId);\r\n        let {token, db, url, urlTest} = ret;\r\n        let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n        this.token = token;\r\n        return new UqHttpChannel(realUrl, token, channelUI);\r\n    }\r\n}\r\n\r\nlet centerHost:string;\r\n\r\nexport function setCenterUrl(url:string) {\r\n    console.log('setCenterUrl %s', url);\r\n    centerHost = url;\r\n    centerChannel = undefined;\r\n    centerChannelUI = undefined;\r\n}\r\n\r\nexport let centerToken:string|undefined = undefined;\r\n\r\nlet loginedUserId:number = 0;\r\nexport function setCenterToken(userId:number, t?:string) {\r\n    loginedUserId = userId;\r\n    centerToken = t;\r\n    centerChannel = undefined;\r\n    centerChannelUI = undefined;\r\n}\r\n\r\nlet centerChannelUI:HttpChannel;\r\nlet centerChannel:HttpChannel;\r\nfunction getCenterChannelUI():HttpChannel {\r\n    if (centerChannelUI !== undefined) return centerChannelUI;\r\n    return centerChannelUI = new CenterHttpChannel(centerHost, centerToken, new HttpChannelNavUI());\r\n}\r\nfunction getCenterChannel():HttpChannel {\r\n    if (centerChannel !== undefined) return centerChannel;\r\n    return centerChannel = new CenterHttpChannel(centerHost, centerToken);\r\n}\r\n\r\nexport abstract class CenterApiBase extends ApiBase {\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        return (this.showWaiting === true || this.showWaiting === undefined)?\r\n            getCenterChannelUI():\r\n            getCenterChannel();\r\n    }\r\n}\r\n\r\nconst uqTokensName = 'uqTokens';\r\nexport class UqTokenApi extends CenterApiBase {\r\n    private localMap: LocalMap = env.localDb.map(uqTokensName);\r\n\r\n    async uq(params: {unit:number, uqOwner:string, uqName:string}):Promise<any> {\r\n        let {uqOwner, uqName} = params;\r\n        let un = uqOwner+'/'+uqName;\r\n        let localCache = this.localMap.child(un);\r\n        try {\r\n            let uqToken:UqLocal = localCache.get();\r\n            if (uqToken !== undefined) {\r\n                let {unit, user} = uqToken;\r\n                if (unit !== params.unit || user !== loginedUserId) {\r\n                    localCache.remove();\r\n                    uqToken = undefined;\r\n                }\r\n            }\r\n            let nowTick = Math.floor(Date.now() / 1000);\r\n            if (uqToken !== undefined) {\r\n                let {tick, value} = uqToken;\r\n                if (value !== undefined && (nowTick - tick) < 24*3600) {\r\n                    return _.clone(value);\r\n                }\r\n            }\r\n            let uqParams:any = _.clone(params);\r\n            uqParams.testing = host.testing;\r\n            let ret = await this.get('uq-token', uqParams);\r\n            if (ret === undefined) {\r\n                let {unit, uqOwner, uqName} = params;\r\n                let err = `center get app-uq(unit=${unit}, '${uqOwner}/${uqName}') - not exists or no unit-service`;\r\n                throw err;\r\n            }\r\n\r\n            uqToken = {\r\n                unit: params.unit,\r\n                user: loginedUserId,\r\n                tick: nowTick,\r\n                value: ret,\r\n            }\r\n            localCache.set(uqToken);\r\n            return _.clone(ret);\r\n        }\r\n        catch (err) {\r\n            localCache.remove();\r\n            throw err;\r\n        }\r\n    }\r\n}\r\n\r\nexport const uqTokenApi = new UqTokenApi('tv/tie/', undefined);\r\n\r\nexport class CallCenterApi extends CenterApiBase {\r\n    directCall(url:string, method:string, body:any):Promise<any> {\r\n        return this.call(url, method, body);\r\n    }\r\n}\r\nexport const callCenterapi = new CallCenterApi('', undefined);\r\n\r\nexport interface UqAppData {\r\n    appName: string;\r\n    appOwner: string;\r\n    id: number;\r\n    version: string;        // AppUI version\r\n    uqs: UqData[];\r\n}\r\n\r\nexport interface UqData {\r\n    id: number;\r\n    uqOwner: string;\r\n    uqName: string;\r\n    access: string;\r\n    newVersion: boolean;\r\n}\r\n\r\nexport interface UqServiceData {\r\n    id: number;\r\n    db: string;\r\n    url: string;\r\n    urlTest: string;\r\n    token: string;\r\n}\r\n\r\n//const appUqsName = 'appUqs';\r\n\r\nexport class CenterAppApi extends CenterApiBase {\r\n    async appUqs(appOwner:string, appName:string):Promise<UqAppData> {\r\n        let ret:UqAppData = await this.get('tie/app-uqs', {appOwner, appName});\r\n        return ret;\r\n    }\r\n    async uqs(uqs: {owner:string; name:string; version:string}[]):Promise<UqData[]> {\r\n        return await this.post('tie/pure-uqs', uqs);\r\n    }\r\n    async unitxUq(unit:number):Promise<UqServiceData> {\r\n        return await this.get('tie/unitx-uq', {unit:unit});\r\n    }\r\n    async changePassword(param: {orgPassword:string, newPassword:string}) {\r\n        return await this.post('tie/change-password', param);\r\n    }\r\n}\r\n\r\nexport interface RegisterParameter {\r\n    nick:string, \r\n    user:string, \r\n    pwd:string,\r\n    country:number, \r\n    mobile:number, \r\n    mobileCountry:number,\r\n    email:string,\r\n    verify:string,\r\n};\r\n\r\nexport class UserApi extends CenterApiBase {\r\n    async login(params: {user: string, pwd: string, guest: number}): Promise<any> {\r\n        //(params as any).device = nav.local.device.get();\r\n        let ret = await this.get('user/login', params);\r\n        switch (typeof ret) {\r\n            default: return;\r\n            case 'string': return decodeUserToken(ret);\r\n            case 'object':\r\n                let token = ret.token;\r\n                let user = decodeUserToken(token);\r\n                let {nick, icon} = ret;\r\n                if (nick) user.nick = nick;\r\n                if (icon) user.icon = icon;\r\n                return user;\r\n        }\r\n        // !== undefined) return decodeToken(token);\r\n    }\r\n    async register(params: RegisterParameter): Promise<any>\r\n    {\r\n        return await this.post('user/register', params);\r\n    }\r\n\r\n    async sendVerify(account:string, type:'mobile'|'email', oem:string) {\r\n        return await this.post('user/set-verify', {account:account, type:type, oem:oem});\r\n    }\r\n\r\n    async checkVerify(account:string, verify:string) {\r\n        return await this.post('user/check-verify', {account:account, verify:verify});\r\n    }\r\n\r\n    async isExists(account:string) {\r\n        return await this.get('user/is-exists', {account:account});\r\n    }\r\n\r\n    async resetPassword(account:string, password:string, verify:string, type:'mobile'|'email'):Promise<any[]> {\r\n        return await this.post('user/reset-password', {account:account, password, verify, type});\r\n    }\r\n    \r\n    async userSetProp(prop:string, value:any) {\r\n        await this.post('tie/user-set-prop', {prop:prop, value:value});\r\n    }\r\n\r\n    async me():Promise<any> {\r\n        return await this.get('tie/me');\r\n    }\r\n\r\n    async user(id:number): Promise<any> {\r\n        return await this.get('tie/user', {id:id});\r\n\t}\r\n\t\r\n\tasync fromKey(key:string): Promise<{id:number, name:string, nick:string, icon:string}> {\r\n\t\treturn await this.get('tie/user-from-key', {key});\r\n\t}\r\n}\r\n\r\nexport const userApi = new UserApi('tv/', undefined);\r\n","import { Context, Form, View } from \"tonva-react\";\r\nimport { CFormView } from \"./CFormView\";\r\n\r\nexport class VFormView<C extends CFormView<any>> extends View<C> {\r\n\trender(param: any) {\r\n\t\tlet {schema, uiSchema} = this.controller;\r\n\t\treturn <Form fieldLabelSize={2} formData={param}\r\n\t\t\tschema={schema}\r\n\t\t\tuiSchema={uiSchema}\r\n\t\t\tonButtonClick={this.onSubmit} />\r\n\t}\r\n\r\n\tprivate onSubmit = async (name:string, context: Context) => {\r\n\t\tcontext.setDisabled(name, true);\r\n\t\tawait this.controller.submit(name, context);\r\n\t\tcontext.setDisabled(name, false);\r\n\t}\r\n}","import { ButtonSchema, Context, Controller, FieldItem, FieldItems, FieldItemString, ID, Schema, UI, UiButton, UiIdItem, UiNumberItem, UiSchema } from \"tonva-react\";\r\nimport { FormUI } from \"./FormUI\";\r\nimport { VFormView } from \"./VFormView\";\r\n\r\nexport class CFormView<T> extends Controller {\r\n\tprotected readonly ui: UI;\r\n\tschema: Schema;\r\n\tuiSchema: UiSchema;\r\n\tlabel: string|JSX.Element;\r\n\tsubmitCaption: string|JSX.Element;\r\n\tonSubmit: (name:string, context: Context) => Promise<void>;\r\n\r\n\tconstructor(formUI: FormUI) {\r\n\t\tsuper();\r\n\t\tlet {label, fieldArr, fields, submitCaption, t} = formUI;\r\n\t\tthis.t = t;\r\n\t\tthis.schema = this.buildItemSchema(fieldArr);\r\n\t\tthis.uiSchema = this.buildUISchema(fields);\r\n\t\tthis.label = t(label);\r\n\t\tthis.submitCaption = t(submitCaption);\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t}\r\n\r\n\tasync setNO(ID: ID, fieldName:string = 'no') {\r\n\t\tlet field = this.schema.find(v => v.name === fieldName);\r\n\t\tif (!field) return;\r\n\t\tif (field.type !== 'string') return;\r\n\t\tlet noField = field as FieldItemString;\r\n\t\tlet no = await ID.NO();\r\n\t\tnoField.readOnly = true;\r\n\t\tnoField.defaultValue = no;\r\n\t\tlet uiField = this.uiSchema.items[fieldName];\r\n\t\tif (uiField) {\r\n\t\t\tuiField.readOnly = true;\r\n\t\t\tuiField.defaultValue = no;\r\n\t\t}\r\n\t}\r\n\r\n\tasync submit(name:string, context: Context) {\r\n\t\tawait this.onSubmit?.(name, context);\r\n\t}\r\n\r\n\tprotected buildItemSchema(fieldArr: FieldItems): Schema {\r\n\t\tlet ret:Schema = [];\r\n\t\tfor (let f of fieldArr) {\r\n\t\t\tlet {type, isKey} = f;\r\n\t\t\tlet required = isKey; // (keys as any[]).findIndex(v => v.name === name) >= 0;\r\n\t\t\tlet fieldItem = {\r\n\t\t\t\t...f,\r\n\t\t\t\trequired,\r\n\t\t\t};\r\n\t\t\tswitch (type) {\r\n\t\t\t\tdefault: ret.push(fieldItem); break;\r\n\t\t\t}\r\n\t\t}\r\n\t\tret.push({\r\n\t\t\tname: 'submit',\r\n\t\t\ttype: 'submit',\r\n\t\t} as ButtonSchema);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected buildUISchema(fields: {[name:string]:FieldItem}):UiSchema {\r\n\t\tlet items = {...fields as any};\r\n\t\tlet uiButton: UiButton = {\r\n\t\t\tlabel: this.submitCaption ?? '提交',\r\n\t\t\tclassName: 'btn btn-primary',\r\n\t\t\twidget: 'button',\r\n\t\t};\r\n\t\titems['submit'] = uiButton;\r\n\t\tfor (let i in fields) {\r\n\t\t\tlet field = fields[i];\r\n\t\t\tlet {type} = field;\r\n\t\t\tif (type === 'id') {\r\n\t\t\t\tlet uiId = field as UiIdItem;\r\n\t\t\t\tlet {pickId} = uiId;\r\n\t\t\t\tif (pickId === undefined) {\r\n\t\t\t\t\tlet uiNumber = field as UiNumberItem;\r\n\t\t\t\t\tuiNumber.widget = 'number';\r\n\t\t\t\t\tuiNumber.placeholder = 'ID number, only on debugging';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet ret = {items};\r\n\t\treturn ret;\r\n\t}\r\n\r\n\trenderForm(item:T):JSX.Element {\r\n\t\tlet v = new VFormView(this);\r\n\t\treturn v.render(item);\r\n\t}\r\n}\r\n","import { VPage } from \"tonva-react\";\r\nimport { CFormPage } from \"./CFormPage\";\r\n\r\nexport class VFormPage<C extends CFormPage<any>> extends VPage<C> {\r\n\theader() {return this.controller.label}\r\n\tprotected get back(): 'close' | 'back' | 'none' {\r\n\t\treturn 'close';\r\n\t}\r\n\t\r\n\tcontent() {\r\n\t\t/*let {param, schema, uiSchema} = this.controller;\r\n\t\treturn <div className=\"p-3\">\r\n\t\t\t<Form fieldLabelSize={2} formData={param}\r\n\t\t\t\tschema={schema}\r\n\t\t\t\tuiSchema={uiSchema}\r\n\t\t\t\tonButtonClick={this.onSubmit} />\r\n\t\t</div>*/\r\n\t\treturn <div className=\"p-3\">\r\n\t\t\t{this.controller.renderForm(this.controller.item)}\r\n\t\t</div>;\r\n\t}\r\n\t/*\r\n\tprivate onSubmit = async (name:string, context: Context) => {\r\n\t\tthis.controller.submit(context.data);\r\n\t}\r\n\t*/\r\n}\r\n","import { CFormView } from \"./CFormView\";\r\nimport { FormUI } from \"./FormUI\";\r\nimport { VFormPage } from \"./VFormPage\";\r\n\r\nexport class CFormPage<T> extends CFormView<T> {\r\n\titem: T;\r\n\tconstructor(formUI: FormUI, item: T) {\r\n\t\tsuper(formUI);\r\n\t\tthis.item = item;\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tthis.openVPage<any, any>(VFormPage);\r\n\t}\r\n}\r\n","import { CFormDialog } from \"./CFormDialog\";\r\nimport { VFormPage } from \"./VFormPage\";\r\n\r\nexport class VDialog extends VFormPage<CFormDialog<any>> {\r\n\tprotected afterBack():void {\r\n\t\tthis.controller.close();\r\n\t}\r\n}\r\n","import { CFormPage } from \"./CFormPage\";\r\nimport { VDialog } from \"./VDialog\";\r\n\r\nexport class CFormDialog<T> extends CFormPage<T> {\r\n\tprotected async internalStart() {\r\n\t\tthis.openVPage(VDialog)\r\n\t}\r\n\r\n\tclose() {\r\n\t\tthis.returnCall(null);\r\n\t}\r\n\r\n\tasync submit(data:any) {\r\n\t\tlet item: any;\r\n\t\tif (!this.item) item = this.item;\r\n\t\telse item = {};\r\n\t\tObject.assign(item, data);\r\n\t\tthis.returnCall(item);\r\n\t\tthis.closePage();\r\n\t}\r\n}\r\n","import { ChangedHandler, ChangingHandler, FieldCustoms, FieldItem, FieldItemId, FieldItemString, ID, PickId, TFunc, UI } from \"tonva-react\";\r\nimport { createPickId } from '../select';\r\n\r\nexport class FormUI {\r\n\tlabel: string|JSX.Element;\r\n\treadonly fieldArr: FieldItem[];\r\n\treadonly fields: {[name:string]: FieldItem};\r\n\tsubmitCaption: string;\r\n\tt: TFunc;\r\n\r\n\tconstructor(ui: UI, fieldCustoms:FieldCustoms, t?: TFunc) {\r\n\t\tthis.t = t ?? ((str:string|JSX.Element) => str);\r\n\t\tlet {label, fieldArr, fields} = ui;\r\n\t\tthis.label = label;\r\n\t\tthis.fieldArr = [];\r\n\t\tthis.fields = {};\r\n\t\tfor (let i in fields) {\r\n\t\t\tlet field = fields[i];\r\n\t\t\tlet fieldCustom = fieldCustoms?.[i];\r\n\t\t\tlet index = fieldArr.findIndex(v => v === field);\r\n\t\t\tlet f:FieldItem;\r\n\t\t\tif (fieldCustom) {\r\n\t\t\t\tlet label = this.t(fieldCustom.label ?? field.label);\r\n\t\t\t\tf = {...field, ...fieldCustom, label};\r\n\t\t\t\tlet {ID} = field;\r\n\t\t\t\tif (ID) {\r\n\t\t\t\t\tlet idField = f as FieldItemId;\r\n\t\t\t\t\tidField.widget = 'id';\r\n\t\t\t\t\tidField.pickId = createPickId(ID.uq.proxy, ID);\r\n\t\t\t\t\t(idField as any).Templet = ID.render;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet label = this.t(field.label);\r\n\t\t\t\tf = {...field, label};\r\n\t\t\t}\r\n\t\t\tthis.fields[i] = f;\r\n\t\t\tthis.fieldArr[index] = f;\r\n\t\t}\r\n\t\t/*\r\n\t\tif (fieldCustoms) {\r\n\t\t\tfor (let i in fieldCustoms) {\r\n\t\t\t\tlet field = fieldCustoms[i];\r\n\t\t\t\tlet {ID} = field;\r\n\t\t\t\tif (ID) {\r\n\t\t\t\t\tthis.setIDUi(i, createPickId(ID.uq.proxy, ID), ID.render);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t*/\r\n\t}\r\n\r\n\tsetIDUi(fieldName:string, pickId: PickId, render: (values:any) => JSX.Element) {\r\n\t\tlet field = this.fields[fieldName];\r\n\t\tif (field === undefined) {\r\n\t\t\talert(`${fieldName} not defined in UI`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (field.type !== 'id') {\r\n\t\t\talert(`${fieldName} is not id UI`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet idField = field as FieldItemId;\r\n\t\tidField.widget = 'id';\r\n\t\tidField.pickId = pickId;\r\n\t\t(idField as any).Templet = render;\r\n\t}\r\n\r\n\tasync setNO(ID:ID, fieldName:string = 'no'):Promise<void> {\r\n\t\tlet field = this.fields[fieldName];\r\n\t\tif (!field) return;\r\n\t\tif (field.type !== 'string') return;\r\n\t\tlet noField = field as FieldItemString;\r\n\t\tnoField.readOnly = true;\r\n\t\tlet no = await ID.NO();\r\n\t\tnoField.defaultValue = no;\r\n\t}\r\n\r\n\thideField(...fieldNames:string[]) {\r\n\t\tfor (let fieldName of fieldNames) {\r\n\t\t\tlet index = this.fieldArr.findIndex(v => v.name === fieldName);\r\n\t\t\tif (index >= 0) this.fieldArr.splice(index, 1);\r\n\t\t}\r\n\t}\r\n\r\n\tsetFieldChanged(fieldName: string, onChanged: ChangedHandler) {\r\n\t\tlet field = this.fields[fieldName];\r\n\t\tif (field) field.onChanged = onChanged;\r\n\t}\r\n\r\n\tsetFieldChanging(fieldName: string, onChanging: ChangingHandler) {\r\n\t\tlet field = this.fields[fieldName];\r\n\t\tif (field) field.onChanging = onChanging;\r\n\t}\r\n}\r\n","import _ from 'lodash';\r\nimport {observable, IObservableArray} from 'mobx';\r\nimport { PageItems } from '../tool';\r\nimport {Field, ArrFields} from './uqMan';\r\nimport {Entity} from './entity';\r\nimport { QueryQueryCaller, QueryPageCaller } from './caller';\r\n\r\nexport type QueryPageApi = (name:string, pageStart:any, pageSize:number, params:any) => Promise<string>;\r\n\r\nexport class QueryPager<T extends any> extends PageItems<T> {\r\n\tprivate query: Query;\r\n\tprivate $page: any;\r\n\tprotected idFieldName: any;\r\n    constructor(query: Query, pageSize?: number, firstSize?: number, itemObservable?:boolean) {\r\n        super(itemObservable);\r\n        this.query = query;\r\n        if (pageSize !== undefined) this.pageSize = pageSize;\r\n\t\tif (firstSize !== undefined) this.firstSize = firstSize;\r\n\t}\r\n\r\n\tsetReverse() {\r\n\t\tthis.appendPosition = 'head';\r\n\t}\r\n\r\n    protected async onLoad() {\r\n\t\tif (this.$page) return;\r\n        let {schema} = this.query;\r\n        if (schema === undefined) {\r\n\t\t\tawait this.query.loadSchema();\r\n\t\t\tschema = this.query.schema;\r\n\t\t}\r\n\t\tif (schema === undefined) return;\r\n\t\tlet $page = this.$page = (schema.returns as any[]).find(v => v.name === '$page');\r\n\t\tif ($page === undefined) return;\r\n\t\tthis.sortOrder = $page.order;\r\n\t\tlet fields = $page.fields;\r\n\t\tif (fields !== undefined) {\r\n\t\t\tlet field = fields[0];\r\n\t\t\tif (field) this.idFieldName = field.name;\r\n\t\t}\r\n    }\r\n\r\n    protected async loadResults(param:any, pageStart:number, pageSize:number):Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.query.page(param, pageStart, pageSize);\r\n\t\treturn ret;\r\n\t}\r\n\tprotected getPageId(item:T) {\r\n\t\tif (item === undefined) return;\r\n\t\tif (typeof item === 'number') return item;\r\n\t\tlet start = (item as any)[this.idFieldName];\r\n\t\tif (start === null) return;\r\n\t\tif (start === undefined) return;\r\n\t\tif (typeof start === 'object') {\r\n\t\t\tlet id = start.id;\r\n\t\t\tif (id !== undefined) return id;\r\n\t\t}\r\n\t\treturn start;\r\n\t}\r\n\tasync refreshItems(item:T) {\r\n\t\tlet index = this._items.indexOf(item);\r\n\t\tif (index < 0) return;\r\n\t\tlet startIndex:number;\r\n\t\tif (this.appendPosition === 'tail') {\r\n\t\t\tstartIndex = index - 1;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tstartIndex = index + 1;\r\n\t\t}\r\n\t\tlet pageStart = this.getPageId(this._items[startIndex]);\r\n\t\tlet pageSize = 1;\r\n        let ret = await this.load(\r\n\t\t\tthis.param, \r\n\t\t\tpageStart,\r\n\t\t\tpageSize);\r\n\t\tlet len = ret.length;\r\n\t\tif (len === 0) {\r\n\t\t\tthis._items.splice(index, 1);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet newItem = ret[i];\r\n\t\t\tif (!newItem) continue;\r\n\t\t\tlet newId = newItem[this.idFieldName];\r\n\t\t\tif (newId === undefined || newId === null) continue;\r\n\t\t\tif (typeof newId === 'object') newId = newId.id;\r\n\t\t\tlet oldItem = this._items.find(v => {\r\n\t\t\t\tlet oldId = (v as any)[this.idFieldName];\r\n\t\t\t\tif (oldId === undefined || oldId === null) return false;\r\n\t\t\t\tif (typeof oldId === 'object') oldId = oldId.id;\r\n\t\t\t\treturn oldId = newId;\r\n\t\t\t});\r\n\t\t\tif (oldItem) {\r\n\t\t\t\t_.merge(oldItem, newItem);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport class UqQuery<P, R> extends Entity {\r\n    get typeName(): string { return 'query';}\r\n    private pageStart: any;\r\n    private pageSize:number;\r\n    private params:any;\r\n    private more: boolean;\r\n    private startField: Field;\r\n    list:IObservableArray; // = observable.array([], {deep: false});\r\n    returns: ArrFields[];\r\n\tisPaged: boolean;\r\n\t\r\n\t/*\r\n\tconstructor(uq:UqMan, name:string, typeId:number) {\r\n\t\tsuper(uq, name, typeId);\r\n\t\tmakeObservable(this, {\r\n\t\t\tlist: observable,\r\n\t\t})\r\n\t}\r\n\t*/\r\n\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {returns} = schema;\r\n        //this.returns = returns;\r\n        this.isPaged = returns && (returns as any[]).find(v => v.name === '$page') !== undefined;\r\n    }\r\n\r\n    resetPage(size:number, params:any) {\r\n        this.pageStart = undefined;\r\n        this.pageSize = size;\r\n        this.params = params;\r\n        this.more = false;\r\n        this.list = undefined;\r\n    }\r\n    get hasMore() {return this.more;}\r\n    async loadPage():Promise<void> {\r\n        if (this.pageSize === undefined) {\r\n            throw new Error('call resetPage(size:number, params:any) first');\r\n        }\r\n        let pageStart:any;\r\n        if (this.pageStart !== undefined) {\r\n            switch (this.startField.type) {\r\n                default: pageStart = this.pageStart; break;\r\n                case 'date':\r\n                case 'time':\r\n                case 'datetime': pageStart = (this.pageStart as Date).getTime(); break;\r\n            }\r\n        }\r\n\t\tlet ret = await this.page(this.params, pageStart, this.pageSize+1);\r\n\t\tlet page = (ret as any).$page;\r\n        /*\r\n        await this.loadSchema();\r\n        let res = await this.tvApi.page(this.name, pageStart, this.pageSize+1, this.params);\r\n        let data = await this.unpackReturns(res);\r\n        let page = data['$page'] as any[];\r\n        */\r\n        this.list = observable.array([], {deep: false});\r\n        if (page !== undefined) {\r\n            if (page.length > this.pageSize) {\r\n                this.more = true;\r\n                page.pop();\r\n                let ret = this.returns.find(r => r.name === '$page');\r\n                this.startField = ret.fields[0];\r\n                this.pageStart = page[page.length-1][this.startField.name];\r\n            }\r\n            else {\r\n                this.more = false;\r\n            }\r\n            this.list.push(...page);\r\n        }\r\n        //this.loaded = true;\r\n    }\r\n\r\n    protected pageCaller(params: any, showWaiting: boolean = true): QueryPageCaller {\r\n        return new QueryPageCaller(this, params, showWaiting);\r\n    }\r\n\r\n    async page(params:P, pageStart:any, pageSize:number, showWaiting: boolean = true):Promise<R> {\r\n        let p = {pageStart, pageSize, params};\r\n        let res = await this.pageCaller(p, showWaiting).request();\r\n        return res;\r\n    }\r\n    protected queryCaller(params: P, showWaiting: boolean = true): QueryQueryCaller {\r\n        return new QueryQueryCaller(this, params, showWaiting);\r\n    }\r\n    async query(params:P, showWaiting:boolean = true):Promise<R> {\r\n        let res = await this.queryCaller(params, showWaiting).request();\r\n        return res;\r\n    }\r\n    async table(params:P, showWaiting:boolean = true): Promise<any[]> {\r\n        let ret = await this.query(params, showWaiting);\r\n        for (let i in ret) {\r\n            return (ret as any)[i];\r\n        }\r\n    }\r\n    async obj(params:P, showWaiting:boolean = true):Promise<any> {\r\n        let ret = await this.table(params, showWaiting);\r\n        if (ret.length > 0) return ret[0];\r\n    }\r\n    async scalar(params:P, showWaiting:boolean = true):Promise<any> {\r\n        let ret = await this.obj(params, showWaiting);\r\n        for (let i in ret) return ret[i];\r\n    }\r\n}\r\n\r\nexport class Query extends UqQuery<any, any> {\r\n}\r\n","import { ID, Uq } from \"tonva-react\";\r\nimport { IDBase } from \"../base/IDBase\";\r\nimport { CList, IDListPageItems, MidList } from \"../list\";\r\nimport { renderSelectItem } from \"./parts\";\r\n\r\nexport class CIDSelect<T extends IDBase, P extends MidIDSelectList<T>> extends CList<T> {\r\n\tmidIDSelectList: P;\r\n\tconstructor(midIDSelectList: P) {\r\n\t\tsuper(midIDSelectList);\r\n\t\tthis.setRes(midIDSelectList.res);\r\n\t\tthis.midIDSelectList = midIDSelectList;\r\n\t}\r\n\r\n\tprotected createMidList(): MidList<T> {\r\n\t\treturn new MidIDSelectList(this.midIDSelectList.uq, this.midIDSelectList.ID);\r\n\t}\r\n\r\n\tprotected onItemClick(item:any):void {\r\n\t\treturn; //this.props.onItemClick(item);\r\n\t}\r\n\r\n\tprotected renderRight():JSX.Element {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprotected renderItem(item:any, index:number):JSX.Element {\r\n\t\tlet onChange = (evt:React.ChangeEvent<HTMLInputElement>) => {\r\n\t\t\tlet {onSelectChange} = this.midIDSelectList;\r\n\t\t\tonSelectChange?.(item, evt.currentTarget.checked);\r\n\t\t}\r\n\t\tlet {renderItem, ID} = this.midIDSelectList;\r\n\t\tlet content = (renderItem ?? ID.render)(item, index);\r\n\t\tlet {$in} = item;\r\n\t\treturn renderSelectItem(onChange, content, $in===1);\r\n\t}\r\n}\r\n\r\nexport class MidIDSelectList<T extends IDBase> extends MidList<T> {\r\n\treadonly ID:ID;\r\n\tonSelectChange: (item:T, isSelected:boolean)=>any;\r\n\r\n\tconstructor(uq:Uq, ID:ID) {\r\n\t\tsuper(uq);\r\n\t\tthis.ID = ID;\r\n\t}\r\n\r\n\tasync init() {\r\n\t\tawait this.ID.loadSchema();\r\n\t}\r\n\tkey:((item:T) => number|string) = item => item.id;\r\n\r\n\tprotected createPageItems() {\r\n\t\tlet listPageItems = new IDListPageItems<T>(\r\n\t\t\t(pageStart:any, pageSize:number) => this.loadPageItems(pageStart, pageSize)\r\n\t\t);\r\n\t\treturn listPageItems;\r\n\t}\r\n\r\n\tprotected async loadPageItems(pageStart:any, pageSize:number):Promise<T[]> {\r\n\t\tlet ret = await this.uq.ID<T>({\r\n\t\t\tIDX: this.ID,\r\n\t\t\tid: undefined,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","export function renderSelectItem(\r\n\tonChange:(evt:React.ChangeEvent<HTMLInputElement>)=>void, \r\n\tcontent:any,\r\n\tdefaultChecked:boolean):JSX.Element {\r\n\treturn <label className=\"mx-3 my-2 d-flex mb-0\">\r\n\t\t<input type=\"checkbox\" onChange={onChange} className=\"mr-3\" defaultChecked={defaultChecked} />\r\n\t\t{content}\r\n\t</label>;\r\n}","import { ID, IX, Uq } from \"tonva-react\";\r\nimport { IDListPageItems } from \"../list\";\r\nimport { IXBase } from \"../base\";\r\nimport { CIDSelect, MidIDSelectList } from \"./CIDSelect\";\r\n\r\nexport class CIXSelect<T extends IXBase> extends CIDSelect<T, MidIXSelectList<T>> {\r\n}\r\n\r\nexport class MidIXSelectList<T extends IXBase> extends MidIDSelectList<T> {\r\n\treadonly IX:IX;\r\n\treadonly id:number;\r\n\tconstructor(uq:Uq, ID:ID, IX:IX, id:number) {\r\n\t\tsuper(uq, ID);\r\n\t\tthis.IX = IX;\r\n\t\tthis.id = id;\r\n\t}\r\n\r\n\tasync init() {\r\n\t\tawait super.init();\r\n\t\tawait this.IX.loadSchema();\r\n\t}\r\n\r\n\tkey:((item:T) => number|string) = item => item.id;\r\n\r\n\tprotected createPageItems() {\r\n\t\tlet listPageItems = new IDListPageItems<T>(\r\n\t\t\t(pageStart:any, pageSize:number) => this.loadPageItems(pageStart, pageSize)\r\n\t\t);\r\n\t\treturn listPageItems;\r\n\t}\r\n\r\n\tprotected async loadPageItems(pageStart:any, pageSize:number):Promise<T[]> {\r\n\t\tlet ret = await this.uq.IDinIX<T>({\r\n\t\t\tID: this.ID,\r\n\t\t\tIX: this.IX,\r\n\t\t\tid: this.id,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\treturn ret as any[];\r\n\t}\r\n}\r\n","import { Context, ID, PickId, Uq } from \"tonva-react\";\r\nimport { CIDSelect,MidIDSelectList } from \"./CIDSelect\";\r\n\r\nexport function createPickId(uq: Uq, ID: ID): PickId {\r\n\tasync function pickId(context:Context, name: string, value: number):Promise<any> {\r\n\t\tlet mid: MidIDSelectList<any> = new MidIDSelectList(uq, ID);\r\n\t\tlet cIDSelect = new CIDSelectInPickId(mid);\r\n\t\tlet ret = await cIDSelect.call<any>();\r\n\t\treturn ret;\r\n\t}\r\n\treturn pickId;\r\n}\r\n\r\nexport class CIDSelectInPickId extends CIDSelect<any, MidIDSelectList<any>> {\r\n\tconstructor(mid: MidIDSelectList<any>) {\r\n\t\tsuper(mid);\r\n\t\tmid.onSelectChange = this.onSelectChange;\r\n\t}\r\n\r\n\tprivate onSelectChange = (item:any, isSelected:boolean) => {\r\n\t\tthis.selectedItem = item;\r\n\t\tthis.closePage();\r\n\t\t// closePage时，returnCall已经被调用了\r\n\t\t// this.returnCall(item);\r\n\t}\r\n}\r\n","const ALPHABET = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\nconst ID_LENGTH = 8;\r\n\r\nexport function uid():string {\r\n    let len = ALPHABET.length;\r\n    let rtn = '';\r\n    for (let i = 0; i < ID_LENGTH; i++) {\r\n        rtn += ALPHABET.charAt(Math.floor(Math.random() * len));\r\n    }\r\n    return rtn;\r\n}\r\n","import _ from 'lodash';\r\nimport {nav} from '../components';\r\nimport {uid} from '../tool/uid';\r\nimport {uqTokenApi, callCenterapi, centerToken, setCenterToken} from './uqApi';\r\nimport {setSubAppWindow} from './wsChannel';\r\nimport { host } from './host';\r\nimport { env } from '../tool';\r\n\r\nexport interface UqToken {\r\n    name: string;\r\n    db: string;\r\n    url: string;\r\n    token: string;\r\n}\r\nconst uqTokens:{[uqName:string]: UqToken}  = {};\r\nexport function logoutUqTokens() {\r\n    for (let i in uqTokens) {\r\n        uqTokens[i] = undefined;\r\n    }\r\n}\r\n\r\nexport function isBridged():boolean {\r\n    return window.self !== window.parent;\r\n}\r\n\r\nwindow.addEventListener('message', async function(evt) {\r\n    var message = evt.data;\r\n\tif (!message) return;\r\n    switch (message.type) {\r\n        case 'sub-frame-started':\r\n            subFrameStarted(evt);\r\n            break;\r\n        case 'ws':\r\n            //wsBridge.receive(message.msg);\r\n            await nav.onReceive(message.msg);\r\n            break;\r\n        case 'init-sub-win':\r\n            await initSubWin(message);\r\n            break;\r\n        case 'pop-app':\r\n            window.console.log('///\\\\\\\\\\\\ pop-app');\r\n            nav.navBack();\r\n            break;\r\n        case 'center-api':\r\n            await callCenterApiFromMessage(evt.source as Window, message);\r\n            break;\r\n        case 'center-api-return':\r\n            bridgeCenterApiReturn(message);\r\n            break;\r\n        case 'app-api':\r\n            let ret = await onReceiveAppApiMessage(message.hash, message.apiName);\r\n            (evt.source as Window).postMessage({\r\n                type: 'app-api-return', \r\n                apiName: message.apiName,\r\n                db: ret.db,\r\n                url: ret.url,\r\n                token: ret.token} as any, \"*\");\r\n            break;\r\n        case 'app-api-return':\r\n            console.log(\"app-api-return: %s\", JSON.stringify(message));\r\n            console.log('await onAppApiReturn(message);');\r\n            await onAppApiReturn(message);\r\n            break;\r\n        default:\r\n\t\t\tif ((message.source as string)?.startsWith('react-devtools') === true) break;\r\n            window.console.log('message: %s', JSON.stringify(message));\r\n            break;\r\n    }\r\n});\r\n\r\nfunction subFrameStarted(evt:any) {\r\n    var message = evt.data;\r\n    let subWin = evt.source as Window;\r\n    setSubAppWindow(subWin);\r\n    hideFrameBack(message.hash);\r\n    let msg:any = _.clone(nav.user);\r\n    msg.type = 'init-sub-win';\r\n    subWin.postMessage(msg, '*');\r\n}\r\nfunction hideFrameBack(hash:string) {\r\n    let el = document.getElementById(hash);\r\n    if (el !== undefined) el.hidden = true;\r\n}\r\nasync function initSubWin(message:any) {\r\n    console.log('initSubWin: set nav.user', message);\r\n    let user = nav.user = message; // message.user;\r\n    setCenterToken(user.id, user.token);\r\n    await nav.showAppView();\r\n}\r\nasync function onReceiveAppApiMessage(hash: string, apiName: string): Promise<UqToken> {\r\n\tlet {unit} = env;\r\n    if (!unit) {\r\n        console.error('no unit defined in unit.json or in index.html, or not logined in', unit);\r\n    }\r\n    let parts = apiName.split('/');\r\n    let param = {unit: unit, uqOwner: parts[0], uqName: parts[1], appOwner: parts[2], appName:parts[3]};\r\n    console.log('uqTokenApi.uq onReceiveAppApiMessage', param);\r\n    let ret = await uqTokenApi.uq(param);\r\n    let {db, url, token} = ret;\r\n    return {name: apiName, db:db, url: url, token: token};\r\n}\r\n\r\nasync function onAppApiReturn(message:any) {\r\n    let {apiName, db, url, urlTest, token} = message;\r\n    let action = uqTokenActions[apiName];\r\n    if (action === undefined) {\r\n        throw new Error('error app api return');\r\n        //return;\r\n    }\r\n    let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n    console.log('onAppApiReturn(message:any): url=' + url + ', real=' + realUrl);\r\n    //action.url = realUrl;\r\n    //action.token = token;\r\n    action.resolve({\r\n        name: apiName,\r\n        db: db,\r\n        url: realUrl,\r\n        token: token,\r\n    } as UqToken);\r\n}\r\n\r\ninterface UqTokenAction {\r\n    resolve: (value?: UqToken | PromiseLike<UqToken>) => void;\r\n    reject: (reason?: any) => void;\r\n}\r\nconst uqTokenActions:{[uq:string]: UqTokenAction} = {};\r\nexport async function buildAppUq(uq:string, uqOwner:string, uqName:string):Promise<void> {\r\n    if (!isBridged()) {\r\n\t\t//let unit = getUnit();\r\n\t\tlet {unit} = env;\r\n        let uqToken = await uqTokenApi.uq({unit,  uqOwner, uqName});\r\n        if (uqToken.token === undefined) uqToken.token = centerToken;\r\n        let {db, url, urlTest} = uqToken;\r\n        let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n        console.log('realUrl: %s', realUrl);\r\n        uqToken.url = realUrl;\r\n        uqTokens[uq] = uqToken;\r\n        return uqToken;\r\n    }\r\n    //console.log(\"**** before buildAppUq ****\", appInFrame);\r\n    let bp = uqTokenActions[uq];\r\n    if (bp !== undefined) return;\r\n    return new Promise<void>((resolve, reject) => {\r\n        uqTokenActions[uq] = {\r\n            resolve: async (at:any) => {\r\n                let {db, url, token} = await at;\r\n                uqTokens[uq] = {\r\n                    name: uq,\r\n                    db: db,\r\n                    url: url,\r\n                    token: token,\r\n                };\r\n                uqTokenActions[uq] = undefined;\r\n                //console.log(\"**** after buildAppUq ****\", appInFrame);\r\n                resolve();\r\n            },\r\n            reject: reject,\r\n        };\r\n        (window.opener || window.parent).postMessage({\r\n            type: 'app-api',\r\n            apiName: uq,\r\n            //hash: appInFrame.hash,\r\n        }, \"*\");\r\n    });\r\n}\r\n\r\nexport function getUqToken(uq:string):UqToken {\r\n    let uts = uqTokens;\r\n    return uts[uq];\r\n}\r\n\r\ninterface BridgeCenterApi {\r\n    id: string;\r\n    resolve: (value?:any)=>any;\r\n    reject: (reason?:any)=>void;\r\n}\r\nconst brideCenterApis:{[id:string]: BridgeCenterApi} = {};\r\nexport async function bridgeCenterApi(url:string, method:string, body:any):Promise<any> {\r\n    console.log('bridgeCenterApi: url=%s, method=%s', url, method);\r\n    return await new Promise<any>(async (resolve, reject) => {\r\n        let callId:string;\r\n        for (;;) {\r\n            callId = uid();\r\n            let bca = brideCenterApis[callId];\r\n            if (bca === undefined) {\r\n                brideCenterApis[callId] = {\r\n                    id: callId,\r\n                    resolve: resolve,\r\n                    reject: reject,\r\n                }\r\n                break;\r\n            }\r\n        }\r\n        (window.opener || window.parent).postMessage({\r\n            type: 'center-api',\r\n            callId: callId,\r\n            url: url,\r\n            method: method,\r\n            body: body\r\n        }, '*');\r\n    });\r\n}\r\n\r\nasync function callCenterApiFromMessage(from:Window, message:any):Promise<void> {\r\n    let {callId, url, method, body} = message;\r\n    let result = await callCenterapi.directCall(url, method, body);\r\n    from.postMessage({\r\n        type: 'center-api-return',\r\n        callId: callId,\r\n        result: result,\r\n    }, '*');\r\n}\r\n\r\nfunction bridgeCenterApiReturn(message:any) {\r\n    let {callId, result} = message;\r\n    let bca = brideCenterApis[callId];\r\n    if (bca === undefined) return;\r\n    brideCenterApis[callId] = undefined;\r\n    bca.resolve(result);\r\n}\r\n","import { messageHub } from \"./messageHub\";\r\n\r\nlet subAppWindow:Window;\r\nfunction postWsToSubApp(msg:any) {\r\n    if (subAppWindow === undefined) return;\r\n    subAppWindow.postMessage({\r\n        type: 'ws',\r\n        msg: msg\r\n    }, '*');\r\n}\r\n\r\nexport function setSubAppWindow(win:Window) {\r\n    subAppWindow = win;\r\n}\r\n\r\nexport function postWsToTop(msg:any) {\r\n    window.top.postMessage({\r\n        type: 'ws',\r\n        msg: msg\r\n    }, '*');\r\n}\r\n\r\nexport abstract class WsBase {\r\n\tprivate messageHub = messageHub;\r\n\t/*\r\n    wsBaseId:string;\r\n    private handlerSeed = 1;\r\n    private anyHandlers:{[id:number]:(msg:any)=>Promise<void>} = {};\r\n\tprivate msgHandlers:{[id:number]:{type:string, handler:(msg:any)=>Promise<void>}} = {};\r\n\t*/\r\n\t/*\r\n    onWsReceiveAny(handler:(msg:any)=>Promise<void>):number {\r\n        let seed = this.handlerSeed++;\r\n        this.anyHandlers[seed] = handler;\r\n        return seed;\r\n    }\r\n    onWsReceive(type:string, handler:(msg:any)=>Promise<void>):number {\r\n        let seed = this.handlerSeed++;\r\n        this.msgHandlers[seed] = {type:type, handler: handler};\r\n        return seed;\r\n    }\r\n    endWsReceive(handlerId:number) {\r\n        delete this.anyHandlers[handlerId];\r\n        delete this.msgHandlers[handlerId];\r\n\t}\r\n\t*/\r\n    async receive(msg:any) {\r\n\t\tthis.messageHub.dispatch(msg);\r\n\t\t/*\r\n        let {$type} = msg;\r\n        for (let i in this.anyHandlers) {\r\n            await this.anyHandlers[i](msg);\r\n        }\r\n        for (let i in this.msgHandlers) {\r\n            let {type, handler} = this.msgHandlers[i];\r\n            if (type !== $type) continue;\r\n            await handler(msg);\r\n\t\t}\r\n\t\t*/\r\n    }\r\n}\r\n\r\nlet wsBaseSeed = 1;\r\nexport class WsBridge extends WsBase {\r\n    wsBaseId:string = 'WsBridge seed ' + wsBaseSeed++;\r\n}\r\n\r\nexport const wsBridge = new WsBridge();\r\n\r\nexport class WSChannel extends WsBase {\r\n    wsBaseId:string = 'WSChannel seed ' + wsBaseSeed++;\r\n    static centerToken:string;\r\n    private wsHost: string;\r\n    private token: string;\r\n    private ws: WebSocket;\r\n\r\n    constructor(wsHost: string, token: string) {\r\n        super();\r\n        this.wsHost = wsHost;\r\n        this.token = token;\r\n    }\r\n\r\n    static setCenterToken(token?: string) {\r\n        WSChannel.centerToken = token;\r\n    }\r\n    \r\n    connect():Promise<void> {\r\n        //this.wsHost = wsHost;\r\n        //this.token = token || WSChannel.centerToken;\r\n        if (this.ws !== undefined) return;\r\n        let that = this;\r\n        return new Promise((resolve, reject) => {\r\n            let ws = new WebSocket(this.wsHost, this.token || WSChannel.centerToken);\r\n            console.log('connect webSocket %s', this.wsHost);\r\n            ws.onopen = (ev) => {\r\n                console.log('webSocket connected %s', this.wsHost);\r\n                that.ws = ws;\r\n                resolve();\r\n            };\r\n            ws.onerror = (ev) => {\r\n                reject('webSocket can\\'t open!');\r\n            };\r\n            ws.onmessage = async (msg) => await that.wsMessage(msg);\r\n            ws.onclose = (ev) => {\r\n                that.ws = undefined;\r\n                console.log('webSocket closed!');\r\n            }\r\n        });\r\n    }\r\n    close() {\r\n        if (this.ws !== undefined) {\r\n            this.ws.close();\r\n            this.ws = undefined;\r\n        }\r\n    }\r\n    private async wsMessage(event:any):Promise<void> {\r\n        try {\r\n            console.log('websocket message: %s', event.data);\r\n            let msg = JSON.parse(event.data);\r\n            postWsToSubApp(msg);\r\n            await this.receive(msg);\r\n        }\r\n        catch (err) {\r\n            console.log('ws msg error: ', err);\r\n        }\r\n    }\r\n    sendWs(msg:any) {\r\n        let netThis = this;\r\n        this.connect().then(() => {\r\n            netThis.ws.send(msg);\r\n        });\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { nav } from './nav';\r\n\r\nexport interface ImageProps {\r\n    src: string;\r\n    className?: string;\r\n    style?: React.CSSProperties;\r\n    altImage?: string;\r\n}\r\n\r\n// src = .src, 表示fontawesome Icon\r\nexport function Image(props: ImageProps) {\r\n\tlet {className, style, src, altImage} = props;\r\n\tlet icon:string;\r\n    if (src) {\r\n\t\tif (src.indexOf('.') !== 0) {\r\n\t\t\tif (src.startsWith(':') === true) {\r\n\t\t\t\tsrc = nav.resUrl + src.substr(1);\r\n\t\t\t}\r\n\t\t\treturn <img src={src} className={className} alt=\"img\"\r\n\t\t\t\tstyle={style}\r\n\t\t\t\tonError={evt=>{\r\n\t\t\t\t\tif (altImage) evt.currentTarget.src=altImage;\r\n\t\t\t\t\telse evt.currentTarget.src = 'https://tv.jkchemical.com/imgs/0001.png';\r\n\t\t\t\t}} />;\r\n\t\t}\r\n\t\ticon = src.substr(1);\r\n\t}\r\n\telse {\r\n\t\ticon = 'file-o'\r\n\t}\r\n\treturn <span className={classNames(className, 'image-none')} style={style}>\r\n\t\t<i className={'fa fa-' + icon} />\r\n\t</span>;\r\n}\r\n","import jwtDecode from 'jwt-decode';\r\n\r\nexport interface Unit {\r\n    id: number;\r\n    name: string;\r\n}\r\n\r\nexport interface Guest {\r\n    id: number;             // id = 0\r\n    guest: number;\r\n    token: string;\r\n}\r\n\r\nexport interface User extends Guest {\r\n    id: number;\r\n    name: string;\r\n    nick?: string;\r\n\ticon?: string;\r\n\troles?: {[uq:string]: string[]}\r\n}\r\n\r\nexport function decodeUserToken(token: string): User {\r\n    let ret:any = jwtDecode(token);\r\n    let user: User = {\r\n        id: ret.id,\r\n        name: ret.name,\r\n        guest: ret.guest,\r\n        token: token,\r\n    };\r\n    return user;\r\n}\r\n\r\nexport function decodeGuestToken(token: string): Guest {\r\n    let ret:any = jwtDecode(token);\r\n    let guest: Guest = {\r\n        id: 0,\r\n        guest: ret.guest,\r\n        token: token,\r\n    };\r\n    return guest;\r\n}\r\n","import { env } from '../tool';\r\n\r\nconst centerHost = process.env['REACT_APP_CENTER_HOST'];\r\nconst centerDebugHost = 'localhost:3000'; //'192.168.86.64';\r\nconst resHost = process.env['REACT_APP_RES_HOST'] || centerHost;\r\nconst resDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nconst uqDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nconst uqDebugBuilderHost = 'localhost:3009';\r\ninterface HostValue {\r\n    value: string;\r\n\tlocal: boolean;\r\n}\r\nconst hosts:{[name:string]:HostValue} = {\r\n    centerhost: {\r\n        value: process.env['REACT_APP_CENTER_DEBUG_HOST'] || centerDebugHost, \r\n\t\tlocal: false,\r\n    },\r\n    reshost: {\r\n        value: process.env['REACT_APP_RES_DEBUG_HOST'] || resDebugHost,\r\n\t\tlocal: false,\r\n    },\r\n    uqhost: {\r\n        value: process.env['REACT_APP_UQ_DEBUG_HOST'] || uqDebugHost, \r\n\t\tlocal: false,\r\n    },\r\n    unitxhost: {\r\n        value: process.env['REACT_APP_UQ_DEBUG_HOST'] || uqDebugHost, \r\n\t\tlocal: false,\r\n    },\r\n    \"uq-build\": {\r\n        value: process.env['REACT_APP_UQ_DEBUG_BUILDER_HOST'] || uqDebugBuilderHost, \r\n\t\tlocal: false,\r\n    }\r\n}\r\n\r\nconst httpArr = ['https://', 'http://'];\r\nfunction isAbsoluteUrl(url:string):boolean {\r\n    for (let str of httpArr) {\r\n        if (url.startsWith(str) === true) return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction urlFromHost(host:string):string {\r\n    if (isAbsoluteUrl(host) === true) {\r\n        if (host.endsWith('/')) return host;\r\n        return host + '/';\r\n    }\r\n    return `http://${host}/`;\r\n}\r\n\r\nfunction centerUrlFromHost(host:string):string {\r\n    return urlFromHost(host);\r\n}\r\nfunction centerWsFromHost(host:string) {\r\n    let https = 'https://';\r\n    if (host.startsWith(https) === true) {\r\n        host = host.substr(https.length);\r\n        if (host.endsWith('/') === true) host = host.substr(0, host.length-1);\r\n        return 'wss://' + host + '/tv/';\r\n    }\r\n    return `ws://${host}/tv/`\r\n}\r\nexport function resUrlFromHost(host:string) {\r\n\tif (!host) return;\r\n    let url = urlFromHost(host);\r\n    return url + 'res/';\r\n}\r\n\r\nconst fetchOptions = {\r\n    method: \"GET\",\r\n    mode: \"no-cors\", // no-cors, cors, *same-origin\r\n    headers: {\r\n        \"Content-Type\": \"text/plain\"\r\n    },\r\n};\r\n\r\nclass Host {\r\n    testing: boolean;\r\n    url: string;\r\n    ws: string;\r\n    resHost: string;\r\n\r\n    async start(testing:boolean) {\r\n\t\tif (!centerHost) debugger;\r\n        this.testing = testing;\r\n        if (env.isDevelopment === true) {\r\n            await this.tryLocal();\r\n        }\r\n        let host = this.getCenterHost();\r\n        this.url = centerUrlFromHost(host);\r\n        this.ws = centerWsFromHost(host);\r\n\t\tthis.resHost = this.getResHost();\r\n    }\r\n\r\n    private debugHostUrl(host:string) {return `http://${host}/hello`}\r\n    private async tryLocal() {\r\n        let promises:PromiseLike<any>[] = [];\r\n        let hostArr:string[] = [];\r\n        for (let i in hosts) {\r\n            let hostValue = hosts[i];\r\n            let {value} = hostValue;\r\n            if (hostArr.findIndex(v => v === value) < 0) hostArr.push(value);\r\n        }\r\n\r\n        for (let host of hostArr) {\r\n            let fetchUrl = this.debugHostUrl(host);\r\n            promises.push(localCheck(fetchUrl));\r\n        }\r\n        let results = await Promise.all(promises);\r\n        let len = hostArr.length;\r\n        for (let i=0; i<len; i++) {\r\n            let local = results[i];\r\n            let host = hostArr[i];\r\n            for (let j in hosts) {\r\n                let hostValue = hosts[j];\r\n                if (hostValue.value === host) {\r\n                    hostValue.local = local;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private getCenterHost():string {\r\n        let {value, local} = hosts.centerhost;\r\n        let hash = document.location.hash;\r\n        if (hash.includes('sheet_debug') === true) {\r\n            return value;\r\n        }\r\n        if (env.isDevelopment === true) {\r\n            if (local === true) return value;\r\n        }\r\n        return centerHost;\r\n    }\r\n\r\n    private getResHost():string {\r\n        let {value, local} = hosts.reshost;\r\n        let hash = document.location.hash;\r\n        if (hash.includes('sheet_debug') === true) {\r\n            return value;\r\n        }\r\n        if (env.isDevelopment === true) {\r\n            if (local === true) return value;\r\n        }\r\n        return resHost;\r\n    }\r\n\r\n    getUrlOrDebug(url:string, debugHost:string = 'uqhost'):string {\r\n        if (env.isDevelopment === false) return url;\r\n        let host = hosts[debugHost];\r\n        if (host === undefined) return url;\r\n        let {value, local} = host;\r\n        if (local === false) return url;\r\n        return `http://${value}/`;\r\n    }\r\n    getUrlOrTest(db:string, url:string, urlTest:string):string {\r\n\t\tif (!urlTest) {\r\n\t\t\turlTest = url;\r\n\t\t\tif (!urlTest) {\r\n\t\t\t\tconsole.error('no server set for ' + db);\r\n\t\t\t\tdebugger;\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (!url) {\r\n\t\t\turl = urlTest;\r\n\t\t}\r\n\t\tlet testProd:string;\r\n        if (this.testing === true) {\r\n\t\t\tif (urlTest !== '-') url = urlTest;\r\n\t\t\ttestProd = 'test';\r\n        }\r\n        else {\r\n\t\t\ttestProd = 'prod';\r\n        }\r\n\t\turl = this.getUrlOrDebug(url);\r\n\t\tif (url.endsWith('/') === false) {\r\n\t\t\turl += '/';\r\n\t\t}\r\n        return `${url}uq/${testProd}/${db}/`;\r\n    }\r\n\r\n    async localCheck(urlDebug: string):Promise<boolean> {\r\n        return await localCheck(urlDebug);\r\n    }\r\n}\r\n\r\nexport const host:Host = new Host();\r\n\r\n// 因为测试的都是局域网服务器，甚至本机服务器，所以一秒足够了\r\n// 网上找了上面的fetch timeout代码。\r\n// 尽管timeout了，fetch仍然继续，没有cancel\r\n\r\n// 实际上，一秒钟不够。web服务器会自动停。重启的时候，可能会比较长时间。也许两秒甚至更多。\r\n//const timeout = 2000;\r\nconst timeout = 2000;\r\n\r\nfunction fetchLocalCheck(url:string):Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n      fetch(url, fetchOptions as any)\r\n      .then(v => {\r\n          v.text().then(resolve).catch(reject);\r\n      })\r\n      .catch(reject);\r\n      const e = new Error(\"Connection timed out\");\r\n      env.setTimeout('fetchLocalCheck', reject, timeout, e);\r\n    });\r\n}\r\n\r\nasync function localCheck(url:string):Promise<boolean> {\r\n    try {\r\n\t\tawait fetchLocalCheck(url);\r\n        return true;\r\n    }\r\n    catch (err) {\r\n        return false;\r\n    }\r\n}\r\n\r\n/*\r\nexport interface IUqForChannel {\r\n    uq: string;\r\n    uqVersion: number;\r\n}\r\n*/","import React from 'react';\r\nimport { PageHeaderProps } from './pageHeader';\r\n\r\nconst scrollAfter = 20; // 20ms之后，scroll执行\r\nexport class Scroller {\r\n    private el: HTMLBaseElement;\r\n    constructor(el: HTMLBaseElement) {\r\n        this.el = el;\r\n    }\r\n\r\n    scrollToTop():void {\r\n        setTimeout(() => this.el.scrollTo(0, 0), scrollAfter);\r\n    }\r\n    scrollToBottom():void {\r\n        setTimeout(() => this.el.scrollTo(0, this.el.scrollTop + this.el.offsetHeight), scrollAfter);\r\n    }\r\n}\r\n\r\nexport interface ScrollProps {\r\n    onScroll?: (e:any) => void;\r\n    onScrollTop?: (scroller: Scroller) => Promise<boolean>;\r\n\tonScrollBottom?: (scroller: Scroller) => Promise<void>;\r\n\tclassName?: string;\r\n}\r\ninterface ScrollViewProps extends ScrollProps {\r\n\tclassName?: string;\r\n\tstyle?: React.CSSProperties;\r\n}\r\nconst scrollTimeGap = 100;\r\nconst scrollEdgeGap = 30;\r\nabstract class ScrollViewBase<T extends ScrollViewProps> extends React.Component<T, null> {\r\n    private bottomTime:number = 0;\r\n\tprivate topTime:number = 0;\r\n\tprivate div: HTMLDivElement;\r\n\r\n\tprotected refDiv = (div:HTMLDivElement) => {\r\n\t\tif (!div) {\r\n\t\t\tif (this.div) {\r\n\t\t\t\tthis.div.removeEventListener('resize', this.onResize)\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.div = div;\r\n\t\tthis.div.addEventListener('resize', this.onResize);\r\n\t}\r\n\r\n\tprivate onResize = (ev:UIEvent) => {\r\n\t\tconsole.error('div resize');\r\n\t};\r\n\r\n    protected onScroll = async (e:any) => {\r\n        let {onScroll, onScrollTop, onScrollBottom} = this.props;\r\n        if (onScroll) onScroll(e);\r\n        let el = e.target as HTMLBaseElement;\r\n        let scroller = new Scroller(el);\r\n        if (el.scrollTop < scrollEdgeGap) {\r\n            if (onScrollTop !== undefined) {\r\n                let topTime = new Date().getTime();\r\n                if (topTime-this.topTime > scrollTimeGap) {\r\n                    this.topTime = topTime;\r\n\t\t\t\t\tonScrollTop(scroller).then(ret => {\r\n\t\t\t\t\t\t // has more\r\n\t\t\t\t\t\tif (ret === true) {\r\n\t\t\t\t\t\t\tlet sh = el.scrollHeight;\r\n\t\t\t\t\t\t\tlet top = 200;\r\n\t\t\t\t\t\t\tif (top > sh) top = sh;\r\n\t\t\t\t\t\t\tel.scrollTop = top;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n                }\r\n            }\r\n        }\r\n        if (el.scrollTop + el.offsetHeight > el.scrollHeight - scrollEdgeGap) {\r\n            if (onScrollBottom !== undefined) {\r\n                let bottomTime = new Date().getTime();\r\n                if (bottomTime - this.bottomTime > scrollTimeGap) {\r\n                    this.bottomTime = bottomTime;\r\n                    onScrollBottom(scroller);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    private eachChild(c:any, direct:'top'|'bottom') {\r\n        let { props } = c;\r\n        if (props === undefined)\r\n            return;\r\n        let { children } = props;\r\n        if (children === undefined)\r\n            return;\r\n        React.Children.forEach(children, (child, index) => {\r\n            let {_$scroll} = child as any;\r\n            if (_$scroll) _$scroll(direct);\r\n            console.log(child.toString());\r\n            this.eachChild(child, direct);\r\n        });\r\n\t}\r\n}\r\n\r\nexport class ScrollView extends ScrollViewBase<ScrollViewProps> {\r\n    render() {\r\n\t\tlet {className, style} = this.props;\r\n\t\treturn <div ref={this.refDiv} className=\"tv-page\"\r\n\t\t\tonScroll={this.onScroll} style={style}>\r\n\t\t\t<article className={className}>\r\n\t\t\t\t{this.props.children}\r\n\t\t\t</article>\r\n\t\t</div>;\r\n    }\r\n}\r\n\r\nexport interface PageWebNav {\r\n\tnavHeader?: JSX.Element; \r\n\tnavRawHeader?: JSX.Element; \r\n\tnavFooter?: JSX.Element; \r\n\tnavRawFooter?: JSX.Element; \r\n\trenderPageHeader?: (props:PageHeaderProps)=>JSX.Element;\r\n}\r\ninterface WebNavScrollViewProps extends ScrollViewProps {\r\n\twebNav: PageWebNav;\r\n}\r\n\r\nexport class WebNavScrollView extends ScrollViewBase<WebNavScrollViewProps> {\r\n    render() {\r\n\t\tlet {className, style, webNav} = this.props;\r\n\t\tlet {navHeader, navRawHeader, navFooter, navRawFooter} = webNav;\r\n\t\tlet vHeader:any, vFooter:any;\r\n\t\tif (navRawHeader) vHeader = navRawHeader;\r\n\t\telse if (navHeader) vHeader = <header><main>{navHeader}</main></header>\r\n\t\tif (navRawFooter) vFooter = navRawFooter;\r\n\t\telse if (navFooter) vFooter = <footer><main>{navFooter}</main></footer>\r\n\r\n\t\treturn <div ref={this.refDiv} className=\"tv-page-webnav\"\r\n\t\t\tonScroll={this.onScroll} style={style}>\r\n\t\t\t{vHeader}\r\n\t\t\t<article className={className}>\r\n\t\t\t\t{this.props.children}\r\n\t\t\t</article>\r\n\t\t\t{vFooter}\r\n\t\t</div>;\r\n    }\r\n}\r\n","import _ from 'lodash';\r\n\r\nexport interface KeyValueRes {\r\n    [key:string]: any;\r\n}\r\n\r\nexport interface Res<T extends KeyValueRes> {\r\n    [lang:string]: T | {[district:string]: T};\r\n}\r\n\r\nexport const resOptions:{\r\n\tlang: string;\r\n\t$lang: string;\r\n\tdistrict: string;\r\n\t$district: string;\r\n} = {\r\n\tlang: undefined,\r\n\t$lang: undefined,\r\n\tdistrict: undefined,\r\n\t$district: undefined,\r\n}\r\n\r\nexport function setResOptions(lang:string, district:string) {\r\n\tresOptions.lang = lang;\r\n\tresOptions.$lang = '$' + lang;\r\n    resOptions.district = district;\r\n    resOptions.$district = '$' + district;\r\n}\r\n\r\n(function() {\r\n    let lang: string, district: string;\r\n    let language = (navigator.languages && navigator.languages[0])  // Chrome / Firefox\r\n        || navigator.language; // ||   // All browsers\r\n    //navigator.userLanguage; // IE <= 10\r\n    if (!language) {\r\n        lang = 'zh';\r\n        district = 'CN';\r\n    }\r\n    else {\r\n        let parts = language.split('-');\r\n        lang = parts[0];\r\n        if (parts.length > 1) district = parts[1].toUpperCase();\r\n    }\r\n    setResOptions(lang, district);\r\n}());\r\n\r\nexport function resLang<T extends KeyValueRes>(res:Res<T>):T {\r\n    let {lang, district} = resOptions;\r\n    let ret:T = {} as T;\r\n    if (res === undefined) return ret;\r\n    _.merge(ret, res._);\r\n    let l = res[lang];\r\n    if (l === undefined) return ret;\r\n    _.merge(ret, l._);\r\n    let d = l[district];\r\n    if (d === undefined) return ret;\r\n    _.merge(ret, d);\r\n    let {entity} = ret;\r\n    if (entity !== undefined) {\r\n        for (let i in entity) {\r\n            entity[i.toLowerCase()] = entity[i];\r\n        }\r\n    }\r\n    return ret;\r\n}\r\n\r\nconst resGlobal:any = {};\r\nexport function setRes(target: any, res: any):(str:string)=>any {\r\n\tif (res === undefined) return;\r\n\tlet {$lang, $district} = resOptions;\r\n\t_.merge(target, res);\r\n\tif ($lang !== undefined) {\r\n\t\tlet l = res[$lang];\r\n\t\tif (l !== undefined) {\r\n\t\t\t_.merge(target, l);\r\n\t\t\tlet d = l[$district];\r\n\t\t\tif (d !== undefined) {\r\n\t\t\t\t_.merge(target, d);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn function(str:string) {\r\n\t\treturn target[str] || str;\r\n\t}\r\n}\r\nexport function setGlobalRes(res: any) {\r\n\tsetRes(resGlobal, res);\r\n}\r\nexport function t(str:string):string|JSX.Element {\r\n\treturn resGlobal[str] || str;\r\n}\r\nexport type TFunc = (str:string|JSX.Element) => string|JSX.Element;\r\n","import { Entity } from './entity';\r\nimport { ActionCaller } from './caller';\r\n\r\nexport class UqAction<P, R> extends Entity {\r\n    get typeName(): string { return 'action';}\r\n    async submit(data:P, waiting: boolean = true) {\r\n\t\tlet caller = new ActionSubmitCaller(this, data)\r\n\t\tlet ret = await caller.request();\r\n\t\treturn ret;\r\n    }\r\n    async submitReturns(data:P):Promise<R> {\r\n       return await new SubmitReturnsCaller(this, data).request();\r\n    }\r\n    async submitConvert(data:P) {\r\n        return await new SubmitConvertCaller(this, data).request();\r\n    }\r\n}\r\n\r\nexport class Action extends UqAction<any, any> {\r\n}\r\n\r\nexport class ActionSubmitCaller extends ActionCaller {\r\n    get path():string {return 'action/' + this.entity.name;}\r\n    buildParams():any {\r\n\t\treturn {data: this.entity.pack(this.params)}\r\n\t}\r\n}\r\n\r\nclass SubmitReturnsCaller extends ActionSubmitCaller {\r\n    get path():string {return 'action/' + this.entity.name + '/returns';}\r\n    xresult(res:any):any {\r\n        let {returns} = this.entity;\r\n        let len = returns.length;\r\n        let ret:{[r:string]:any[]} = {};\r\n        for (let i=0; i<len; i++) {\r\n            let retSchema = returns[i];\r\n            ret[retSchema.name] = res[i];\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n\r\nclass SubmitConvertCaller extends ActionSubmitCaller {\r\n    get path():string {return 'action-convert/' + this.entity.name;}\r\n    buildParams():any {\r\n        return {\r\n            data: this.params\r\n        };\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport '../../css/va-lmr.css';\r\n\r\nexport interface LMRProps {\r\n    className?: string | string[];\r\n    left?: string|JSX.Element;\r\n    right?: string|JSX.Element;\r\n    onClick?: ()=>void;\r\n}\r\n\r\n@observer\r\nexport class LMR extends React.Component<LMRProps> {\r\n    render() {\r\n        let {className, left, children, right, onClick} = this.props;\r\n        let l, r;\r\n        if (left !== undefined) l = <header>{left}</header>;\r\n        if (right !== undefined) r = <footer>{right}</footer>;\r\n        let cursor;\r\n        if (onClick !== undefined) cursor = 'cursor-pointer';\r\n        return <div className={classNames('va-lmr', className, cursor)} onClick={onClick}>\r\n            {l}\r\n            <div>{children}</div>\r\n            {r}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport '../../css/va-badge.css';\r\n\r\nexport interface BadgeProps {\r\n    className?: string;\r\n    badge?: string|number;\r\n    size?: 'xs' | 'sm' | 'lg';\r\n    color?: 'secondary'|'success'|'danger'|'primary'|'info'|'warning';\r\n    badgeAlign?: 'left'|'center'|'right';\r\n    badgeVertical?: 'top'|'middle'|'bottom';\r\n}\r\n\r\n@observer\r\nexport class Badge extends React.Component<BadgeProps> {\r\n    render() {\r\n        let {className, badge, size, color, badgeAlign, badgeVertical, children} = this.props;\r\n        let cn = classNames(\r\n            className,\r\n            'va-badge',\r\n            size && 'va-badge-'+size,\r\n            'va-badge-' + (color||'secondary'),\r\n            badgeAlign && 'va-badg-'+badgeAlign,\r\n            badgeVertical && 'va-badg-'+badgeVertical,\r\n        );\r\n        let b;\r\n        if (badge) b = <b>{badge}</b>;\r\n        return <div className={cn}>\r\n            {children}\r\n            {b}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport interface FAProps {\r\n    name: string;\r\n    className?: string;\r\n    size?: 'lg'|'2x'|'3x'|'4x'|'5x';\r\n    spin?: boolean;\r\n    fixWidth?: boolean;\r\n    border?: boolean;\r\n    pull?: 'left'|'right';\r\n    pulse?: boolean;\r\n    rotate?: 90|180|270;\r\n    flip?: 'horizontal'|'vertical';\r\n    inverse?: boolean;\r\n}\r\n\r\nexport class FA extends React.Component<FAProps> {\r\n    render() {\r\n        let {name, className, size, spin, fixWidth, border, pull, pulse, rotate, flip, inverse} = this.props;\r\n        let cn = classNames(className, 'fa',\r\n            name && ('fa-' + name),\r\n            size && 'fa-'+size,\r\n            fixWidth && 'fa-fw',\r\n            border && 'fa-border',\r\n            pull && 'fa-pull-' + pull,\r\n            spin && 'fa-spin',\r\n            pulse && 'fa-pulse',\r\n            rotate && 'fa-rotate-' + rotate,\r\n            flip && 'fa-flip-' + flip,\r\n            inverse && 'fa-inverse',\r\n        );\r\n        return <i className={cn} />\r\n    }\r\n}\r\n\r\nexport interface StackedFAProps {\r\n    className?: string;\r\n    size?: 'lg',\r\n}\r\nexport class StackedFA extends React.Component<StackedFAProps> {\r\n    render() {\r\n        let {className, size, children} = this.props;\r\n        let cn = classNames(\r\n            'fa-stack',\r\n            className,\r\n            size && 'fa-' + size);\r\n        return <span className={cn}>\r\n            {children}\r\n        </span>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {FA} from './FA';\r\n\r\nexport interface IconTextProps {\r\n    icon: string;\r\n    iconClass?: string;\r\n    text: string | JSX.Element;\r\n    textClass?: string;\r\n}\r\n\r\nexport class IconText extends React.Component<IconTextProps> {\r\n    render() {\r\n        let {icon, iconClass, text, textClass} = this.props;\r\n        return <div className=\"py-2\">\r\n            <FA className={iconClass} name={icon} fixWidth={true} />\r\n            <span className={textClass}>{text}</span>\r\n        </div>;\r\n    }\r\n}\r\n","export * from './base';\r\nexport * from './ID';\r\nexport * from './IDX';\r\nexport * from './IX';\r\nexport * from './sheet';\r\nexport * from './tag';\r\nexport * from './form';\r\nexport * from './roles';\r\nexport * from './select';","import _ from 'lodash';\r\n\r\nclass _LocalStorage {\r\n    getItem(key:string) {\r\n        return localStorage.getItem(key)\r\n    }\r\n    setItem(key:string, value:string) {\r\n        localStorage.setItem(key, value);\r\n    }\r\n    removeItem(key:string) {\r\n        localStorage.removeItem(key);\r\n    }\r\n}\r\n\r\nconst __ls = new _LocalStorage(); // new Ls;\r\n\r\nexport class LocalCache {\r\n    private readonly local: Local;\r\n    //private value: T;\r\n    readonly key: string|number;\r\n\r\n    constructor(local:Local, key:string|number) {\r\n        this.local = local;\r\n        this.key = key;\r\n    }\r\n    get():any {\r\n        try {\r\n            // 下面缓冲的内容不能有，可能会被修改，造成circular引用\r\n            //if (this.value !== undefined) return this.value;\r\n            let text = this.local.getItem(this.key);\r\n            if (text === null) return;\r\n            if (text === undefined) return undefined;\r\n            //return this.value = \r\n            return JSON.parse(text);\r\n        }\r\n        catch (err) {\r\n            this.local.removeItem(this.key);\r\n            return;\r\n        }\r\n    }\r\n    set(value:any) {\r\n\t\tlet t = JSON.stringify(value, (key, value) => {\r\n\t\t\tif (key !== '_tuid') return value;\r\n\t\t});\r\n\t\tthis.local.setItem(this.key, t);\r\n    }\r\n    remove(local?:Local) {\r\n        if (local === undefined) {\r\n            this.local.removeItem(this.key);\r\n        }\r\n        else {\r\n            this.local.removeLocal(local);\r\n        }\r\n    }\r\n    child(key:string|number):LocalCache {\r\n        return this.local.child(key);\r\n    }\r\n    arr(key:string|number):LocalArr {\r\n        return this.local.arr(key);\r\n    }\r\n    map(key:string|number):LocalMap {\r\n        return this.local.map(key);\r\n    }\r\n}\r\n\r\nabstract class Local {\r\n    private readonly caches: {[key:string]:LocalCache};\r\n    private readonly locals: {[key:string]:Local};\r\n    protected readonly name: string;\r\n    constructor(name: string) {\r\n        this.name = name;\r\n        this.caches = {};\r\n        this.locals = {};\r\n    }\r\n\r\n    protected abstract keyForGet(key:string|number):string;\r\n    protected abstract keyForSet(key:string|number):string;\r\n    protected abstract keyForRemove(key:string|number):string;\r\n    abstract removeAll():void;\r\n    getItem(key:string|number):string {\r\n        let k = this.keyForGet(key);\r\n        if (k === undefined) return;\r\n        return __ls.getItem(k);\r\n    }\r\n    setItem(key:string|number, value: string):void {\r\n        let k = this.keyForSet(key);\r\n        __ls.setItem(k, value);\r\n    }\r\n    removeItem(key:string|number):void {\r\n        let k = this.keyForSet(key);\r\n        if (k === undefined) return;\r\n        localStorage.removeItem(k);\r\n    }\r\n    arr(key:string|number):LocalArr {\r\n        let sk = String(key);\r\n        let arr = this.locals[sk] as LocalArr;\r\n        if (arr === undefined) {\r\n            let k = this.keyForSet(key);\r\n            this.locals[sk] = arr = new LocalArr(k);\r\n        }\r\n        return arr;\r\n    }\r\n    map(key:string|number):LocalMap {\r\n        let sk = String(key);\r\n        let map = this.locals[sk] as LocalMap;\r\n        if (map === undefined) {\r\n            let k = this.keyForSet(key);\r\n            this.locals[sk] = map = new LocalMap(k);\r\n        }\r\n        return map;\r\n    }\r\n    removeLocal(local:Local) {\r\n        let sk = local.name;\r\n        let k = this.keyForRemove(sk);\r\n        if (k === undefined) return;\r\n        let arr = this.locals[sk];\r\n        if (arr === undefined) arr = new LocalArr(k);\r\n        else this.locals[sk] = undefined;\r\n        arr.removeAll();\r\n    }\r\n    child(key:string|number):LocalCache {\r\n        let ks = String(key);\r\n        let ret = this.caches[ks];\r\n        if (ret !== undefined) return ret;\r\n        return this.caches[ks] =ret = new LocalCache(this, key);\r\n    }\r\n}\r\n\r\nconst maxArrSize = 500;\r\nexport class LocalArr extends Local {\r\n    private readonly index: number[];\r\n    constructor(name: string) {\r\n        super(name);\r\n        let index = __ls.getItem(this.name);\r\n        this.index = index === null? [] : index.split('\\n').map(v => Number(v));\r\n    }\r\n    private saveIndex() {\r\n        __ls.setItem(this.name, this.index.join('\\n'));\r\n    }\r\n    protected keyForGet(key:number):string {\r\n        let i = _.indexOf(this.index, key);\r\n        if (i < 0) return undefined;\r\n        return `${this.name}.${key}`;\r\n    }\r\n    protected keyForSet(key:number):string {\r\n        let i = _.indexOf(this.index, key);\r\n        if (i<0) {\r\n            this.index.unshift(key);\r\n            if (this.index.length > maxArrSize) this.index.pop();\r\n        }\r\n        else {\r\n            this.index.splice(i, 1);\r\n            this.index.unshift(key)\r\n        }\r\n        this.saveIndex();\r\n        return `${this.name}.${key}`;\r\n    }\r\n    protected keyForRemove(key:number):string {\r\n        let i = _.indexOf(this.index, key);\r\n        if (i<0) return;\r\n        this.index.splice(i, 1);\r\n        this.saveIndex();\r\n        return `${this.name}.${key}`;\r\n    }\r\n    removeAll():void {\r\n        for (let i of this.index) {\r\n            __ls.removeItem(`${this.name}.${i}`);\r\n        }\r\n        __ls.removeItem(this.name);\r\n        this.index.splice(0);\r\n    }\r\n    item(index:number):LocalCache {\r\n        return this.child(index);\r\n    }\r\n}\r\n\r\nexport class LocalMap extends Local {\r\n    private readonly index: {[key:string]:number};\r\n    private max: number;\r\n    constructor(name: string) {\r\n        super(name);\r\n        this.max = 0;\r\n        this.index = {};\r\n        let index = __ls.getItem(this.name);\r\n        if (index !== null) {\r\n            let ls = index.split('\\n');\r\n            ls.forEach(l => {\r\n                let p = l.indexOf('\\t');\r\n                if (p<0) return;\r\n                let key = l.substr(0, p);\r\n                let i = Number(l.substr(p+1));\r\n                if (isNaN(i) === true) return;\r\n                this.index[key] = i;\r\n                if (i>this.max) this.max = i;\r\n            });\r\n        }\r\n    }\r\n    private saveIndex() {\r\n        let ls:string[] = [];\r\n        for (let k in this.index) {\r\n            let v = this.index[k];\r\n            if (v === undefined) continue;\r\n            ls.push(`${k}\\t${v}`);\r\n        }\r\n        __ls.setItem(this.name, ls.join('\\n'));\r\n    }\r\n    protected keyForGet(key:number):string {\r\n        let i = this.index[key];\r\n        if (i === undefined) return undefined;\r\n        return `${this.name}.${i}`;\r\n    }\r\n    protected keyForSet(key:number):string {\r\n        let i = this.index[key];\r\n        if (i === undefined) {\r\n            ++this.max;\r\n            i = this.max;\r\n            this.index[key] = i;\r\n            this.saveIndex();\r\n        }\r\n        return `${this.name}.${i}`;\r\n    }\r\n    protected keyForRemove(key:string|number):string {\r\n        let i = this.index[key];\r\n        if (i===undefined) return;\r\n        this.index[key] = undefined;\r\n        this.saveIndex();\r\n        return `${this.name}.${i}`;\r\n    }\r\n    removeAll():void {\r\n        for (let i in this.index) {\r\n            __ls.removeItem(`${this.name}.${this.index[i]}`);\r\n            this.index[i] = undefined;\r\n        }\r\n        __ls.removeItem(this.name);\r\n        this.max = 0;\r\n    }\r\n    item(key:string):LocalCache {\r\n        return this.child(key);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { BoxId } from './boxId';\r\nimport { Tuid } from './tuid';\r\nimport { observer } from 'mobx-react';\r\n\r\nconst TuidContent = (tuidName:string, values:any, x?:any) => {\r\n    return <>{tuidName}: {uqStringify(values)}</>;\r\n};\r\n\r\nexport function uqStringify(values: any): string {\r\n    let s = '{';\r\n    if (values === undefined) return 'undefined';\r\n    for (let i in values) {\r\n        let v = values[i];\r\n        s += i + ': ';\r\n        if (v === undefined) {\r\n            s += 'undefined';\r\n        }\r\n        else if (v === null) {\r\n            s += 'null';\r\n        }\r\n        else {\r\n            switch (typeof v) {\r\n                default:\r\n                    s += v;\r\n                    break;\r\n                case 'function':\r\n                    s += 'function';\r\n                    break;\r\n                case 'object':\r\n                    s += '{obj}';\r\n                    break;\r\n            }\r\n        }\r\n        s += ', ';\r\n    }\r\n    return s + '}';\r\n}\r\n\r\nexport class ReactBoxId implements BoxId {\r\n    readonly id: number;\r\n    protected tuid: Tuid;\r\n    protected ui: (values:any) => JSX.Element;\r\n    readonly isUndefined:boolean;\r\n    constructor(id: number, tuid: Tuid, ui: (values:any) => JSX.Element) {\r\n        this.id = Number(id);\r\n        this.tuid = tuid;\r\n        this.ui = ui;\r\n        this.isUndefined = (this.tuid === undefined);\r\n    }\r\n\r\n    get obj():any {\r\n        return this.tuid.valueFromId(this.id);\r\n    }\r\n\r\n    equ(id:BoxId|number): boolean {\r\n        if (id === undefined || id === null) return false;\r\n        if (typeof id === 'object') return this.id === id.id;\r\n        return this.id === id;\r\n    }\r\n\r\n    render(ui:TvTemplet, x:any):JSX.Element {\r\n        if (this.id === undefined || this.id === null || isNaN(this.id) === true) return;\r\n        let boxName = this.boxName; // this.tuid.name;\r\n        let val = this.obj; // this.tuid.valueFromId(this.id);\r\n        if (this.isUndefined === true) {\r\n            if (ui !== undefined) return ui(val, x);\r\n            return TuidContent(boxName, val, x);\r\n        }\r\n        switch (typeof val) {\r\n            case 'undefined':\r\n                return <span className=\"text-black-50\">{boxName} undefined</span>;\r\n            case 'number':\r\n                return <span className=\"text-light\">{boxName} {this.id}</span>;\r\n        }\r\n        if (ui === undefined) {\r\n            ui = this.ui;\r\n        }\r\n        if (ui !== undefined) {\r\n            if (typeof ui !== 'function') {\r\n                ui = (ui as any).content;\r\n            }\r\n            if (ui !== undefined) {\r\n                let ret = ui(val/*, this.tuidUR.res*/);\r\n                if (ret !== undefined) return ret;\r\n                return <span className=\"text-danger\">{boxName} {this.id}</span>;\r\n            }\r\n        }\r\n\r\n        return TuidContent(boxName, val);\r\n    }\r\n\r\n    get boxName():string {return this.tuid.name}\r\n    // ui(): TvTemplet {return this.tuid.ui}\r\n    // res(): any {return this.tuid.res}\r\n\r\n    async assure(): Promise<BoxId> {\r\n        await this.tuid.assureBox(this.id);\r\n        return this;\r\n    }\r\n}\r\n\r\nfunction boxIdContent(bi: number|BoxId, ui:TvTemplet, x:any) {\r\n    let logContent:any;\r\n    let boxId:ReactBoxId = bi as ReactBoxId;\r\n    switch(typeof bi) {\r\n        case 'undefined': logContent = <>boxId undefined</>; break;\r\n        case 'number': logContent = <>id:{bi}</>; break;\r\n        default:\r\n            if (typeof boxId.render !== 'function') {\r\n                if (ui === undefined) {\r\n                    logContent = TuidContent(boxId.boxName, bi, x);\r\n                }\r\n                else {\r\n                    return ui(bi, x);\r\n                }\r\n            }\r\n            break;\r\n    }\r\n    if (logContent !== undefined) {\r\n        return <del className=\"text-danger\">{logContent}</del>;\r\n    }\r\n    return boxId.render(ui, x);\r\n}\r\n\r\nexport type TvTemplet = (values?:any, x?:any) => JSX.Element;\r\n\r\ninterface Props {\r\n    tuidValue: number|BoxId, \r\n    ui?: TvTemplet,\r\n    x?: any,\r\n    nullUI?: ()=>JSX.Element\r\n}\r\n\r\nconst Tv = observer(({tuidValue, ui, x, nullUI}:Props) => {\r\n    if (tuidValue === undefined) {\r\n        if (nullUI === undefined) return <small className=\"text-muted\">[无]</small>;\r\n        return nullUI();\r\n    }\r\n    if (tuidValue === null) {\r\n        if (nullUI === undefined) return <>[null]</>;\r\n        return nullUI();\r\n    }\r\n    let ttv = typeof tuidValue;\r\n    switch (ttv) {\r\n        default:\r\n            if (ui === undefined)\r\n                return <>{ttv}-{tuidValue}</>;\r\n            else {\r\n                let ret = ui(tuidValue, x);\r\n                if (ret !== undefined) return ret;\r\n                return <>{tuidValue}</>;\r\n            }\r\n        case 'object':\r\n            let divObj = boxIdContent(tuidValue, ui, x);\r\n            if (divObj !== undefined) return divObj;\r\n            return nullUI === undefined? <>id null</>: nullUI();\r\n        case 'number':\r\n            return <>id...{tuidValue}</>;\r\n    }\r\n});\r\n\r\nexport const tv = (tuidValue:number|BoxId, ui?:TvTemplet, x?:any, nullUI?:()=>JSX.Element):JSX.Element => {\r\n    return <Tv tuidValue={tuidValue} ui={ui} x={x} nullUI={nullUI} />;\r\n};\r\n","import * as React from 'react';\r\n\r\nexport function Loading() {\r\n    return <div className=\"d-flex h-100 align-items-center justify-content-center\">\r\n        <i className=\"fa fa-spinner fa-spin fa-2x fa-fw text-info\" />\r\n    </div>;\r\n}\r\n","import { from62 } from './62';\r\nimport { LocalMap } from './localDb';\r\n\r\nexport const env = (function () {\r\n\tlet {unit, testing, params, lang, district, timeZone} = initEnv();\r\n    return {\r\n\t\tunit,\r\n\t\ttesting,\r\n\t\tparams,\r\n\t\tlang, \r\n\t\tdistrict,\r\n\t\ttimeZone,\r\n\t\tbrowser: detectBrowser(), \r\n        isDevelopment: process.env.NODE_ENV === 'development',\r\n        localDb: new LocalMap(testing===true? '$$':'$'),\r\n        setTimeout: (tag:string, callback: (...args: any[]) => void, ms: number, ...args: any[]):NodeJS.Timer => {\r\n            return global.setTimeout(callback, ms, ...args);\r\n        },\r\n        clearTimeout: (handle:NodeJS.Timer):void => {\r\n            global.clearTimeout(handle);\r\n        },\r\n        setInterval: (callback: (...args: any[]) => void, ms: number, ...args: any[]): NodeJS.Timer => {\r\n            return global.setInterval(callback, ms, ...args);\r\n        },\r\n        clearInterval: (handle:NodeJS.Timer):void => {\r\n            global.clearInterval(handle);\r\n        }\r\n    }\r\n}());\r\n\r\nfunction initEnv(): {\r\n\tunit: number; \r\n\ttesting: boolean; \r\n\tparams: {[key:string]: string}; \r\n\tlang: string; \r\n\tdistrict: string;\r\n\ttimeZone: number;}\r\n{\r\n\tlet pl     = /\\+/g,  // Regex for replacing addition symbol with a space\r\n        search = /([^&=]+)=?([^&]*)/g,\r\n        decode = function (s:any) { return decodeURIComponent(s.replace(pl, \" \")); },\r\n        query  = window.location.search.substring(1);\r\n    let params:{[key:string]:string} = {};\r\n    for (;;) {\r\n\t   let match = search.exec(query);\r\n\t   if (!match) break;\r\n       params[decode(match[1])] = decode(match[2]);\t\r\n\t}\r\n\r\n\tlet testing:boolean; // = isTesting();\r\n\tlet unit:number;\r\n\r\n\tlet sUnit = params['u'] || params['unit'];\r\n\tif (sUnit) {\r\n\t\tlet p = sUnit.indexOf('-');\t\t\r\n\t\tif (p>=0) {\r\n\t\t\tlet tc = sUnit.charCodeAt(p+1);\r\n\t\t\tconst tt = 'tT';\r\n\t\t\ttesting = tc === tt.charCodeAt(0) || tc === tt.charCodeAt(1);\r\n\t\t\tsUnit = sUnit.substr(0, p);\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttesting = false;\r\n\t\t}\r\n\t\tif (sUnit[0] === '0') {\r\n\t\t\tunit = Number(sUnit);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tunit = from62(sUnit);\r\n\t\t}\r\n\t\tif (isNaN(unit) === true) unit = undefined;\r\n\t}\r\n\telse {\r\n\t\t// 下面都是为了兼容以前的操作。\r\n\t\t// 整个url上，只要有test作为独立的字符串出现，就是testing\r\n\t\ttesting = /(\\btest\\b)/i.test(document.location.href);\r\n\t\tlet unitName:string;\r\n\t\tlet el = document.getElementById('unit');\r\n\t\tif (el) {\r\n\t\t\tunitName = el.innerText;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tel = document.getElementById('unit.json');\r\n\t\t\tif (el) {\r\n\t\t\t\tlet json = el.innerHTML;\r\n\t\t\t\tif (json) {\r\n\t\t\t\t\tlet res = JSON.parse(json);\r\n\t\t\t\t\tunitName = res?.unit;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!unitName) {\r\n\t\t\tunitName = process.env.REACT_APP_UNIT;\r\n\t\t}\r\n\r\n\t\tif (unitName) {\r\n\t\t\tunit = Number.parseInt(unitName);\r\n\t\t\tif (Number.isInteger(unit) === false) {\r\n\t\t\t\tif (unitName === '百灵威') {\r\n\t\t\t\t\tunit = 24;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!unit) unit = 0;\r\n\t}\r\n    let lang: string, district: string;\r\n    let language = (navigator.languages && navigator.languages[0])  // Chrome / Firefox\r\n        || navigator.language; // ||   // All browsers\r\n    //navigator.userLanguage; // IE <= 10\r\n    if (!language) {\r\n        lang = 'zh';\r\n        district = 'CN';\r\n    }\r\n    else {\r\n        let parts = language.split('-');\r\n        lang = parts[0];\r\n        if (parts.length > 1) district = parts[1].toUpperCase();\r\n    }\r\n\tlet timeZone = -new Date().getTimezoneOffset() / 60;\r\n\treturn {unit, testing, params, lang, district, timeZone};\r\n}\r\n\r\nfunction detectBrowser() { \r\n    if((navigator.userAgent.indexOf(\"Opera\") || navigator.userAgent.indexOf('OPR')) >= 0 )\r\n        return 'Opera';\r\n\tif(navigator.userAgent.indexOf(\"Chrome\") >= 0 )\r\n        return 'Chrome';\r\n\tif(navigator.userAgent.indexOf(\"Safari\") >= 0)\r\n        return 'Safari';\r\n\tif(navigator.userAgent.indexOf(\"Firefox\") >= 0 )\r\n        return 'Firefox';\r\n\tif((navigator.userAgent.indexOf(\"MSIE\") >= 0 ) || (!!(document as any).documentMode === true ))\r\n        return 'IE'; //crap\r\n    return 'Unknown';\r\n}\r\n","import { User } from '../tool';\r\n\r\nexport interface Login {\r\n\tshowLogin(callback?: (user:User)=>Promise<void>, withBack?:boolean):void;\r\n\tshowLogout(callback?: ()=>Promise<void>):void\r\n\t//showRegister():void\r\n\t//showForget():void\r\n\tshowChangePassword():void\r\n}\r\n\r\nexport async function createLogin():Promise<Login> {\r\n\tlet importCLogin = await import('../auth/CLogin');\r\n\treturn new importCLogin.CLogin();\r\n}\r\n\r\nexport async function showRegister():Promise<void> {\r\n\tlet importCRegister = await import('../auth/register/CRegister');\r\n\tlet c = new importCRegister.CRegister();\r\n\tc.start();\r\n}\r\n\r\nexport async function showForget():Promise<void> {\r\n\tlet importCRegister = await import('../auth/register/CRegister');\r\n\tlet c = new importCRegister.CForget();\r\n\tc.start();\r\n}\r\n","export * from './uqMan';\r\nexport * from './entity';\r\nexport * from './action';\r\nexport * from './query';\r\nexport * from './sheet';\r\nexport * from './tuid';\r\nexport * from './book';\r\nexport * from './map';\r\nexport * from './history';\r\nexport * from './pending';\r\nexport * from './uqsMan';\r\nexport * from './tag/tag';\r\nexport * from './enum';\r\nexport * from './build';\r\nexport * from './ID';\r\n","\r\nexport * from './boxId';\r\nexport * from './tuid';\r\nexport { TuidsCache } from './tuidsCache';\r\nexport { tv, ReactBoxId, uqStringify } from './reactBoxId';","import { TFunc } from \"../res\";\r\nimport { Entity } from \"./entity\";\r\nimport { Render, UI } from '../ui';\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nexport abstract class IDXEntity<M> extends Entity {\r\n\treadonly ui: UI;\r\n\treadonly render: Render<M>;\r\n\treadonly t: TFunc;\r\n}\r\n\r\nexport class UqID<M> extends IDXEntity<M> {\r\n\tget typeName() {return 'id'}\r\n\tasync NO(): Promise<string> {\r\n\t\tlet ret = await this.uqApi.post('id-no', {ID:this.name});\r\n\t\treturn ret;\r\n\t};\r\n}\r\n\r\nexport class ID extends UqID<any> {\t\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nexport class UqIDX<M> extends IDXEntity<M> {\r\n\tget typeName() {return 'idx'}\r\n}\r\n\r\nexport class IDX extends UqIDX<any> {\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nexport class UqIX<M> extends IDXEntity<M> {\r\n\tget typeName() {return 'ix'}\r\n}\r\n\r\nexport class IX extends UqIX<any> {\r\n}\r\n\r\n/* eslint-enable no-unused-vars */\r\n","import { VPage } from \"tonva-react\";\r\nimport { CID } from \"./CID\";\r\n\r\nexport class VEdit extends VPage<CID<any>> {\r\n\theader() {return  this.controller.editHeader}\r\n\tcontent() {\r\n\t\tlet {cFormView, item} = this.controller;\r\n\t\t//let {itemSchema, uiSchema} = midID;\r\n\t\treturn <div className=\"p-3\">\r\n\t\t\t{cFormView.renderForm(item)}\r\n\t\t</div>;\r\n\t\t/*\r\n\t\t\t<Form fieldLabelSize={2} formData={item}\r\n\t\t\tschema={itemSchema}\r\n\t\t\tuiSchema={uiSchema}\r\n\t\t\tonButtonClick={this.onSubmit} />\r\n\t\t*/\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport { FA, PropGrid, View, VPage } from \"tonva-react\";\r\nimport { CID } from \"./CID\";\r\n\r\nexport class VView extends VPage<CID<any>> {\r\n\theader() {return this.controller.midID.itemHeader}\r\n\tright() {\r\n\t\treturn this.controller.renderViewRight();\r\n\t\t/*\r\n\t\treturn <button\r\n\t\t\tclassName=\"btn btn-sm btn-primary mr-2\" \r\n\t\t\tonClick={() => this.controller.onItemEdit()}>\r\n\t\t\t<FA name=\"pencil-square-o\" />\r\n\t\t</button>;\r\n\t\t*/\r\n\t}\r\n\tcontent() {\r\n\t\tlet V = observer(() => {\r\n\t\t\tlet {item, midID} = this.controller;\r\n\t\t\tlet {props} = midID;\r\n\t\t\treturn <div className=\"py-3\">\r\n\t\t\t\t<PropGrid rows={props}\r\n\t\t\t\t\tvalues={item} />\r\n\t\t\t</div>;\t\r\n\t\t});\r\n\t\treturn <V />;\r\n\t}\r\n}\r\n\r\nexport class VViewRight extends View<CID<any>> {\r\n\trender() {\r\n\t\treturn <button\r\n\t\t\tclassName=\"btn btn-sm btn-primary mr-2\" \r\n\t\t\tonClick={() => this.controller.onItemEdit()}>\r\n\t\t\t<FA name=\"pencil-square-o\" />\r\n\t\t</button>;\r\n\t}\r\n}\r\n","import { zh } from \"./zh\";\r\nimport { en } from \"./en\";\r\n\r\nexport const res = {\r\n\t$zh: zh,\r\n\t$en: en,\r\n}\r\n","export const zh = {\r\n\tnew: '新建',\r\n\tedit: '修改',\r\n\tlist: '列表',\r\n}","export const en = {\r\n\tnew: 'New',\r\n\tedit: 'Edit',\r\n\tlist: 'List',\r\n}\r\n","import { makeObservable, observable, runInAction } from \"mobx\";\r\nimport { Context, Controller } from \"tonva-react\";\r\nimport { renderItem } from \"../tools\";\r\nimport { IDBase } from \"../base\";\r\nimport { CList } from '../list';\r\nimport { CFormView, FormUI } from \"../form\";\r\nimport { MidID } from \"./MidID\";\r\nimport { MidIDList } from \"./MidIDList\";\r\nimport { VEdit } from \"./VEdit\";\r\nimport { VView, VViewRight } from \"./VView\";\r\nimport { res } from \"./res\";\r\n\r\nexport class CID<T extends IDBase> extends Controller {\r\n\titem:T = null;\r\n\tmidID: MidID<T>;\r\n\tcFormView: CFormView<T>;\r\n\tprivate midIDList: MidIDList<T>;\r\n\tprivate valueChanged: boolean;\r\n\r\n\tconstructor(midID: MidID<T>) {\r\n\t\tsuper();\r\n\t\tmakeObservable(this, {\r\n\t\t\titem: observable,\r\n\t\t});\r\n\t\tthis.setRes(res);\r\n\t\tthis.setRes(midID.res);\r\n\t\tthis.midID = midID;\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tthis.valueChanged = false;\r\n\t\tawait this.midID.init();\r\n\t\tthis.createFormView();\r\n\t\tthis.midIDList =  this.midID.createMidIDList();\r\n\t\tthis.midIDList.onRightClick = this.onItemNew;\r\n\t\tthis.midIDList.renderItem = this.renderItem;\r\n\t\tthis.midIDList.onItemClick = this.onItemClick;\r\n\t\tthis.midIDList.renderRight = undefined;\r\n\t\tlet cList = this.createCList();\r\n\t\tawait cList.call();\r\n\t\tthis.returnCall(this.valueChanged);\r\n\t}\r\n\r\n\tprotected createFormView() {\r\n\t\tlet {ID, IDUI} = this.midID;\r\n\t\tlet {fieldCustoms} = IDUI;\r\n\t\tlet formUI = new FormUI(ID.ui, fieldCustoms, ID.t);\r\n\t\tthis.cFormView = new CFormView(formUI);\r\n\t\tthis.cFormView.onSubmit = this.onSubmit;\r\n\t} \r\n\r\n\tprotected createCList() {\r\n\t\treturn new CList(this.midIDList);\r\n\t}\r\n\r\n\tprivate onSubmit = async (name:string, context: Context) => {\r\n\t\tawait this.saveID(context.data);\r\n\t\tthis.closePage();\r\n\t}\r\n\r\n\trenderItem: (item:T, index:number) => JSX.Element = (item:T, index:number) => {\r\n\t\tlet {ID } = this.midID;\r\n\t\tif (ID) return ID.render(item);\r\n\t\treturn renderItem(item, index);\r\n\t}\r\n\tonItemClick: (item: T) => void = (item:any) => {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.item = item;\r\n\t\t\tthis.onItemView();\t\r\n\t\t});\r\n\t}\r\n\r\n\tonItemEdit = async (): Promise<void> => {\r\n\t\tthis.valueChanged = false;\r\n\t\tawait this.midID.init();\r\n\t\tthis.createFormView();\r\n\t\tthis.openVPage(VEdit);\r\n\t}\r\n\r\n\tonItemView():void {\r\n\t\tthis.openVPage(VView);\r\n\t}\r\n\r\n\tonItemNew = async (): Promise<void> => {\r\n\t\tawait this.cFormView.setNO(this.midID.ID);\r\n\t\trunInAction(() => {\r\n\t\t\tthis.item = undefined;\r\n\t\t\tthis.openVPage(VEdit);\r\n\t\t});\r\n\t}\r\n\r\n\tasync saveID(itemProps:any) {\r\n\t\tlet id = this.item?.id;\r\n\t\tlet item = {\r\n\t\t\t...itemProps,\r\n\t\t\tid,\r\n\t\t}\r\n\t\tlet ret = await this.midID.saveID(item);\r\n\t\tif (ret) id = ret;\r\n\t\tthis.midIDList?.update(id, item);\r\n\t\trunInAction(() => {\r\n\t\t\tif (this.item)\r\n\t\t\t\tObject.assign(this.item, item);\r\n\t\t\telse\r\n\t\t\t\tthis.item = item;\r\n\t\t});\r\n\t\tthis.valueChanged = true;\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tget itemHeader() {\r\n\t\treturn (this.midID.itemHeader as string ?? this.midID.ID.ui.label as string)\r\n\t}\r\n\r\n\tget editHeader() {\r\n\t\treturn this.t(this.item? 'edit' : 'new') + ' ' + this.itemHeader;\r\n\t}\r\n\r\n\trenderViewRight(item?: T) {\r\n\t\tif (item) this.item = item;\r\n\t\treturn this.renderView(VViewRight);\r\n\t}\r\n}\r\n","import { ID, IX, Uq } from \"tonva-react\";\r\nimport { IDBase, IXBase } from \"../base\";\r\nimport { MidIDListBase } from \"../list\";\r\n\r\nexport class MidIDList<T extends IDBase> extends MidIDListBase<T> {\r\n\treadonly ID:ID;\r\n\t\r\n\tconstructor(uq:Uq, ID:ID) {\r\n\t\tsuper(uq);\r\n\t\tthis.ID = ID;\r\n\t}\r\n\r\n\tasync init() {\r\n\t\t//await this.ID.loadSchema();\r\n\t}\r\n\r\n\tprotected async loadPageItems(pageStart:any, pageSize:number):Promise<T[]> {\r\n\t\tlet ret = await this.uq.ID<T>({\r\n\t\t\tIDX: this.ID,\r\n\t\t\tid: undefined,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tupdate(id:number, item:any) {\r\n\t\titem.id = id;\r\n\t\tthis.listPageItems.update(item);\r\n\t}\r\n}\r\n\r\nexport class MidIXIDList<T extends IXBase> extends MidIDList<T> {\r\n\treadonly IX:IX;\r\n\tconstructor(uq:Uq, ID:ID, IX:IX) {\r\n\t\tsuper(uq, ID);\r\n\t\tthis.IX = IX;\r\n\t}\r\n\r\n\tprotected async loadPageItems(pageStart:any, pageSize:number):Promise<T[]> {\r\n\t\tlet ret = await this.uq.IX<T>({\r\n\t\t\tIX: this.IX,\r\n\t\t\tIDX: [this.ID],\r\n\t\t\tix: undefined,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\t/*\r\n\t\tfor (let item of ret) {\r\n\t\t\titem.id = item.id;\r\n\t\t\tdelete item.id;\r\n\t\t}\r\n\t\t*/\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import { ID, Schema, UiSchema, Uq, Prop, UiButton, UiItemCollection, IDUI, IX, ParamActIX } from \"tonva-react\";\r\nimport { IDBase, Mid } from \"../base\";\r\nimport { MidIDList, MidIXIDList } from \"./MidIDList\";\r\n\r\nexport class MidID<T extends IDBase> extends Mid {\r\n\treadonly IDUI: IDUI;\r\n\treadonly ID: ID;\r\n\r\n\tconstructor(uq: Uq, IDUI: IDUI) {\r\n\t\tsuper(uq);\r\n\t\tthis.IDUI = IDUI;\r\n\t\tthis.ID = IDUI.ID;\r\n\t}\r\n\r\n\tlistHeader: string|JSX.Element;\r\n\titemHeader: string|JSX.Element;\r\n\r\n\tasync init():Promise<void> {\r\n\t\tawait this.loadSchema();\r\n\t\tthis._itemSchema = await this.buildItemSchema(this.IDUI);\r\n\t\tthis._uiSchema = this.buildUISchema(this.IDUI);\r\n\t}\r\n\r\n\tcreateMidIDList():MidIDList<T> {\r\n\t\tlet ret = new MidIDList<T>(this.uq, this.ID);\r\n\t\tret.header = this.listHeader;\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected buildUISchema(IDUI:IDUI):UiSchema {\r\n\t\tlet {ID} = IDUI;\r\n\t\tlet items:UiItemCollection = {};\r\n\t\tthis._uiSchema = {items};\r\n\t\tlet {fields} = ID.ui;\r\n\t\tif (fields) {\r\n\t\t\tfor (let f of this._itemSchema) {\r\n\t\t\t\tlet {name} = f;\r\n\t\t\t\tObject.assign(f, (fields as any)[name]);\r\n\t\t\t\t(items as any)[name] = f;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet uiButton: UiButton = {\r\n\t\t\tlabel: '提交',\r\n\t\t\tclassName: 'btn btn-primary',\r\n\t\t\twidget: 'button',\r\n\t\t};\r\n\t\titems['submit'] = uiButton;\r\n\t\treturn this._uiSchema;\r\n\t}\r\n\tprotected async loadSchema() {\r\n\t\tawait this.ID.loadSchema();\r\n\t}\r\n\r\n\tasync load(id:number): Promise<T[]> {\r\n\t\tlet ret = await this.uq.ID<T>({\r\n\t\t\tIDX: this.ID,\r\n\t\t\tid,\r\n\t\t\tpage: undefined,\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tasync saveID(data:any):Promise<number> {\r\n\t\tlet param: any = {};\r\n\t\tparam[this.ID.name] = [data];\r\n\t\tlet ret = await this.uq.Acts(param);\r\n\t\tlet id = ret[this.ID.name];\r\n\t\tif (!id) return;\r\n\t\treturn id[0];\r\n\t}\r\n\r\n\tprivate _itemSchema: Schema;\r\n\tget itemSchema(): Schema {\r\n\t\t//if (this._itemSchema !== undefined) \r\n\t\treturn this._itemSchema;\r\n\t\t//return this._itemSchema = this.buildItemSchema(this.ID);\r\n\t}\r\n\r\n\tprivate _uiSchema: UiSchema;\r\n\tget uiSchema(): UiSchema {\r\n\t\t//if (this._uiSchema !== undefined) \r\n\t\treturn this._uiSchema;\r\n\t\t//return this._uiSchema = this.buildUISchema(this.ID);\r\n\t}\r\n\r\n\tprivate _props: Prop[];\r\n\tget props():Prop[] {\r\n\t\tif (this._props !== undefined) return this._props;\r\n\t\treturn this._props = this.buildGridProps(this.IDUI.ID);\r\n\t}\r\n\r\n\t/*\r\n\tprotected async setDefaultNo() {\r\n\t\tfor (let fieldItem of this._itemSchema) {\r\n\t\t\tif (fieldItem.name === 'no') {\r\n\t\t\t\tlet no = await this.ID.NO();\r\n\t\t\t\tthis.setNO(no, fieldItem);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t*/\r\n}\r\n\r\nexport class MidIXID<T extends IDBase> extends MidID<T> {\r\n\treadonly IX: IX;\r\n\tconstructor(uq: Uq, IDUI: IDUI, IX: IX) {\r\n\t\tsuper(uq, IDUI);\r\n\t\tthis.IX = IX;\r\n\t}\r\n\r\n\tcreateMidIDList():MidIDList<T> {\r\n\t\tlet ret = new MidIXIDList<any>(this.uq, this.ID, this.IX);\r\n\t\tret.header = this.listHeader;\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync saveID(data:any):Promise<number> {\r\n\t\tlet param: ParamActIX<T> = {\r\n\t\t\tID: this.ID,\r\n\t\t\tIX: this.IX,\r\n\t\t\tvalues: [\r\n\t\t\t\t{ix:undefined, id:data}\r\n\t\t\t],\r\n\t\t};\r\n\t\tlet ret = await this.uq.ActIX(param);\r\n\t\tlet id = ret[0];\r\n\t\tif (!id) return;\r\n\t\treturn id;\r\n\t}\r\n}\r\n","export class SlrForEarning {\r\n  slope: number;\r\n  intercept: number;\r\n  y: number[];\r\n  slopeR: number;\r\n  endY: number;\r\n  r2: number;\r\n\r\n  constructor(y:number[]) {\r\n    this.y = y;\r\n    this.regress();\r\n    let score = this.score();\r\n    this.r2 = score.r2;\r\n  }\r\n\r\n  regress() {\r\n    const n = this.y.length;\r\n    let xSum = 0;\r\n    let ySum = 0;\r\n  \r\n    let xSquared = 0;\r\n    let xY = 0;\r\n  \r\n    for (let x = 0; x < n; ++x) {\r\n      xSum += x;\r\n      ySum += this.y[x];\r\n      xSquared += x * x;\r\n      xY += x * this.y[x];\r\n    }\r\n  \r\n    const numerator = n * xY - xSum * ySum;\r\n    this.slope = numerator / (n * xSquared - xSum * xSum);\r\n    this.intercept = (1 / n) * ySum - this.slope * (1 / n) * xSum;\r\n\r\n    let ym = this.slope > 0 ? this.predict(n-2) : this.predict(1);\r\n    this.slopeR = ym < 0.01 ? undefined : this.slope / ym;\r\n  }\r\n\r\n  score() {\r\n    const n = this.y.length;\r\n    const y2 = new Array(n);\r\n    for (let i = 0; i < n; i++) {\r\n      y2[i] = this.predict(i);\r\n    }\r\n\r\n    let xSum = 0;\r\n    let ySum = 0;\r\n    let chi2 = 0;\r\n    let rmsd = 0;\r\n    let xSquared = 0;\r\n    let ySquared = 0;\r\n    let xY = 0;\r\n    for (let i = 0; i < n; i++) {\r\n      let yi2 = y2[i];\r\n      xSum += yi2;\r\n      let yi = this.y[i];\r\n      ySum += yi;\r\n      xSquared += yi2 * yi2;\r\n      ySquared += yi * yi;\r\n      xY += yi2 * yi;\r\n      let yiyi2 = yi - yi2;\r\n      if (yi !== 0) {\r\n        chi2 += (yiyi2 * yiyi2) / yi;\r\n      }\r\n      rmsd += yiyi2 * yiyi2;\r\n    }\r\n\r\n    const r =\r\n      (n * xY - xSum * ySum) /\r\n      Math.sqrt((n * xSquared - xSum * xSum) * (n * ySquared - ySum * ySum));\r\n\r\n    return {\r\n      r: r,\r\n      r2: r * r,\r\n      chi2: chi2,\r\n      rmsd: Math.sqrt(rmsd / n)\r\n    };\r\n  }\r\n\r\n\r\n  predict(x:number) {\r\n    return this.slope * x + this.intercept;\r\n  }\r\n\r\n  computeX(y:number) {\r\n    return (y - this.intercept) / this.slope;\r\n  }\r\n}\r\n","import {HttpChannel} from './httpChannel';\r\nimport { Caller } from './caller';\r\n\r\nexport async function refetchApi(channel:HttpChannel, url:string, options:any, \r\n    resolve:(values:any)=>any, reject:(reason:any)=>void)\r\n{\r\n    await channel.fetch(url, options, false, resolve, reject);\r\n}\r\n\r\nexport abstract class ApiBase {\r\n    protected token: string;\r\n    protected path: string;\r\n    protected showWaiting: boolean;\r\n\r\n    constructor(path: string, showWaiting: boolean) {\r\n        this.path = path || '';\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    protected abstract getHttpChannel(): Promise<HttpChannel>;\r\n\r\n    async xcall(caller:Caller<any>):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.xcall(this.path, caller);\r\n    }\r\n\r\n    public async call(url:string, method:string, body:any):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.callFetch(url, method, body);\r\n    }\r\n\r\n    public async get(path:string, params:any=undefined): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.get(this.path + path, params);\r\n    }\r\n\r\n    public async post(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.post(this.path + path, params);\r\n    }\r\n\r\n    public async put(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.put(this.path + path, params);\r\n    }\r\n\r\n    public async delete(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.delete(this.path + path, params);\r\n    }\r\n}\r\n","import { LocalMap, LocalCache, env } from '../tool';\r\nimport { UqData, UqAppData, CenterAppApi } from '../net';\r\nimport { UqMan } from './uqMan';\r\nimport { TuidImport, TuidInner } from './tuid';\r\nimport { nav } from '../components';\r\nimport { AppConfig, UqConfig } from '../app';\r\n\r\nexport interface TVs {\r\n    [uqName:string]: {\r\n        [tuidName: string]: (values: any) => JSX.Element;\r\n    }\r\n}\r\n\r\nexport class UQsMan {\r\n\tstatic _uqs: any;\r\n\tstatic value: UQsMan;\r\n\t//static uqOwnerMap: {[key:string]:string};\r\n\r\n\tstatic async build(appConfig: AppConfig) {\r\n\t\tlet {app, uqs, tvs} = appConfig;\r\n\t\tlet retErrors:string[];\r\n\t\tif (app) {\r\n\t\tlet {name, version/*, ownerMap*/} = app;\r\n\t\t\tretErrors = await UQsMan.load(name, version, tvs);\r\n\t\t}\r\n\t\telse if (uqs) {\r\n\t\t\tretErrors = await UQsMan.loadUqs(uqs, tvs);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Error('either uqs or app must be defined in AppConfig');\r\n\t\t}\r\n\t\treturn retErrors;\r\n\t}\r\n\r\n\t// 返回 errors, 每个uq一行\r\n\tprivate static async load(tonvaAppName:string, version:string, tvs:TVs):Promise<string[]> {\r\n\t\tlet uqsMan = UQsMan.value = new UQsManApp(tonvaAppName, tvs);\r\n        let {appOwner, appName} = uqsMan;\r\n        let {localData} = uqsMan;\r\n        let uqAppData:UqAppData = localData.get();\r\n        if (!uqAppData || uqAppData.version !== version) {\r\n\t\t\tuqAppData = await loadAppUqs(appOwner, appName);\r\n\t\t\tif (!uqAppData.id) {\r\n\t\t\t\treturn [\r\n\t\t\t\t\t`${appOwner}/${appName}不存在。请仔细检查app全名。`\r\n\t\t\t\t];\r\n\t\t\t}\r\n            uqAppData.version = version;\r\n            localData.set(uqAppData);\r\n            // \r\n            for (let uq of uqAppData.uqs) uq.newVersion = true;\r\n        }\r\n        let {id, uqs} = uqAppData;\r\n\t\tuqsMan.id = id;\r\n\t\t//console.error(uqAppData);\r\n\t\t//let ownerProfixMap: {[owner: string]: string};\r\n\t\treturn uqsMan.buildUqs(uqs);\r\n\t}\r\n\r\n\t// 返回 errors, 每个uq一行\r\n\tprivate static async loadUqs(uqConfigs: UqConfig[], tvs:TVs):Promise<string[]> {\r\n\t\tlet uqsMan = UQsMan.value = new UQsMan(tvs);\r\n\t\tlet uqs = await loadUqs(uqConfigs);\r\n\t\treturn uqsMan.buildUqs(uqs, uqConfigs);\r\n\t}\r\n\r\n\tprivate uqMans: UqMan[] = [];\r\n    private collection: {[uqLower: string]: UqMan};\r\n    private readonly tvs: TVs;\r\n\r\n    protected constructor(tvs:TVs) {\r\n        this.tvs = tvs || {};\r\n\t\tthis.buildTVs();\r\n\t\tthis.uqMans = [];\r\n        this.collection = {};\r\n    }\r\n\r\n\tprivate async buildUqs(uqDataArr:UqData[], uqConfigs?:UqConfig[]):Promise<string[]> {\r\n        await this.init(uqDataArr);\r\n        let retErrors = await this.load();\r\n\t\tif (retErrors.length > 0) return retErrors;\r\n\t\tretErrors.push(...this.setTuidImportsLocal());\r\n\t\tif (retErrors.length > 0) return retErrors;\r\n\t\tif (uqConfigs) {\r\n\t\t\tfor (let uqConfig of uqConfigs) {\r\n\t\t\t\tlet {dev, name} = uqConfig;\r\n\t\t\t\tlet {name:owner} = dev;\r\n\t\t\t\tlet uqLower = owner.toLowerCase() + '/' + name.toLowerCase();\r\n\t\t\t\tlet uq = this.collection[uqLower];\r\n\t\t\t\tuq.config = uqConfig;\r\n\t\t\t}\r\n\t\t}\r\n\t\tUQsMan._uqs = this.buildUQs();\r\n\t}\r\n\r\n\tstatic uq(uqName: string): UqMan {\r\n\t\treturn UQsMan.value.collection[uqName.toLowerCase()];\r\n\t}\r\n\t\r\n\tstatic async getUqUserRoles(uqLower:string):Promise<string[]> {\r\n\t\tlet uqMan = UQsMan.value.collection[uqLower];\r\n\t\tif (uqMan === undefined) return null;\r\n\t\tlet roles = await uqMan.getRoles();\r\n\t\treturn roles;\r\n\t}\r\n\r\n    private buildTVs() {\r\n\t\tif (!this.tvs) return;\r\n        for (let i in this.tvs) {\r\n            let uqTVs = this.tvs[i];\r\n            if (uqTVs === undefined) continue;\r\n            let l = i.toLowerCase();\r\n            if (l === i) continue;\r\n            this.tvs[l] = uqTVs;\r\n            for (let j in uqTVs) {\r\n                let en = uqTVs[j];\r\n                if (en === undefined) continue;\r\n                let lj = j.toLowerCase();\r\n                if (lj === j) continue;\r\n                uqTVs[lj] = en;\r\n            }\r\n        }\r\n    }\r\n\r\n    async init(uqsData:UqData[]):Promise<void> {\r\n        let promiseInits: PromiseLike<void>[] = uqsData.map(uqData => {\r\n\t\t\tlet {uqOwner, uqName} = uqData;\r\n\t\t\tlet uqFullName = uqOwner + '/' + uqName;\r\n\t\t\t//let uqUI = this.ui.uqs[uqFullName] as UqUI || {};\r\n\t\t\t//let cUq = this.newCUq(uqData, uqUI);\r\n\t\t\t//this.cUqCollection[uqFullName] = cUq;\r\n\t\t\t//this.uqs.addUq(cUq.uq);\r\n\t\t\tlet uq = new UqMan(this, uqData, undefined, this.tvs[uqFullName] || this.tvs[uqName]);\r\n\t\t\tthis.uqMans.push(uq);\r\n\t\t\t//uq.ownerProfix = UQsMan.uqOwnerMap[uqOwner.toLowerCase()];\r\n\t\t\t//this.collection[uqFullName] = uq;\r\n\t\t\tlet lower = uqFullName.toLowerCase();\r\n\t\t\tthis.collection[lower] = uq;\r\n\t\t\t/*\r\n\t\t\tif (lower !== uqFullName) {\r\n\t\t\t\tthis.collection[lower] = uq;\r\n\t\t\t}\r\n\t\t\t*/\r\n\t\t\treturn uq.init();\r\n\t\t});\r\n        await Promise.all(promiseInits);\r\n    }\r\n\r\n    async load(): Promise<string[]> {\r\n        let retErrors:string[] = [];\r\n\t\tlet promises: PromiseLike<string>[] = [];\r\n\t\t//let lowerUqNames:string[] = [];\r\n\t\t// collection有小写名字，还有正常名字\r\n        //for (let i in this.collection) {\r\n\t\tfor (let uqMan of this.uqMans) {\r\n\t\t\t//let lower = (i as string).toLowerCase();\r\n\t\t\t//if (lowerUqNames.indexOf(lower) >= 0) continue;\r\n\t\t\t//lowerUqNames.push(lower);\r\n            //let uq = this.collection[i];\r\n            promises.push(uqMan.loadEntities());\r\n\t\t}\r\n\t\tlet results = await Promise.all(promises);\r\n        for (let result of results)\r\n        {\r\n            let retError = result; // await cUq.loadSchema();\r\n            if (retError !== undefined) {\r\n                retErrors.push(retError);\r\n            }\r\n\t\t}\r\n        return retErrors;\r\n    }\r\n\r\n    buildUQs(): any {\r\n        //let that = this;\r\n        let uqs:any = {};\r\n        for (let uqMan of this.uqMans) {\r\n            let uqKey = uqMan.getUqKey();\r\n\t\t\tlet lower = uqKey.toLowerCase();\r\n\t\t\tlet proxy = uqMan.createProxy();\r\n\t\t\tuqs[uqKey] = proxy;\r\n\t\t\tif (lower !== uqKey) uqs[lower] = proxy;\r\n        }\r\n        return new Proxy(uqs, {\r\n            get: (target, key, receiver) => {\r\n                let lk = (key as string).toLowerCase();\r\n                let ret = target[lk];\r\n                if (ret !== undefined) return ret;\r\n                /*\r\n                for (let i in uqs) {\r\n                    if (i.toLowerCase() === lk) {\r\n                        return uqs[i];\r\n                    }\r\n                }*/\r\n                debugger;\r\n                console.error('error in uqs');\r\n                this.showReload(`代码错误：新增 uq ${String(key)}`);\r\n                return undefined;\r\n            },\r\n        });\r\n\t}\r\n\t\r\n\tgetUqMans() {\r\n\t\treturn this.uqMans;\r\n\t}\r\n\r\n    private showReload(msg: string) {\r\n\t\tfor (let uqMan of this.uqMans) {\r\n\t\t\tuqMan.localMap.removeAll();\r\n\t\t}\r\n        nav.showReloadPage(msg);\r\n    }\r\n\r\n    setTuidImportsLocal():string[] {\r\n        let ret:string[] = [];\r\n        for (let uqMan of this.uqMans) {\r\n            for (let tuid of uqMan.tuidArr) {\r\n                if (tuid.isImport === true) {\r\n                    let error = this.setInner(tuid as TuidImport);\r\n                    if (error) ret.push(error);\r\n                }\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    private setInner(tuidImport: TuidImport):string {\r\n        let {from} = tuidImport;\r\n        let fromName = from.owner + '/' + from.uq;\r\n        let uq = this.collection[fromName];\r\n        if (uq === undefined) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} is not loaded`;\r\n        }\r\n        let iName = tuidImport.name\r\n        let tuid = uq.tuid(iName);\r\n        if (tuid === undefined) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} has no Tuid ${iName}`;\r\n        }\r\n        if (tuid.isImport === true) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} Tuid ${iName} is import`;\r\n        }\r\n        tuidImport.setFrom(tuid as TuidInner);\r\n    }\r\n}\r\n\r\nclass UQsManApp extends UQsMan {\r\n    readonly appOwner: string;\r\n    readonly appName: string;\r\n    readonly localMap: LocalMap;\r\n    readonly localData: LocalCache;\r\n    id: number;\r\n\r\n\tconstructor(tonvaAppName:string, tvs:TVs) {\r\n\t\tsuper(tvs);\r\n        let parts = tonvaAppName.split('/');\r\n        if (parts.length !== 2) {\r\n            throw new Error('tonvaApp name must be / separated, owner/app');\r\n        }\r\n        this.appOwner = parts[0];\r\n        this.appName = parts[1];\r\n        this.localMap = env.localDb.map(tonvaAppName);\r\n        this.localData = this.localMap.child('uqData');\r\n\t}\r\n}\r\n\r\nasync function loadAppUqs(appOwner:string, appName:string): Promise<UqAppData> {\r\n    let centerAppApi = new CenterAppApi('tv/', undefined);\r\n    let ret = await centerAppApi.appUqs(appOwner, appName);\r\n    return ret;\r\n}\r\n\r\nasync function loadUqs(uqConfigs: UqConfig[]): Promise<UqData[]> {\r\n\tlet uqs: {owner:string; name:string; version:string}[] = uqConfigs.map(\r\n\t\tv => {\r\n\t\t\tlet {dev, name, version} =v;\r\n\t\t\tlet {name:owner} = dev;\r\n\t\t\treturn {owner, name, version};\r\n\t\t}\r\n\t);\r\n    let centerAppApi = new CenterAppApi('tv/', undefined);\r\n    let ret = await centerAppApi.uqs(uqs);\r\n    return ret;\r\n}\r\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { runInAction } from \"mobx\";\r\nimport { ID, IX, Uq } from \"tonva-react\";\r\nimport { CList, MidIDListBase } from \"../list\";\r\nimport { IXBase } from \"../base\";\r\n\r\nexport class CIXList<T2 extends IXBase> extends CList<T2> {\r\n\tprotected midIXList: MidIXList<T2>;\r\n\tconstructor(midIXList: MidIXList<T2>) {\r\n\t\tsuper(midIXList);\r\n\t\tthis.setRes(midIXList.res);\r\n\t\tthis.midIXList = midIXList;\r\n\t}\r\n\r\n\tupdate(item:any) {\r\n\t\tthis.midIXList.update(item);\r\n\t}\r\n}\r\n\r\nexport class MidIXList<T extends IXBase> extends MidIDListBase<T> {\r\n\treadonly IX:IX;\r\n\treadonly ID:ID;\r\n\treadonly id: number;\r\n\tconstructor(uq:Uq, IX:IX, ID:ID, id:number) {\r\n\t\tsuper(uq, undefined);\r\n\t\tthis.IX = IX;\r\n\t\tthis.ID = ID;\r\n\t\tthis.id = id;\r\n\t}\r\n\r\n\tasync init() {\r\n\t\tawait this.IX.loadSchema();\r\n\t}\r\n\r\n\t//key:((item:T) => number|string) = item => item.id 2;\r\n\r\n\tprotected async loadPageItems(pageStart:any, pageSize:number):Promise<T[]> {\r\n\t\tlet ret = await this.uq.IX<T>({\r\n\t\t\tIX: this.IX,\r\n\t\t\tIDX: this.ID? [this.ID] : undefined,\r\n\t\t\tix: this.id,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tupdate(item:T) {\r\n\t\trunInAction(() => {\r\n\t\t\tlet {_items} = this.listPageItems;\r\n\t\t\tif (!_items) return;\r\n\t\t\tlet {ix, id} = item;\r\n\t\t\tif (id < 0) {\r\n\t\t\t\tlet index = _items.findIndex(v => v.id === -id && v.id === id);\r\n\t\t\t\tif (index >= 0) _items.splice(index, 1);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet ret = _items.find(v => v.id === id && v.id === id);\r\n\t\t\t\tif (!ret) {\r\n\t\t\t\t\t_items.unshift({ix, id} as T);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n","import { Controller, ID, IX, Uq } from \"tonva-react\";\r\nimport { Mid } from \"../base\";\r\nimport { CIXList, MidIXList } from \"./CIXList\";\r\n\r\nexport class MidIX extends Mid {\r\n\treadonly IX: IX;\r\n\treadonly ID: ID;\r\n\treadonly id: number;\r\n\tconstructor(uq:Uq, IX:IX, ID:ID, id:number, res?:any) {\r\n\t\tsuper(uq, res);\r\n\t\tthis.IX = IX;\r\n\t\tthis.ID = ID;\r\n\t\tthis.id = id;\r\n\t}\r\n\r\n\tasync init(): Promise<void> {\r\n\t}\r\n}\r\n\r\nexport class CIX<P extends MidIX> extends Controller {\r\n\tprotected readonly midIX: P;\r\n\r\n\tconstructor(midIX: P) {\r\n\t\tsuper();\r\n\t\tthis.setRes(midIX.res);\r\n\t\tthis.midIX = midIX;\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tlet {uq, IX, ID, id} = this.midIX;\r\n\t\tlet midIXList = new MidIXList(uq, IX, ID, id);\r\n\t\tmidIXList.onRightClick = this.onItemEdit;\r\n\t\tmidIXList.renderItem = undefined;\r\n\t\tmidIXList.onItemClick = this.onItemClick;\r\n\t\tmidIXList.renderRight = undefined;\r\n\t\tlet idList = new CIXList(midIXList);\r\n\t\tawait idList.start();\r\n\t}\r\n\r\n\tprivate onItemEdit = () => {\r\n\r\n\t}\r\n\r\n\tprivate onItemClick = (item:any) => {\r\n\t\t\r\n\t}\r\n}\r\n","import { ID } from \"tonva-react\";\r\nimport { CIX, MidIX } from \"./CIX\";\r\nimport { CIXList, MidIXList} from \"./CIXList\";\r\nimport { CIXSelect, MidIXSelectList } from \"../select\";\r\n\r\nexport interface IXEditProps extends MidIX {\r\n\tID: ID;\r\n}\r\n\r\nexport class CIXEdit extends CIX<IXEditProps> {\r\n\tprivate cIXList: CIXList<any>;\r\n\tprotected async internalStart() {\r\n\t\tlet {uq, IX, ID, id} = this.midIX;\r\n\t\tlet midIXList = new MidIXList(uq, IX, ID, id);\r\n\t\tmidIXList.onRightClick = this.onListRightClick;\r\n\t\tmidIXList.renderItem = undefined;\r\n\t\tmidIXList.onItemClick = undefined;\r\n\t\tmidIXList.renderRight = undefined;\r\n\t\tthis.cIXList = new CIXList(midIXList);\r\n\t\tawait this.cIXList.start();\r\n\t}\r\n\r\n\tprivate onListRightClick = async () => {\r\n\t\tlet {uq, ID, IX, id} = this.midIX;\r\n\t\tlet midIXList = new MidIXSelectList(uq, ID, IX, id);\r\n\t\tmidIXList.renderItem = undefined;\r\n\t\tmidIXList.onSelectChange = this.onSelectChange;\r\n\t\tlet cSelect = new CIXSelect(midIXList);\r\n\t\tawait cSelect.start();\r\n\t}\r\n\r\n\tprivate onSelectChange = async (item:any, isSelected:boolean) => {\r\n\t\tlet param:any = {};\r\n\t\tlet {IX, id} = this.midIX;\r\n\t\tif (isSelected === false) {\r\n\t\t\t// id negtive means delete\r\n\t\t\tid = -id;\r\n\t\t}\r\n\t\tlet idItem = {ix:id, id: item.id};\r\n\t\tparam[IX.name] = [idItem];\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\tlet ret = await this.midIX.uq.Acts(param);\r\n\t\tthis.cIXList.update(idItem);\r\n\t} \r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { ItemSchema, UiImageItem, UiItem } from '../schema';\r\nimport { ImageUploader } from '../resUploader';\r\nimport { nav } from '../nav';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { Edit } from './edit';\r\n\r\nexport class ImageItemEdit extends ItemEdit {\r\n    get uiItem(): UiImageItem {return this._uiItem as UiImageItem}\r\n\tresId: string = null;\r\n\t\r\n\tconstructor(edit:Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string|JSX.Element, value: any) {\r\n\t\tsuper(edit, itemSchema, uiItem, label, value);\r\n\t\tmakeObservable(this, {\r\n\t\t\tresId: observable\r\n\t\t})\r\n\t}\r\n\r\n    protected async internalStart():Promise<any> {\r\n        this.resId = this.value;\r\n        return new Promise<any>((resolve, reject) => {\r\n            nav.push(React.createElement(this.page, {resolve:resolve, reject:reject}), ()=>reject());\r\n        });\r\n    }\r\n\r\n    /*\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        let ret = await this.resUploader.upload();\r\n        if (ret === null) {\r\n            this.overSize = true;\r\n            env.setTimeout('imageItemEdit upload', () => this.overSize = false, 3000);\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.value);\r\n    }\r\n    */\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let size:any = this.uiItem && this.uiItem.size;\r\n\r\n        /*\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>resolve(this.resId)}>保存</button>;\r\n        let overSize:any;\r\n        if (this.overSize === true) {\r\n            overSize = <div className=\"text-danger\">\r\n                <i className=\"fa fa-times-circle\" /> 图片文件大小超过2M，无法上传\r\n            </div>;\r\n        }\r\n        */\r\n        return <ImageUploader \r\n            label={'更改' + this.label}\r\n            id={this.resId}\r\n            size={size}\r\n            onSaved={(resId):Promise<void>=>{resolve(resId); return;}} />;\r\n        /*\r\n        return <Page header={'更改' + this.label} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div>上传图片：</div>\r\n                    <div className=\"my-3\">\r\n                        <ResUploader ref={v=>this.resUploader=v} multiple={false} maxSize={2048} />\r\n                    </div>\r\n                    <div>\r\n                        <button className=\"btn btn-primary\" onClick={this.upload}>上传</button>\r\n                    </div>\r\n                </div>\r\n                {overSize}\r\n                <div className=\"small muted my-4\">支持JPG、GIF、PNG格式图片，不超过2M。</div>\r\n                <div className=\"d-flex\">\r\n                    <div className=\"w-12c h-12c mr-4\"\r\n                        style={{border: '1px dotted gray', padding: '8px'}}>\r\n                        <Image className=\"w-100 h-100\" src={this.resId} />\r\n                    </div>\r\n                    <div>\r\n                        <div className=\"small\">图片预览</div>\r\n                        <Image className=\"w-4c h-4c mt-3\" src={this.resId} />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n        */\r\n    })\r\n}\r\n","export class ErForEarning {\r\n  A:number;\r\n  B:number;\r\n  y: number[];\r\n  r2: number;\r\n\r\n  constructor(y:number[]) {\r\n    this.y = y;\r\n    this.regress();\r\n    let score = this.score();\r\n    this.r2 = score.r2;\r\n  }\r\n\r\n  regress() {\r\n    const n = this.y.length;\r\n    let xSum = 0;\r\n    let ySum = 0;\r\n  \r\n    let xSquared = 0;\r\n    let xY = 0;\r\n  \r\n    for (let x = 0; x < n; ++x) {\r\n      xSum += x;\r\n      let yx = Math.log(this.y[x]);\r\n      ySum += yx;\r\n      xSquared += x * x;\r\n      xY += x * yx;\r\n    }\r\n  \r\n    const numerator = n * xY - xSum * ySum;\r\n    let slope = numerator / (n * xSquared - xSum * xSum);\r\n    let intercept = (1 / n) * ySum - slope * (1 / n) * xSum;\r\n    this.A = Math.exp(intercept);\r\n    this.B = slope;\r\n  }\r\n\r\n  score() {\r\n    const n = this.y.length;\r\n    const y2 = new Array(n);\r\n    for (let i = 0; i < n; i++) {\r\n      y2[i] = this.predict(i);\r\n    }\r\n\r\n    let xSum = 0;\r\n    let ySum = 0;\r\n    let chi2 = 0;\r\n    let rmsd = 0;\r\n    let xSquared = 0;\r\n    let ySquared = 0;\r\n    let xY = 0;\r\n    for (let i = 0; i < n; i++) {\r\n      let yi2 = y2[i];\r\n      xSum += yi2;\r\n      let yi = this.y[i];\r\n      ySum += yi;\r\n      xSquared += yi2 * yi2;\r\n      ySquared += yi * yi;\r\n      xY += yi2 * yi;\r\n      let yiyi2 = yi - yi2;\r\n      if (yi !== 0) {\r\n        chi2 += (yiyi2 * yiyi2) / yi;\r\n      }\r\n      rmsd += yiyi2 * yiyi2;\r\n    }\r\n\r\n    const r =\r\n      (n * xY - xSum * ySum) /\r\n      Math.sqrt((n * xSquared - xSum * xSum) * (n * ySquared - ySum * ySum));\r\n\r\n    return {\r\n      r: r,\r\n      r2: r * r,\r\n      chi2: chi2,\r\n      rmsd: Math.sqrt(rmsd / n)\r\n    };\r\n  }\r\n\r\n  predict(x:number) {\r\n    return this.A * Math.exp(x * this.B);\r\n  }\r\n}\r\n","\r\nexport const mobileRegex = /^[0-9]*$/;\r\nexport const emailRegex = /\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*/;\r\n// /^([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+\\.[a-zA-Z]{2,3}$/\r\n\r\nexport const EmailFieldRule = (value:any): string|string[] => {\r\n    if (emailRegex.test(value as string) === false) return '电子邮件格式错误';\r\n}\r\n\r\nexport const MobileFieldRule = (value:any): string|string[] => {\r\n    if (emailRegex.test(value as string) === false) return '手机格式错误';\r\n}\r\n","import _ from 'lodash';\r\nimport {observable, IObservableArray, computed, makeObservable, runInAction} from 'mobx';\r\n\r\nexport abstract class PageItems<T> {\r\n    loading: boolean = false;\r\n    beforeLoad: boolean = true;\r\n    loaded: boolean = false;\r\n    _items:IObservableArray<T> = null;\r\n    allLoaded: boolean = false;\r\n    get items():IObservableArray<T> {\r\n        if (this.beforeLoad === true) return null;\r\n        if (this.loaded === false) return undefined;\r\n        return this._items;\r\n\t}\r\n    topDiv:string = '$$top';\r\n\tbottomDiv:string = '$$bottom';\r\n\r\n    constructor(itemObservable:boolean = false) {\r\n\t\tmakeObservable(this, {\r\n\t\t\tloading: observable,\r\n\t\t\tbeforeLoad: observable,\r\n\t\t\tloaded: observable,\r\n\t\t\t_items: observable,\r\n\t\t\tallLoaded: observable,\r\n\t\t\titems: computed,\r\n\t\t\ttopDiv: observable,\r\n\t\t\tbottomDiv: observable,\r\n\t\t});\r\n\t\tif (itemObservable === undefined) itemObservable = false;\r\n        this._items = observable.array<T>([], {deep:itemObservable});\r\n    }\r\n\tprivate isFirst: boolean = true;\r\n\tprivate pageItemAction: (item:T, results:{[name:string]:any[]}) => void;\r\n\tprivate itemConverter: (item:any, queryResults:{[name:string]:any[]}) => T;\r\n\t\t\r\n\tsetEachPageItem(pageItemAction: (item:T, results:{[name:string]:any[]}) => void) {\r\n\t\tthis.pageItemAction = pageItemAction;\r\n\t}\r\n\r\n\tsetItemConverter(itemConverter: (item:any, queryResults:{[name:string]:any[]}) => T) {\r\n\t\tthis.itemConverter = itemConverter;\r\n\t}\r\n\r\n    scrollToTop = () => {\r\n\t\tthis.scrollIntoView(this.topDiv);\r\n\t\t//let id = '$$top'+uid();\r\n\t\t//this.topDiv = id;\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(this.topDiv);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t\t*/\r\n    }\r\n    scrollToBottom = () => {\r\n\t\tthis.scrollIntoView(this.bottomDiv);\r\n\t\t//let id = '$$bottom'+uid();\r\n\t\t//this.bottomDiv = id;\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(this.bottomDiv);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t\t*/\r\n\t}\r\n\tprivate scrollIntoView(divId:string) {\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(divId);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t}\r\n\r\n    protected param: any;\r\n    protected firstSize = 100;\r\n    protected pageStart:any = undefined;\r\n    protected pageSize = 30;\r\n    protected appendPosition:'head'|'tail' = 'tail';\r\n\r\n\tprotected sortOrder:'asc'|'desc';\r\n\tprotected abstract loadResults(param:any, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}>;\r\n\tprotected getPageId(item:T):any {return;}\r\n\tprotected setPageStart(item:T) {\r\n\t\tthis.pageStart = this.getPageId(item);\r\n\t}\r\n\t\r\n\tprotected async load(param:any, pageStart:any, pageSize:number):Promise<any[]> {\r\n\t\tlet results = await this.loadResults(param, pageStart, pageSize);\r\n\t\tlet pageList = results.$page;\r\n\t\tif (this.itemConverter) {\r\n\t\t\tlet ret:T[] = [];\r\n\t\t\tlet len = pageList.length;\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tlet item = this.itemConverter(pageList[i], results);\r\n\t\t\t\tret.push(item);\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t\tif (this.pageItemAction !== undefined) {\r\n\t\t\tlet len = pageList.length;\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tthis.pageItemAction(pageList[i], results);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn pageList;\r\n\t}\r\n\r\n    reset() {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.isFirst = true;\r\n\t\t\tthis.beforeLoad = true;\r\n\t\t\tthis.loaded = false;\r\n\t\t\tthis.param = undefined;\r\n\t\t\tthis.allLoaded = false;\r\n\t\t\tthis.pageStart = undefined;\r\n\t\t\tthis._items.clear();\r\n\t\t\t//this.setPageStart(undefined);\r\n\t\t});\r\n    }\r\n\r\n    append(item:T) {\r\n        if (this.appendPosition === 'tail')\r\n            this._items.unshift(item);\r\n        else\r\n            this._items.push(item);\r\n    }\r\n\r\n    async first(param:any):Promise<void> {\r\n        this.reset();\r\n        this.beforeLoad = false;\r\n        this.param = param;\r\n        await this.more();\r\n\t}\r\n\r\n\tprivate changing = false;\r\n\tasync attach(): Promise<void> {\r\n\t\tif (this.sortOrder === undefined) {\r\n\t\t\tconsole.error('没有定义增减序，无法attach');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.changing === true) return;\r\n\t\tthis.changing = true;\r\n\t\tlet items = this._items;\r\n\t\tlet isAsc = this.sortOrder === 'asc';\r\n\t\t//let isTail:boolean, \r\n\t\tlet endItem:T;\r\n\t\tlet scrollToEnd:() => void;\r\n\t\tlet pushItem:(item:T) => void;\r\n\t\tif (this.appendPosition === 'tail') {\r\n\t\t\t//isTail = true;\r\n\t\t\tendItem = items[0];\r\n\t\t\tscrollToEnd = this.scrollToTop;\r\n\t\t\tpushItem = (item:T) => items.unshift(item);\r\n\r\n\t\t}\r\n\t\telse {\r\n\t\t\t//isTail = false;\r\n\t\t\tlet endIndex = items.length;\r\n\t\t\tendItem = items[endIndex-1];\r\n\t\t\tscrollToEnd = this.scrollToBottom;\r\n\t\t\tpushItem = (item:T) => items.splice(endIndex, 0, item);\r\n\t\t}\r\n\t\tlet startId = this.getPageId(endItem);\r\n\t\tlet pid = undefined;\r\n\t\tlet sum = 0, max = 50;\r\n\t\tfor (;sum < max;) {\r\n\t\t\tlet ret = await this.load(this.param, pid, 3);\r\n\t\t\tlet len = ret.length;\r\n\t\t\tif (len === 0) break;\r\n\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tlet item = ret[i];\r\n\t\t\t\tpid = this.getPageId(item);\r\n\t\t\t\tif (isAsc === true) {\r\n\t\t\t\t\tif (pid >= startId) {\r\n\t\t\t\t\t\tmax = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (pid <= startId) {\r\n\t\t\t\t\t\tmax = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tpushItem(item);\r\n\t\t\t\t/*\r\n\t\t\t\tif (isTail === true) {\r\n\t\t\t\t\tthis._items.unshift(item);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis._items.push(item);\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n\t\t\t\t++sum;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.changing = false;\r\n\t\tif (sum > 0) {\r\n\t\t\tscrollToEnd();\r\n\t\t\t/*\r\n\t\t\tif (isTail === true) this.scrollToTop();\r\n\t\t\telse this.scrollToBottom();\r\n\t\t\t*/\r\n\t\t}\r\n\t}\r\n\r\n\tasync refresh(): Promise<void> {\r\n\t\tif (this.changing === true) return;\r\n\t\tthis.changing = true;\r\n\t\tlet ret = await this.load(this.param, undefined, this.firstSize>this.pageSize? this.firstSize:this.pageSize);\r\n\t\tthis._items.clear();\r\n\t\tthis.setLoaded(ret);\r\n\t\t/*\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet item = ret[i];\r\n\t\t\tlet pid = this.getRefreshPageId(item);\r\n\t\t\tlet index = this._items.findIndex(v => this.getRefreshPageId(v) === pid);\r\n\t\t\t//let index = _.sortedIndexBy(this._items, item, v=>this.getRefreshPageId(v));\r\n\t\t\t//let oldItem = this._items[index];\r\n\t\t\t//let oid = this.getRefreshPageId(oldItem);\r\n\t\t\tif (index >= 0) {\r\n\t\t\t\t_.merge(this._items[index], item);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._items.splice(0, 0, item);\r\n\t\t\t}\r\n\t\t}\r\n\t\t*/\r\n\t\tthis.changing = false;\r\n\t}\r\n\r\n\tprotected getRefreshPageId(item:T) {\r\n\t\treturn this.getPageId(item);\r\n\t}\r\n\r\n    protected async onLoad(): Promise<void> {}\r\n    protected async onLoaded(): Promise<void> {}\r\n\r\n    async more():Promise<boolean> {\r\n        if (this.allLoaded === true) return false;\r\n\t\tif (this.loading === true) return true;\r\n\t\tif (this.changing === true) return true;\r\n\t\trunInAction(() => {\r\n\t\t\tthis.loading = true;\r\n\t\t\tthis.changing = true;\r\n\t\t});\r\n        await this.onLoad();\r\n        if (this.pageStart === undefined) this.setPageStart(undefined);\r\n        let pageSize = this.pageSize + 1;\r\n        if (this.isFirst === true) {\r\n            if (this.firstSize > this.pageSize) pageSize = this.firstSize+1;\r\n        }\r\n        let ret = await this.load(\r\n                this.param, \r\n                this.pageStart,\r\n\t\t\t\tpageSize);\r\n\t\tlet len = ret.length;\r\n\t\tlet allLoaded:boolean;\r\n        if ((this.isFirst===true && len>this.firstSize) ||\r\n            (this.isFirst===false && len>this.pageSize))\r\n        {\r\n            allLoaded = false;\r\n            --len;\r\n            ret.splice(len, 1);\r\n        }\r\n        else {\r\n            allLoaded = true;\r\n\t\t}\r\n\t\tthis.setLoaded(ret);\r\n\t\tthis.onLoaded();\r\n\t\trunInAction(() => {\r\n\t\t\tthis.loaded = true;\r\n\t\t\tthis.allLoaded = allLoaded;\r\n\t\t\tthis.isFirst = false;\r\n\t\t\tthis.changing = false;\r\n\t\t\tthis.loading = false;\r\n\t\t});\r\n\t\treturn !this.allLoaded;\r\n\t}\r\n\t\r\n\tprivate setLoaded(data:any[]) {\r\n\t\tlet len = data.length;\r\n        if (len === 0) {\r\n\t\t\tthis.setPageStart(undefined);\r\n            this._items.clear();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.setPageStart(data[len-1]);\r\n\t\t\tif (this.appendPosition === 'tail') {\r\n\t\t\t\tthis._items.push(...data);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._items.unshift(...data.reverse());\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfindItem(item:any):T {\r\n\t\tlet pid = this.getPageId(item);\r\n\t\tlet index = _.findIndex(this._items, v => this.getPageId(v) === pid);\r\n\t\tif (index < 0) return;\r\n\t\treturn this._items[index];\r\n\t\t//let oldItem = this._items[index];\r\n\t\t//let oid = this.getPageId(oldItem);\r\n\t\t//if (pid === oid) return oldItem;\r\n\t}\r\n}\r\n","const digits = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';\r\nconst c0 = digits.charCodeAt(0);\r\nconst c9 = digits.charCodeAt(9);\r\nconst A = digits.charCodeAt(10);\r\nconst Z = digits.charCodeAt(35);\r\nconst a = digits.charCodeAt(36);\r\nconst z = digits.charCodeAt(61);\r\nexport function from62(v:string):number {\r\n\tif (v === null) return null;\r\n\tif (v === undefined) return undefined;\r\n\tif (typeof v !== 'string') return Number.NaN;\r\n\tlet len = v.length;\r\n\tif (len === 0) return Number.NaN;\r\n\tlet ret = 0;\r\n\tfor (let i=0; i<len; i++) {\r\n\t\tlet c = v.charCodeAt(i);\r\n\t\tlet n:number;\r\n\t\tif (c < c0) return Number.NaN;\r\n\t\tif (c <= c9) {\r\n\t\t\tn = c - c0;\r\n\t\t}\r\n\t\telse if (c < A) {\r\n\t\t\treturn Number.NaN;\r\n\t\t} \r\n\t\telse if (c <= Z) {\r\n\t\t\tn = c - A + 10;\r\n\t\t}\r\n\t\telse if (c < a) {\r\n\t\t\treturn Number.NaN;\r\n\t\t}\r\n\t\telse if (c <= z) {\r\n\t\t\tn = c - a + 36;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn Number.NaN;\r\n\t\t}\r\n\t\tret *= 62;\r\n\t\tret += n;\r\n\t}\r\n\treturn ret;\r\n}\r\n\r\nexport function to62(v:number):string {\r\n\tif (v === null) return null;\r\n\tif (v === undefined) return undefined;\r\n\tif (typeof v !== 'number') return '';\r\n\tif (v < 0) return '';\r\n\tlet ret = '';\r\n\tfor (;;) {\r\n\t\tret = digits[v % 62] + ret;\r\n\t\tv = Math.floor(v / 62);\r\n\t\tif (v === 0) break;\r\n\t}\r\n\treturn ret;\r\n}\r\n","class MessageHub {\r\n    private handlerSeed = 1;\r\n    private anyHandlers:{[id:number]:(msg:any)=>Promise<void>} = {};\r\n    private msgHandlers:{[id:number]:{type:string, handler:(msg:any)=>Promise<void>}} = {};\r\n\tregisterReceiveHandler(handler:(msg:any)=>Promise<void>):number;\r\n\tregisterReceiveHandler(type:string, handler:(msg:any)=>Promise<void>):number;\t\r\n    registerReceiveHandler(...args:any[]):number {\r\n\t\tlet seed = this.handlerSeed++;\r\n\t\tlet args0 = args[0];\r\n\t\tlet handler:(msg:any)=>Promise<void>;\r\n\t\tswitch (typeof args0) {\r\n\t\t\tcase 'string':\r\n\t\t\t\thandler = args[1];\r\n\t\t\t\tthis.msgHandlers[seed] = {type:args0, handler};\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'function':\r\n\t\t\t\tthis.anyHandlers[seed] = args0;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn seed;\r\n    }\r\n    unregisterReceiveHandler(handlerId:number) {\r\n        delete this.anyHandlers[handlerId];\r\n        delete this.msgHandlers[handlerId];\r\n    }\r\n    async dispatch(msg:any) {\r\n        let {$type} = msg;\r\n        for (let i in this.anyHandlers) {\r\n            await this.anyHandlers[i](msg);\r\n        }\r\n        for (let i in this.msgHandlers) {\r\n            let {type, handler} = this.msgHandlers[i];\r\n            if (type !== $type) continue;\r\n            await handler(msg);\r\n        }\r\n    }\r\n}\r\n\r\nexport const messageHub = new MessageHub();\r\n","// typescript version of krasimir/navigo\r\n\r\nexport type RouteFunc = (params?:string|{[name:string]:string}, query?:string) => void;\r\n\r\nexport interface NamedRoute {\r\n\tas: string;\r\n\tuses: RouteFunc;\r\n\thooks?: Hooks;\r\n}\r\nexport interface Hooks {\r\n\tbefore: (done:()=>void, params:object) => void;\r\n\tafter: (params:object) => void;\r\n\tleave: (params:object) => void;\r\n\talready: (params:object) => void;\r\n}\r\ninterface Handler {\r\n\thandler: RouteFunc;\r\n\thooks: Hooks;\r\n}\r\ninterface LastResolved {\r\n\turl: string;\r\n\tquery: string;\r\n\thooks: Hooks;\r\n\tparams?: {[name:string]:string};\r\n\tname?: string;\r\n}\r\ninterface Route {\r\n\troute: string|RegExp;\r\n\thandler: RouteFunc,\r\n\tname: string,\r\n\thooks: Hooks\r\n}\r\n\r\nexport class Navigo {\r\n\tprivate static PARAMETER_REGEXP = /([:*])(\\w+)/g;\r\n\tprivate static WILDCARD_REGEXP = /\\*/g;\r\n\tprivate static REPLACE_VARIABLE_REGEXP = '([^\\\\/]+)';   \t// 单\\，编译错误 ([^\\/]+)\r\n\tprivate static REPLACE_WILDCARD = `(?:.*)`;\r\n\tprivate static FOLLOWED_BY_SLASH_REGEXP = '(?:\\\\/$|$)';\t\t// 单\\，编译错误 (?:\\/$|$)\r\n\tprivate static MATCH_REGEXP_FLAGS = '';\r\n\r\n\tprivate static isPushStateAvailable() {\r\n\t\treturn !!(\r\n\t\t  typeof window !== 'undefined' &&\r\n\t\t  window.history &&\r\n\t\t  window.history.pushState\r\n\t\t);\r\n\t}\r\n\t\r\n\tprivate static clean(s:string|RegExp) {\r\n\t\tif (s instanceof RegExp) return s;\r\n\t\treturn Navigo.cleanUrl(s);\r\n\t}\r\n\tprivate static cleanUrl(s:string) {\r\n\t\treturn s.replace(/\\/+$/, '').replace(/^\\/+/, '^/');\r\n\t}\r\n\r\n\tprivate static regExpResultToParams(match:any[], names:string[]) {\r\n\t\tif (names.length === 0) return null;\r\n\t\tif (!match) return null;\r\n\t\treturn match\r\n\t\t  .slice(1, match.length)\r\n\t\t  .reduce((params, value, index) => {\r\n\t\t\t\tif (params === null) params = {};\r\n\t\t\t\tparams[names[index]] = decodeURIComponent(value);\r\n\t\t\t\treturn params;\r\n\t\t  }, null);\r\n\t}\r\n\t  \r\n\tprivate static replaceDynamicURLParts(route:string|RegExp) {\r\n\t\tlet paramNames:string[] = [], regexp:RegExp;\r\n\t  \r\n\t\tif (route instanceof RegExp) {\r\n\t\t\tregexp = route;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tregexp = new RegExp(\r\n\t\t\t\troute.replace(Navigo.PARAMETER_REGEXP, function (full, dots, name) {\r\n\t\t\t\t\t\tparamNames.push(name);\r\n\t\t\t\t\t\treturn Navigo.REPLACE_VARIABLE_REGEXP;\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.replace(Navigo.WILDCARD_REGEXP, Navigo.REPLACE_WILDCARD) + Navigo.FOLLOWED_BY_SLASH_REGEXP\r\n\t\t\t\t, Navigo.MATCH_REGEXP_FLAGS);\r\n\t\t}\r\n\t\treturn { regexp, paramNames };\r\n\t}\r\n\t  \r\n\tprivate static getUrlDepth(url:string):number {\r\n\t\treturn url.replace(/\\/$/, '').split('/').length;\r\n\t}\r\n\t  \r\n\tprivate static compareUrlDepth(urlA:string, urlB:string) {\r\n\t\treturn Navigo.getUrlDepth(urlB) - Navigo.getUrlDepth(urlA);\r\n\t}\r\n\t  \r\n\tprivate static findMatchedRoutes(url:string, routes:Route[] = []) {\r\n\t\treturn routes.map(route => {\r\n\t\t\tlet { regexp, paramNames } = Navigo.replaceDynamicURLParts(Navigo.clean(route.route));\r\n\t\t\tlet match = url.replace(/^\\/+/, '/').match(regexp);\r\n\t\t\tlet params = Navigo.regExpResultToParams(match, paramNames);\r\n\t\t\treturn match ? { match, route, params } : false;\r\n\t\t}).filter(m => m);\r\n\t}\r\n\t  \r\n\tprivate static match(url:string, routes:Route[]) {\r\n\t\treturn Navigo.findMatchedRoutes(url, routes)[0] || false;\r\n\t}\r\n\t  \r\n\tprivate static root(url:string, routes:Route[]) {\r\n\t\tconst colonExp = RegExp('\\\\/:\\\\D(\\\\w*)', 'g');\r\n\t\tconst exp = ''; // '($|\\\\/)';  // 单\\，编译报错 ($|\\/)\r\n\t\tlet matched = routes.map(\r\n\t\t\troute => {\r\n\t\t\t\tlet r = route.route;\r\n\t\t\t\tif (r === '' || r === '*') return url;\r\n\t\t\t\tif (typeof r === 'string') {\r\n\t\t\t\t\tr = r.replace(colonExp, '\\\\/\\\\w+');\r\n\t\t\t\t}\r\n\t\t\t\tlet routeExp = r + exp;\r\n\t\t\t\tlet ret = url.split(new RegExp(routeExp))[0];\r\n\t\t\t\treturn ret;\r\n\t\t\t}\r\n\t\t);\r\n\t\tlet fallbackURL = Navigo.cleanUrl(url);\r\n\t\tlet len = matched.length;\r\n\t\tif (len === 0) return fallbackURL;\r\n\t\tlet matched0 = matched[0];\r\n\t\tif (len === 1) return matched0;\r\n\t\treturn matched.reduce((result, url) => {\r\n\t\t\tif (result.length > url.length) result = url;\r\n\t\t\treturn result;\r\n\t\t}, matched0);\r\n\t}\r\n\t  \r\n\tprivate static isHashChangeAPIAvailable() {\r\n\t\treturn typeof window !== 'undefined' && 'onhashchange' in window;\r\n\t}\r\n\t  \r\n\tprivate static extractGETParameters(url:string):string {\r\n\t\treturn url.split(/\\?(.*)?$/).slice(1).join('');\r\n\t}\r\n\t  \r\n\tprivate static getOnlyURL(url:string, useHash:boolean, hash:string) {\r\n\t\tlet onlyURL = url, split:string[];\r\n\t\tvar cleanGETParam = (str:string) => str.split(/\\?(.*)?$/)[0];\r\n\t  \r\n\t\tif (typeof hash === 'undefined') {\r\n\t\t\t// To preserve BC\r\n\t\t\thash = '#';\r\n\t\t}\r\n\t  \r\n\t\tif (Navigo.isPushStateAvailable() && !useHash) {\r\n\t\t  \tonlyURL = cleanGETParam(url).split(hash)[0];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tsplit = url.split(hash);\r\n\t\t\tonlyURL = split.length > 1 ? cleanGETParam(split[1]) : cleanGETParam(split[0]);\r\n\t\t}\r\n\t\treturn onlyURL;\r\n\t}\r\n\t  \r\n\tprivate static manageHooks(handler:RouteFunc, hooks:Hooks, params?:any, exHooks?:Hooks) {\r\n\t\tif (hooks && typeof hooks === 'object') {\r\n\t\t\tif (hooks.before) {\r\n\t\t\t\thooks.before((shouldRoute = true) => {\r\n\t\t\t\tif (!shouldRoute) return;\r\n\t\t\t\thandler();\r\n\t\t\t\thooks.after && hooks.after(params);\r\n\t\t\t\t}, params);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telse if (hooks.after) {\r\n\t\t\t\thandler();\r\n\t\t\t\thooks.after && hooks.after(params);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\thandler();\r\n\t}\r\n\t  \r\n\tprivate static isHashedRoot(url:string, useHash:boolean, hash:string) {\r\n\t\tif (Navigo.isPushStateAvailable() && !useHash) {\r\n\t\t  return false;\r\n\t\t}\r\n\t  \r\n\t\tif (!url.match(hash)) {\r\n\t\t  return false;\r\n\t\t}\r\n\t  \r\n\t\tlet split = url.split(hash);\r\n\t  \r\n\t\treturn split.length < 2 || split[1] === '';\r\n\t}\r\n\t\r\n\tprivate root:string;\r\n\tprivate _routes:Route[] = [];\r\n\tprivate _useHash:boolean;\r\n\tprivate _hash:string;\r\n\tprivate _paused:boolean;\r\n\tprivate _destroyed:boolean;\r\n\tprivate _lastRouteResolved:LastResolved;\r\n\tprivate _notFoundHandler:Handler;\r\n\tprivate _defaultHandler:Handler;\r\n\tprivate _usePushState:boolean;\r\n\tprivate _genericHooks:Hooks;\r\n\tprivate _historyUpdateMethod: 'pushState' | 'replaceState'; // HistoryUpdateMethod;\r\n\tprivate timout: any; //NodeJS.Timeout;\r\n\r\n\tconstructor(r:string = null, useHash:boolean = false, hash:string = '#') {\r\n\t\tthis.root = null;\r\n\t\tthis._useHash = useHash;\r\n\t\tthis._hash = (!hash)? '#' : hash;\r\n\t\tthis._paused = false;\r\n\t\tthis._destroyed = false;\r\n\t\tthis._lastRouteResolved = null;\r\n\t\tthis._notFoundHandler = null;\r\n\t\tthis._defaultHandler = null;\r\n\t\tthis._usePushState = !useHash && Navigo.isPushStateAvailable();\r\n\t\t//this._onLocationChange = this._onLocationChange.bind(this);\r\n\t\tthis._genericHooks = null;\r\n\t\tthis._historyUpdateMethod = 'pushState';\r\n\t\r\n\t\tif (r) {\r\n\t\t\tthis.root = useHash ? r.replace(/\\/$/, '/' + this._hash) : r.replace(/\\/$/, '');\r\n\t\t} else if (useHash) {\r\n\t\t\tthis.root = this._cLoc().split(this._hash)[0].replace(/\\/$/, '/' + this._hash);\r\n\t\t}\r\n\t\r\n\t\tthis._listen();\r\n\t\tthis.updatePageLinks();\r\n\t}\r\n  \r\n\tnavigate(path:string, absolute:boolean = false):Navigo {\r\n\t\tlet to:string;\r\n\t\tpath = path || '';\r\n\t\tif (this._usePushState) {\r\n\t\t\tto = (!absolute ? this._getRoot() + '/' : '') + path.replace(/^\\/+/, '/');\r\n\t\t\tto = to.replace(/([^:])(\\/{2,})/g, '$1/');\r\n\t\t\tthis._historyUpdate({}, '', to);\r\n\t\t\tthis.resolve();\r\n\t\t}\r\n\t\telse if (typeof window !== 'undefined') {\r\n\t\t\tpath = path.replace(new RegExp('^' + this._hash), '');\r\n\t\t\tlet {location} = window;\r\n\t\t\tlocation.href = location.href\r\n\t\t\t\t.replace(/#$/, '')\r\n\t\t\t\t.replace(new RegExp(this._hash + '.*$'), '') + this._hash + path;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\ton(routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(url:string, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(regex:RegExp, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(options: {[url:string]: RouteFunc|NamedRoute}):Navigo;\r\n\ton(...args:any[]):Navigo {\r\n\t\tlet arg0 = args[0];\r\n\t\tlet arg1 = args[1];\r\n\t\tswitch (typeof arg0) {\r\n\t\t\tcase 'function':\r\n\t\t\t\tthis._defaultHandler = { handler: arg0, hooks: arg1 };\r\n\t\t\t\tif (!this._notFoundHandler) {\r\n\t\t\t\t\tthis._notFoundHandler = this._defaultHandler;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'object':\r\n\t\t\t\tlet orderedRoutes = Object.keys(arg0).sort(Navigo.compareUrlDepth);\r\n\t\t\t\torderedRoutes.forEach(route => this.on(route, arg0[route]));\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tif (args.length < 2) break;\r\n\t\t\t\tif (arg0 === '/') {\r\n\t\t\t\t\tthis._defaultHandler = { \r\n\t\t\t\t\t\thandler: typeof arg1 === 'object'? arg1.uses : arg1, \r\n\t\t\t\t\t\thooks: args[2],\r\n\t\t\t\t\t};\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tthis._add(arg0, arg1, args[2]);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\toff(handler:RouteFunc):Navigo {\r\n\t\tif (this._defaultHandler !== null && handler === this._defaultHandler.handler) {\r\n\t\t\tthis._defaultHandler = null;\r\n\t\t}\r\n\t\telse if (this._notFoundHandler !== null && handler === this._notFoundHandler.handler) {\r\n\t\t\tthis._notFoundHandler = null;\r\n\t\t}\r\n\t\tthis._routes = this._routes.reduce((result, r) => {\r\n\t\t\tif (r.handler !== handler) result.push(r);\r\n\t\t\treturn result;\r\n\t\t}, []);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tnotFound(handler:RouteFunc, hooks:Hooks):Navigo {\r\n\t\tthis._notFoundHandler = { handler, hooks };\r\n\t\treturn this;\r\n\t}\r\n\r\n\tresolve(current?:string) {\r\n\t\tlet c = current || this._cLoc();\r\n\t\tlet root = this._getRoot();\r\n\t\tlet url = c.replace(root, '');\r\n\t\r\n\t\tif (this._useHash) {\r\n\t\t\tconst exp = '^\\\\/';  // 单\\，编译报错 ^\\/\r\n\t\t\turl = url.replace(new RegExp(exp + this._hash), '/');\r\n\t\t}\r\n\t\r\n\t\tlet GETParameters = Navigo.extractGETParameters(current || this._cLoc());\r\n\t\tlet onlyURL = Navigo.getOnlyURL(url, this._useHash, this._hash);\r\n\t\r\n\t\tif (this._paused) return false;\r\n\t\r\n\t\tif (\r\n\t\t\tthis._lastRouteResolved &&\r\n\t\t\tonlyURL === this._lastRouteResolved.url &&\r\n\t\t\tGETParameters === this._lastRouteResolved.query\r\n\t\t) {\r\n\t\t\tif (this._lastRouteResolved.hooks && this._lastRouteResolved.hooks.already) {\r\n\t\t\t\tthis._lastRouteResolved.hooks.already(this._lastRouteResolved.params);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\r\n\t\tlet matched = Navigo.match(onlyURL, this._routes);\r\n\t\r\n\t\tlet manageHooks = (handler:Handler) => {\r\n\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\tquery: GETParameters, \r\n\t\t\t\t\t\thooks: handler.hooks\r\n\t\t\t\t\t};\r\n\t\t\t\t\thandler.handler(GETParameters);\r\n\t\t\t\t}, handler.hooks);\r\n\t\t\t}, this._genericHooks);\r\n\t\t}\r\n\r\n\t\tif (matched === false) {\r\n\t\t\tif (this._defaultHandler && (\r\n\t\t\t\tonlyURL === '' ||\r\n\t\t\t\tonlyURL === '/' ||\r\n\t\t\t\tonlyURL === this._hash ||\r\n\t\t\t\tNavigo.isHashedRoot(onlyURL, this._useHash, this._hash)\r\n\t\t\t)) {\r\n\t\t\t\t/*\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\t\tquery: GETParameters, \r\n\t\t\t\t\t\t\thooks: this._defaultHandler.hooks\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis._defaultHandler.handler(GETParameters);\r\n\t\t\t\t\t}, this._defaultHandler.hooks);\r\n\t\t\t\t}, this._genericHooks);\r\n\t\t\t\t*/\r\n\t\t\t\tmanageHooks(this._defaultHandler);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\telse if (this._notFoundHandler) {\r\n\t\t\t\t/*\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\t\tquery: GETParameters,\r\n\t\t\t\t\t\t\thooks: this._notFoundHandler.hooks\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis._notFoundHandler.handler(GETParameters);\r\n\t\t\t\t\t}, this._notFoundHandler.hooks);\r\n\t\t\t\t}, this._genericHooks);\r\n\t\t\t\t*/\r\n\t\t\t\tmanageHooks(this._notFoundHandler);\r\n\t\t\t}\r\n\t\t\treturn false;\t\r\n\t\t}\r\n\t\tlet m = matched;\r\n\t\tif (m) {\r\n\t\t\tthis._callLeave();\r\n\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\turl: onlyURL,\r\n\t\t\t\tquery: GETParameters,\r\n\t\t\t\thooks: m.route.hooks,\r\n\t\t\t\tparams: m.params,\r\n\t\t\t\tname: m.route.name\r\n\t\t\t};\r\n\t\t\tlet handler = m.route.handler;\r\n\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tm.route.route instanceof RegExp ?\r\n\t\t\t\t\thandler(...(m.match.slice(1, m.match.length))) :\r\n\t\t\t\t\thandler(m.params, GETParameters);\r\n\t\t\t\t}, m.route.hooks, m.params, this._genericHooks);\r\n\t\t\t}, this._genericHooks, m.params);\r\n\t\t\treturn m;\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis._routes = [];\r\n\t\tthis._destroyed = true;\r\n\t\tthis._lastRouteResolved = null;\r\n\t\tthis._genericHooks = null;\r\n\t\tclearTimeout(this.timout);\r\n\t\tif (typeof window !== 'undefined') {\r\n\t\t\twindow.removeEventListener('popstate', this._onLocationChange);\r\n\t\t\twindow.removeEventListener('hashchange', this._onLocationChange);\r\n\t\t}\r\n\t}\r\n\r\n\tupdatePageLinks() {\r\n\t\t//var self = this;\r\n\t\tif (typeof document === 'undefined') return;\r\n\t\t\tthis._findLinks().forEach(link => {\r\n\t\t\tif (!link.hasListenerAttached) {\r\n\t\t\t\tlink.addEventListener('click', (e: React.MouseEvent<HTMLElement>) => {\r\n\t\t\t\t\tif((e.ctrlKey || e.metaKey) && e.currentTarget.tagName.toLowerCase() === 'a'){ return false; }\r\n\t\t\t\t\tvar location = this.getLinkPath(link);\r\n\t\t\r\n\t\t\t\t\tif (!this._destroyed) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tthis.navigate(location.replace(/\\/+$/, '').replace(/^\\/+/, '/'));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tlink.hasListenerAttached = true;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tgenerate(name:string, data:any = {}) {\r\n\t\tlet result = this._routes.reduce((result, route) => {\r\n\t\t\tif (route.name === name) {\r\n\t\t\t\tresult = route.route.toString();\r\n\t\t\t\tfor (let key in data) {\r\n\t\t\t\t\tresult = result.replace(':' + key, data[key]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}, '');\r\n\t\r\n\t\treturn this._useHash ? this._hash + result : result;\r\n\t}\r\n\r\n\tlink(path:string) {\r\n\t\treturn this._getRoot() + path;\r\n\t}\r\n\r\n\tpause(status:boolean = true) {\r\n\t\tthis._paused = status;\r\n\t\tif (status) {\r\n\t\t\tthis._historyUpdateMethod = 'replaceState';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._historyUpdateMethod = 'pushState';\r\n\t\t}\r\n\t}\r\n\r\n\tresume() {\r\n\t\tthis.pause(false);\r\n\t}\r\n\r\n\thistoryAPIUpdateMethod(value:'pushState' | 'replaceState') {\r\n\t\tif (typeof value === 'undefined') return this._historyUpdateMethod;\r\n\t\tthis._historyUpdateMethod = value;\r\n\t\treturn value;\r\n\t}\r\n\r\n\tdisableIfAPINotAvailable() {\r\n\t\tif (!Navigo.isPushStateAvailable()) {\r\n\t\t\tthis.destroy();\r\n\t\t}\r\n\t}\r\n\r\n\tlastRouteResolved() {\r\n\t\treturn this._lastRouteResolved;\r\n\t}\r\n\r\n\tgetLinkPath(link:any) {\r\n\t\treturn link.getAttribute('href');\r\n\t}\r\n\r\n\thooks(hooks:Hooks) {\r\n\t\tthis._genericHooks = hooks;\r\n\t}\r\n\r\n\tprivate _add(route:string|RegExp, handler:RouteFunc|NamedRoute, hooks:Hooks) {\r\n\t\tif (typeof route === 'string') {\r\n\t\t\troute = encodeURI(route);\r\n\t\t}\r\n\t\tthis._routes.push(\r\n\t\t\ttypeof handler === 'object' ?\r\n\t\t\t{\r\n\t\t\t\troute,\r\n\t\t\t\thandler: handler.uses,\r\n\t\t\t\tname: handler.as,\r\n\t\t\t\thooks: hooks || handler.hooks\r\n\t\t\t} \r\n\t\t\t:\r\n\t\t\t{\r\n\t\t\t\troute,\r\n\t\t\t\thandler, \r\n\t\t\t\tname: undefined,\r\n\t\t\t\thooks,\r\n\t\t\t}\r\n\t\t);\r\n\t\treturn this._add;\r\n\t}\r\n\r\n\tprivate _historyUpdate(data:any, title:string, url?:string) {\r\n\t\tswitch (this._historyUpdateMethod) {\r\n\t\t\tdefault: throw Error('unknow history method ' + this._historyUpdateMethod);\r\n\t\t\tcase 'pushState': window.history.pushState(data, title, url); return;\r\n\t\t\tcase 'replaceState': window.history.replaceState(data, title, url); return;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _getRoot() {\r\n\t\tif (this.root !== null) return this.root;\r\n\t\tlet cLoc = this._cLoc();\r\n\t\tlet cLocRoot = cLoc.split('?')[0];\r\n\t\tthis.root = Navigo.root(cLocRoot, this._routes);\r\n\t\treturn this.root;\r\n\t}\r\n\r\n\tprivate _listen() {\r\n\t\tif (this._usePushState) {\r\n\t\t\twindow.addEventListener('popstate', this._onLocationChange);\r\n\t\t}\r\n\t\telse if (Navigo.isHashChangeAPIAvailable()) {\r\n\t\t\twindow.addEventListener('hashchange', this._onLocationChange);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet cached = this._cLoc();\r\n\t\r\n\t\t\tlet check = () => {\r\n\t\t\t\tlet current = this._cLoc();\r\n\t\t\t\tif (cached !== current) {\r\n\t\t\t\t\tcached = current;\r\n\t\t\t\t\tthis.resolve();\r\n\t\t\t\t}\r\n\t\t\t\tif (this.timout) clearTimeout(this.timout);\r\n\t\t\t\tthis.timout = setTimeout(check, 200);\r\n\t\t\t};\r\n\t\t\tcheck();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _cLoc() {\r\n\t\tif (typeof window !== 'undefined') {\r\n\t\t\t//if (typeof window.__NAVIGO_WINDOW_LOCATION_MOCK__ !== 'undefined') {\r\n\t\t\t//\treturn window.__NAVIGO_WINDOW_LOCATION_MOCK__;\r\n\t\t\t//}\r\n\t\t\treturn Navigo.cleanUrl(window.location.href);\r\n\t\t}\r\n\t\treturn '';\r\n\t}\r\n\r\n\tprivate _findLinks() {\r\n\t\treturn [].slice.call(document.querySelectorAll('[data-navigo]'));\r\n\t}\r\n\r\n\tprivate _onLocationChange = () => {\r\n\t\tconsole.log('_onLocationChange');\r\n\t\tthis.resolve();\r\n\t}\r\n\r\n\tprivate _callLeave() {\r\n\t\tconst lastRouteResolved = this._lastRouteResolved;\t\r\n\t\tif (lastRouteResolved) {\r\n\t\t\tlet {params, hooks} = lastRouteResolved;\r\n\t\t\tif (hooks) {\r\n\t\t\t\tif (hooks.leave) {\r\n\t\t\t\t\thooks.leave(params);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n//export default Navigo;\r\nexport const navigo = new Navigo();\r\n","import * as React from 'react';\r\nimport {nav} from '../nav';\r\n\r\nexport interface PageHeaderProps {\r\n    back?: 'back' | 'close' | 'none';\r\n    center: string | JSX.Element;\r\n    right?: JSX.Element;\r\n    logout?: boolean | (()=>Promise<void>);\r\n    className?: string;\r\n\tafterBack?: () => void;\r\n\tex?: JSX.Element;\r\n}\r\n\r\nexport function renderPageHeader(props: PageHeaderProps, inWebNav?: boolean) {\r\n    let onBack = async () => {\r\n        await nav.back(); // 这个才会显示confirm box，在dataForm里面，如果输入了数据的话\r\n\t\tlet {afterBack} = props;\r\n\t\tif (afterBack) afterBack();\r\n    }\r\n    let onLogoutClick = () => {\r\n\t\tlet logout = async () => {\r\n\t\t\tlet {logout} = props;\r\n\t\t\tif (typeof logout === 'function') {\r\n\t\t\t\tawait logout(); \r\n\t\t\t}\r\n\t\t\tawait nav.logout(undefined);\r\n\t\t}\r\n\t\tnav.showLogout(logout);\r\n    }\r\n\r\n\tlet b = nav.level > 1 || window.self !== window.top;\r\n\tlet {back, right, center, logout, className, ex} = props;\r\n\tif (inWebNav === true &&  !back && !right && !center) return;\r\n\tlet vBack:any, debugLogout:any;\r\n\tif (logout !== undefined && window.self === window.top) {\r\n\t\tif ((typeof logout === 'boolean' && logout === true)\r\n\t\t\t|| typeof logout === 'function')\r\n\t\t{\r\n\t\t\tlet {user} = nav;\r\n\t\t\tif (user !== undefined) {\r\n\t\t\t\tlet {nick, name} = user;\r\n\t\t\t\tdebugLogout = <div className=\"d-flex align-items-center\">\r\n\t\t\t\t\t<small className=\"text-light\">{nick || name}</small>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// eslint-disable-next-line\r\n\t\t\t\t\t\t<div className=\"ml-2 py-2 px-3 cursor-pointer\"\r\n\t\t\t\t\t\t\trole=\"button\"\r\n\t\t\t\t\t\t\tonClick={onLogoutClick}>\r\n\t\t\t\t\t\t\t<i className=\"fa fa-sign-out fa-lg\" />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (b) {\r\n\t\tswitch (props.back) {\r\n\t\t\tcase 'none':\r\n\t\t\t\tvBack = undefined;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\tcase 'back':\r\n\t\t\t\tvBack = <nav onClick={onBack}>{nav.backIcon}</nav>;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'close':\r\n\t\t\t\tvBack = <nav onClick={onBack}>{nav.closeIcon}</nav>;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tif (window.self !== window.top) {\r\n\t\tconsole.log(document.location.href);\r\n\t\t// pop = <header onClick={this.openWindow} className=\"mx-1\"><FA name=\"external-link\" /></header>;\r\n\t}\r\n\tif (vBack === undefined && typeof center === 'string') {\r\n\t\tcenter = <div className=\"px-3\">{center}</div>;\r\n\t}\r\n\tlet rightView = (right || debugLogout) && <aside>{right} {debugLogout}</aside>;\r\n\tlet header = <header className={className}>\r\n\t\t<nav>\r\n\t\t\t{vBack}\r\n\t\t\t{/*pop 弹出window暂时停止作用 */}\r\n\t\t\t<div>{center}</div>\r\n\t\t\t{rightView}\r\n\t\t</nav>\r\n\t\t{ex}\r\n\t</header>;\r\n\tif (inWebNav === true) return header;\r\n\treturn <>\r\n\t\t<section className=\"tv-page-header\">{header}</section>\r\n\t\t{header}\r\n\t</>;\r\n}\r\n\r\nexport class PageHeader extends React.Component<PageHeaderProps> {\r\n\trender() {return renderPageHeader(this.props)}\r\n\t/*\r\n    private back = async () => {\r\n        await nav.back(); // 这个才会显示confirm box，在dataForm里面，如果输入了数据的话\r\n\t\tlet {afterBack} = this.props;\r\n\t\tif (afterBack) afterBack();\r\n    }\r\n    openWindow() {\r\n        window.open(document.location.href);\r\n    }\r\n    private logoutClick = () => {\r\n        nav.showLogout(this.logout);\r\n    }\r\n    private logout = async () => {\r\n        let {logout} = this.props;\r\n        if (typeof logout === 'function') {\r\n            await logout(); \r\n        }\r\n        await nav.logout(undefined);\r\n    }\r\n    render() {\r\n        let b = nav.level > 1 || window.self !== window.top;\r\n        let {right, center, logout, className, ex} = this.props;\r\n        let back:any, debugLogout:any;\r\n        if (logout !== undefined && window.self === window.top) {\r\n            if ((typeof logout === 'boolean' && logout === true)\r\n                || typeof logout === 'function')\r\n            {\r\n                let {user} = nav;\r\n                if (user !== undefined) {\r\n                    let {nick, name} = user;\r\n                    debugLogout = <div className=\"d-flex align-items-center\">\r\n                        <small className=\"text-light\">{nick || name}</small>\r\n                        {\r\n                            // eslint-disable-next-line\r\n                            <div className=\"ml-2 py-2 px-3 cursor-pointer\"\r\n                                role=\"button\"\r\n                                onClick={this.logoutClick}>\r\n                                <i className=\"fa fa-sign-out fa-lg\" />\r\n                            </div>\r\n                        }\r\n                    </div>;\r\n                }\r\n            }\r\n        }\r\n        if (b) {\r\n            switch (this.props.back) {\r\n                case 'none':\r\n                    back = undefined;\r\n                    break;\r\n                default:\r\n                case 'back':\r\n                    back = <nav onClick={this.back}><i className=\"fa fa-angle-left\" /></nav>;\r\n                    break;\r\n                case 'close':\r\n                    back = <nav onClick={this.back}><i className=\"fa fa-close\" /></nav>;\r\n                    break;\r\n            }\r\n        }\r\n        if (window.self !== window.top) {\r\n            console.log(document.location.href);\r\n            // pop = <header onClick={this.openWindow} className=\"mx-1\"><FA name=\"external-link\" /></header>;\r\n        }\r\n        if (back === undefined && typeof center === 'string') {\r\n            center = <div className=\"px-3\">{center}</div>;\r\n        }\r\n\t\tlet rightView = (right || debugLogout) && <aside>{right} {debugLogout}</aside>;\r\n\t\tlet header = <header className={className}>\r\n\t\t\t<nav>\r\n\t\t\t\t{back}\r\n\t\t\t\t<div>{center}</div>\r\n\t\t\t\t{rightView}\r\n\t\t\t</nav>\r\n\t\t\t{ex}\r\n\t\t</header>;\r\n        return <>\r\n\t\t\t<section className=\"tv-page-header\">{header}</section>\r\n\t\t\t{header}\r\n\t\t</>;\r\n\t}\r\n\t*/\r\n}\r\n","import * as React from 'react';\r\nimport { makeObservable, observable, runInAction } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport { IVPage } from './page';\r\nimport { IObservableValue } from 'mobx';\r\nimport '../../css/va-tab.css';\r\nimport { ScrollView } from './scrollView';\r\n\r\nexport type TabCaption = (selected:boolean) => JSX.Element;\r\n\r\nexport interface TabProp {\r\n    name: string;\r\n    caption: TabCaption;\r\n\tcontent?: () => JSX.Element;\r\n\tpage?: IVPage;\r\n    notify?: IObservableValue<number>;\r\n    load?: () => Promise<void>;\r\n\tonShown?: () => Promise<void>;\r\n\tisSelected?: boolean;\r\n\tonScroll?: () => void;\r\n\tonScrollTop?: () => Promise<boolean>;\r\n\tonScrollBottom?: () => Promise<void>;\r\n\tclassName?: string;\r\n}\r\n\r\nexport interface TabsProps {\r\n    tabs: TabProp[];\r\n    tabPosition?: 'top' | 'bottom';\r\n    size?: 'sm' | 'lg' | 'md';\r\n    tabBg?: string;\r\n    contentBg?: string;\r\n    sep?: string;\r\n    selected?: string;\r\n    borderColor?: string;\r\n    borderWidth?: string;\r\n}\r\n\r\nclass Tab {\r\n\tloaded: boolean = false;\r\n\tselected: boolean = false;\r\n\t\r\n    name: string;\r\n    caption: TabCaption;\r\n\tcontentBuilder: ()=>JSX.Element;\r\n\tpage: IVPage;\r\n    notify: IObservableValue<number>;\r\n    load?: () => Promise<void>;\r\n\tonShown?: () => Promise<void>;\r\n\tonScroll?: () => void;\r\n\tonScrollTop?: () => Promise<boolean>;\r\n\tonScrollBottom?: () => Promise<void>;\r\n\tclassName?: string;\r\n\r\n\tprivate _content: JSX.Element;\r\n\t\r\n\tconstructor() {\r\n\t\tmakeObservable(this, {\r\n\t\t\tloaded: observable, \r\n\t\t\tselected: observable, \r\n\t\t});\r\n\t}\r\n    \r\n    get content(): JSX.Element {\r\n\t\tif (this.load && this.loaded === false) return null;\r\n\t\tif (this.selected === false) return this._content;\r\n\t\tif (!this._content) {\r\n\t\t\tif (this.contentBuilder !== undefined) {\r\n\t\t\t\tthis._content = this.contentBuilder();\r\n\t\t\t}\r\n\t\t\telse if (this.page !== undefined) {\r\n\t\t\t\tthis._content = this.page.content();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._content = <div className=\"p-5\">tab 应该定义content或者page</div>;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._content;\r\n    }\r\n\r\n    async shown() {\r\n        if (this.onShown !== undefined) {\r\n            await this.onShown();\r\n        }\r\n        if (this.load !== undefined) {\r\n\t\t\tif (this.loaded === false) {\r\n\t\t\t\tawait this.load();\r\n\t\t\t\trunInAction(() => {\r\n\t\t\t\t\tthis.loaded = true;\r\n\t\t\t\t});\r\n\t\t\t}\r\n        }\r\n    }\r\n}\r\n\r\nexport const TabCaptionComponent = (label:string|JSX.Element, icon:string, color:string) => <div \r\n    className={'d-flex justify-content-center align-items-center flex-column cursor-pointer ' + color}>\r\n    <div><i className={'fa fa-lg fa-' + icon} /></div>\r\n    <small>{label}</small>\r\n</div>;\r\n\r\n//export const TabCaption = TabCaptionComponent;\r\n\r\nexport class TabsView {\r\n\tprivate props: TabsProps;\r\n    private size: string;\r\n    private tabBg: string;\r\n    private sep: string;\r\n    selectedTab: Tab;\r\n    tabArr: Tab[];\r\n\r\n    constructor(props: TabsProps) {\r\n\t\tthis.props = props;\r\n\t\tlet {size, tabs, tabBg: tabBack, sep, selected} = props;\r\n\t\tthis.size = size || 'md';\r\n        this.tabArr = tabs.map(v => {\r\n            let tab = new Tab();\r\n            let {name, caption, content, page, notify, load, onShown, isSelected, onScroll, onScrollTop, onScrollBottom, className} = v;\r\n\t\t\ttab.name = name;\r\n\t\t\tif (isSelected === true || name === selected) {\r\n\t\t\t\tthis.selectedTab = tab;\r\n\t\t\t}\r\n\t\t\ttab.selected = false;\r\n\t\t\ttab.caption = caption;\r\n\t\t\tif (content !== undefined) {\r\n\t\t\t\ttab.contentBuilder = content;\r\n\t\t\t}\r\n\t\t\telse if (page !== undefined) {\r\n\t\t\t\ttab.page = page;\r\n\t\t\t\t//contentBuilder = () => {return page.content()};\r\n\t\t\t}\r\n            tab.notify = notify;\r\n            tab.load = load;\r\n\t\t\ttab.onShown = onShown;\r\n\t\t\ttab.onScroll = onScroll;\r\n\t\t\ttab.onScrollTop = onScrollTop;\r\n\t\t\ttab.onScrollBottom = onScrollBottom;\r\n\t\t\ttab.className = className;\r\n            return tab;\r\n        });\r\n        this.tabBg = tabBack;\r\n        //this.contentBg = contentBack;\r\n        this.sep = sep;\r\n        if (this.selectedTab === undefined) {\r\n\t\t\tthis.selectedTab = this.tabArr[0];\r\n\t\t}\r\n        this.selectedTab.selected = true;\r\n\t\tmakeObservable(this, {\r\n\t\t\tselectedTab: observable, \r\n\t\t\ttabArr: observable,\r\n\t\t});\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabClick(this.selectedTab);\r\n\t\t}, 100);\t\t\r\n    }\r\n\r\n    tabClick = async (tab:Tab) => {\r\n\t\tif (!tab) {\r\n\t\t\ttab = this.selectedTab;\r\n\t\t\tif (tab === undefined) {\r\n\t\t\t\tif (this.tabArr === undefined) return;\r\n\t\t\t\tif (this.tabArr.length === 0) return;\r\n\t\t\t\ttab = this.tabArr[0];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\trunInAction(() => {\r\n\t\t\tthis.selectedTab.selected = false;\r\n\t\t\ttab.selected = true;\r\n\t\t\tthis.selectedTab = tab;\r\n\t\t});\r\n\t\t\r\n\t\tawait tab.shown();\r\n    }\r\n\r\n\tprivate tabs = observer(() => {\r\n        let {tabPosition, borderColor} = this.props;\r\n        let bsCur:React.CSSProperties, bsTab:React.CSSProperties\r\n        if (borderColor) {\r\n            bsCur = {\r\n                borderColor: borderColor,\r\n                borderStyle: 'solid',\r\n                borderTopWidth: 1,\r\n                borderLeftWidth: 1,\r\n                borderRightWidth: 1,\r\n                borderBottomWidth: 1,\r\n            }\r\n            bsTab = {\r\n                borderColor: borderColor,\r\n                borderStyle: 'solid',\r\n                borderTopWidth: 1,\r\n                borderBottomWidth: 1,\r\n                borderLeftWidth: 0,\r\n                borderRightWidth: 0,\r\n            }\r\n            if (tabPosition === 'top') {\r\n                bsCur.borderBottomWidth = 0;\r\n                bsCur.borderTopLeftRadius = 10;\r\n                bsCur.borderTopRightRadius = 10;\r\n                bsTab.borderTopWidth = 0;\r\n            }\r\n            else {\r\n                bsCur.borderTopWidth = 0;\r\n                bsCur.borderBottomLeftRadius = 10;\r\n                bsCur.borderBottomRightRadius = 10;\r\n                bsTab.borderBottomWidth = 0;\r\n            }\r\n        }\r\n\t\tlet cn = classNames('tv-tabs', this.tabBg, this.sep, 'tv-tabs-' + this.size);\r\n\t\tlet tabs = <div className={cn}>\r\n            {this.tabArr.map((v,index) => {\r\n                let {selected, caption, notify} = v;\r\n                let notifyCircle:any;\r\n                if (notify !== undefined) {\r\n                    let num = notify.get();\r\n                    if (num !== undefined) {\r\n                        if (num > 0) notifyCircle = <u>{num>99?'99+':num}</u>;\r\n                        else if (num < 0) notifyCircle = <u className=\"dot\" />;\r\n                    }\r\n                }\r\n                return <div key={index} onClick={()=>this.tabClick(v)} style={selected===true? bsCur:bsTab}>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t{notifyCircle}\r\n\t\t\t\t\t{caption(selected)}\r\n\t\t\t\t\t</div>\r\n                </div>\r\n            })}\r\n\t\t</div>;\r\n\t\treturn tabs;\r\n\t});\r\n\r\n\tcontent = observer(() => {\r\n\t\tlet displayNone:React.CSSProperties = {visibility: 'hidden'};\r\n\t\treturn <>\r\n\t\t\t{this.tabArr.map((v,index) => {\r\n\t\t\t\tlet {tabPosition} = this.props;\r\n\t\t\t\tlet {content, page, onScroll, onScrollTop, onScrollBottom, className} = v;\r\n\t\t\t\tlet tabs = React.createElement(this.tabs);\r\n\t\t\t\tlet pageHeader:any, pageFooter:any;\r\n\t\t\t\tif (page !== undefined) {\r\n\t\t\t\t\tpageHeader = page.header();\r\n\t\t\t\t\tpageFooter = page.footer();\r\n\t\t\t\t}\r\n\t\t\t\tlet header:any, footer:any;\r\n\t\t\t\tlet visibility:React.CSSProperties = {visibility:'hidden'};\r\n\t\t\t\tif (tabPosition === 'top') {\r\n\t\t\t\t\theader = <>\r\n\t\t\t\t\t\t<section className=\"tv-page-header\">\r\n\t\t\t\t\t\t\t<header>{tabs}{pageHeader}</header>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<header style={visibility}>{tabs}{pageHeader}</header>\r\n\t\t\t\t\t</>;\r\n\t\t\t\t\tif (pageFooter !== undefined) {\r\n\t\t\t\t\t\tfooter = <>\r\n\t\t\t\t\t\t\t<footer style={visibility}>{pageFooter}</footer>\r\n\t\t\t\t\t\t\t<section className=\"tv-page-footer\">\r\n\t\t\t\t\t\t\t\t<footer>{pageFooter}</footer>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t</>;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (pageHeader !== undefined) {\r\n\t\t\t\t\t\theader = <>\r\n\t\t\t\t\t\t\t<section className='tv-page-header'>\r\n\t\t\t\t\t\t\t\t<header>{pageHeader}</header>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t\t<header style={visibility}>{pageHeader}</header>\r\n\t\t\t\t\t\t</>;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfooter = <>\r\n\t\t\t\t\t\t<footer style={visibility}>{pageFooter}{tabs}</footer>\r\n\t\t\t\t\t\t<section className='tv-page-footer'>\r\n\t\t\t\t\t\t\t<footer>{pageFooter}{tabs}</footer>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t</>;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet style:React.CSSProperties;\r\n\t\t\t\tif (v.selected===false) style = displayNone;\r\n\t\t\t\treturn <ScrollView key={index} className={className}\r\n\t\t\t\t\tstyle={style}\r\n\t\t\t\t\tonScroll={onScroll} onScrollTop={onScrollTop} onScrollBottom={onScrollBottom}>\r\n\t\t\t\t\t{header}\r\n\t\t\t\t\t{content}\r\n\t\t\t\t\t{footer}\r\n\t\t\t\t</ScrollView>;\r\n\t\t\t})}\r\n\t\t</>;\r\n\t});\r\n\r\n    render() {\r\n\t\tlet {tabPosition} = this.props;\r\n\t\tlet tabs = React.createElement(this.tabs);\r\n\t\tlet header:any, footer:any;\r\n\t\tlet visibility:React.CSSProperties = {display:'none'};\r\n\t\tif (tabPosition === 'top') {\r\n\t\t\theader = <header>{tabs}</header>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfooter = <footer>{tabs}</footer>;\r\n\t\t}\r\n\t\treturn <>\r\n\t\t\t{header}\r\n\t\t\t{this.tabArr.map((v,index) => {\r\n\t\t\t\tlet style:React.CSSProperties;\r\n\t\t\t\tif (v.selected===false) style = visibility;\r\n\t\t\t\treturn <div key={index} className={classNames(v.className)} style={style}>\r\n\t\t\t\t\t{v.content}\r\n\t\t\t\t</div>;\r\n\t\t\t})}\r\n\t\t\t{footer}\r\n\t\t</>;\r\n    }\r\n};\r\n\r\n@observer export class Tabs extends React.Component<TabsProps> {\r\n\tprivate readonly tabsView: TabsView;\r\n    constructor(props: TabsProps) {\r\n\t\tsuper(props);\r\n\t\tthis.tabsView = new TabsView(props);\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabsView.tabClick(undefined);\r\n\t\t}, 100);\r\n\t\t*/\r\n    }\r\n\r\n    render() {\r\n\t\treturn this.tabsView.render();\r\n    }\r\n};\r\n\r\n@observer export class RootTabs extends React.Component<TabsProps> {\r\n\tprivate readonly tabsView: TabsView;\r\n    constructor(props: TabsProps) {\r\n\t\tsuper(props);\r\n\t\tthis.tabsView = new TabsView(props);\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabsView.tabClick(undefined);\r\n\t\t}, 100);\r\n\t\t*/\r\n    }\r\n\r\n    render() {\r\n\t\treturn React.createElement(this.tabsView.content);\r\n    }\r\n};\r\n","import * as React from 'react';\r\nimport { nav } from './nav';\r\nimport { Loading } from './loading';\r\nimport { Image as ImageControl } from './image';\r\nimport { Page } from './page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { LMR } from './simple';\r\n\r\nexport interface ResUploaderProps {\r\n    className?: string;\r\n    label?: string;\r\n    multiple?: boolean;\r\n    maxSize?: number;\r\n    onFilesChange?: (evt: React.ChangeEvent<HTMLInputElement>) => void;\r\n}\r\n\r\n@observer\r\nexport class ResUploader extends React.Component<ResUploaderProps> {\r\n    private fileInput: HTMLInputElement;\r\n\tfileName: string = null;\r\n\t\r\n\tconstructor(props: ResUploaderProps) {\r\n\t\tsuper(props);\r\n\t\tmakeObservable(this, {\r\n\t\t\tfileName: observable,\r\n\t\t});\r\n\t}\r\n\r\n    buildFormData():FormData {\r\n        let {maxSize} = this.props;\r\n        if (maxSize === undefined || maxSize <= 0) \r\n            maxSize = 100000000000;\r\n        else\r\n            maxSize = maxSize * 1024;\r\n        var files:FileList = this.fileInput.files;\r\n        var data = new FormData();\r\n        let len = files.length;\r\n        for (let i=0; i<len; i++) {\r\n            let file = files[i];\r\n            if (file.size > maxSize) return null;\r\n            data.append('files[]', file, file.name);\r\n        }\r\n    }\r\n\r\n    getFile0(): File {\r\n        return this.fileInput.files[0];\r\n    }\r\n\r\n    upload = async (formData?: FormData):Promise<string|{error:any}> => {\r\n        let resUrl = nav.resUrl + 'upload';\r\n        if (!formData) formData = this.buildFormData();\r\n        try {\r\n            nav.startWait();\r\n            let headers = new Headers();\r\n            headers.append('Access-Control-Allow-Origin', '*');\r\n            //2019-12-18：因为 vivo按oppo某些版本不支持，暂时先不要 \r\n            //let abortController = new AbortController();\r\n            let res = await fetch(resUrl, {\r\n                method: \"POST\",\r\n                body: formData,\r\n                headers: headers,\r\n                //signal: abortController.signal,\r\n            });\r\n            let json = await res.json();\r\n            return ':' + json.res.id;\r\n        }\r\n        catch (err) {\r\n            console.error('%s %s', resUrl, err);\r\n            return {error:err};\r\n        }\r\n        finally {\r\n            nav.endWait();\r\n        }\r\n    }\r\n\r\n    private onFilesChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let {onFilesChange} = this.props;\r\n        if (onFilesChange) onFilesChange(evt);\r\n        let files = evt.target.files;\r\n        let len = files.length;\r\n        let names:string[] = [];\r\n        for (let i=0; i<len; i++) {\r\n            names.push(files.item(i).name);\r\n        }\r\n        this.fileName = names.join(', ');\r\n    }\r\n\r\n    render() {\r\n        let {className, multiple, label} = this.props;\r\n        return <div>\r\n                <label className=\"btn btn-outline-success\">\r\n                    {label || '选择文件'} \r\n                    <input \r\n                        className={className}\r\n                        ref={t=>this.fileInput=t} \r\n                        onChange={this.onFilesChange}\r\n                        type='file' name='file' \r\n                        multiple={multiple} style={{display:'none'}} />\r\n                </label>\r\n                &nbsp;\r\n                {this.fileName}\r\n            </div>\r\n    }\r\n}\r\n\r\nfunction formatSize(size:number, pointLength:number=2, units?:string[]) {\r\n    var unit;\r\n    units = units || [ 'B', 'K', 'M', 'G', 'TB' ];\r\n    while ( (unit = units.shift()) && size > 1024 ) {\r\n        size = size / 1024;\r\n    }\r\n    return (unit === 'B' ? size : size.toFixed( pointLength === undefined ? 2 : pointLength)) + unit;\r\n}\r\n\r\ninterface ImageUploaderProps {\r\n    id?: string;\r\n    label?: string;\r\n    size?: 'sm' | 'md' | 'lg' | 'xl' | 'raw';\r\n\tonSaved?: (imageId:string) => Promise<void>;\r\n\timageTypes?: string[];\r\n}\r\n\r\nconst xlargeSize = 1600;\r\nconst largeSize = 800;\r\nconst mediumSize = 400;\r\nconst smallSize = 180;\r\n\r\n@observer\r\nexport class ImageUploader extends React.Component<ImageUploaderProps> {\r\n\tprivate static imageTypes = ['gif', 'jpg', 'jpeg', 'png', 'svg', 'apng', 'bmp', 'ico', 'cur', 'tiff', 'tif', 'webp'];\r\n\tprivate imgBaseSize: number;\r\n\tprivate imageTypes: string[];\r\n    private suffix: string;\r\n\tprivate resUploader: ResUploader;\r\n\t\r\n    file: File = null;\r\n    desImgWidth: number = null;\r\n    desImgHeight: number = null;\r\n    desImgSize: number = null;\r\n    srcImgWidth: number = null;\r\n    srcImgHeight: number = null;\r\n    isChanged: boolean = false;\r\n    resId: string = null;\r\n    enableUploadButton: boolean = false;\r\n    srcImage: string = null;\r\n    desImage: string = null;\r\n    fileError: string = null;\r\n    uploaded: boolean = false;\r\n\r\n    constructor(props: ImageUploaderProps) {\r\n\t\tsuper(props);\r\n\t\tmakeObservable(this, {\r\n\t\t\tfile: observable,\r\n\t\t\tdesImgWidth: observable,\r\n\t\t\tdesImgHeight: observable,\r\n\t\t\tdesImgSize: observable,\r\n\t\t\tsrcImgWidth: observable,\r\n\t\t\tsrcImgHeight: observable,\r\n\t\t\tisChanged: observable,\r\n\t\t\tresId: observable,\r\n\t\t\tenableUploadButton: observable,\r\n\t\t\tsrcImage: observable,\r\n\t\t\tdesImage: observable,\r\n\t\t\tfileError: observable,\r\n\t\t\tuploaded: observable,\r\n\t\t});\r\n\t\tthis.resId = props.id;\r\n\t\tthis.imageTypes = props.imageTypes || ImageUploader.imageTypes;\r\n    }\r\n\r\n    private onFileChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.fileError = undefined;\r\n        this.uploaded = false;\r\n        this.enableUploadButton = evt.target.files.length > 0;\r\n        if (this.enableUploadButton) {\r\n            this.file = evt.target.files[0];\r\n            let pos = this.file.name.lastIndexOf('.');\r\n            if (pos >= 0) this.suffix = this.file.name.substr(pos+1).toLowerCase();\r\n            if(this.imageTypes.indexOf(this.suffix) < 0){\r\n                this.fileError = `图片类型必须是 ${this.imageTypes.join(', ')} 中的一种`;\r\n                return;\r\n            }\r\n            let reader = new FileReader();\r\n            reader.readAsDataURL(this.file);\r\n            reader.onload = async () => {\r\n\t\t\t\tthis.srcImage = reader.result as string;\r\n\t\t\t\tswitch (this.suffix ) {\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tawait this.setSize(this.props.size);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'svg':\r\n\t\t\t\t\t\tthis.imgBaseSize = mediumSize;\r\n\t\t\t\t\t\tthis.desImgSize = this.srcImage.length;\r\n\t\t\t\t\t\tthis.desImage = this.srcImage;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n            };\r\n        }\r\n    }\r\n\r\n    private async setSize(size?: 'sm' | 'md' | 'lg' | 'xl' | 'raw') {\r\n        switch (size) {\r\n            default:\r\n            case 'sm':\r\n                this.imgBaseSize = smallSize; break;\r\n            case 'md':\r\n                this.imgBaseSize = mediumSize; break;\r\n            case 'lg':\r\n\t\t\t\tthis.imgBaseSize = largeSize; break;\r\n\t\t\tcase 'xl':\r\n\t\t\t\tthis.imgBaseSize = xlargeSize; break;\r\n\t\t\tcase 'raw':\r\n\t\t\t\tthis.imgBaseSize = -1; break;\r\n\t\t}\r\n\t\tthis.desImage = await this.compress();\r\n    }\r\n\r\n    private compress = ():Promise<string> => {\r\n        return new Promise<string>((resolve, reject) => {\r\n            var img = new Image();\r\n            img.src = this.srcImage;\r\n            img.onload = () => {\r\n                //var that = this;\r\n                // 默认按比例压缩\r\n                let {width, height} = img;\r\n                this.srcImgWidth = width;\r\n                this.srcImgHeight = height;\r\n                let scale = width / height;\r\n\t\t\t\tlet w:number, h:number;\r\n\t\t\t\tif (this.imgBaseSize < 0) {\r\n\t\t\t\t\tw = width;\r\n\t\t\t\t\th = height;\r\n\t\t\t\t}\r\n                else if (width <= this.imgBaseSize && height <= this.imgBaseSize) {\r\n                    w = width;\r\n                    h = height;\r\n                }\r\n                else if (scale < 0) {\r\n                    w = this.imgBaseSize;\r\n                    h = w / scale;\r\n                }\r\n                else {\r\n                    h = this.imgBaseSize;\r\n                    w = h * scale;\r\n                }\r\n                this.desImgWidth = Math.round(w);\r\n                this.desImgHeight = Math.round(h);\r\n                var quality = 0.7;  // 默认图片质量为0.7\r\n                //生成canvas\r\n                var canvas = document.createElement('canvas');\r\n                var ctx = canvas.getContext('2d');\r\n                // 创建属性节点\r\n                var anw = document.createAttribute(\"width\");\r\n                anw.nodeValue = String(w);\r\n                var anh = document.createAttribute(\"height\");\r\n                anh.nodeValue = String(h);\r\n                canvas.setAttributeNode(anw);\r\n                canvas.setAttributeNode(anh);\r\n                ctx.drawImage(img, 0, 0, w, h);\r\n                let base64 = canvas.toDataURL('image/' + this.suffix , quality);\r\n                let blob = this.convertBase64UrlToBlob(base64);\r\n                this.desImgSize = blob.size;\r\n                if (this.desImgSize > 3*1024*1024) {\r\n                    this.fileError = \"图片大于3M，无法上传\";\r\n                    this.enableUploadButton = false;\r\n                }\r\n                resolve(base64);\r\n            }\r\n        });\r\n    }\r\n\r\n    private convertBase64UrlToBlob(urlData: string):Blob {\r\n        let arr = urlData.split(',');\r\n        let mime = arr[0].match(/:(.*?);/)[1];\r\n        let bstr = atob(arr[1]);\r\n        let n = bstr.length;\r\n        let u8arr = new Uint8Array(n);\r\n        while(n--){\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], {type:mime});\r\n    }\r\n\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        let formData = new FormData();\r\n        let blob = this.convertBase64UrlToBlob(this.desImage);\r\n        formData.append('image', blob, this.file.name);\r\n        let ret = await this.resUploader.upload(formData);\r\n        if (typeof ret === 'object') {\r\n            let {error} = ret;\r\n            let type = typeof error;\r\n            let err:string;\r\n            switch (type) {\r\n                case 'undefined': err = 'error: undefined'; break;\r\n                case 'string': err = error; break;\r\n                case 'object': err = error.message; break;\r\n                default: err = String(err); break;\r\n            }\r\n            this.fileError = 'error: ' + type + ' - ' + err;\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.props.id);\r\n        this.uploaded = true;\r\n    }\r\n\r\n    private onSaved = (): Promise<void> => {\r\n        let {onSaved} = this.props;\r\n        onSaved && onSaved(this.resId);\r\n        return;\r\n    }\r\n\r\n    private showOrgImage = () => {\r\n        nav.push(<Page header=\"原图\">\r\n            <div className=\"p-3 text-center\">\r\n                <ImageControl className=\"h-min-4c\" style={{maxWidth:'100%'}} src={this.srcImage} />\r\n            </div>\r\n        </Page>);\r\n    }\r\n\r\n    private levelDiv() {\r\n        if (this.props.size) return;\r\n        let arr = [{caption:'小图', size:'sm'}];\r\n        if (this.srcImgHeight > mediumSize || this.srcImgWidth > mediumSize) {\r\n            arr.push({caption:'中图', size:'md'});\r\n        }\r\n        if (this.srcImgHeight > largeSize || this.srcImgWidth > largeSize) {\r\n            arr.push({caption:'大图', size:'lg'});\r\n        }\r\n        if (this.srcImgHeight > xlargeSize || this.srcImgWidth > xlargeSize) {\r\n\t\t\tarr.push({caption:'超大图', size:'xl'});\r\n\t\t\tarr.push({caption:'原图', size:'raw'});\r\n        }\r\n        if (arr.length < 2) return;\r\n        return <div>{arr.map((v, index) => {\r\n            let {caption, size} = v;\r\n            return <label key={index} className=\"mr-3\"><input type=\"radio\" name=\"size\" \r\n                onChange={()=>this.setSize(size as any)}\r\n                defaultChecked={index===0} /> {caption}</label>;\r\n        })}</div>\r\n    }\r\n\r\n    render() {\r\n        let {label} = this.props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={this.onSaved}>保存</button>;\r\n        return <Page header={label || '更改图片'} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div className=\"mb-3\">\r\n                        <ResUploader ref={v=>this.resUploader=v} \r\n                            multiple={false} maxSize={2048} \r\n                            label=\"选择图片文件\"\r\n                            onFilesChange={this.onFileChange} />\r\n                        <div className=\"small text-muted\">支持 {this.imageTypes.join(', ')} 格式图片。</div>\r\n                        {this.fileError && <div className=\"text-danger\">{this.fileError}</div>}\r\n                    </div>\r\n                    <LMR left=\r\n                    {\r\n                        this.uploaded === true? \r\n                            <div className=\"text-success p-2\">上传成功！</div>\r\n                            :\r\n                            this.file && this.desImgSize > 0 && <div className=\"mb-3 d-flex align-items-end\">\r\n                                <div className=\"mr-5\">\r\n                                    {this.levelDiv()}\r\n                                    <div>分辨率：{this.desImgWidth} x {this.desImgHeight}\r\n                                    &nbsp; &nbsp;\r\n                                    文件大小：{formatSize(this.desImgSize)}\r\n                                    </div>\r\n                                </div>\r\n                                <button className=\"btn btn-primary\" \r\n                                    disabled={!this.enableUploadButton}\r\n                                    onClick={this.upload}>上传</button>\r\n                            </div>\r\n                    }\r\n                    right={this.desImage && \r\n                        <button className=\"btn btn-link btn-sm text-right mb-3\" onClick={this.showOrgImage}>\r\n                            原图大小: {formatSize(this.file.size)}<br/>\r\n                            分辨率：{this.srcImgWidth} x {this.srcImgHeight}\r\n                        </button>\r\n                    }\r\n                    ></LMR>\r\n                </div>\r\n                <div className=\"text-center\" \r\n                    style={{\r\n                        border: (this.uploaded===true? '2px solid green' : '1px dotted gray'),\r\n                        padding: '8px'\r\n                    }}>\r\n                    <ImageControl className=\"h-min-4c\" style={{maxWidth:'100%'}} src={this.desImage} />\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\ninterface AudioUploaderProps {\r\n    id?: string;\r\n    label?: string;\r\n    onSaved?: (imageId:string) => Promise<void>;\r\n}\r\n\r\n@observer\r\nexport class AudioUploader extends React.Component<AudioUploaderProps> {\r\n\tprivate static audioTypes = ['mp3', 'wav'];\r\n\r\n    private suffix: string;\r\n\tprivate resUploader: ResUploader;\r\n\r\n\tcontent: string = null;\r\n\tfile: File = null;\r\n\tfileSize: number = null;\r\n    isChanged: boolean = false;\r\n    resId: string = null;\r\n    enableUploadButton: boolean = false;\r\n    fileError: string = null;\r\n\tuploaded: boolean = false;\r\n\tuploading: boolean = false;\r\n\r\n    constructor(props: AudioUploaderProps) {\r\n\t\tsuper(props);\r\n\t\tmakeObservable(this, {\r\n\t\t\tcontent: observable,\r\n\t\t\tfile: observable,\r\n\t\t\tfileSize: observable,\r\n\t\t\r\n\t\t\tisChanged: observable,\r\n\t\t\tresId: observable,\r\n\t\t\tenableUploadButton: observable,\r\n\t\t\tfileError: observable,\r\n\t\t\tuploaded: observable,\r\n\t\t\tuploading: observable,\r\n\t\t});\r\n        this.resId = props.id;\r\n    }\r\n\r\n    private onFileChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.fileError = undefined;\r\n        this.uploaded = false;\r\n        this.enableUploadButton = evt.target.files.length > 0;\r\n        if (this.enableUploadButton) {\r\n            this.file = evt.target.files[0];\r\n            let pos = this.file.name.lastIndexOf('.');\r\n            if (pos >= 0) this.suffix = this.file.name.substr(pos+1).toLowerCase();\r\n            if(AudioUploader.audioTypes.indexOf(this.suffix) < 0){\r\n                this.fileError = `音频类型必须是 ${AudioUploader.audioTypes.join(', ')} 中的一种`;\r\n                return;\r\n            }\r\n            let reader = new FileReader();\r\n            reader.readAsDataURL(this.file);\r\n            reader.onload = async () => {\r\n\t\t\t\tthis.content = reader.result as string;\r\n\t\t\t\tthis.fileSize = this.content.length;\r\n            };\r\n        }\r\n    }\r\n\r\n    private convertBase64UrlToBlob(urlData: string):Blob {\r\n        let arr = urlData.split(',');\r\n        let mime = arr[0].match(/:(.*?);/)[1];\r\n        let bstr = atob(arr[1]);\r\n        let n = bstr.length;\r\n        let u8arr = new Uint8Array(n);\r\n        while(n--){\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], {type:mime});\r\n    }\r\n\r\n    private upload = async () => {\r\n\t\tif (!this.resUploader) return;\r\n\t\tthis.uploading = true;\r\n        let formData = new FormData();\r\n        let blob = this.convertBase64UrlToBlob(this.content);\r\n        formData.append('image', blob, this.file.name);\r\n        let ret = await this.resUploader.upload(formData);\r\n        if (typeof ret === 'object') {\r\n            let {error} = ret;\r\n            let type = typeof error;\r\n            let err:string;\r\n            switch (type) {\r\n                case 'undefined': err = 'error: undefined'; break;\r\n                case 'string': err = error; break;\r\n                case 'object': err = error.message; break;\r\n                default: err = String(err); break;\r\n            }\r\n            this.fileError = 'error: ' + type + ' - ' + err;\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.props.id);\r\n        this.uploaded = true;\r\n    }\r\n\r\n    private onSaved = (): Promise<void> => {\r\n        let {onSaved} = this.props;\r\n        onSaved && onSaved(this.resId);\r\n        return;\r\n    }\r\n\r\n    render() {\r\n        let {label} = this.props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={this.onSaved}>保存</button>;\r\n        return <Page header={label || '更改文件'} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div className=\"mb-3\">\r\n                        <ResUploader ref={v=>this.resUploader=v} \r\n                            multiple={false} maxSize={2048} \r\n                            label=\"选择音频文件\"\r\n                            onFilesChange={this.onFileChange} />\r\n                        <div className=\"small text-muted\">支持 {AudioUploader.audioTypes.join(', ')} 格式。</div>\r\n                        {this.fileError && <div className=\"text-danger\">{this.fileError}</div>}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\t\t\t<LMR left=\r\n                    {\r\n                        this.uploaded === true? \r\n                            <div className=\"text-success p-2\">上传成功！</div>\r\n\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\tthis.uploading === true?\r\n\t\t\t\t\t\t\t\t<div className=\"m-3\"><Loading /></div>\r\n\t\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\t\tthis.file && this.content && <div className=\"m-3\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"mb-3\">\r\n\t\t\t\t\t\t\t\t\t\t文件大小：{formatSize(this.fileSize)}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<button className=\"btn btn-primary\" \r\n\t\t\t\t\t\t\t\t\t\tdisabled={!this.enableUploadButton}\r\n\t\t\t\t\t\t\t\t\t\tonClick={this.upload}>上传</button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t/>\r\n        </Page>;\r\n    }\r\n}\r\n","import { UqApi, UqData, UnitxApi } from '../net';\r\nimport { Tuid, TuidDiv, TuidImport, TuidInner, TuidBox, TuidsCache } from './tuid';\r\nimport { Action } from './action';\r\nimport { Sheet } from './sheet';\r\nimport { Query } from './query';\r\nimport { Book } from './book';\r\nimport { History } from './history';\r\nimport { Map } from './map';\r\nimport { Pending } from './pending';\r\nimport { CreateBoxId, BoxId } from './tuid';\r\nimport { LocalMap, LocalCache, env, capitalCase } from '../tool';\r\nimport { UQsMan } from './uqsMan';\r\nimport { ReactBoxId } from './tuid/reactBoxId';\r\nimport { Tag } from './tag/tag';\r\nimport { UqEnum } from './enum';\r\nimport { Entity } from './entity';\r\nimport { CenterApi, centerApi, UqConfig } from '../app';\r\nimport { ID, IX, IDX } from './ID';\r\nimport { nav } from '../components';\r\n\r\nexport type FieldType = 'id' | 'tinyint' | 'smallint' | 'int' | 'bigint' | 'dec' | 'float' | 'double' | 'char' | 'text'\r\n    | 'datetime' | 'date' | 'time' | 'timestamp';\r\n\r\nexport function fieldDefaultValue(type:FieldType) {\r\n    switch (type) {\r\n        case 'tinyint':\r\n        case 'smallint':\r\n        case 'int':\r\n        case 'bigint':\r\n        case 'dec':\r\n\t\tcase 'float':\r\n\t\tcase 'double':\r\n            return 0;\r\n        case 'char':\r\n        case 'text':\r\n            return '';\r\n        case 'datetime':\r\n        case 'date':\r\n            return '2000-1-1';\r\n        case 'time':\r\n            return '0:00';\r\n    }\r\n}\r\n\r\nexport interface Field {\r\n    name: string;\r\n    type: FieldType;\r\n    tuid?: string;\r\n    arr?: string;\r\n    null?: boolean;\r\n    size?: number;\r\n    owner?: string;\r\n    _tuid: TuidBox;\r\n}\r\nexport interface ArrFields {\r\n    name: string;\r\n    fields: Field[];\r\n    id?: string;\r\n    order?: string;\r\n}\r\nexport interface FieldMap {\r\n    [name:string]: Field;\r\n}\r\nexport interface SchemaFrom {\r\n    owner:string;\r\n    uq:string;\r\n}\r\nexport interface TuidModify {\r\n    max: number;\r\n    seconds: number;\r\n}\r\n\r\ninterface ParamPage {\r\n\tstart:number;\r\n\tend?: number;\r\n\tsize:number;\r\n}\r\n\r\nexport interface ParamActIX<T> {\r\n\tIX: IX;\r\n\tID?: ID;\r\n\tvalues: {ix:number, id:number|T}[];\r\n}\r\n\r\nexport interface ParamActIXSort {\r\n\tIX: IX;\r\n\tix: number;\r\n\tid: number;\t\t\t\t\t// id to be moved\r\n\tafter: number;\t\t\t\t// insert after id. if before first, then 0\r\n}\r\n\r\nexport interface ParamActDetail<M,D> {\r\n\tmaster: {\r\n\t\tID: ID;\r\n\t\tvalue: M;\r\n\t};\r\n\tdetail: {\r\n\t\tID: ID;\r\n\t\tvalues: D[];\r\n\t};\r\n}\r\n\r\nexport interface RetActDetail {\r\n\tmaster: number;\r\n\tdetail: number[];\r\n}\r\n\r\nexport interface ParamActDetail2<M,D,D2> extends ParamActDetail<M, D> {\r\n\tdetail2: {\r\n\t\tID: ID;\r\n\t\tvalues: D2[];\r\n\t};\r\n}\r\n\r\nexport interface RetActDetail2 extends RetActDetail {\r\n\tdetail2: number[];\r\n}\r\n\r\nexport interface ParamActDetail3<M,D,D2,D3> extends ParamActDetail2<M, D, D2> {\r\n\tdetail3: {\r\n\t\tID: ID;\r\n\t\tvalues: D3[];\r\n\t};\r\n}\r\n\r\nexport interface RetActDetail3 extends RetActDetail2 {\r\n\tdetail3: number[];\r\n}\r\n\r\nexport interface ParamIDNO {\r\n\tID: ID;\r\n}\r\n\r\nexport interface ParamIDDetailGet {\r\n\tid: number;\r\n\tmaster: ID;\r\n\tdetail: ID;\r\n\tdetail2?: ID;\r\n\tdetail3?: ID;\r\n}\r\n\r\nexport interface ParamID {\r\n\tIDX: (ID|IDX) | (ID|IDX)[];\r\n\tid: number | number[];\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamKeyID {\r\n\tID: ID;\r\n\tkey: {[key:string]:string|number};\r\n\tIDX?: (ID|IDX)[];\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamIX {\r\n\tIX: IX;\r\n\tIX1?: IX;\r\n\tix: number | number[];\r\n\tIDX?: (ID|IDX)[];\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamKeyIX {\r\n\tID: ID;\r\n\tkey: {[key:string]:string|number};\r\n\tIX: IX;\r\n\tIDX?: (ID|IDX)[];\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamIDLog {\r\n\tIDX: (ID|IDX);\r\n\tfield: string;\r\n\tid: number;\r\n\tlog: 'each' | 'day' | 'week' | 'month' | 'year';\r\n\ttimeZone?: number;\r\n\tfar?: number;\r\n\tnear?: number;\r\n\tpage: ParamPage;\r\n}\r\n\r\nexport interface ParamIDSum {\r\n\tIDX: IDX;\r\n\tfield: string[];\r\n\tid: number|number[];\r\n\tfar?: number;\t\t\t\t// 以前\r\n\tnear?: number;\t\t\t\t// 最近\r\n}\r\n\r\nexport interface ParamIDxID {\r\n\tID: ID;\r\n\tIX: IX;\r\n\tID2: ID;\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface IDXValue {\r\n\tvalue: number;\r\n\ttime?: number|Date;\r\n\tact: '='|'+';\r\n}\r\n\r\nexport interface ParamIDinIX {\r\n\tID: ID;\r\n\tid: number;\r\n\tIX: IX;\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamIDTree {\r\n\tID: ID;\r\n\tparent: number;\r\n\tkey: string|number;\r\n\tlevel?: number;\t\t\t\t// 无值，默认1一级\r\n\tpage?: ParamPage;\r\n}\r\n\r\nfunction IDPath(path:string):string {return path;}\r\n\r\nexport interface Uq {\r\n\t$: UqMan;\r\n\tActs(param:any): Promise<any>;\r\n\tActIX<T>(param: ParamActIX<T>): Promise<number[]>;\r\n\tActIXSort(param: ParamActIXSort): Promise<void>;\r\n\tActDetail<M,D>(param: ParamActDetail<M,D>): Promise<RetActDetail>;\r\n\tActDetail<M,D,D2>(param: ParamActDetail2<M,D,D2>): Promise<RetActDetail2>;\r\n\tActDetail<M,D,D2,D3>(param: ParamActDetail3<M,D,D2,D3>): Promise<RetActDetail3>;\r\n\tIDNO(param: ParamIDNO): Promise<string>;\r\n\tIDDetailGet<M,D>(param: ParamIDDetailGet): Promise<[M[], D[]]>;\r\n\tIDDetailGet<M,D,D2>(param: ParamIDDetailGet): Promise<[M[], D[], D2[]]>;\r\n\tIDDetailGet<M,D,D2,D3>(param: ParamIDDetailGet): Promise<[M[], D[], D2[], D3[]]>;\r\n\tID<T>(param: ParamID): Promise<T[]>;\r\n\tKeyID<T>(param: ParamKeyID): Promise<T[]>;\r\n\tIX<T>(param: ParamIX): Promise<T[]>;\r\n\tIXr<T> (param: ParamIX): Promise<T[]>; // IX id 反查IX list\r\n\tKeyIX<T>(param: ParamKeyIX): Promise<T[]>;\r\n\tIDLog<T> (param: ParamIDLog): Promise<T[]>;\r\n\tIDSum<T> (param: ParamIDSum): Promise<T[]>;\r\n\tIDxID<T,T2> (param: ParamIDxID): Promise<[T[],T2[]]>; // ID list with IX 对应的子集\r\n\tIDinIX<T>(param:ParamIDinIX): Promise<T&{$in:boolean}[]>;\r\n\tIDTree<T>(param:ParamIDTree): Promise<T[]>;\r\n}\r\n\r\nexport class UqMan {\r\n\tprivate readonly entities: {[name:string]: Entity} = {};\r\n\tprivate readonly enums: {[name:string]: UqEnum} = {};\r\n\tprivate readonly actions: {[name:string]: Action} = {};\r\n    private readonly queries: {[name:string]: Query} = {};\r\n\tprivate readonly ids: {[name:string]: ID} = {};\r\n\tprivate readonly idxs: {[name:string]: IDX} = {};\r\n\tprivate readonly ixs: {[name:string]: IX} = {};\r\n\r\n    private readonly sheets: {[name:string]: Sheet} = {};\r\n    private readonly books: {[name:string]: Book} = {};\r\n    private readonly maps: {[name:string]: Map} = {};\r\n    private readonly histories: {[name:string]: History} = {};\r\n\tprivate readonly pendings: {[name:string]: Pending} = {};\r\n\tprivate readonly tags: {[name:string]: Tag} = {};\r\n    private readonly tuidsCache: TuidsCache;\r\n    private readonly localEntities: LocalCache;\r\n    private readonly tvs:{[entity:string]:(values:any)=>JSX.Element};\r\n\tproxy: any;\r\n    readonly localMap: LocalMap;\r\n    readonly localModifyMax: LocalCache;\r\n    readonly tuids: {[name:string]: Tuid} = {};\r\n    readonly createBoxId: CreateBoxId;\r\n    readonly newVersion: boolean;\r\n    readonly uqOwner: string;\r\n    readonly uqName: string;\r\n    readonly name: string;\r\n    readonly uqApi: UqApi;\r\n\treadonly id: number;\r\n\r\n    uqVersion: number;\r\n\t//ownerProfix: string;\r\n\tconfig: UqConfig;\r\n\r\n    constructor(uqs:UQsMan, uqData: UqData, createBoxId:CreateBoxId, tvs:{[entity:string]:(values:any)=>JSX.Element}) {\r\n        this.createBoxId = createBoxId;\r\n        if (createBoxId === undefined) {\r\n            this.createBoxId = this.createBoxIdFromTVs;\r\n            this.tvs = tvs || {};\r\n        }\r\n        let {id, uqOwner, uqName, /*access, */newVersion} = uqData;\r\n        this.newVersion = newVersion;\r\n        this.uqOwner = uqOwner;\r\n        this.uqName = uqName;\r\n        this.id = id;\r\n        this.name = uqOwner + '/' + uqName;\r\n        this.uqVersion = 0;\r\n\t\t//this.localMap = uqs.localMap.map(this.name);\r\n\t\tthis.localMap = env.localDb.map(this.name);\r\n        this.localModifyMax = this.localMap.child('$modifyMax');\r\n        this.localEntities = this.localMap.child('$access');\r\n        let baseUrl = 'tv/';\r\n\r\n\t\t/*\r\n        let acc: string[];\r\n        if (access === null || access === undefined || access === '*') {\r\n            acc = [];\r\n        }\r\n        else {\r\n            acc = access.split(';').map(v => v.trim()).filter(v => v.length > 0);\r\n\t\t}\r\n\t\t*/\r\n        if (this.name === '$$$/$unitx') {\r\n            // 这里假定，点击home link之后，已经设置unit了\r\n            // 调用 UnitxApi会自动搜索绑定 unitx service\r\n            this.uqApi = new UnitxApi(env.unit);\r\n        }\r\n        else {\r\n            //let {appOwner, appName} = uqs;\r\n            this.uqApi = new UqApi(baseUrl, /*appOwner, appName, */uqOwner, uqName/*, acc*/, true);\r\n        }\r\n        this.tuidsCache = new TuidsCache(this);\r\n    }\r\n\r\n\tget center():CenterApi {return centerApi;}\r\n\r\n\tgetID(name:string):ID {return this.ids[name.toLowerCase()];};\r\n\tgetIDX(name:string):IDX {return this.idxs[name.toLowerCase()];};\r\n\tgetIX(name:string):IX {return this.ixs[name.toLowerCase()];};\r\n\r\n    private createBoxIdFromTVs:CreateBoxId = (tuid:Tuid, id:number):BoxId =>{\r\n        let {name} = tuid;\r\n        /*\r\n        let tuidUR = this.tuidURs[name];\r\n        if (tuidUR === undefined) {\r\n            let {ui, res} = this.getUI(tuid);\r\n            this.tuidURs[name] = tuidUR = new TuidWithUIRes(tuid, ui, res);\r\n        }\r\n        */\r\n        return new ReactBoxId(id, tuid, this.tvs[name]);\r\n\t}\r\n\t\r\n\tprivate roles:string[];\r\n\tasync getRoles():Promise<string[]> {\r\n\t\tif (this.roles !== undefined) return this.roles;\r\n\t\tthis.roles = await this.uqApi.getRoles();\r\n\t\treturn this.roles;\r\n\t}\r\n\r\n    tuid(name:string):Tuid {return this.tuids[name.toLowerCase()]}\r\n    tuidDiv(name:string, div:string):TuidDiv {\r\n        let tuid = this.tuids[name.toLowerCase()]\r\n        return tuid && tuid.div(div.toLowerCase());\r\n    }\r\n    action(name:string):Action {return this.actions[name.toLowerCase()]}\r\n    sheet(name:string):Sheet {return this.sheets[name.toLowerCase()]}\r\n    query(name:string):Query {return this.queries[name.toLowerCase()]}\r\n    book(name:string):Book {return this.books[name.toLowerCase()]}\r\n    map(name:string):Map {return this.maps[name.toLowerCase()]}\r\n    history(name:string):History {return this.histories[name.toLowerCase()]}\r\n    pending(name:string):Pending {return this.pendings[name.toLowerCase()]}\r\n\r\n    sheetFromTypeId(typeId:number):Sheet {\r\n        for (let i in this.sheets) {\r\n            let sheet = this.sheets[i];\r\n            if (sheet.typeId === typeId) return sheet;\r\n        }\r\n    }\r\n\r\n\tallRoles: string[];\r\n    readonly tuidArr: Tuid[] = [];\r\n    readonly actionArr: Action[] = [];\r\n    readonly queryArr: Query[] = [];\r\n    readonly idArr: ID[] = [];\r\n    readonly idxArr: IDX[] = [];\r\n    readonly ixArr: IX[] = [];\r\n    readonly enumArr: UqEnum[] = [];\r\n    readonly sheetArr: Sheet[] = [];\r\n    readonly bookArr: Book[] = [];\r\n    readonly mapArr: Map[] = [];\r\n    readonly historyArr: History[] = [];\r\n    readonly pendingArr: Pending[] = [];\r\n    readonly tagArr: Tag[] = [];\r\n\r\n    async init() {\r\n        await this.uqApi.init();\r\n    }\r\n\r\n    async loadEntities(): Promise<string> {\r\n        try {\r\n            let entities = this.localEntities.get();\r\n            if (!entities) {\r\n                entities = await this.uqApi.loadEntities();\r\n\t\t\t}\r\n            if (!entities) return;\r\n            this.buildEntities(entities);\r\n        }\r\n        catch (err) {\r\n            return err;\r\n        }\r\n    }\r\n\r\n\tbuildEntities(entities:any) {\r\n        if (entities === undefined) {\r\n            debugger;\r\n        }\r\n        this.localEntities.set(entities);\r\n        let {access, tuids, role, version} = entities;\r\n\t\tthis.uqVersion = version;\r\n\t\tthis.allRoles = role?.names;\r\n        this.buildTuids(tuids);\r\n\t\tthis.buildAccess(access);\r\n\t}\r\n\t\r\n    private buildTuids(tuids:any) {\r\n        for (let i in tuids) {\r\n            let schema = tuids[i];\r\n            let {typeId, from} = schema;\r\n            let tuid = this.newTuid(i, typeId, from);\r\n            tuid.sys = true;\r\n        }\r\n        for (let i in tuids) {\r\n            let schema = tuids[i];\r\n            let tuid = this.getTuid(i);\r\n            tuid.setSchema(schema);\r\n        }\r\n        for (let i in this.tuids) {\r\n            let tuid = this.tuids[i];\r\n            tuid.buildFieldsTuid();\r\n        }\r\n\t}\r\n\r\n    async loadEntitySchema(entityName: string): Promise<any> {\r\n        return await this.uqApi.schema(entityName);\r\n    }\r\n\r\n\tasync loadAllSchemas():Promise<void> {\r\n\t\tlet ret = await this.uqApi.allSchemas();\r\n\t\tlet entities: Entity[][] = [\r\n\t\t\tthis.actionArr, \r\n\t\t\tthis.enumArr,\r\n\t\t\tthis.sheetArr,\r\n\t\t\tthis.queryArr,\r\n\t\t\tthis.bookArr,\r\n\t\t\tthis.mapArr,\r\n\t\t\tthis.historyArr,\r\n\t\t\tthis.pendingArr,\r\n\t\t\tthis.tagArr,\r\n\t\t\tthis.idArr,\r\n\t\t\tthis.idxArr,\r\n\t\t\tthis.ixArr,\r\n\t\t];\r\n\t\tentities.forEach(arr => {\r\n\t\t\tarr.forEach(v => {\r\n\t\t\t\tlet entity = ret[v.name.toLowerCase()];\r\n\t\t\t\tif (!entity) return;\r\n\t\t\t\tlet schema = entity.call;\r\n\t\t\t\tif (!schema) return;\r\n\t\t\t\tv.buildSchema(schema);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n    getTuid(name:string): Tuid {\r\n        return this.tuids[name];\r\n    }\r\n\r\n    private buildAccess(access:any) {\r\n        for (let a in access) {\r\n            let v = access[a];\r\n            switch (typeof v) {\r\n                case 'string': this.fromType(a, v); break;\r\n                case 'object': this.fromObj(a, v); break;\r\n            }\r\n        }\r\n    }\r\n\r\n    cacheTuids(defer:number) {\r\n        this.tuidsCache.cacheTuids(defer);\r\n    }\r\n\r\n\tprivate setEntity(name:string, entity:Entity) {\r\n\t\tthis.entities[name] = entity;\r\n\t\tthis.entities[name.toLowerCase()] = entity;\r\n\t}\r\n\r\n    newEnum(name:string, id:number):UqEnum {\r\n        let enm = this.enums[name];\r\n        if (enm !== undefined) return enm;\r\n\t\tenm = this.enums[name] = new UqEnum(this, name, id);\r\n\t\tthis.setEntity(name, enm);\r\n        this.enumArr.push(enm);\r\n        return enm;\r\n    }\r\n\tnewAction(name:string, id:number):Action {\r\n        let action = this.actions[name];\r\n        if (action !== undefined) return action;\r\n        action = this.actions[name] = new Action(this, name, id);\r\n\t\tthis.setEntity(name, action);\r\n        this.actionArr.push(action);\r\n        return action;\r\n    }\r\n    private newTuid(name:string, id:number, from:SchemaFrom):Tuid {\r\n        let tuid = this.tuids[name];\r\n        if (tuid !== undefined) return tuid;\r\n        if (from !== undefined)\r\n            tuid = new TuidImport(this, name, id, from);\r\n        else\r\n            tuid = new TuidInner(this, name, id);\r\n        this.tuids[name] = tuid;\r\n\t\tthis.setEntity(name, tuid);\r\n        this.tuidArr.push(tuid);\r\n        return tuid;\r\n    }\r\n    newQuery(name:string, id:number):Query {\r\n        let query = this.queries[name];\r\n        if (query !== undefined) return query;\r\n        query = this.queries[name] = new Query(this, name, id)\r\n\t\tthis.setEntity(name, query);\r\n        this.queryArr.push(query);\r\n        return query;\r\n    }\r\n    private newBook(name:string, id:number):Book {\r\n        let book = this.books[name];\r\n        if (book !== undefined) return book;\r\n        book = this.books[name] = new Book(this, name, id);\r\n\t\tthis.setEntity(name, book);\r\n        this.bookArr.push(book);\r\n        return book;\r\n    }\r\n    private newMap(name:string, id:number):Map {\r\n        let map = this.maps[name];\r\n        if (map !== undefined) return map;\r\n        map = this.maps[name] = new Map(this, name, id)\r\n\t\tthis.setEntity(name, map);\r\n        this.mapArr.push(map);\r\n        return map;\r\n    }\r\n    private newTag(name:string, id:number):Tag {\r\n        let tag = this.tags[name];\r\n        if (tag !== undefined) return tag;\r\n        tag = this.tags[name] = new Tag(this, name, id)\r\n\t\tthis.setEntity(name, tag);\r\n        this.tagArr.push(tag);\r\n        return tag;\r\n    }\r\n    private newHistory(name:string, id:number):History {\r\n        let history = this.histories[name];\r\n        if (history !== undefined) return;\r\n        history = this.histories[name] = new History(this, name, id)\r\n\t\tthis.setEntity(name, history);\r\n        this.historyArr.push(history);\r\n        return history;\r\n    }\r\n    private newPending(name:string, id:number):Pending {\r\n        let pending = this.pendings[name];\r\n        if (pending !== undefined) return;\r\n        pending = this.pendings[name] = new Pending(this, name, id)\r\n\t\tthis.setEntity(name, pending);\r\n        this.pendingArr.push(pending);\r\n        return pending;\r\n    }\r\n    private newSheet(name:string, id:number):Sheet {\r\n        let sheet = this.sheets[name];\r\n        if (sheet !== undefined) return sheet;\r\n        sheet = this.sheets[name] = new Sheet(this, name, id);\r\n\t\tthis.setEntity(name, sheet);\r\n        this.sheetArr.push(sheet);\r\n        return sheet;\r\n    }\r\n    private newID(name:string, id:number):ID {\r\n\t\tlet lName = name.toLowerCase();\r\n        let idEntity = this.ids[lName];\r\n        if (idEntity !== undefined) return idEntity;\r\n        idEntity = this.ids[lName] = new ID(this, name, id);\r\n\t\tthis.setEntity(name, idEntity);\r\n        this.idArr.push(idEntity);\r\n        return idEntity;\r\n    }\r\n    private newIDX(name:string, id:number):IDX {\r\n\t\tlet lName = name.toLowerCase();\r\n        let idx = this.idxs[lName];\r\n        if (idx !== undefined) return idx;\r\n        idx = this.idxs[lName] = new IDX(this, name, id);\r\n\t\tthis.setEntity(name, idx);\r\n        this.idxArr.push(idx);\r\n        return idx;\r\n    }\r\n    private newIX(name:string, id:number):IX {\r\n\t\tlet lName = name.toLowerCase();\r\n        let ix = this.ixs[lName];\r\n        if (ix !== undefined) return ix;\r\n        ix = this.ixs[lName] = new IX(this, name, id);\r\n\t\tthis.setEntity(name, ix);\r\n        this.ixArr.push(ix);\r\n        return ix;\r\n    }\r\n    private fromType(name:string, type:string) {\r\n        let parts = type.split('|');\r\n        type = parts[0];\r\n        let id = Number(parts[1]);\r\n        switch (type) {\r\n            //case 'uq': this.id = id; break;\r\n            case 'tuid':\r\n                // Tuid should not be created here!;\r\n                //let tuid = this.newTuid(name, id);\r\n                //tuid.sys = false;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'id': this.newID(name, id); break;\r\n\t\t\tcase 'idx': this.newIDX(name, id); break;\r\n\t\t\tcase 'ix': this.newIX(name, id); break;\r\n            case 'action': this.newAction(name, id); break;\r\n            case 'query': this.newQuery(name, id); break;\r\n            case 'book': this.newBook(name, id); break;\r\n            case 'map': this.newMap(name, id); break;\r\n            case 'history': this.newHistory(name, id); break;\r\n            case 'sheet':this.newSheet(name, id); break;\r\n\t\t\tcase 'pending': this.newPending(name, id); break;\r\n\t\t\tcase 'tag': this.newTag(name, id); break;\r\n\t\t\tcase 'enum': this.newEnum(name, id); break;\r\n        }\r\n    }\r\n    private fromObj(name:string, obj:any) {\r\n        switch (obj['$']) {\r\n            case 'sheet': this.buildSheet(name, obj); break;\r\n        }\r\n    }\r\n    private buildSheet(name:string, obj:any) {\r\n        let sheet = this.sheets[name];\r\n        if (sheet === undefined) sheet = this.newSheet(name, obj.id);\r\n        sheet.build(obj);\r\n    }\r\n    buildFieldTuid(fields:Field[], mainFields?:Field[]) {\r\n        if (fields === undefined) return;\r\n        for (let f of fields) {\r\n            let {tuid} = f;\r\n            if (tuid === undefined) continue;\r\n            let t = this.getTuid(tuid);\r\n            if (t === undefined) continue;\r\n            f._tuid = t.buildTuidBox();\r\n        }\r\n        for (let f of fields) {\r\n            let {owner} = f;\r\n            if (owner === undefined) continue;\r\n            let ownerField = fields.find(v => v.name === owner);\r\n            if (ownerField === undefined) {\r\n                if (mainFields !== undefined) {\r\n                    ownerField = mainFields.find(v => v.name === owner);\r\n                }\r\n                if (ownerField === undefined) {\r\n                    debugger;\r\n                    throw new Error(`owner field ${owner} is undefined`);\r\n                }\r\n            }\r\n            let {arr, tuid} = f;\r\n            let t = this.getTuid(ownerField._tuid.tuid.name);\r\n            if (t === undefined) continue;\r\n            let div = t.div(arr || tuid);\r\n            f._tuid = div && div.buildTuidDivBox(ownerField);\r\n            if (f._tuid === undefined) {\r\n                debugger;\r\n                throw new Error(`owner field ${owner} is not tuid`);\r\n            }\r\n        }\r\n    }\r\n    buildArrFieldsTuid(arrFields:ArrFields[], mainFields:Field[]) {\r\n        if (arrFields === undefined) return;\r\n        for (let af of arrFields) {\r\n            let {fields} = af;\r\n            if (fields === undefined) continue;\r\n            this.buildFieldTuid(fields, mainFields);\r\n        }\r\n    }\r\n\r\n    pullModify(modifyMax:number) {\r\n        this.tuidsCache.pullModify(modifyMax);\r\n\t}\r\n\r\n\tgetUqKey() {\r\n\t\t//let l = this.uqName.toLowerCase();\r\n\t\tlet uqKey:string = this.uqName.split(/[-._]/).join('').toLowerCase();\r\n\t\tif (this.config) {\r\n\t\t\tlet {dev} = this.config;\r\n\t\t\tuqKey = capitalCase(dev.alias || dev.name) + capitalCase(uqKey);\r\n\t\t}\r\n\t\treturn uqKey;\r\n\t}\r\n\r\n\tcreateProxy():any {\r\n\t\tlet ret = new Proxy(this.entities, {\r\n\t\t\tget: (target, key, receiver) => {\r\n\t\t\t\tlet lk = (key as string).toLowerCase();\r\n\t\t\t\tif (lk === '$') {\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t}\r\n\t\t\t\tlet ret = target[lk];\r\n\t\t\t\tif (ret !== undefined) return ret;\r\n\t\t\t\tswitch (key) {\r\n\t\t\t\t\tdefault: debugger; break;\r\n\t\t\t\t\tcase 'Acts': return this.Acts;\r\n\t\t\t\t\tcase 'ActIX': return this.ActIX;\r\n\t\t\t\t\tcase 'ActIXSort': return this.ActIXSort;\r\n\t\t\t\t\tcase 'IDDetail': return this.ActDetail;\r\n\t\t\t\t\tcase 'IDNO': return this.IDNO;\r\n\t\t\t\t\tcase 'IDDetailGet': return this.IDDetailGet;\r\n\t\t\t\t\tcase 'ID': return this.ID;\r\n\t\t\t\t\tcase 'KeyID': return this.KeyID;\r\n\t\t\t\t\tcase 'IX': return this.IX;\r\n\t\t\t\t\tcase 'IXr': return this.IXr;\r\n\t\t\t\t\tcase 'KeyIX': return this.KeyIX;\r\n\t\t\t\t\tcase 'IDLog': return this.IDLog;\r\n\t\t\t\t\tcase 'IDSum': return this.IDSum;\r\n\t\t\t\t\tcase 'IDinIX': return this.IDinIX;\r\n\t\t\t\t\tcase 'IDxID': return this.IDxID;\r\n\t\t\t\t\tcase 'IDTree': return this.IDTree;\r\n\t\t\t\t}\r\n\t\t\t\tlet err = `entity ${this.name}.${String(key)} not defined`;\r\n\t\t\t\tconsole.error(err);\r\n\t\t\t\tthis.showReload('UQ错误：' + err);\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.proxy = ret;\r\n\t\treturn ret;\r\n\t}\r\n\r\n    private showReload(msg: string) {\r\n\t\tthis.localMap.removeAll();\r\n\t\tnav.showReloadPage(msg);\r\n    }\r\n\r\n\t//private coms:any;\r\n\t//private setComs = (coms: any) => {this.coms = coms;}\r\n\tprivate Acts = async (param:any): Promise<any> => {\r\n\t\t// 这边的obj属性序列，也许会不一样\r\n\t\tlet arr:string[] = [];\r\n\t\tlet apiParam:any = {};\r\n\t\tfor (let i in param) {\r\n\t\t\tarr.push(i);\r\n\t\t\tapiParam[i] = (param[i] as any[]).map(v => {\r\n\t\t\t\tlet obj:any = {};\r\n\t\t\t\tfor (let j in v) {\r\n\t\t\t\t\tlet val = v[j];\r\n\t\t\t\t\tif (typeof val === 'object') {\r\n\t\t\t\t\t\tlet nv:any = {};\r\n\t\t\t\t\t\tfor (let n in val) {\r\n\t\t\t\t\t\t\tlet tv = val[n];\r\n\t\t\t\t\t\t\tif (tv && typeof tv === 'object') {\r\n\t\t\t\t\t\t\t\tif (n === 'time') {\r\n\t\t\t\t\t\t\t\t\tif (Object.prototype.toString.call(tv) === '[object Date]') {\r\n\t\t\t\t\t\t\t\t\t\ttv = (tv as Date).getTime();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tlet id = tv['id'];\r\n\t\t\t\t\t\t\t\t\ttv = id;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tnv[n] = tv;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tobj[j] = nv;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tobj[j] = val;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn obj;\r\n\t\t\t});\r\n\t\t}\r\n\t\tapiParam['$'] = arr;\r\n\t\tlet ret = await this.uqApi.post(IDPath('acts'), apiParam);\r\n\t\tlet retArr = (ret[0].ret as string).split('\\n');\r\n\t\tlet retActs:{[key:string]:number[]} = {};\r\n\t\tfor (let i=0; i<arr.length; i++) {\r\n\t\t\tretActs[arr[i]] = ids(retArr[i].split('\\t'));\r\n\t\t}\r\n\t\treturn retActs;\r\n\t}\r\n\r\n\tprivate ActIX = async (param: ParamActIX<any>): Promise<number[]> => {\r\n\t\tlet {IX, ID, values} = param;\r\n\t\tlet apiParam:any = {\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tID: entityName(ID),\r\n\t\t\tvalues,\r\n\t\t};\r\n\t\tlet ret = await this.uqApi.post(IDPath('act-ix'), apiParam);\r\n\t\treturn (ret[0].ret as string).split('\\t').map(v => Number(v));\r\n\t}\r\n\r\n\tprivate ActIXSort = async (param: ParamActIXSort): Promise<void> => {\r\n\t\tlet {IX, ix, id, after} = param;\r\n\t\tlet apiParam:any = {\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tix,\r\n\t\t\tid,\r\n\t\t\tafter,\r\n\t\t};\r\n\t\tawait this.uqApi.post(IDPath('act-ix-sort'), apiParam);\r\n\t}\r\n\r\n\tprivate ActDetail = async (param: ParamActDetail<any, any>): Promise<any> => {\r\n\t\tlet {master, detail, detail2, detail3} = param as unknown as ParamActDetail3<any, any, any, any>;\r\n\t\tlet postParam:any = {\r\n\t\t\tmaster: {\r\n\t\t\t\tname: entityName(master.ID),\r\n\t\t\t\tvalue: toScalars(master.value),\r\n\t\t\t},\r\n\t\t\tdetail: {\r\n\t\t\t\tname: entityName(detail.ID),\r\n\t\t\t\tvalues: detail.values?.map(v => toScalars(v)),\r\n\t\t\t},\r\n\t\t}\r\n\t\tif (detail2) {\r\n\t\t\tpostParam.detail2 = {\r\n\t\t\t\tname: entityName(detail2.ID),\r\n\t\t\t\tvalues: detail2.values?.map(v => toScalars(v)),\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (detail3) {\r\n\t\t\tpostParam.detail3 = {\r\n\t\t\t\tname: entityName(detail3.ID),\r\n\t\t\t\tvalues: detail3.values?.map(v => toScalars(v)),\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet ret = await this.uqApi.post(IDPath('act-detail'), postParam);\r\n\t\tlet val:string = ret[0].ret;\r\n\t\tlet parts = val.split('\\n');\r\n\t\tlet items = parts.map(v => v.split('\\t'));\r\n\t\tret = {\r\n\t\t\tmaster: ids(items[0])[0],\r\n\t\t\tdetail: ids(items[1]),\r\n\t\t\tdetail2: ids(items[2]),\r\n\t\t\tdetail3: ids(items[3]),\r\n\t\t};\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate IDNO = async (param: ParamIDNO): Promise<string> => {\r\n\t\tlet {ID} = param;\r\n\t\tlet ret = await this.uqApi.post(IDPath('id-no'), {ID: entityName(ID)});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate IDDetailGet = async (param: ParamIDDetailGet): Promise<any> => {\r\n\t\tlet {id, master, detail, detail2, detail3} = param;\r\n\t\tlet ret = await this.uqApi.post(IDPath('id-detail-get'), {\r\n\t\t\tid,\r\n\t\t\tmaster: entityName(master),\r\n\t\t\tdetail: entityName(detail),\r\n\t\t\tdetail2: entityName(detail2),\r\n\t\t\tdetail3: entityName(detail3),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\t//private checkParam(ID:ID, IDX:(ID|IDX)|(ID|IDX)[], IX:IX, id:number|number[], key:{[key:string]:string|number}, page: ParamPage) {\r\n\t//}\r\n\tprivate IDXToString(p:ID|IDX|((ID|IDX)[])):string|string[] {\r\n\t\tif (Array.isArray(p) === true) return (p as (ID|IDX)[]).map(v => entityName(v));\r\n\t\treturn entityName(p as ID|IDX);\r\n\t}\r\n\tprivate ID = async (param: ParamID): Promise<any[]> => {\r\n\t\tlet {IDX} = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('id'), {\r\n\t\t\t...param,\r\n\t\t\tIDX: this.IDXToString(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprivate KeyID = async (param: ParamKeyID): Promise<any[]> => {\r\n\t\tlet {ID, IDX} = param;\r\n\t\t//this.checkParam(null, IDX, null, null, key, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('key-id'), {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprivate IX = async (param: ParamIX): Promise<any[]> => {\r\n\t\tlet {IX, IX1, IDX} = param;\r\n\t\t//this.checkParam(null, IDX, IX, id, null, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('ix'), {\r\n\t\t\t...param,\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tIX1: entityName(IX1),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprivate IXr = async (param: ParamIX): Promise<any[]> => {\r\n\t\tlet {IX, IX1, IDX} = param;\r\n\t\t//this.checkParam(null, IDX, IX, id, null, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('ixr'), {\r\n\t\t\t...param,\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tIX1: entityName(IX1),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprivate KeyIX = async (param: ParamKeyIX): Promise<any[]> => {\r\n\t\tlet {ID, IX, IDX} = param;\r\n\t\t//this.checkParam(ID, IDX, IX, null, key, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('key-ix'), {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprivate IDLog = async (param: ParamIDLog): Promise<any[]> => {\r\n\t\tlet {IDX} = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('id-log'), {\r\n\t\t\t...param,\r\n\t\t\tIDX: entityName(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprivate IDSum = async (param: ParamIDSum): Promise<any[]> => {\r\n\t\tlet {IDX} = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('id-sum'), {\r\n\t\t\t...param,\r\n\t\t\tIDX: entityName(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprivate IDinIX = async (param:ParamIDinIX): Promise<any|{$in:boolean}[]> => {\r\n\t\tlet {ID, IX} = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('id-in-ix'), {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: entityName(IX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprivate IDxID = async (param:ParamIDxID): Promise<any[]> => {\r\n\t\tlet {ID, IX, ID2} = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('id-x-id'), {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tID2: entityName(ID2),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate IDTree = async (param:ParamIDTree): Promise<any[]> => {\r\n\t\tlet {ID} = param;\r\n\t\tlet ret = await this.uqApi.post(IDPath('id-tree'), {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n}\r\n\r\nfunction ids(item:string[]):number[] {\r\n\tif (!item) return;\r\n\tlet len = item.length;\r\n\tif (len <= 1) return;\r\n\tlet ret:number[] = [];\r\n\tfor (let i=0; i<len-1; i++) ret.push(Number(item[i]));\r\n\treturn ret;\r\n}\r\n\r\nfunction entityName(entity:Entity | string): string {\r\n\tif (!entity) return;\r\n\tif (typeof entity === 'string') return entity;\r\n\treturn entity.name;\r\n}\r\n\r\nfunction toScalars(value:any):any {\r\n\tif (!value) return value;\r\n\tlet ret:any = {};\r\n\tfor (let i in value) {\r\n\t\tlet v = value[i];\r\n\t\tif (typeof v === 'object') v = v['id'];\r\n\t\tret[i] = v;\r\n\t}\r\n\treturn ret;\r\n}","import { Entity } from './entity';\r\nimport { PageItems } from '../tool/pageItems';\r\nimport { EntityCaller } from './caller';\r\nimport { ArrFields } from './uqMan';\r\n\r\nexport interface SheetState {\r\n    name: string;\r\n    actions: SheetAction[];\r\n}\r\n\r\nexport interface SheetAction {\r\n    name: string;\r\n}\r\n\r\nexport interface StateCount {\r\n    state: string;\r\n    count: number;\r\n}\r\n\r\nexport interface SheetSaveReturnV<V> {\r\n\tid: number;\r\n\tflow: number;\r\n\tstate: string;\r\n\tverify: V[];\r\n}\r\n\r\nexport interface SheetSaveReturn extends SheetSaveReturnV<any> {\r\n}\r\n\r\ninterface GetSheetReturn<M> {\r\n\tbrief: any;\r\n\tdata: M;\r\n\tflows: any[];\r\n}\r\n\r\nexport class UqSheet<M, V> extends Entity {\r\n    get typeName(): string { return 'sheet';}\r\n\tstates: SheetState[];\r\n\tverify: {returns: ArrFields[]};\r\n\r\n    /*\r\n    setStates(states: SheetState[]) {\r\n        for (let state of states) {\r\n            this.setStateAccess(this.states.find(s=>s.name==state.name), state);\r\n        }\r\n    }*/\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n\t\tthis.states = schema.states;\r\n\t\tthis.verify = schema.verify;\r\n    }\r\n    build(obj:any) {\r\n        this.states = [];\r\n        for (let op of obj.ops) {\r\n            this.states.push({name: op, actions:undefined});\r\n        }\r\n        /*\r\n        for (let p in obj) {\r\n            switch(p) {\r\n                case '#':\r\n                case '$': continue;\r\n                default: this.states.push(this.createSheetState(p, obj[p])); break;\r\n            }\r\n        }*/\r\n    }\r\n    private createSheetState(name:string, obj:object):SheetState {\r\n        let ret:SheetState = {name:name, actions:[]};\r\n        let actions = ret.actions;\r\n        for (let p in obj) {\r\n            let action:SheetAction = {name: p};\r\n            actions.push(action);\r\n        }\r\n        return ret;\r\n    }\r\n    async save(discription:string, data:M):Promise<SheetSaveReturnV<V>> {\r\n        let {id} = this.uq;\r\n        let params = {app: id, discription: discription, data:data};\r\n        return await new SaveCaller(this, params).request();\r\n    }\r\n    async saveDebugDirect(discription:string, data:M):Promise<SheetSaveReturn> {\r\n        let {id} = this.uq;\r\n        let params = {app: id, discription: discription, data:data};\r\n        return await new SaveDirectCaller(this, params).request();\r\n    }\r\n    async action(id:number, flow:number, state:string, action:string) {\r\n        return await new ActionCaller(this, {id:id, flow:flow, state:state, action:action}).request();\r\n    }\r\n    async actionDebugDirect(id:number, flow:number, state:string, action:string) {\r\n        return await new ActionDirectCaller(this, {id:id, flow:flow, state:state, action:action}).request();\r\n    }\r\n    private unpack(data:any):GetSheetReturn<M> {\r\n        //if (this.schema === undefined) await this.loadSchema();\r\n        let ret = data[0];\r\n        let brief = ret[0];\r\n        let sheetData = this.unpackSheet(brief.data);\r\n        let flows = data[1];\r\n        return {\r\n            brief: brief,\r\n            data: sheetData,\r\n            flows: flows,\r\n        }\r\n    }\r\n    async getSheet(id:number):Promise<GetSheetReturn<M>> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.getSheet(this.name, id);\r\n        */\r\n        let ret = await new GetSheetCaller(this, id).request();\r\n        if (ret[0].length === 0) return await this.getArchive(id);\r\n        return this.unpack(ret);\r\n    }\r\n    async getArchive(id:number):Promise<GetSheetReturn<M>> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.sheetArchive(this.name, id)\r\n        return this.unpack(ret);\r\n        */\r\n        let ret = await new SheetArchiveCaller(this, id).request();\r\n        return this.unpack(ret);\r\n    }\r\n\r\n    async getArchives(pageStart:number, pageSize:number) {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.sheetArchives(this.name, {pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {pageStart:pageStart, pageSize:pageSize};\r\n        return await new SheetArchivesCaller(this, params).request();\r\n    }\r\n\r\n    async getStateSheets(state:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.stateSheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {state:state, pageStart:pageStart, pageSize:pageSize};\r\n        return await new StateSheetsCaller(this, params).request();\r\n    }\r\n    createPageStateItems<T>(): PageStateItems<T> {return new PageStateItems<T>(this);}\r\n\r\n    async stateSheetCount():Promise<StateCount[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret:StateCount[] = await this.uqApi.stateSheetCount(this.name);\r\n        return this.states.map(s => {\r\n            let n = s.name, count = 0;\r\n            let r = ret.find(v => v.state === n);\r\n            if (r !== undefined) count = r.count;\r\n            return {state: n, count: count} \r\n        });\r\n        */\r\n        return await new StateSheetCountCaller(this, undefined).request();\r\n    }\r\n\r\n    async userSheets(state:string, user:number, pageStart:number, pageSize:number):Promise<any[]> {\r\n        let params = {state:state, user:user, pageStart:pageStart, pageSize:pageSize};\r\n        return await new UserSheetsCaller(this, params).request();\r\n    }\r\n\r\n    async mySheets(state:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.mySheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {state:state, pageStart:pageStart, pageSize:pageSize};\r\n        return await new MySheetsCaller(this, params).request();\r\n    }\r\n}\r\n\r\nexport class Sheet extends UqSheet<any, any> {\r\n}\r\n\r\nabstract class SheetCaller<T> extends EntityCaller<T> {\r\n    protected get entity(): Sheet {return this._entity as Sheet;}\r\n    protected readonly suffix:string;\r\n    get path():string {return `sheet/${this.entity.name}/${this.suffix}`;}\r\n}\r\n\r\nclass SaveCaller extends SheetCaller<{app:number; discription:string; data:any}> {\r\n    get path():string {return `sheet/${this.entity.name}`;}\r\n    buildParams() {\r\n        let {app, discription, data} = this.params;\r\n        return {\r\n            app: app,\r\n            discription: discription,\r\n            data: this.entity.pack(data)\r\n        };\r\n    }\r\n    xresult(res:any):any {\r\n\t\tlet {verify} = this.entity;\r\n\t\tif (verify === undefined) return res;\r\n\t\tlet resVerify = res.verify;\r\n\t\tif (resVerify === undefined || resVerify.length === 0) {\r\n\t\t\tres.verify = undefined;\r\n\t\t\treturn res;\r\n\t\t}\r\n\t\tlet {returns} = verify;\r\n\t\tres.verify = this.entity.unpackReturns(resVerify, returns);\r\n        return res;\r\n    }\r\n}\r\n\r\nclass SaveDirectCaller extends SaveCaller {\r\n    get path():string {return `sheet/${this.entity.name}/direct`;}\r\n}\r\n\r\nclass ActionCaller extends SheetCaller<{id:number, flow:number, state:string, action:string}> {\r\n    method = 'PUT';\r\n    get path():string {return `sheet/${this.entity.name}`;}\r\n}\r\n\r\nclass ActionDirectCaller extends ActionCaller {\r\n    get path():string {return `sheet/${this.entity.name}/direct`;}\r\n}\r\n\r\nclass GetSheetCaller extends SheetCaller<number> {\r\n    //protected readonly params: number;  // id\r\n    method = 'GET';\r\n    //private id:number;\r\n    //protected readonly suffix = 'archive';\r\n    buildParams() {}\r\n    get path():string {return `sheet/${this.entity.name}/get/${this.params}`;}\r\n}\r\n\r\nclass SheetArchiveCaller extends SheetCaller<number> {\r\n    //protected readonly params: number;  // id\r\n    method = 'GET';\r\n    //protected readonly suffix = 'archive';\r\n    buildParams() {}\r\n    get path():string {return `sheet/${this.entity.name}/archive/${this.params}`;}\r\n}\r\n\r\nclass SheetArchivesCaller extends SheetCaller<{pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'archives';\r\n}\r\n\r\nclass StateSheetsCaller extends SheetCaller<{state:string, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'states';\r\n}\r\n\r\nclass StateSheetCountCaller extends SheetCaller<undefined> {\r\n    method = 'GET';\r\n    protected readonly suffix = 'statecount';\r\n    xresult(res:any):any {\r\n        let {states} = this.entity;\r\n        return states.map(s => {\r\n            let n = s.name, count = 0;\r\n            let r = (res as any[]).find(v => v.state === n);\r\n            if (r !== undefined) count = r.count;\r\n            return {state: n, count: count} \r\n        });\r\n    }\r\n}\r\n\r\nclass UserSheetsCaller extends SheetCaller<{state:string, user:number, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'user-sheets';\r\n    xresult(res:any):any {\r\n        return res;\r\n    }\r\n}\r\n\r\nclass MySheetsCaller extends SheetCaller<{state:string, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'my-sheets';\r\n    xresult(res:any):any {\r\n        return res;\r\n    }\r\n}\r\n\r\nexport class PageStateItems<T> extends PageItems<T> {\r\n    private sheet: Sheet;\r\n    constructor(sheet: Sheet) {\r\n        super(true);\r\n        this.sheet = sheet;\r\n        this.pageSize = 10;\r\n\t}\r\n\tprotected async loadResults(param:any, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.sheet.getStateSheets(param, pageStart, pageSize);\r\n\t\treturn {$page: ret};\r\n\t}\r\n\t/*\r\n    protected async load(param:any, pageStart:any, pageSize:number):Promise<any[]> {\r\n        let ret = await this.sheet.getStateSheets(param, pageStart, pageSize);\r\n        return ret;\r\n\t}\r\n\t*/\r\n\tprotected getPageId(item:T) {\r\n\t\treturn item === undefined? 0 : (item as any).id;\r\n\t}\r\n\t/*\r\n    protected setPageStart(item:any) {\r\n        this.pageStart = item === undefined? 0 : item.id;\r\n\t}\r\n\t*/\r\n}\r\n","import { UqQuery} from './query';\r\nimport { QueryQueryCaller } from './caller';\r\n\r\nexport class UqBook<P, R> extends UqQuery<P, R> {\r\n    get typeName(): string { return 'book';}\r\n    protected queryApiName = 'book';\r\n\r\n    protected queryCaller(params: any): QueryQueryCaller {\r\n        return new BookQueryCaller(this, params);\r\n    }\r\n}\r\n\r\nexport class Book extends UqBook<any, any> {\r\n}\r\n\r\nexport class BookQueryCaller extends QueryQueryCaller {\r\n    get path():string {return `book/${this.entity.name}`;}\r\n}\r\n","import { UqQuery } from './query';\r\n\r\nexport class UqHistory<P,R> extends UqQuery<P,R>  {\r\n    get typeName(): string { return 'history';}\r\n    protected queryApiName = 'history';\r\n}\r\n\r\nexport class History extends UqHistory<any, any> {\r\n}\r\n","import { Entity } from './entity';\r\nimport { Action, ActionSubmitCaller } from './action';\r\nimport { Query } from './query';\r\nimport { Field } from './uqMan';\r\nimport { EntityCaller, QueryPageCaller, QueryQueryCaller } from './caller';\r\n\r\ninterface MapActions {\r\n    add: Action;\r\n    del: Action;\r\n}\r\ninterface MapQueries {\r\n    all: Query;\r\n    page: Query;\r\n    query: Query;\r\n}\r\n\r\nexport class UqMap extends Entity {\r\n    get typeName(): string { return 'map';}\r\n    keys: Field[];\r\n    actions: MapActions = {} as any;\r\n    queries: MapQueries = {} as any;\r\n    schemaFrom: {owner:string; uq:string};\r\n\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        this.schemaFrom = this.schema.from;\r\n        let {actions, queries, keys} = schema;\r\n        this.uq.buildFieldTuid(this.keys = keys);\r\n        for (let i in actions) {\r\n            let actionSchema = actions[i];\r\n            let {name} = actionSchema;\r\n            let action = this.uq.newAction(name, undefined);\r\n            action.setSchema(actionSchema);\r\n            action.buildFieldsTuid();\r\n            (this.actions as any)[i] = action;\r\n        }\r\n        for (let i in queries) {\r\n            let querySchema = queries[i];\r\n            let {name} = querySchema;\r\n            let query = this.uq.newQuery(name, undefined);\r\n            query.setSchema(querySchema);\r\n            query.buildFieldsTuid();\r\n            (this.queries as any)[i] = query;\r\n        }\r\n    }\r\n\r\n    async add(param:any) {\r\n        let ret = await new AddCaller(this, param).request();\r\n        return ret;\r\n    }\r\n\r\n    async del(param:any) {\r\n        let ret = await new DelCaller(this, param).request();\r\n        return ret;\r\n    }\r\n\r\n    async all() {\r\n        let ret = await new AllCaller(this, undefined).request();\r\n        return ret;\r\n    }\r\n\r\n    async page(param:any, pageStart:any, pageSize: number) {\r\n        let ret = await new PageCaller(this, {pageStart:pageStart, pageSize:pageSize, param:param}).request();\r\n        return ret;\r\n    }\r\n\r\n    async query(param:any) {\r\n       let qc = new QueryCaller(this, param);\r\n       let ret = await qc.request();\r\n       return ret;\r\n   }\r\n    async table(params:any): Promise<any[]> {\r\n        let ret = await this.query(params);\r\n        for (let i in ret) {\r\n            return ret[i];\r\n        }\r\n    }\r\n    async obj(params:any):Promise<any> {\r\n        let ret = await this.table(params);\r\n        if (ret.length > 0) return ret[0];\r\n    }\r\n    async scalar(params:any):Promise<any> {\r\n        let ret = await this.obj(params);\r\n        for (let i in ret) return ret[i];\r\n    }\r\n}\r\n\r\nexport class Map extends UqMap {\r\n}\r\n\r\nabstract class MapCaller extends EntityCaller<any> {\r\n    protected get entity(): Map {return this._entity as Map;}\r\n    get path():string {return undefined;}\r\n\r\n    protected abstract getCaller(param: any):EntityCaller<any>;\r\n\r\n    protected async innerCall(): Promise<any> {\r\n        let caller = this.getCaller(this.params);\r\n        let res = await this.entity.uqApi.xcall(caller);\r\n        let ret = caller.xresult(res.res);\r\n        return {res: ret};\r\n    }\r\n\r\n    buildParams() {\r\n        let p = super.buildParams();\r\n        return p;\r\n    }\r\n}\r\n\r\nclass AddCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapAddCaller(this.entity, this.entity.actions.add, param);\r\n    }\r\n}\r\n\r\nclass DelCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapDelCaller(this.entity, this.entity.actions.add, param);\r\n    }\r\n}\r\n\r\nclass AllCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapAllCaller(this.entity, this.entity.queries.all, param);\r\n    }\r\n}\r\n\r\nclass PageCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapPageCaller(this.entity, this.entity.queries.page, param);\r\n    }\r\n}\r\n\r\nclass QueryCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapQueryCaller(this.entity, this.entity.queries.query, param);\r\n    }\r\n}\r\n\r\nclass MapAddCaller extends ActionSubmitCaller {\r\n    private map: Map;\r\n    constructor(map:Map, action:Action, params:any) {\r\n        super(action, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/add`}\r\n    get headers(): {[header:string]: string} {return undefined;}\r\n}\r\n\r\nclass MapDelCaller extends ActionSubmitCaller {\r\n    private map: Map;\r\n    constructor(map:Map, action:Action, params:any) {\r\n        super(action, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/del`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapAllCaller extends QueryPageCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/all`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapPageCaller extends QueryPageCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/page`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapQueryCaller extends QueryQueryCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/query`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n","import { UqQuery } from './query';\r\n\r\nexport class UqPending<P,R> extends UqQuery<P,R>  {\r\n    get typeName(): string { return 'pending';}\r\n    protected queryApiName = 'pending';\r\n}\r\n\r\nexport class Pending extends UqPending<any, any> {\r\n}\r\n","import { Entity } from \"./entity\";\r\n\r\nexport class UqEnum extends Entity {\r\n    get typeName(): string { return 'enum';}\r\n}","/*eslint @typescript-eslint/no-unused-vars: [\"off\", { \"vars\": \"all\" }]*/\r\nimport * as React from 'react';\r\nimport { VPage, Page, List } from 'tonva-react';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport RC2 from 'react-chartjs-2'\r\nimport { GFunc } from './GFunc';\r\nimport { CStockInfo } from './CStockInfo'\r\nimport { StockCapitalearning, StockBonus } from './StockInfoType';\r\nimport { renderStockRow } from 'tool';\r\nimport { ErForEarning } from './ErForEarning';\r\nimport { SlrForEarning } from './SlrForEarning';\r\n\r\nexport class VStockInfo extends VPage<CStockInfo> {\r\n    private input: HTMLInputElement;\r\n    private key: string = undefined;\r\n\r\n    async open(param?: any) {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    @observable protected ttmLimit: boolean = false;\r\n\r\n    render(param: any): JSX.Element {\r\n        return this.page();\r\n    }\r\n\r\n    checkLimitShow = (e: any) => {\r\n        let check = e.target.checked as boolean;\r\n        this.ttmLimit = check;\r\n    }\r\n\r\n    checkShowLater = (e: any) => {\r\n        let check = e.target.checked as boolean;\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { openMetaView, baseItem, isLogined } = this.controller;\r\n        let { name, code, day } = baseItem;\r\n        let viewMetaButton = <></>;\r\n        if (isLogined) {\r\n            viewMetaButton = <button type=\"button\" className=\"btn w-100\" onClick={openMetaView}>view</button>\r\n        }\r\n\r\n\t\tlet headStr = name + ' ' + code;\r\n        if (day !== undefined) {\r\n            headStr += ' - ' + day;\r\n        }\r\n        let head = <div >{headStr}</div>\r\n        return <Page header={head}\r\n            headerClassName='bg-primary'>\r\n            {React.createElement(this.pageContent)}\r\n        </Page>;\r\n    })\r\n\r\n    private pageContent = observer(() => {\r\n        return <>\r\n            {React.createElement(this.baseInfo)}\r\n            {this.historyChart()}\r\n            {React.createElement(this.predictInfo)}\r\n            {React.createElement(this.predictSeasonEarning)}\r\n            {React.createElement(this.seasonEarning)}\r\n            {React.createElement(this.capitalEarning)}\r\n            {React.createElement(this.bonus)}\r\n        </>\r\n    });\r\n\r\n    private onChange = (evt: React.ChangeEvent<any>) => {\r\n        let v = evt.target.value;\r\n        let n = Number(v);\r\n        if (isNaN(n) === true || !Number.isInteger(n)) {\r\n            if (this.input) {\r\n                this.input.value = this.key;\r\n            }\r\n            return;\r\n        }\r\n        this.key = evt.target.value;\r\n        if (this.key !== undefined) {\r\n            this.key = this.key.trim();\r\n            if (this.key === '') this.key = undefined;\r\n        }\r\n    }\r\n\r\n    private baseInfo = observer(() => {\r\n        let { stock, baseItem } = this.controller;\r\n\t\tlet {cCommon} = this.controller.cApp;\r\n\t\tlet pinStock = <div className=\"d-flex align-self-stretch\">\r\n\t\t\t{cCommon.renderStockLink(stock)}\r\n\t\t\t&nbsp;\r\n\t\t\t{cCommon.renderPinStock(stock)}\r\n\t\t\t&nbsp;\r\n\t\t\t{cCommon.renderBlockStock(stock)}\r\n\t\t</div>;\r\n\t\treturn renderStockRow(undefined, stock, undefined, pinStock);\r\n    });\r\n\r\n    private historyChart = () => {\r\n        let { baseItem } = this.controller;\r\n        let { market, code, symbol } = baseItem;\r\n        // if (market === 'HK') {\r\n        //     return undefined;\r\n        // }\r\n        // else {\r\n        //     let urlweek = `https://image.sinajs.cn/newchart/weekly/n/${symbol}.gif`;\r\n        //     let urlmonth = `https://image.sinajs.cn/newchart/monthly/n/${symbol}.gif`\r\n        //     return <div className=\"d-flex\">\r\n        //         <div className=\"px-2\" style={{ width: '50%' }}><img alt=\"\" src={urlweek} /></div>\r\n        //         <div className=\"px-2\" style={{ width: '50%' }}><img alt=\"\" src={urlmonth} /></div>\r\n        //     </div>;\r\n        // }\r\n    }\r\n\r\n    // protected historyChart = observer(() => {\r\n    // \tlet {historyData, baseItem} = this.controller;\r\n    // \tif (historyData === undefined) \r\n    // \treturn <></>;\r\n    // \tlet chartHistory = <></>;\r\n    // \tlet labelList:any[] = [];\r\n    // \tlet priceList:number[] = [];\r\n    // \tlet ttmList:number[] = [];\r\n    // \tfor (let item of historyData) {\r\n    // \tlet {day, price, ttm} = item;\r\n    // \tlabelList.push(day);\r\n    // \tpriceList.push(GFunc.numberToPrecision(price, 4));\r\n    // \tif (ttm <= 0) \r\n    // \t\tttmList.push(undefined);\r\n    // \telse {\r\n    // \t\tif (this.ttmLimit && ttm >= 35) {\r\n    // \t\tttmList.push(35);\r\n    // \t\t}\r\n    // \t\telse {\r\n    // \t\tttmList.push(GFunc.numberToPrecision(ttm, 4));\r\n    // \t\t}\r\n    // \t}\r\n    // \t}\r\n    // \tlet chartdata1 = {\r\n    // \tlabels: labelList,\r\n    // \tdatasets: [\r\n    // \t\t{\r\n    // \t\tlabel: '价格',\r\n    // \t\tdata: priceList,\r\n    // \t\tborderColor:'blue',\r\n    // \t\tbackgroundColor:'skyBlue',\r\n    // \t\tborderWidth: 1,\r\n    // \t\tfill: false,\r\n    // \t\tyAxisID: 'y-axis-1',\r\n    // \t\t},\r\n    // \t\t{\r\n    // \t\tlabel: 'TTM',\r\n    // \t\tdata: ttmList,\r\n    // \t\tborderColor:'red',\r\n    // \t\tbackgroundColor:'pink',\r\n    // \t\tborderWidth: 1,\r\n    // \t\tfill: false,\r\n    // \t\tyAxisID: 'y-axis-2',\r\n    // \t\t}\r\n    // \t]\r\n    // \t};\r\n    // \tlet options = {\r\n    // \tscales:{\r\n    // \t\tyAxes: [{\r\n    // \t\t\ttype: 'linear',\r\n    // \t\t\tdisplay: true,\r\n    // \t\t\tposition: 'left',\r\n    // \t\t\tid: 'y-axis-1',\r\n    // \t\t}, {\r\n    // \t\t\ttype: 'linear',\r\n    // \t\t\tdisplay: true,\r\n    // \t\t\tposition: 'right',\r\n    // \t\t\tid: 'y-axis-2',\r\n    // \t\t\tgridLines: {\r\n    // \t\t\t\tdrawOnChartArea: false\r\n    // \t\t\t}\r\n    // \t\t}],       \r\n    // \t}\r\n    // \t}\r\n    // \tchartHistory = <RC2 data={chartdata1} type='line' options={options} />;\r\n    // \tlet right = <></>;\r\n    // \tif (baseItem.day !== undefined) {\r\n    // \tright = <><label className=\"px-3\"> <input type=\"checkbox\" name=\"showLater\" defaultChecked={false}\r\n    // \t\t\tonChange={this.checkShowLater} />显示后面数据</label>\r\n    // \t\t<label className=\"px-3\"> <input type=\"checkbox\" name=\"selectType\" defaultChecked={this.ttmLimit}\r\n    // \t\tonChange={this.checkLimitShow} />限制TTM显示范围</label>\r\n    // \t\t</>;\r\n\r\n    // \t}\r\n    // \telse {\r\n    // \tright = <label className=\"px-3\"> <input type=\"checkbox\" name=\"selectType\" defaultChecked={this.ttmLimit}\r\n    // \t\tonChange={this.checkLimitShow} />限制TTM显示范围</label>;\r\n    // \t}\r\n    // \treturn <><LMR className=\"px-3 py-2 bg-white\" left={'历史走势'} right={right}></LMR>\r\n    // \t<div className=\"px-3\" style={{width:'95%'}}>{chartHistory}</div>\r\n    // \t</>;\r\n    // });\r\n\r\n    protected predictInfo = observer(() => {\r\n        let { predictData, ypredict } = this.controller;\r\n        if (predictData === undefined)\r\n            return <></>;\r\n        let { e, b, r2, epre, l, lr2, lpre } = predictData;\r\n        let chart1 = <></>;\r\n        if (ypredict.length === 5) {\r\n            let er = new ErForEarning(ypredict);\r\n            let chartdata1 = {\r\n                labels: ['0', '1', '2', '3', '4'],\r\n                datasets: [\r\n                    {\r\n                        label: '原值',\r\n                        data: ypredict.map(v => GFunc.numberToPrecision(v)),\r\n                        borderColor: 'black',\r\n                        backgroundColor: 'skyBlue',\r\n                        showLine: false,\r\n                        pointStyle: \"crossRot\",\r\n                        borderWidth: 1,\r\n                        pointRadius: 5,\r\n                        fill: false,\r\n                    } as any\r\n                ]\r\n            };\r\n            if (!(isNaN(er.B) || isNaN(er.A))) {\r\n                let per: number[] = [];\r\n                for (let i = 0; i < 5; ++i) {\r\n                    per.push(GFunc.numberToPrecision(er.predict(i), 4));\r\n                }\r\n                chartdata1.datasets.push(\r\n                    {\r\n                        label: '指数回归',\r\n                        data: per,\r\n                        borderColor: 'red',\r\n                        backgroundColor: 'pink',\r\n                        borderWidth: 1,\r\n                        fill: false,\r\n                    });\r\n            }\r\n            let lr = new SlrForEarning(ypredict);\r\n            if (!(isNaN(lr.slope) || isNaN(lr.intercept))) {\r\n                let plr: number[] = [];\r\n                for (let i = 0; i < 5; ++i) {\r\n                    plr.push(GFunc.numberToPrecision(lr.predict(i), 4));\r\n                }\r\n                chartdata1.datasets.push(\r\n                    {\r\n                        label: '线性回归',\r\n                        data: plr,\r\n                        borderColor: 'blue',\r\n                        backgroundColor: 'pink',\r\n                        borderWidth: 1,\r\n                        fill: false,\r\n                    });\r\n            }\r\n            chart1 = <RC2 data={chartdata1} type='line' />;\r\n        }\r\n        let chart2 = this.predictChartFullInfo();\r\n        let chart3 = this.predictChartROE();\r\n        return <><div className=\"px-3 py-2 bg-white\">指数回归预测</div>\r\n            <div className=\"d-flex flex-wrap\">\r\n                <div className=\"px-3 c12\">{GFunc.caption('e')}{GFunc.numberToString(e, 4)}</div>\r\n                <div className=\"px-3 c12\">{GFunc.caption('指数b')}{GFunc.numberToString(b, 4)}</div>\r\n                <div className=\"px-3 c12\">{GFunc.caption('r2')}{GFunc.numberToString(r2, 4)}</div>\r\n                <div className=\"px-3 c12\">{GFunc.caption('e预测')}{GFunc.numberToString(epre)}</div>\r\n            </div>\r\n            <div className=\"px-3 py-2 bg-white\">线性回归预测</div>\r\n            <div className=\"d-flex flex-wrap\">\r\n                <div className=\"px-3 c12\">{GFunc.caption('e')}{GFunc.numberToString(e, 4)}</div>\r\n                <div className=\"px-3 c12\">{GFunc.caption('增长率')}{GFunc.numberToString(l, 4)}</div>\r\n                <div className=\"px-3 c12\">{GFunc.caption('r2')}{GFunc.numberToString(lr2, 4)}</div>\r\n                <div className=\"px-3 c12\">{GFunc.caption('e预测')}{GFunc.numberToString(lpre)}</div>\r\n            </div>\r\n            <div className=\"d-flex\">\r\n                <div className=\"px-2\" style={{ width: '50%' }}>{chart1}</div>\r\n                <div className=\"px-2\" style={{ width: '50%' }}>{chart2}</div>\r\n            </div>\r\n            <div className=\"d-flex\">\r\n                <div className=\"px-2\" style={{ width: '50%' }}>{chart3}</div>\r\n            </div>\r\n        </>;\r\n    });\r\n\r\n    protected predictChartFullInfo = () => {\r\n        let { predictSeasonDataFull } = this.controller;\r\n        let len = predictSeasonDataFull.length;\r\n        if (len <= 0)\r\n            return <></>;\r\n        let label = [];\r\n        let y: number[] = [];\r\n        for (let i = len - 1; i >= 0; --i) {\r\n            let item = predictSeasonDataFull[i];\r\n            if (item.esum === undefined)\r\n                continue;\r\n            label.push(GFunc.SeasonnoToYearMonth(item.season));\r\n            y.push(item.esum);\r\n        }\r\n\r\n        let er = new ErForEarning(y);\r\n        let chartdataFull = {\r\n            labels: label,\r\n            datasets: [\r\n                {\r\n                    label: '原值',\r\n                    data: y.map(v => GFunc.numberToPrecision(v)),\r\n                    borderColor: 'black',\r\n                    backgroundColor: 'skyBlue',\r\n                    showLine: false,\r\n                    pointStyle: \"crossRot\",\r\n                    borderWidth: 1,\r\n                    pointRadius: 5,\r\n                    fill: false,\r\n                } as any\r\n            ]\r\n        };\r\n        if (!(isNaN(er.B) || isNaN(er.A))) {\r\n            let per: number[] = [];\r\n            for (let i = 0; i < len; ++i) {\r\n                per.push(GFunc.numberToPrecision(er.predict(i), 4));\r\n            }\r\n            chartdataFull.datasets.push(\r\n                {\r\n                    label: '指数 R2:' + GFunc.numberToString(er.r2, 4),\r\n                    data: per,\r\n                    borderColor: 'red',\r\n                    backgroundColor: 'pink',\r\n                    borderWidth: 1,\r\n                    fill: false,\r\n                });\r\n        }\r\n        let lr = new SlrForEarning(y);\r\n        if (!(isNaN(lr.slope) || isNaN(lr.intercept))) {\r\n            let plr: number[] = [];\r\n            for (let i = 0; i < len; ++i) {\r\n                plr.push(GFunc.numberToPrecision(lr.predict(i), 4));\r\n            }\r\n            chartdataFull.datasets.push(\r\n                {\r\n                    label: '线性 R2:' + GFunc.numberToString(lr.r2, 4),\r\n                    data: plr,\r\n                    borderColor: 'blue',\r\n                    backgroundColor: 'pink',\r\n                    borderWidth: 1,\r\n                    fill: false,\r\n                });\r\n        }\r\n        return <RC2 data={chartdataFull} type='line' />;\r\n    };\r\n\r\n    protected predictChartROE = () => {\r\n        let { predictSeasonDataFull } = this.controller;\r\n        let len = predictSeasonDataFull.length;\r\n        if (len <= 0)\r\n            return <></>;\r\n        let label = [];\r\n        let y: number[] = [];\r\n        for (let i = len - 1; i >= 0; --i) {\r\n            let item = predictSeasonDataFull[i];\r\n            if (item.esum === undefined)\r\n                continue;\r\n            label.push(GFunc.SeasonnoToYearMonth(item.season));\r\n            y.push(item.esumorg / item.corg);\r\n        }\r\n\r\n        let chartdataFull = {\r\n            labels: label,\r\n            datasets: [\r\n                {\r\n                    label: 'ROE原值',\r\n                    data: y.map(v => GFunc.numberToPrecision(v)),\r\n                    borderColor: 'black',\r\n                    backgroundColor: 'skyBlue',\r\n                    showLine: false,\r\n                    pointStyle: \"crossRot\",\r\n                    borderWidth: 1,\r\n                    pointRadius: 5,\r\n                    fill: false,\r\n                } as any\r\n            ]\r\n        };\r\n        let lr = new SlrForEarning(y);\r\n        if (!(isNaN(lr.slope) || isNaN(lr.intercept))) {\r\n            let plr: number[] = [];\r\n            for (let i = 0; i < len; ++i) {\r\n                plr.push(Number.parseFloat(lr.predict(i).toPrecision(4)));\r\n            }\r\n            chartdataFull.datasets.push(\r\n                {\r\n                    label: '线性 R2:' + GFunc.numberToString(lr.r2, 4),\r\n                    data: plr,\r\n                    borderColor: 'blue',\r\n                    backgroundColor: 'pink',\r\n                    borderWidth: 1,\r\n                    fill: false,\r\n                });\r\n        }\r\n        return <RC2 data={chartdataFull} type='line' />;\r\n    };\r\n\r\n    private predictSeasonEarning = observer(() => {\r\n        let items = this.controller.predictSeasonData;\r\n        let header = <div className=\"px-3\">\r\n            <div className=\"px-3 c6\">年月</div>\r\n            <div className=\"px-3 c6 text-right\">股本</div>\r\n            <div className=\"px-3 c6 text-right\">季收益</div>\r\n            <div className=\"px-3 c6 text-right\">年收益</div>\r\n            <div className=\"px-3 c6 text-right\">ROE</div>\r\n            <div className=\"px-3 c6 text-right\">股本o</div>\r\n            <div className=\"px-3 c6 text-right\">季收益o</div>\r\n            <div className=\"px-3 c6 text-right\">年收益o</div>\r\n        </div>;\r\n        return <>\r\n            <div className=\"px-3 py-1\">历年股本收益-用于回归计算</div>\r\n            <List header={header} loading=\"...\"\r\n                items={items}\r\n                item={{\r\n                    render: (row: { season: number, c: number, e: number, esum: number, corg: number, eorg: number, esumorg: number }) => {\r\n                        let { season, c, e, esum, corg, eorg, esumorg } = row;\r\n                        let ym = GFunc.SeasonnoToYearMonth(season);\r\n                        let a = 0;\r\n                        return <div className=\"px-3 py-2 d-flex flex-wrap\">\r\n                            <div className=\"px-3 c6\">{ym.toString()}</div>\r\n                            <div className=\"px-3 c6 text-right\">{GFunc.numberToFixString(c)}</div>\r\n                            <div className=\"px-3 c6 text-right\">{GFunc.numberToFixString(e)}</div>\r\n                            <div className=\"px-3 c6 text-right\">{GFunc.numberToFixString(esum)}</div>\r\n                            <div className=\"px-3 c6 text-right\">{GFunc.percentToFixString(esum / c)}</div>\r\n                            <div className=\"px-3 c6 text-right\">{GFunc.numberToFixString(corg)}</div>\r\n                            <div className=\"px-3 c6 text-right\">{GFunc.numberToFixString(eorg)}</div>\r\n                            <div className=\"px-3 c6 text-right\">{GFunc.numberToFixString(esumorg)}</div>\r\n                        </div>\r\n                    }\r\n                }}\r\n            />\r\n        </>\r\n    });\r\n\r\n\r\n    private seasonEarning = observer(() => {\r\n        let items = this.controller.seasonData;\r\n        let header = <div className=\"px-3\">\r\n            <div className=\"px-3 c6\">年月</div>\r\n            <div className=\"px-3 c6 text-right\">股本</div>\r\n            <div className=\"px-3 c6 text-right\">季收益</div>\r\n            <div className=\"px-3 c6 text-right\">年收益</div>\r\n            <div className=\"px-3 c6 text-right\">ROE</div>\r\n            <div className=\"px-3 c6 text-right\">股本o</div>\r\n            <div className=\"px-3 c6 text-right\">季收益o</div>\r\n            <div className=\"px-3 c6 text-right\">年收益o</div>\r\n        </div>;\r\n        return <>\r\n            <div className=\"px-3 py-1\">历年季度股本收益</div>\r\n            <List header={header} loading=\"...\"\r\n                items={items}\r\n                item={{\r\n                    render: (row: { season: number, c: number, e: number, esum: number, corg: number, eorg: number, esumorg: number }) => {\r\n                        let { season, c, e, esum, corg, eorg, esumorg } = row;\r\n                        let ym = GFunc.SeasonnoToYearMonth(season);\r\n                        let a = 0;\r\n                        return <div className=\"px-3 py-2 d-flex flex-wrap\">\r\n                            <div className=\"px-3 c6\">{ym.toString()}</div>\r\n                            <div className=\"px-3 c6 text-right\">{GFunc.numberToFixString(c)}</div>\r\n                            <div className=\"px-3 c6 text-right\">{GFunc.numberToFixString(e)}</div>\r\n                            <div className=\"px-3 c6 text-right\">{GFunc.numberToFixString(esum)}</div>\r\n                            <div className=\"px-3 c6 text-right\">{GFunc.percentToFixString(esum / c)}</div>\r\n                            <div className=\"px-3 c6 text-right\">{GFunc.numberToFixString(corg)}</div>\r\n                            <div className=\"px-3 c6 text-right\">{GFunc.numberToFixString(eorg)}</div>\r\n                            <div className=\"px-3 c6 text-right\">{GFunc.numberToFixString(esumorg)}</div>\r\n                        </div>\r\n                    }\r\n                }}\r\n            />\r\n        </>\r\n    });\r\n\r\n\r\n    private capitalEarning = observer(() => {\r\n        let items = this.controller.capitalearning;\r\n        let header = <div className=\"px-3\">\r\n            <div className=\"px-3 c6\">年</div>\r\n            <div className=\"px-3 c6 text-right\">股本</div>\r\n            <div className=\"px-3 c6 text-right\">收益</div>\r\n            <div className=\"px-3 c6 text-right\">ROE</div>\r\n        </div>;\r\n        return <>\r\n            <div className=\"px-3 py-1\">历年股本收益</div>\r\n            <List header={header} loading=\"...\"\r\n                items={items}\r\n                item={{\r\n                    render: (row: StockCapitalearning) => {\r\n                        let { capital, earning } = row;\r\n                        return <div className=\"px-3 py-2 d-flex flex-wrap\">\r\n                            <div className=\"px-3 c6\">{row.year}</div>\r\n                            <div className=\"px-3 c6 text-right\"> {capital.toFixed(2)}</div>\r\n                            <div className=\"px-3 c6 text-right\"> {earning.toFixed(2)}</div>\r\n                            <div className=\"px-3 c6 text-right\"> {(earning / capital * 100).toFixed(1)}%</div>\r\n                        </div>\r\n                    }\r\n                }}\r\n            />\r\n        </>\r\n    });\r\n\r\n    private bonus = observer(() => {\r\n        let items = this.controller.bonus;\r\n        let header = <div className=\"px-3\">\r\n            <div className=\"px-3 c8\">日期</div>\r\n            <div className=\"px-3 c6 text-right\">分红</div>\r\n        </div>;\r\n        return <>\r\n            <div className=\"px-3 py-1\">历年分红</div>\r\n            <List header={header} loading=\"...\"\r\n                items={items}\r\n                item={{\r\n                    render: (row: StockBonus) => {\r\n                        return <div className=\"px-3 py-2 d-flex flex-wrap\">\r\n                            <div className=\"px-3 c8\">{row.day}</div>\r\n                            <div className=\"px-3 c6 text-right\"> {row.bonus.toFixed(2)}</div>\r\n                        </div>\r\n                    }\r\n                }}\r\n            />\r\n        </>\r\n    });\r\n}","import {CenterApiBase} from '../net';\r\n\r\nexport class CenterApi extends CenterApiBase {\r\n    async userAppUnits(app:number):Promise<any[]> {\r\n        return await this.get('tie/user-app-units', {app:app});\r\n    }\r\n    async userFromId(userId:number):Promise<any> {\r\n        return await this.get('user/user-name-nick-icon-from-id', {userId:userId});\r\n\t}\r\n\tasync userFromKey(userName:string):Promise<any> {\r\n\t\treturn await this.get('tie/user-from-key', {key:userName});\r\n\t}\r\n}\r\n\r\nexport const centerApi = new CenterApi('tv/', undefined);\r\n","//import * as React from 'react';\r\nimport { Page, nav, LMR } from \"../components\";\r\nimport { VPage } from '../vm';\r\n//import { appInFrame } from '../net';\r\nimport { CAppBase } from \"./CAppBase\";\r\n//import { UQsMan } from '../uq';\r\n\r\n/*\r\nexport class VAppMain extends VPage<CMainBase> {\r\n    async open(param?:any) {\r\n        this.openPage(this.appPage);\r\n    }\r\n\r\n    render(param?:any) {\r\n        return this.appContent();\r\n    }\r\n\r\n    protected appPage = () => {\r\n        let {caption} = this.controller;\r\n        return <Page header={caption} logout={async()=>{appInFrame.unit = undefined}}>\r\n            {this.appContent()}\r\n        </Page>;\r\n    }\r\n\r\n    protected appContent = () => {\r\n        let {cUqArr} = this.controller;\r\n        let content:any;\r\n        if (cUqArr.length === 0) {\r\n            content = <div className=\"text-danger\">\r\n                <FA name=\"\" /> 此APP没有绑定任何的UQ\r\n            </div>;\r\n        }\r\n        else {\r\n            content = cUqArr.map((v,i) => <div key={i}>{v.render()}</div>);\r\n        }\r\n        return <>{content}</>;\r\n    };\r\n}\r\n*/\r\nexport class VUnsupportedUnit extends VPage<CAppBase<any>> {\r\n\tprivate params: {predefinedUnit:number, uqsLoadErrors:string[]};\r\n    async open(params: {predefinedUnit:number, uqsLoadErrors:string[]}) {\r\n\t\tthis.params = params;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = () => {\r\n\t\tlet {predefinedUnit, uqsLoadErrors} = this.params;\r\n        let {user} = nav;\r\n\t\tlet userName:string = user? user.name : '[未登录]';\r\n\t\t//let {appOwner, appName} = UQsMan.value;\r\n        return <Page header=\"APP无法运行\" logout={true}>\r\n            <div className=\"m-3 text-danger container\">\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">登录用户</div>\r\n                    <div className=\"col-sm text-body\">{userName}</div>\r\n                </div>\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">预设小号</div>\r\n                    <div className=\"col-sm text-body\">{predefinedUnit || <small className=\"\">[无预设小号]</small>}</div>\r\n                </div>\r\n\t\t\t\t{\r\n\t\t\t\t\tuqsLoadErrors && uqsLoadErrors.map(v => {\r\n\t\t\t\t\t\treturn <div className=\"form-group row\">\r\n\t\t\t\t\t\t\t<div className=\"col-sm-3 font-weight-bold\">App</div>\r\n\t\t\t\t\t\t\t<div className=\"col-sm text-body\">{v}</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">小号{predefinedUnit}</div>\r\n                    <div className=\"col-sm text-body\">\r\n                        预设小号定义在 public/unit.json 文件中。\r\n                        定义了这个文件的程序，只能由url直接启动。\r\n                        用户第一次访问app之后，会缓存在localStorage里。<br/>\r\n                        如果要删去缓存的预定义Unit，logout然后再login。\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\t\t</Page>;\t\t\r\n\t}\r\n\t/*\r\n\t<div className=\"form-group row\">\r\n\t\t<div className=\"col-sm-3 font-weight-bold\">\r\n\t\t\t可能原因<FA name=\"exclamation-triangle\" />\r\n\t\t</div>\r\n\t\t<div className=\"col-sm text-body\">\r\n\t\t\t<ul className=\"p-0\">\r\n\t\t\t\t<li>没有小号运行 {appName}</li>\r\n\t\t\t\t<li>用户 <b>{userName}</b> 没有加入任何一个运行{appName}的小号</li>\r\n\t\t\t\t{\r\n\t\t\t\t\tpredefinedUnit && \r\n\t\t\t\t\t<li>预设小号 <b>{predefinedUnit}</b> 没有运行App {appName}</li>\r\n\t\t\t\t}\r\n\t\t\t</ul>\r\n\t\t</div>\r\n\t</div>\r\n\t*/\r\n}\r\n\r\nexport class VUnitSelect extends VPage<CAppBase<any>> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderRow = (item: any, index: number):JSX.Element => {\r\n        let {id, nick, name} = item;\r\n        return <LMR className=\"px-3 py-2\" right={'id: ' + id}>\r\n            <div>{nick || name}</div>\r\n        </LMR>;\r\n    }\r\n    private onRowClick = async (appUnit: any) => {\r\n\t\t//appInFrame.unit = appUnit.id; // 25;\r\n\t\t//this.controller.setAppUnit(appUnit);\r\n        await this.controller.start();\r\n    }\r\n\r\n    private page = () => {\r\n        return <Page header=\"选择小号\" logout={true}>\r\n\t\t\t<div>this.controller.appUnits appUnits removed</div>\r\n        </Page>\r\n        // <List items={this.controller.appUnits} item={{render: this.renderRow, onClick: this.onRowClick}}/>\r\n\t}\r\n}\r\n\r\nexport class VErrorsPage extends VPage<CAppBase<any>> {\r\n    async open(errors:string[]) {\r\n        this.openPage(this.page, {errors:errors});\r\n    }\r\n\r\n    private page = (errors:{errors:string[]}) => {\r\n        return <Page header=\"ERROR\">\r\n            <div className=\"m-3\">\r\n\t\t\t\t<div className=\"p-3 d-flex justify-content-center align-items-center\">\r\n\t\t\t\t\t<button className=\"btn btn-danger\" onClick={nav.resetAll}>重启网页</button>\r\n\t\t\t\t</div>\r\n\r\n                <div>Load Uqs 发生错误：</div>\r\n                {errors.errors.map((r, i) => <div key={i}>{r}</div>)}\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport class VStartError extends VPage<CAppBase<any>> {\r\n    async open(error:any) {\r\n        this.openPage(this.page, {error:error});\r\n    }\r\n\r\n    private page = ({error}:{error:any}) => {\r\n        return <Page header=\"App start error!\">\r\n            <pre>\r\n                {typeof error === 'string'? error : error.message}\r\n            </pre>\r\n        </Page>;\r\n    }\r\n}","import { nav, RouteFunc, Hooks, Navigo, NamedRoute } from \"../components\";\r\nimport { t, setGlobalRes } from '../res';\r\nimport { Controller } from '../vm';\r\nimport { UQsMan, TVs } from \"../uq\";\r\nimport { centerApi } from \"./centerApi\";\r\nimport { VErrorsPage, VStartError } from \"./vMain\";\r\nimport { User } from \"../tool\";\r\n\r\nexport interface IConstructor<T> {\r\n    new (...args: any[]): T;\r\n}\r\n\r\nexport interface DevConfig {\r\n\tname: string;\r\n\talias?: string;\r\n\tmemo?: string;\r\n}\r\n\r\nexport interface UqConfig {\r\n\tdev: DevConfig;\r\n\tname: string;\r\n\talias?: string;\t\r\n\tversion?: string;\r\n\tmemo?: string;\r\n}\r\n\r\nexport interface UqsConfig {\r\n\tapp?: {\r\n\t\tdev: DevConfig;\r\n\t\tname: string;\r\n\t\tversion?: string;\r\n\t};\r\n\t//devs?: DevConfig[];\r\n\tuqs?: UqConfig[];\r\n}\r\n\r\nexport interface AppConfig extends UqsConfig {\r\n\t/*\r\n\tapp?: {\r\n\t\tname: string;\r\n\t\tversion: string;\r\n\t\townerMap?: {[key:string]: string};\r\n\t};\r\n\t*/\r\n    //appName: string;        // 格式: owner/appName\r\n    version: string;        // 版本变化，缓存的uqs才会重载\r\n    tvs?: TVs;\r\n    //uqNameMap?: {[uqName:string]: string};      // uqName='owner/uq' 映射到内存简单名字：uq, 可以注明映射，也可以自动。有可能重\r\n    loginTop?: JSX.Element;\r\n    oem?: string;               // 用户注册发送验证码的oem厂家，默认同花\r\n\tprivacy?: string;\r\n\tnoUnit?: boolean;\t\t\t// app的运行，不跟unit绑定\r\n\thtmlTitle?: string;\r\n}\r\n\r\nexport interface Elements {\r\n\t[id:string]: (element: HTMLElement)=>void,\r\n}\r\n\r\nexport abstract class CAppBase<U> extends Controller {\r\n\tprivate appConfig: AppConfig;\r\n    protected _uqs: U;\r\n\r\n    constructor(config?: AppConfig) {\r\n\t\tsuper();\r\n\t\tthis.appConfig = config || (nav.navSettings as AppConfig);\r\n\t\tif (this.appConfig) {\r\n\t\t\tlet {app, uqs} = this.appConfig;\r\n\t\t\tif (app === undefined && uqs === undefined) {\r\n\t\t\t\tthrow new Error('app or uqs must be defined in AppConfig');\r\n\t\t\t}\r\n\t\t}\r\n    }\r\n\r\n    get uqs(): U {return this._uqs;}\r\n\r\n\tinternalT(str:string):any {\r\n\t\treturn t(str);\r\n\t}\r\n\t\r\n\tsetRes(res:any) {\r\n\t\tsetGlobalRes(res);\r\n\t}\r\n\tprotected afterBuiltUQs(uqs: any) {}\r\n\r\n    protected async beforeStart():Promise<boolean> {\r\n        try {\r\n\t\t\tthis.onNavRoutes();\r\n\t\t\tif (!this.appConfig) return true;\r\n\t\t\tlet retErrors = await UQsMan.build(this.appConfig);\r\n            if (retErrors !== undefined) {\r\n                this.openVPage(VErrorsPage, retErrors);\r\n                return false;\r\n            }\r\n\t\t\tthis._uqs = UQsMan._uqs;\r\n\t\t\tthis.afterBuiltUQs(this._uqs);\r\n            //let retErrors = await this.load();\r\n            //let app = await loadAppUqs(this.appOwner, this.appName);\r\n            // if (isDevelopment === true) {\r\n\t\t\t// 这段代码原本打算只是在程序员调试方式下使用，实际上，也可以开放给普通用户，production方式下\r\n\t\t\t//let retErrors = UQsMan.errors;\r\n            //let {predefinedUnit} = appInFrame;\r\n            let {user} = nav;\r\n            if (user !== undefined && user.id > 0) {\r\n            }\r\n            return true;\r\n        }\r\n        catch (err) {\r\n            this.openVPage(VStartError, err);\r\n            return false;\r\n        }\r\n    }\r\n\tprotected async afterStart():Promise<void> {\r\n\t\tnav.resolveRoute();\r\n\t\tnav.onChangeLogin = (user:User) => this.onChangeLogin(user);\r\n\t\tthis.onChangeLogin(this.user);\r\n\t}\r\n\r\n    async userFromId(userId:number):Promise<any> {\r\n        return await centerApi.userFromId(userId);\r\n    }\r\n\r\n\tprotected on(routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\tprotected on(url:string, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\tprotected on(regex:RegExp, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\tprotected on(options: {[url:string]: RouteFunc|NamedRoute}):Navigo;\r\n\tprotected on(...args:any[]):Navigo {\r\n\t\treturn nav.on(args[0], args[1], args[2]);\r\n\t}\r\n\r\n\tprotected onNavRoutes() {return;}\r\n\r\n\tasync getUqRoles(uqName:string):Promise<string[]> {\r\n\t\tlet {user} = nav;\r\n\t\tif (!user) return null;\r\n\t\tlet {roles:userRoles} = nav.user;\r\n\t\tlet uq = uqName.toLowerCase();\r\n\t\tlet roles:string[];\r\n\t\tif (userRoles) {\r\n\t\t\troles = userRoles[uq];\r\n\t\t}\r\n\t\tif (roles) return roles;\r\n\r\n\t\troles = await UQsMan.getUqUserRoles(uq);\r\n\t\tif (!roles) roles = null;\r\n\t\tnav.setUqRoles(uq, roles);\r\n\t\treturn roles;\r\n\t}\r\n\r\n\tisAdmin(roles:string[]):boolean {\r\n\t\treturn this.isRole(roles, '$');\r\n\t}\r\n\r\n\tisRole(roles:string[], role:string):boolean {\r\n\t\tif (!roles) return false;\r\n\t\trole = role.toLowerCase();\r\n\t\treturn roles.indexOf(role) >= 0;\r\n\t}\r\n\r\n\tprotected onChangeLogin(user: User):Promise<void> {\r\n\t\treturn;\r\n\t}\r\n}\r\n","import { AppConfig, CAppBase } from './CAppBase';\r\n\r\nexport async function start(CApp: new (config: AppConfig) => CAppBase<any>, appConfig: AppConfig, isUserLogin?:boolean) {\r\n\tif (appConfig) {\r\n\t\tlet {htmlTitle} = appConfig;\r\n\t\tif (htmlTitle) {\r\n\t\t\tdocument.title = htmlTitle;\r\n\t\t}\r\n\t\tlet html = document.getElementsByTagName('html');\r\n\t\tlet html0 = html[0];\r\n\t\tif (html0) {\r\n\t\t\tlet version = html0?.getAttribute('data-version');\r\n\t\t\tif (version) {\r\n\t\t\t\t//appConfig.version = version;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tlet cApp = new CApp(appConfig);\r\n    await cApp.start(isUserLogin);\r\n}\r\n","import _ from 'lodash';\r\nimport { Controller, WebNav } from \"../vm\";\r\nimport { CAppBase, IConstructor } from \"./CAppBase\";\r\n\r\nexport abstract class CBase<A extends CAppBase<U>, U> extends Controller {\r\n    protected readonly _uqs: U;\r\n    protected readonly _cApp: A;\r\n\r\n    constructor(cApp: any) {\r\n        super();\r\n        this._cApp = cApp;\r\n        this._uqs = cApp?.uqs;\r\n\t}\r\n\r\n    get uqs(): U {return this._uqs}\r\n\tget cApp(): A {return this._cApp}\r\n\tasync getUqRoles(uqName:string):Promise<string[]> {\r\n\t\treturn this._cApp?.getUqRoles(uqName);\r\n\t}\r\n\r\n\tinternalT(str:string):any {\r\n\t\tlet r = super.internalT(str);\r\n\t\tif (r!==undefined) return r;\r\n\t\treturn this._cApp.internalT(str);\r\n\t}\r\n\r\n    protected newC<T extends CBase<A,U>>(type: IConstructor<T>, param?:any):T {\r\n\t\tlet c = new type(this.cApp);\r\n\t\tc.init(param);\r\n\t\treturn c;\r\n    }\r\n\r\n    protected newSub<O extends CBase<A,U>, T extends CSub<A,U,O>>(type: IConstructor<T>, param?:any):T {\r\n\t\tlet s = new type(this);\r\n\t\ts.init(param);\r\n\t\treturn s;\r\n\t}\r\n\t\r\n\tgetWebNav(): WebNav<any> {\r\n\t\tlet wn = this._cApp?.getWebNav();\r\n\t\tif (wn === undefined) return;\r\n\t\tlet ret = _.clone(wn);\r\n\t\t_.merge(ret, this.webNav);\r\n\t\treturn ret;\r\n\t}\r\n}\r\n\r\nexport abstract class CSub<A extends CAppBase<U>, U, T extends CBase<A, U>> extends CBase<A,U> {\r\n    protected _owner: T;\r\n\r\n    constructor(owner: T) {\r\n        super(owner.cApp);\r\n        this._owner = owner;\r\n\t}\r\n\r\n\tinternalT(str:string):any {\r\n\t\tlet r = super.internalT(str);\r\n\t\tif (r!==undefined) return r;\r\n\t\treturn this._owner.internalT(str);\r\n\t}\r\n\r\n    protected get owner(): T {return this._owner}\r\n\t\r\n\tgetWebNav(): WebNav<any> {\r\n\t\tlet wn = this._cApp?.getWebNav();\r\n\t\tif (wn === undefined) return;\r\n\t\tlet ownerWNs:WebNav<any>[] = [];\r\n\t\tfor (let p = this.owner; p!==undefined; p = (p as any)?.owner) {\r\n\t\t\townerWNs.push(p.webNav);\r\n\t\t}\r\n\t\tlet ret = _.clone(wn);\r\n\t\tfor (;;) {\r\n\t\t\tlet own = ownerWNs.pop();\r\n\t\t\tif (own === undefined) break;\r\n\t\t\t_.merge(ret, own);\r\n\t\t}\r\n\t\t_.merge(ret, this.webNav);\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { IValuesView, IValuesViewRenderOptions } from '../../components';\r\nimport { Tag, TagValue } from './tag';\r\n\r\nconst radioStyle:React.CSSProperties = {height: 'auto'};\r\n\r\nexport class TagView implements IValuesView {\r\n\tprivate tag: Tag;\r\n\tconstructor(tag: Tag) {\r\n\t\tthis.tag = tag;\r\n\t}\r\n\trender(values: number|string):JSX.Element {\r\n\t\tlet names:string[];\r\n\t\tif (typeof values === 'number') {\r\n\t\t\tnames = [this.tag.nameFromId(values)];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tnames = this.tag.namesFromIds(values);\r\n\t\t}\r\n\t\treturn <div className=\"d-flex flex-wrap \">{names.map((name, index)=>{\r\n\t\t\treturn <div key={index} className=\"mx-2 border border-muted rounded px-3 bg-light\">{name}</div>\r\n\t\t})}</div>;\r\n\t}\r\n\trenderRadios(value: number, options: IValuesViewRenderOptions): JSX.Element {\r\n        let content = this.tag.values.map((item,index) => {\r\n\t\t\treturn <div className=\"col\" key={index}>{this.renderRadio(item, value, options)}</div>;\r\n        });\r\n\t\treturn this.renderView(options, content);\r\n\t}\r\n\trenderChecks(values: string, options: IValuesViewRenderOptions): JSX.Element {\r\n\t\tlet arr = values===undefined? undefined : values.split('|').map(v => Number(v));\r\n\t\tlet content = this.tag.values.map((item,index) => {\r\n\t\t\tlet checked: boolean = arr===undefined? undefined : arr.indexOf(item.id)>=0;\r\n\t\t\treturn <div className=\"col\" key={index}>{this.renderCheck(item, checked, options)}</div>\r\n\t\t});\r\n\t\treturn this.renderView(options, content);\r\n\t}\r\n\tprivate renderView(options: IValuesViewRenderOptions, content:any) {\r\n\t\tlet {className, wrapClassName} = options;\r\n\t\twrapClassName = wrapClassName?\r\n\t\t\t'row ' + wrapClassName\r\n\t\t\t:\r\n\t\t\t'row row-cols-2 row-cols-sm-3 row-cols-md-4';\r\n\t\treturn <div className={className} style={radioStyle}>\r\n\t\t\t<div className={wrapClassName}>\r\n                {content}\r\n\t\t\t</div>\r\n        </div>;\r\n\t}\r\n\tprivate renderRadio(item:TagValue, value: number, options: IValuesViewRenderOptions):JSX.Element {\r\n\t\tlet {id, name} = item;\r\n\t\tlet {inputs, inputName, onInputChange} = options;\r\n\t\tlet ref = inputs && ((input:HTMLInputElement)=>inputs[id]=input);\r\n\t\treturn <label className=\"form-radio-inline\">\r\n\t\t\t<input ref={ref} type=\"radio\" name={inputName}\r\n\t\t\t\tvalue={id} defaultChecked={value===id}\r\n\t\t\t\tonChange={onInputChange} />\r\n\t\t\t{name}\r\n\t\t</label>;\r\n\t}\r\n\r\n\tprivate renderCheck(item:TagValue, checked: boolean, options: IValuesViewRenderOptions):JSX.Element {\r\n\t\tlet {id, name} = item;\r\n\t\tlet {inputs, onInputChange} = options;\r\n\t\tlet ref = inputs && ((input:HTMLInputElement)=>inputs[id]=input);\r\n\t\treturn <label className=\"form-radio-inline\">\r\n\t\t\t<input ref={ref} type=\"checkbox\"\r\n\t\t\t\tvalue={id} defaultChecked={checked}\r\n\t\t\t\tonChange={onInputChange} />\r\n\t\t\t{name}\r\n\t\t</label>;\r\n\t}\r\n}\r\n","import { Entity } from \"../entity\";\r\nimport { TagView } from \"./tagView\";\r\n\r\nexport interface TagValue {\r\n\tid: number;\r\n\tname: string;\r\n\text: string;\r\n}\r\n\r\nexport class UqTag extends Entity {\r\n    get typeName(): string { return 'tag';}\r\n\tvalues: TagValue[];\r\n\tprivate coll: {[id:number]: TagValue} = {};\r\n\r\n\tprivate _view: TagView;\r\n\tget view(): TagView { \r\n\t\tif (this._view !== undefined) return this._view; \r\n\t\treturn this._view = new TagView(this);\r\n\t}\r\n\r\n\tnameFromId(id:number) {\r\n\t\tlet c = this.coll[id]; \r\n\t\treturn c===undefined? undefined : c.name;\r\n\t}\r\n\r\n\tnamesFromIds(ids:string):string[] {\r\n\t\tlet ret:string[] = [];\r\n\t\tfor (let id of ids.split('|')) {\r\n\t\t\tlet c = this.coll[Number(id)];\r\n\t\t\tlet name = c===undefined? undefined : c.name;\r\n\t\t\tif (name !== undefined) ret.push(name);\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync loadValues():Promise<TagValue[]> {\r\n\t\tif (this.values !== undefined) return this.values;\r\n\t\tthis.values = [];\r\n\t\tlet ret = await this.uqApi.get('tag/values/' + this.name);\r\n\t\tif (ret === undefined) return;\r\n\t\tlet lines = (ret as string).split('\\n');\r\n\t\tfor (let line of lines) {\r\n\t\t\tif (line.length === 0) continue;\r\n\t\t\tlet parts = line.split('\\t');\r\n\t\t\tlet id = Number(parts[0]);\r\n\t\t\tlet val = {\r\n\t\t\t\tid: id,\r\n\t\t\t\tname: parts[1],\r\n\t\t\t\text: parts[2],\r\n\t\t\t};\r\n\t\t\tthis.values.push(val);\r\n\t\t\tthis.coll[id] = val;\r\n\t\t}\r\n\t\treturn this.values;\r\n\t}\r\n}\r\n\r\nexport class Tag extends UqTag {\r\n}","//=== UqApp builder created on Sat Mar 27 2021 11:57:55 GMT-0400 (GMT-04:00) ===//\nimport { CSub, CBase, CAppBase, IConstructor } from 'tonva-react';\nimport { UQs } from './uqs';\nimport { CApp } from './CApp';\n\nexport abstract class CUqBase extends CBase<CApp, UQs> {\n}\n\nexport abstract class CUqSub<A extends CAppBase<U>, U, T extends CBase<A,U>> extends CSub<A, U, T> {\n}\n\nexport abstract class CUqApp extends CAppBase<UQs> {\n\tprotected newC<T extends CUqBase>(type: IConstructor<T>): T {\n\t\tlet c = new type(this);\n\t\tc.init();\n\t\treturn c;\n\t}\n}\n","import { UQs } from \"uq-app\";\r\nimport { Log } from \"../Logger\";\r\n\r\nexport const testTimesChange = {\r\n\tname: 'TimesChange', \r\n\tdiscription: 'Test Times Change hours', \r\n\ttest: async (log: Log, uqs: UQs):Promise<void> => {\r\n\t\t/*\r\n\t\tlet tc = uqs.BzTimesChange;\r\n\t\tlet ret = await tc.IDActs({\r\n\t\t\tstaff: [\r\n\t\t\t\t{id: undefined, no: '101', firstName: 'Song', lastName: 'Sha'}\r\n\t\t\t]\r\n\t\t});\r\n\t\tlog(ret);\r\n\t\tlet id = 13369344;\r\n\t\tlet r1 = await tc.IDActs({\r\n\t\t\thours: [\r\n\t\t\t\t{id, onsite:{value: 3, time: new Date(2021, 0, 1)}}\r\n\t\t\t]\r\n\t\t});\r\n\t\tlog(r1);\r\n\r\n\t\tlet month = await tc.IDLog({\r\n\t\t\tIDX: tc.Hours,\r\n\t\t\tfield: 'onsite',\r\n\t\t\tid,\r\n\t\t\tlog: 'month',\r\n\t\t\ttimeZone: -5,\r\n\t\t\tpage: {\r\n\t\t\t\tstart: undefined,\r\n\t\t\t\tend: new Date(2021,0,1).getTime(),\r\n\t\t\t\tsize: 10,\r\n\t\t\t}\r\n\t\t});\r\n\t\tlog(month);\r\n\r\n\t\tlet sum = await tc.IDSum({\r\n\t\t\tIDX: tc.Hours,\r\n\t\t\tfield: ['onsite'],\r\n\t\t\tid: [id],\r\n\t\t\tfar: undefined,\r\n\t\t\tnear: new Date().getTime(),\r\n\t\t});\r\n\t\tlog(sum);\r\n\t\t*/\r\n\t}\r\n}\r\n","import { DebugItem } from \"../CBug\";\r\nimport { testTimesChange } from \"./test-times-change\";\r\nimport { testItem1 } from \"./test1\";\r\nimport { testItem2 } from \"./test2\";\r\nimport { testItem3 } from \"./test3\";\r\nimport { testItem4 } from \"./test4\";\r\n\r\nexport const debugItems: DebugItem[] = [\r\n\ttestItem1,\r\n\ttestItem2,\r\n\ttestItem3,\r\n\ttestItem4,\r\n\ttestTimesChange,\r\n];\r\n","import { DebugItem } from \"../CBug\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { UQs } from \"uq-app\";\r\nimport { Log } from \"../Logger\";\r\n\r\n//BzTest, BzHelloTonva, BzCustomerPayment, \r\n\r\nexport const testItem1:DebugItem = {\r\n\tname: 'HelloTonva.GetProductStock',\r\n\tdiscription: '{product: 1}',\r\n\ttest: async ( log: Log, uqs: UQs):Promise<void> => {\r\n\t\t/*\r\n\t\tlet a = await uqs.BzTest.ID({\r\n\t\t\tIDX: uqs.BzTest.X1,\r\n\t\t\tid: 7077888,\r\n\t\t});\r\n\t\tfor (let item of a) {\r\n\t\t\tlog(item);\r\n\t\t}\r\n\r\n\t\tlet e = await uqs.BzTest.IDActs({\r\n\t\t\ttag: [\r\n\t\t\t\t{id: undefined, type: 'a', name: 'b'},\r\n\t\t\t\t{id: undefined, type: 'a', name: 'c'},\r\n\t\t\t\t{id: undefined, type: 'd', name: 'c'},\r\n\t\t\t],\r\n\t\t\tx1: [\r\n\t\t\t\t{id: undefined, a1: 1, a2: 3, a3:5, n5: 7},\r\n\t\t\t\t{id: undefined, a1: 1, a2: 7, a3:51, n5: 71},\r\n\t\t\t],\r\n\t\t\tassign1: [\r\n\t\t\t\t{ix: 3, id: 5, val: 3},\r\n\t\t\t\t{ix: 3, id: 6, val: 30},\r\n\t\t\t],\r\n\t\t\tiBook1: [\r\n\t\t\t\t{id: 7, f1: 3.5, f2: 7.2, b: 'bbbb', c: 1},\r\n\t\t\t\t{id: 8, f1: 3.5, f2: 7.2, b: 'bbbbc', c: 2},\r\n\t\t\t],\r\n\t\t});\r\n\t\tlog(e);\r\n\r\n\t\tlet b = await uqs.BzTest.IDDetail<BzTest.OrderMaster, BzTest.OrderDetail>\r\n\t\t({\r\n\t\t\tmaster: {\r\n\t\t\t\tID: uqs.BzTest.OrderMaster,\r\n\t\t\t\tvalue: {customer: 1 },\r\n\t\t\t},\r\n\t\t\tdetail: {\r\n\t\t\t\tID: uqs.BzTest.OrderDetail,\r\n\t\t\t\tvalues: [\r\n\t\t\t\t\t{product:11, price:2.0, quantity:3.0, amount:6.0},\r\n\t\t\t\t\t{product:12, price:2.0, quantity:5.0, amount:10.0},\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tlog(b);\r\n\r\n\t\tlet c = await uqs.BzTest.IDDetailGet<BzTest.OrderMaster, BzTest.OrderDetail>({\r\n\t\t\tid: 8716325,\r\n\t\t\tmaster: uqs.BzTest.OrderMaster,\r\n\t\t\tdetail: uqs.BzTest.OrderDetail,\r\n\t\t});\r\n\r\n\t\tfor (let ci of c) {\r\n\t\t\tlog(ci);\r\n\t\t}\r\n\r\n\t\t//let u: BzHelloTonva.Return$pokedRet;\r\n\t\t//u.poke = 1;\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\tlet f = BzCustomerPayment.EnumCustomerAction.confirm;\r\n\r\n\t\tlet ret = await uqs.BzHelloTonva.GetProductStock.query({product: 1});\r\n\t\tlog(ret);\r\n\t\t*/\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t}\r\n}","import { UQs } from \"uq-app\";\r\nimport { Log } from \"../Logger\";\r\n\r\nexport const testItem2 = {\r\n\tname: '第二测试', \r\n\tdiscription: 'second test', \r\n\ttest: async (log: Log, uqs: UQs):Promise<void> => {\r\n\t\t/*\r\n\t\tlet ret = await uqs.BzHelloTonva.TestArr.submitReturns({rows: [\r\n\t\t\t{a: 1, b: 2}, \r\n\t\t\t{a: 3, b: 4}, \r\n\t\t]});\r\n\t\tlog(ret);\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\t*/\r\n\t}\r\n}\r\n","import { UQs } from \"uq-app\";\r\nimport { Log } from \"../Logger\";\r\n\r\nexport const testItem3 = {\r\n\tname: '第三测试', \r\n\tdiscription: 'third test', \r\n\ttest: async (log: Log, uqs: UQs):Promise<void> => {\r\n\t\t/*\r\n\t\tlet a = await uqs.BzTest.IDLog({\r\n\t\t\tIDX: uqs.BzTest.IBook1,\r\n\t\t\tfield: 'f2',\r\n\t\t\tid: 7,\r\n\t\t\tlog: 'each',\r\n\t\t\tpage: {start:undefined, size: 50},\r\n\t\t});\r\n\t\tlog(a);\r\n\r\n\t\tlet b = await uqs.BzTest.KeyID({\r\n\t\t\tID: uqs.BzTest.X1,\r\n\t\t\tkey: {a1: 1, a2: undefined},\r\n\t\t});\r\n\t\tlog(b);\r\n\r\n\t\tlet c = await uqs.BzTest.IX({\r\n\t\t\tIX: uqs.BzTest.Assign1,\r\n\t\t\tid: 3,\r\n\t\t});\r\n\t\tlog(c);\r\n\r\n\t\tlet d = await uqs.BzTest.KeyIX({\r\n\t\t\tID: uqs.BzTest.X1,\r\n\t\t\tkey: {a1: 1, a2: undefined},\r\n\t\t\tIX: uqs.BzTest.Assign1,\r\n\t\t});\r\n\t\tlog(d);\r\n\r\n\t\tlet e = await uqs.BzTest.IDActs({\r\n\t\t\tiBook1: [\r\n\t\t\t\t{id: -7, f1: 3.5, f2: 7.2, b: 'bbbb', c: 1},\r\n\t\t\t]\r\n\t\t});\r\n\t\tlog(e);\r\n\r\n\t\tlet ret = await uqs.BzHelloTonva.TestArr.submitReturns({rows: [\r\n\t\t\t{a: 1, b: 2}, \r\n\t\t\t{a: 3, b: 4}, \r\n\t\t]});\r\n\t\tlog(ret);\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\t*/\r\n\t}\r\n}\r\n","import { UQs } from \"uq-app\";\r\nimport { Log } from \"../Logger\";\r\n\r\nexport const testItem4 = {\r\n\tname: 'Tag测试', \r\n\tdiscription: 'Tag Test', \r\n\ttest: async (log: Log, uqs: UQs):Promise<void> => {\r\n\t\t/*\r\n\t\tlet ret = await uqs.BzTest.IX({\r\n\t\t\tIX: uqs.BzTest.CustomerTag,\r\n\t\t\tid: 1,\r\n\t\t\tIDX: [uqs.BzTest.Tag],\r\n\t\t\tpage: undefined,\r\n\t\t});\r\n\t\tlog(ret);\r\n\t\t*/\r\n\t}\r\n}\r\n","import { FA, LMR, VPage } from \"tonva-react\";\r\nimport { CBug, DebugItem } from \"./CBug\";\r\n\r\nexport class VBug extends VPage<CBug> {\r\n\theader() {\r\n\t\treturn <div className=\"px-3\">\r\n\t\t\tDebug\r\n\t\t\t<small className=\"text-muted\"> - 本页仅调试状态可见</small>\r\n\t\t</div>\r\n\t}\r\n\tcontent() {\r\n        return <div>\r\n\t\t\t<div>\r\n\t\t\t\t{this.controller.debugItems.map(this.renderItem)}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"px-3 py-2\">\r\n\t\t\t\t<button className=\"btn btn-primary\" onClick={this.controller.test}>test</button>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderItem = (item:DebugItem, index:number):JSX.Element => {\r\n\t\tlet {name, discription} = item;\r\n\t\tlet right = <FA name=\"angle-right\" />;\r\n\t\treturn <LMR key={index} className=\"px-3 py-2 cursor-pointer mt-1 bg-white\"\r\n\t\t\tonClick={() => this.controller.openDebugPage(item)}\r\n\t\t\tright={right}>\r\n\t\t\t<div>{name} <small className=\"text-muted\">{discription}</small></div>\r\n\t\t</LMR>;\r\n\t}\r\n}","import { VPage } from \"tonva-react\";\r\nimport { CBug } from \"./CBug\";\r\n\r\nexport class VConsole extends VPage<CBug> {\r\n\tprivate div: HTMLDivElement;\r\n\tprivate divBottom: HTMLDivElement;\r\n\tinit() {\r\n\t\tthis.startAutoScrollToBottom();\r\n\t}\r\n\theader() {\r\n\t\treturn this.controller.currentItem.name;\r\n\t}\r\n\tcontent() {\r\n\t\tlet {currentItem} = this.controller;\r\n\t\tlet {name, discription} = currentItem;\r\n\t\treturn <div>\r\n\t\t\t<div className=\"p-3\">\r\n\t\t\t<div><b>{name}</b></div>\r\n\t\t\t<div>{discription}</div>\r\n\t\t\t</div>\r\n\t\t\t<div ref={t => this.div = t} className=\"p-3 border-top border-primary bg-light\" />\r\n\t\t\t<div ref={t => this.divBottom = t} />\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate autoScrollEnd:boolean = false;\r\n\tprivate autoScroll = true;\r\n    private lastScrollTop = 0;\r\n    private timeHandler:any;\r\n    private startAutoScrollToBottom() {\r\n\t\tif (this.autoScrollEnd === true) return;\r\n\t\tthis.autoScroll = true;\r\n\t\tif (this.timeHandler !== undefined) return;\r\n        this.timeHandler = setInterval(() => {\r\n\t\t\tif (this.autoScroll === false) return;\r\n            this.divBottom?.scrollIntoView();\r\n        }, 100);\r\n    }\r\n    private endAutoScrollToBottom() {\r\n        setTimeout(() => {\r\n\t\t\tthis.autoScroll = false;\r\n\t\t\tthis.autoScrollEnd = true;\r\n\t\t\tif (this.timeHandler === undefined) return;\r\n\t\t\tclearInterval(this.timeHandler);\r\n\t\t\tthis.timeHandler = undefined;\r\n\t\t}, 300);\r\n\t}\r\n\tprivate pauseAutoScrollToBottom() {\r\n\t\tthis.autoScroll = false;\r\n\t}\r\n\tprotected onPageScroll(e:any) {\r\n        let el = e.target as HTMLBaseElement;\r\n        let {scrollTop, scrollHeight, offsetHeight} = el;\r\n        if (scrollTop <= this.lastScrollTop) {\r\n            this.pauseAutoScrollToBottom();\r\n        }\r\n        else if (scrollTop + offsetHeight > scrollHeight - 30) {\r\n            this.startAutoScrollToBottom();\r\n        }\r\n\r\n        this.lastScrollTop = scrollTop;\r\n\t}\r\n\r\n\tlog = (message?: any):void => {\r\n\t\tconst range = document.createRange();\r\n\t\trange.selectNode(this.div);\r\n\t\tlet html:string;\r\n\t\tif (!message) {\r\n\t\t\thtml = '<div>&nbsp;</div>';\r\n\t\t}\r\n\t\telse if (typeof message === 'object') {\r\n\t\t\thtml = this.objToHtml(message);\r\n\t\t}\r\n\t\telse {\r\n\t\t\thtml = '<div>' + message + '</div>';\r\n\t\t}\r\n\t\tconst child = range.createContextualFragment(html);\r\n\t\tthis.div.appendChild(child);\r\n\t}\r\n\r\n\tprivate objToHtml(obj: any) {\r\n\t\tif (obj === null) return '<div>null</div>';\r\n\t\tif (obj === undefined) return '<div>undefined</div>';\r\n\t\tif (Array.isArray(obj) === true) {\r\n\t\t\treturn this.arrToHtml(0, obj);\r\n\t\t}\r\n\t\tlet ret = '<div>{</div>';\r\n\t\tfor (let i in obj) {\r\n\t\t\tret += this.indent(1) + i + ': ';\r\n\t\t\tlet v = obj[i];\r\n\t\t\tif (Array.isArray(v) === true) {\r\n\t\t\t\tret += this.arrToHtml(1, v);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tret += this.objToString(v);\r\n\t\t\t}\r\n\t\t}\r\n\t\tret += '<div>}</div>';\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate indent(n:number) {\r\n\t\tif (!n) return '';\r\n\t\tlet ret = '';\r\n\t\tn = n*2;\r\n\t\tfor (let i=0; i<n; i++) ret += '&emsp;';\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate objToString(obj: any) {\r\n\t\tif (obj === null) {\r\n\t\t\treturn 'null';\r\n\t\t}\r\n\t\tif (Array.isArray(obj) === true) {\r\n\t\t\treturn 'array[' + obj.length + ']';\r\n\t\t}\r\n\t\tswitch (typeof obj) {\r\n\t\tdefault: return obj.toString();\r\n\t\tcase 'undefined': return 'undefined';\r\n\t\tcase 'object':\r\n\t\t\tif (obj.tuid === undefined) {\r\n\t\t\t\treturn 'obj';\r\n\t\t\t}\r\n\t\t\treturn obj.id;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate objToLine(indent:number, obj:any) {\r\n\t\tlet first = true;\r\n\t\tlet ret = '<div>' + this.indent(indent) + '{ ';\r\n\t\tfor (let i in obj) {\r\n\t\t\tif (first === false) {\r\n\t\t\t\tret += ', ';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfirst = false;\r\n\t\t\t}\r\n\t\t\tret += i + ':' + this.objToString(obj[i]);\r\n\t\t}\r\n\t\tret += ' }</div>';\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate indentVal(indent:number, val:any):string {\r\n\t\treturn '<div>' + this.indent(indent) + val + '</div>'\r\n\t}\r\n\tprivate arrToHtml(indent:number, arr:any[]) {\r\n\t\tlet ret = '<div>' + this.indent(indent) + '[</div>';\r\n\t\tfor (let item of arr) {\r\n\t\t\tlet t:string|number;\r\n\t\t\tswitch (typeof item) {\r\n\t\t\t\tdefault: t = this.indentVal(indent+1, item); break;\r\n\t\t\t\tcase 'object': t = this.objToLine(indent+1, item); break;\r\n\t\t\t\tcase 'string': t = this.indentVal(indent+1, `'${item}'`); break;\r\n\t\t\t}\r\n\t\t\tret += t;\r\n\t\t}\r\n\t\tret += '<div>' + this.indent(indent) + ']</div>';\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import { CUqBase, UQs } from \"uq-app\";\r\nimport { Log } from \"./Logger\";\r\nimport { debugItems } from \"./tester\";\r\nimport { VBug } from \"./VBug\";\r\nimport { VConsole } from \"./VConsole\";\r\n\r\nexport interface DebugItem {\r\n\tname: string;\r\n\tdiscription?: string;\r\n\ttest: (log:Log, uqs: UQs) => Promise<void>;\r\n}\r\n\r\nexport class CBug extends CUqBase {\r\n\tdebugItems = [...debugItems];\r\n\tcurrentItem: DebugItem;\r\n\r\n\tprotected async internalStart() {\r\n\t\tthis.openVPage(VBug);\r\n\t}\r\n\r\n\ttab = () => this.renderView(VBug);\r\n\r\n\tload = async () => {\r\n\r\n\t}\r\n\r\n\topenDebugPage = async (item:DebugItem) => {\r\n\t\tthis.currentItem = item;\r\n\t\tlet console = await this.openVPage(VConsole);\r\n\t\tlet {test} = item;\r\n\t\tlet start = new Date();\r\n\t\tconsole.log(`=== test start at ${start} ===`);\r\n\t\tconsole.log();\r\n\t\tawait test(console.log, this.uqs);\r\n\t\tlet span = Date.now() - start.getTime();\r\n\t\tlet ms = (1000 + (span % 1000)).toString().substr(1);\r\n\t\tlet s = Math.floor(span / 1000);\r\n\t\tlet m = Math.floor(s / 60);\r\n\t\tlet t = '';\r\n\t\tif (m > 0) t += ms + '\\'';\r\n\t\tt += s + '\"' + ms;\r\n\t\tconsole.log();\r\n\t\tconsole.log(`=== test end: ${t} ===`);\r\n\t}\r\n\r\n\ttest = async () => {\r\n\t\tlet uqName = 'BizDev/hello-tonva';\r\n\t\tlet roles = await this.getUqRoles(uqName);\r\n\t\talert(roles);\r\n\t}\r\n}\r\n","import { zh } from \"./zh\";\r\nimport { en } from \"./en\";\r\n\r\nexport const res = {\r\n\t$zh: zh,\r\n\t$en: en,\r\n}\r\n","export const zh = {\r\n\thome: '首页',\r\n\trelation: '关系',\r\n\tdiscover: '发现',\r\n\ttest: '测试',\r\n\tdebug: 'Debug',\r\n\tme: '我',\r\n\r\n\tchangePassword: '修改密码',\r\n\taboutTheApp: '关于本APP',\r\n\tlogout: '退出登录',\r\n\tpleaseLogin: '登录',\r\n\r\n\tcontent: '内容',\r\n\tbackend: '后台管理',\r\n\r\n\tmyAll: '自选股',\r\n\tmyBlack: '黑名单',\r\n\r\n\t\r\n}\r\n","export const en = {\r\n\thome: 'Home',\r\n\trelation: 'Relation',\r\n\tdiscover: 'Discover',\r\n\ttest: 'Test',\r\n\tdebug: 'Debug',\r\n\tme: 'Me',\r\n\r\n\tchangePassword: 'Change password',\r\n\taboutTheApp: 'About the APP',\r\n\tlogout: 'Logout',\r\n\tpleaseLogin: 'Login',\r\n\r\n\tcontent: 'Content',\r\n\tbackend: 'Backend Management',\r\n\r\n\tmyAll: 'All My Stock',\r\n\tmyBlack: 'Block List',\r\n}\r\n","//=== UqApp builder created on Tue Jan 05 2021 18:41:24 GMT-0500 (GMT-05:00) ===//\nimport { VPage, TabProp, TabCaptionComponent, TabsProps } from 'tonva-react';\nimport { CApp } from './CApp';\n\nconst color = (selected: boolean) => selected === true ? 'text-primary' : 'text-muted';\n/*\nfunction caption(label:string|JSX.Element, icon:string) {\n\treturn (selected: boolean) => TabCaptionComponent(label, icon, color(selected));\n}\n*/\nexport class VMain extends VPage<CApp> {\n\theader() {return false;}\n\n\tprotected get tabsProps(): TabsProps {\n\t\t/*\n\t\tlet { cHome, cBug, cMe, cUI } = this.controller;\n\t\tlet tabs: TabProp[] = [\n\t\t\t{name: 'home', caption: caption(t('home'), 'home'), content: cHome.tab},\n\t\t\t{name: 'me', caption: caption(t('me'), 'user-o'), content: cMe.tab, load: cMe.load},\n\t\t];\n\t\tif (this.isDev === true) {\n\t\t\ttabs.push({\n\t\t\t\tname: 'UI', caption: caption(t('UI'), 'television'), content: cUI.tab\n\t\t\t});\n\t\t\ttabs.push({\n\t\t\t\tname: 'debug', caption: caption(t('debug'), 'bug'), content: cBug.tab, onShown: cBug.load\n\t\t\t});\n\t\t}\n\t\treturn {tabs};\n\t\t*/\n\t\tlet { cHome, cFind, cMe } = this.controller;\n\t\tlet tabs: TabProp[] = [\n\t\t\t/*{ \n\t\t\t\tname: 'home', label: '首页', icon: 'home', content: cHome.tab, \n\t\t\t\tnotify: undefined, \n\t\t\t\tload: cHome.load, \n\t\t\t\tonShown: cHome.load,\n\t\t\t},*/\n\t\t\t{\n\t\t\t\tname: 'home', label: '首页', icon: 'money', \n\t\t\t\tnotify: undefined,\n\t\t\t\tcontent: cHome.tab, //load: cGroup.load, onShow: cGroup.load,\n\t\t\t},\n\t\t\t/*{\n\t\t\t\tname: 'explorer', label: '持仓', icon: 'money', content: cHolding.tab, // load: cHolding.load \n\t\t\t},*/\n\t\t\t{\n\t\t\t\tname: 'find', label: '发现', icon: 'search', content: cFind.tab, load: cFind.load\n\t\t\t},\n\t\t\t/*\n\t\t\t{\n\t\t\t\tname: 'explorer', label: '选股', icon: 'search', content: cExporer.tab, load: cExporer.load\n\t\t\t},*/\n\t\t\t{\n\t\t\t\tname: 'me', label: '我的', icon: 'user', content: cMe.tab, onShown: undefined, load: cMe.load\n\t\t\t}\n\t\t].map(v => {\n\t\t\tlet { name, label, icon, content, notify, load, onShown } = v;\n\t\t\treturn {\n\t\t\t\tname,\n\t\t\t\tcaption: (selected: boolean) => TabCaptionComponent(label, icon, color(selected)),\n\t\t\t\tcontent,\n\t\t\t\tnotify,\n\t\t\t\tload,\n\t\t\t\tonShown,\n\t\t\t};\n\t\t});\n\t\treturn {tabs};\n\t}\n\n\t/*\n\tprotected get webNav(): PageWebNav {\n\t\treturn {\n\t\t\tnavHeader: <div>webNav header</div>, \n\t\t\tnavFooter: <div>webNav footer</div>,\n\t\t};\n\t}\n\t*/\n}\n","import { FA, LMR, VPage } from \"tonva-react\";\r\nimport { CTester, UIItem } from \"./CTest\";\r\n\r\nexport class VTester extends VPage<CTester> {\r\n\theader() {\r\n\t\treturn <div className=\"px-3\">\r\n\t\t\tUI\r\n\t\t\t<small className=\"text-muted\"> - 本页仅调试状态可见</small>\r\n\t\t</div>\r\n\t}\r\n\tcontent() {\r\n        return <div>\r\n\t\t\t<div>\r\n\t\t\t\t{this.controller.uiItems.map(this.renderItem)}\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderItem = (item:UIItem, index:number):JSX.Element => {\r\n\t\tlet {name, discription, click} = item;\r\n\t\tlet right = <FA name=\"angle-right\" />;\r\n\t\treturn <LMR key={index} className=\"px-3 py-2 cursor-pointer mt-1 bg-white\"\r\n\t\t\tonClick={click}\r\n\t\t\tright={right}>\r\n\t\t\t<div>{name} <small className=\"text-muted\">{discription}</small></div>\r\n\t\t</LMR>;\r\n\t}\r\n}\r\n","import { CBase, Context } from \"tonva-react\";\r\nimport { CID, MidID, CIDX, MidIDX, MidTag, CIDTagList, CTagIDList\r\n\t, SheetUI, MidIDTagList, CSheetNew, MidSheet } from \"tonva-uqui\";\r\nimport { CApp, UQs } from \"uq-app\";\r\n//import { OrderDetail, OrderMaster } from \"uq-app/uqs/BzHelloTonva\";\r\nimport { VTester } from \"./VTest\";\r\nimport { isNumber } from \"lodash\";\r\n\r\nexport interface UIItem {\r\n\tname: string;\r\n\tdiscription?: string;\r\n\tclick: () => Promise<void>;\r\n}\r\n\r\nexport class CTester extends CBase<CApp,UQs> {\r\n\treadonly uiItems:UIItem[] = [\r\n\t\t/*\r\n\t\t{\r\n\t\t\tname: 'customer',\r\n\t\t\tdiscription: '客户信息',\r\n\t\t\tclick: async () => {\r\n\t\t\t\tlet uq = this.uqs.BzHelloTonva;\r\n\t\t\t\tlet mid = new MidID(uq, {ID:uq.Customer});\r\n\t\t\t\tlet cID = new CID(mid);\r\n\t\t\t\tawait cID.start();\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: 'tag',\r\n\t\t\tdiscription: '客户标签',\r\n\t\t\tclick: async () => {\r\n\t\t\t\tlet uq = this.uqs.BzHelloTonva;\r\n\t\t\t\tlet midTag = new MidTag(uq, uq.Customer, uq.CustomerTag, uq.Tag, 'customer');\r\n\t\t\t\tlet midIDTagList = new MidIDTagList(midTag);\r\n\t\t\t\tlet cIDTagList = new CIDTagList(midIDTagList);\r\n\t\t\t\tawait cIDTagList.start();\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: 'tagCustomer',\r\n\t\t\tdiscription: '标签客户',\r\n\t\t\tclick: async () => {\r\n\t\t\t\tlet uq = this.uqs.BzHelloTonva;\r\n\t\t\t\tlet midTag = new MidTag(uq, uq.Customer, uq.CustomerTag, uq.Tag, 'customer');\r\n\t\t\t\tlet cTagIDList = new CTagIDList(midTag);\r\n\t\t\t\tawait cTagIDList.start();\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: 'staff',\r\n\t\t\tdiscription: 'TimeChange Staff',\r\n\t\t\tclick: async () => {\r\n\t\t\t\tlet uq = this.uqs.BzHelloTonva;\r\n\t\t\t\tlet mid = new MidID(uq, {ID:uq.Staff});\r\n\t\t\t\tlet cStaff = new CID(mid);\r\n\t\t\t\tcStaff.renderItem = (item:any, index:number): JSX.Element => {\r\n\t\t\t\t\treturn <div className=\"\">{uq.Staff.render(item)}</div>\r\n\t\t\t\t};\r\n\t\t\t\tawait cStaff.start();\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: 'hours',\r\n\t\t\tdiscription: 'TimeChange Hours',\r\n\t\t\tclick: async () => {\r\n\t\t\t\tlet uq = this.uqs.BzHelloTonva;\r\n\t\t\t\tlet mid = new MidIDX(uq, uq.Hours, uq.Staff, this.timeZone);\r\n\t\t\t\tlet cHours = new CIDX(mid);\r\n\t\t\t\tawait cHours.start();\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: 'sheet-order',\r\n\t\t\tdiscription: 'Sheet Order Hello Tonva',\r\n\t\t\tclick: async () => {\r\n\t\t\t\tlet uq = this.uqs.BzHelloTonva;\r\n\t\t\t\tlet onChanged = async (context:Context, value:any, prev:any) => {\r\n\t\t\t\t\tlet quantity = context.getValue('quantity');\r\n\t\t\t\t\tlet price = context.getValue('price');\r\n\t\t\t\t\tif (isNumber(quantity) && isNumber(value)) {\r\n\t\t\t\t\t\tcontext.setValue('amount', (price*quantity).toFixed(2));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlet sheetUI:SheetUI = {\r\n\t\t\t\t\tmaster: {\r\n\t\t\t\t\t\tID: uq.OrderMaster,\r\n\t\t\t\t\t\tfieldCustoms: {\r\n\t\t\t\t\t\t\tcustomer: {ID: uq.Customer},\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdetail: {\r\n\t\t\t\t\t\tID: uq.OrderDetail,\r\n\t\t\t\t\t\tfieldCustoms: {\r\n\t\t\t\t\t\t\tproduct: { ID: uq.Customer },\r\n\t\t\t\t\t\t\tprice: { onChanged },\r\n\t\t\t\t\t\t\tquantity: { onChanged },\r\n\t\t\t\t\t\t\tamount: { readOnly: true, }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlet mid = new MidSheet<OrderMaster, OrderDetail>(uq, sheetUI, this.res);\r\n\t\t\t\tlet cSheetNew = new CSheetNew(mid);\r\n\t\t\t\tawait cSheetNew.start();\r\n\t\t\t}\r\n\t\t},\r\n\t\t*/\r\n\t];\r\n\r\n\tprotected async internalStart() {\r\n\t\tthis.openVPage(VTester);\r\n\t}\r\n\r\n\ttab = () => this.renderView(VTester);\r\n}\r\n","import { Res, UI } from \"tonva-react\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\nimport { $Piecewise } from \"./BruceYuMi\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"isKey\": true,\n\t\t\"label\": \"Name\"\n\t} as undefined,\n\tmul: {\n\t\t\"name\": \"mul\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Mul\"\n\t} as FieldItemInt,\n\tdiv: {\n\t\t\"name\": \"div\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Div\"\n\t} as FieldItemInt,\n\toffset: {\n\t\t\"name\": \"offset\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Offset\"\n\t} as FieldItemInt,\n\tasc: {\n\t\t\"name\": \"asc\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Asc\"\n\t} as undefined,\n};\n/*==fields==*/\n\nexport const fieldArr: FieldItem[] = [\n\tfields.name, fields.mul, fields.div, fields.offset, fields.asc, \n];\n\nexport const ui: UI = {\n\tlabel: \"$Piecewise\",\n\tfieldArr,\n\tfields,\n};\n\nexport const res: Res<any> = {\n\tzh: {\n\t},\n\ten: {\n\t}\n};\n\nexport function render(item: $Piecewise):JSX.Element {\n\treturn <>{JSON.stringify(item)}</>;\n};\n","import { Res, UI } from \"tonva-react\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\nimport { Market } from \"./BruceYuMi\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": true,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n\tcurrency: {\n\t\t\"name\": \"currency\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Currency\"\n\t} as FieldItemString,\n};\n/*==fields==*/\n\nexport const fieldArr: FieldItem[] = [\n\tfields.name, fields.currency, \n];\n\nexport const ui: UI = {\n\tlabel: \"Market\",\n\tfieldArr,\n\tfields,\n};\n\nexport const res: Res<any> = {\n\tzh: {\n\t},\n\ten: {\n\t}\n};\n\nexport function render(item: Market):JSX.Element {\n\treturn <>{JSON.stringify(item)}</>;\n};\n","import { Res, UI } from \"tonva-react\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\nimport { Transaction } from \"./BruceYuMi\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tholding: {\n\t\t\"name\": \"holding\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": true,\n\t\t\"label\": \"Holding\"\n\t} as FieldItemId,\n\ttick: {\n\t\t\"name\": \"tick\",\n\t\t\"isKey\": true,\n\t\t\"label\": \"Tick\"\n\t} as undefined,\n\tprice: {\n\t\t\"name\": \"price\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Price\"\n\t} as FieldItemInt,\n\tquantity: {\n\t\t\"name\": \"quantity\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Quantity\"\n\t} as FieldItemInt,\n\tamount: {\n\t\t\"name\": \"amount\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Amount\"\n\t} as FieldItemInt,\n};\n/*==fields==*/\n\nexport const fieldArr: FieldItem[] = [\n\tfields.holding, fields.tick, fields.price, fields.quantity, fields.amount, \n];\n\nexport const ui: UI = {\n\tlabel: \"Transaction\",\n\tfieldArr,\n\tfields,\n};\n\nexport const res: Res<any> = {\n\tzh: {\n\t},\n\ten: {\n\t}\n};\n\nexport function render(item: Transaction):JSX.Element {\n\treturn <>{JSON.stringify(item)}</>;\n};\n","import { Res, setRes, TFunc, UI } from \"tonva-react\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\nimport { Group } from \"./BruceYuMi\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tno: {\n\t\t\"name\": \"no\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": true,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"No\"\n\t} as FieldItemString,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n\ttype: {\n\t\t\"name\": \"type\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Type\"\n\t} as undefined,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.no, fields.name, fields.type, \n];\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t\tGroup: '股票组',\n\t\tNo: '编号',\n\t\tName: '组名',\n\t},\n\t$en: {\n\t}\n};\n\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: Group):JSX.Element {\n\tlet {name} = item;\n\treturn <>{t(name)}</>;\n};\n\nexport const ui: UI = {\n\tlabel: t(\"Group\"),\n\tfieldArr,\n\tfields,\n};\n","import { Res, setRes, TFunc, UI } from \"tonva-react\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\nimport { Account } from \"./BruceYuMi\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tno: {\n\t\t\"name\": \"no\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": true,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"No\"\n\t} as FieldItemString,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n};\n/*==fields==*/\n\nexport const fieldArr: FieldItem[] = [\n\tfields.no, fields.name, \n];\n\nexport const ui: UI = {\n\tlabel: \"Account\",\n\tfieldArr,\n\tfields,\n};\n\nexport const resRaw: Res<any> = {\n\t$zh: {\n\t\tNo: '编号',\n\t\tName: '名称',\n\t},\n\t$en: {\n\t}\n};\n\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: Account):JSX.Element {\n\tlet {name} = item;\n\treturn <>{t(name)}</>;\n};\n","import { Res, setRes, TFunc, UI } from \"tonva-react\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\nimport { Holding } from \"./BruceYuMi\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\taccount: {\n\t\t\"name\": \"account\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": true,\n\t\t\"label\": \"Account\"\n\t} as FieldItemId,\n\tstock: {\n\t\t\"name\": \"stock\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": true,\n\t\t\"label\": \"Stock\"\n\t} as FieldItemId,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n];\n\nexport const ui: UI = {\n\tlabel: \"Holding\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\tzh: {\n\t},\n\ten: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: Holding):JSX.Element {\n\treturn <>{JSON.stringify(item)}</>;\n};\n","import { Res, UI } from \"tonva-react\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\nimport { $PiecewiseDetail } from \"./BruceYuMi\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tparent: {\n\t\t\"name\": \"parent\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": true,\n\t\t\"label\": \"Parent\"\n\t} as FieldItemId,\n\trow: {\n\t\t\"name\": \"row\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": true,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Row\"\n\t} as FieldItemInt,\n\tsec: {\n\t\t\"name\": \"sec\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Sec\"\n\t} as FieldItemInt,\n\tvalue: {\n\t\t\"name\": \"value\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Value\"\n\t} as FieldItemInt,\n};\n/*==fields==*/\n\nexport const fieldArr: FieldItem[] = [\n\tfields.parent, fields.row, fields.sec, fields.value, \n];\n\nexport const ui: UI = {\n\tlabel: \"$PiecewiseDetail\",\n\tfieldArr,\n\tfields,\n};\n\nexport const res: Res<any> = {\n\tzh: {\n\t},\n\ten: {\n\t}\n};\n\nexport function render(item: $PiecewiseDetail):JSX.Element {\n\treturn <>{JSON.stringify(item)}</>;\n};\n","import { Res, UI } from \"tonva-react\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\nimport { Stock } from \"./BruceYuMi\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tmarket: {\n\t\t\"name\": \"market\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": true,\n\t\t\"label\": \"Market\"\n\t} as FieldItemId,\n\tcode: {\n\t\t\"name\": \"code\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": true,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Code\"\n\t} as FieldItemString,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n\tsearch: {\n\t\t\"name\": \"search\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Search\"\n\t} as FieldItemString,\n\trawId: {\n\t\t\"name\": \"rawId\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"RawId\"\n\t} as FieldItemId,\n};\n/*==fields==*/\n\nexport const fieldArr: FieldItem[] = [\n\tfields.market, fields.code, fields.name, fields.search, fields.rawId, \n];\n\nexport const ui: UI = {\n\tlabel: \"Stock\",\n\tfieldArr,\n\tfields,\n};\n\nexport const res: Res<any> = {\n\tzh: {\n\t},\n\ten: {\n\t}\n};\n\nexport function render(item: Stock):JSX.Element {\n\tlet {name, code} = item;\n\treturn <><span>{name}</span> <span>{code}</span></>;\n};\n","import { Res, UI } from \"tonva-react\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\nimport { StockValue } from \"./BruceYuMi\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tmiValue: {\n\t\t\"name\": \"miValue\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"MiValue\"\n\t} as FieldItemNum,\n\tincValue: {\n\t\t\"name\": \"incValue\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"number\",\n\t\t\"label\": \"IncValue\"\n\t} as FieldItemNum,\n\tearning: {\n\t\t\"name\": \"earning\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Earning\"\n\t} as FieldItemNum,\n\tdivident: {\n\t\t\"name\": \"divident\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Divident\"\n\t} as FieldItemNum,\n\tprice: {\n\t\t\"name\": \"price\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Price\"\n\t} as FieldItemNum,\n\tpvolumn: {\n\t\t\"name\": \"pvolumn\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Pvolumn\"\n\t} as FieldItemNum,\n\troe: {\n\t\t\"name\": \"roe\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Roe\"\n\t} as FieldItemNum,\n\tinc1: {\n\t\t\"name\": \"inc1\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Inc1\"\n\t} as FieldItemNum,\n\tinc2: {\n\t\t\"name\": \"inc2\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Inc2\"\n\t} as FieldItemNum,\n\tinc3: {\n\t\t\"name\": \"inc3\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Inc3\"\n\t} as FieldItemNum,\n\tinc4: {\n\t\t\"name\": \"inc4\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Inc4\"\n\t} as FieldItemNum,\n\tpreInc: {\n\t\t\"name\": \"preInc\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"PreInc\"\n\t} as FieldItemNum,\n\tvolumn: {\n\t\t\"name\": \"volumn\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Volumn\"\n\t} as FieldItemNum,\n\tsmoothness: {\n\t\t\"name\": \"smoothness\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Smoothness\"\n\t} as undefined,\n\tdate: {\n\t\t\"name\": \"date\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Date\"\n\t} as undefined,\n\tmiRate: {\n\t\t\"name\": \"miRate\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"MiRate\"\n\t} as FieldItemNum,\n\tdvRate: {\n\t\t\"name\": \"dvRate\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"DvRate\"\n\t} as FieldItemNum,\n\tttm: {\n\t\t\"name\": \"ttm\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Ttm\"\n\t} as FieldItemNum,\n};\n/*==fields==*/\n\nexport const fieldArr: FieldItem[] = [\n\tfields.miValue, fields.incValue, fields.earning, fields.divident, fields.price, fields.pvolumn, fields.roe, fields.inc1, fields.inc2, fields.inc3, fields.inc4, fields.preInc, fields.volumn, fields.smoothness, fields.date, fields.miRate, fields.dvRate, fields.ttm, \n];\n\nexport const ui: UI = {\n\tlabel: \"StockValue\",\n\tfieldArr,\n\tfields,\n};\n\nexport const res: Res<any> = {\n\tzh: {\n\t},\n\ten: {\n\t}\n};\n\nexport function render(item: StockValue):JSX.Element {\n\treturn <>{JSON.stringify(item)}</>;\n};\n","import { Res, UI } from \"tonva-react\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\nimport { AccountValue } from \"./BruceYuMi\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tmiValue: {\n\t\t\"name\": \"miValue\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"number\",\n\t\t\"label\": \"MiValue\"\n\t} as FieldItemNum,\n\tmarket: {\n\t\t\"name\": \"market\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Market\"\n\t} as FieldItemNum,\n\tcount: {\n\t\t\"name\": \"count\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Count\"\n\t} as FieldItemInt,\n\tcash: {\n\t\t\"name\": \"cash\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Cash\"\n\t} as FieldItemInt,\n};\n/*==fields==*/\n\nexport const fieldArr: FieldItem[] = [\n\tfields.miValue, fields.market, fields.count, fields.cash, \n];\n\nexport const ui: UI = {\n\tlabel: \"AccountValue\",\n\tfieldArr,\n\tfields,\n};\n\nexport const res: Res<any> = {\n\tzh: {\n\t},\n\ten: {\n\t}\n};\n\nexport function render(item: AccountValue):JSX.Element {\n\treturn <>{JSON.stringify(item)}</>;\n};\n","import { Res, UI } from \"tonva-react\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\nimport { Portfolio } from \"./BruceYuMi\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tquantity: {\n\t\t\"name\": \"quantity\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Quantity\"\n\t} as FieldItemInt,\n\tcost: {\n\t\t\"name\": \"cost\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"number\",\n\t\t\"label\": \"Cost\"\n\t} as FieldItemNum,\n};\n/*==fields==*/\n\nexport const fieldArr: FieldItem[] = [\n\tfields.quantity, fields.cost, \n];\n\nexport const ui: UI = {\n\tlabel: \"Portfolio\",\n\tfieldArr,\n\tfields,\n};\n\nexport const res: Res<any> = {\n\tzh: {\n\t},\n\ten: {\n\t}\n};\n\nexport function render(item: Portfolio):JSX.Element {\n\treturn <>{JSON.stringify(item)}</>;\n};\n","import { Res, setRes, TFunc, UI } from \"tonva-react\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\nimport { UserBlockStock } from \"./BruceYuMi\";\n\n/*--fields--*/\nconst fields = {\n\tix: {\n\t\t\"name\": \"ix\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Ix\"\n\t} as FieldItemId,\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n];\n\nexport const ui: UI = {\n\tlabel: \"UserBlockStock\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\tzh: {\n\t},\n\ten: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: UserBlockStock):JSX.Element {\n\treturn <>{JSON.stringify(item)}</>;\n};\n","import { Res, UI } from \"tonva-react\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\nimport { UserAccount } from \"./BruceYuMi\";\n\n/*--fields--*/\nconst fields = {\n\tix: {\n\t\t\"name\": \"ix\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Ix\"\n\t} as FieldItemId,\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tsort: {\n\t\t\"name\": \"sort\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Sort\"\n\t} as FieldItemInt,\n};\n/*==fields==*/\n\nexport const fieldArr: FieldItem[] = [\n\tfields.sort, \n];\n\nexport const ui: UI = {\n\tlabel: \"UserAccount\",\n\tfieldArr,\n\tfields,\n};\n\nexport const res: Res<any> = {\n\tzh: {\n\t},\n\ten: {\n\t}\n};\n\nexport function render(item: UserAccount):JSX.Element {\n\treturn <>{JSON.stringify(item)}</>;\n};\n","import { Res, UI } from \"tonva-react\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\nimport { UserGroup } from \"./BruceYuMi\";\n\n/*--fields--*/\nconst fields = {\n\tix: {\n\t\t\"name\": \"ix\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Ix\"\n\t} as FieldItemId,\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n};\n/*==fields==*/\n\nexport const fieldArr: FieldItem[] = [\n\t\n];\n\nexport const ui: UI = {\n\tlabel: \"UserGroup\",\n\tfieldArr,\n\tfields,\n};\n\nexport const res: Res<any> = {\n\tzh: {\n\t},\n\ten: {\n\t}\n};\n\nexport function render(item: UserGroup):JSX.Element {\n\treturn <>{JSON.stringify(item)}</>;\n};\n","import { Res, setRes, TFunc, UI } from \"tonva-react\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\nimport { UserAllStock } from \"./BruceYuMi\";\n\n/*--fields--*/\nconst fields = {\n\tix: {\n\t\t\"name\": \"ix\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Ix\"\n\t} as FieldItemId,\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n];\n\nexport const ui: UI = {\n\tlabel: \"UserAllStock\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\tzh: {\n\t},\n\ten: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: UserAllStock):JSX.Element {\n\treturn <>{JSON.stringify(item)}</>;\n};\n","import { Res, setRes, TFunc, UI } from \"tonva-react\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\nimport { AccountHolding } from \"./BruceYuMi\";\n\n/*--fields--*/\nconst fields = {\n\tix: {\n\t\t\"name\": \"ix\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Ix\"\n\t} as FieldItemId,\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n];\n\nexport const ui: UI = {\n\tlabel: \"AccountHolding\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\tzh: {\n\t},\n\ten: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: AccountHolding):JSX.Element {\n\treturn <>{JSON.stringify(item)}</>;\n};\n","import { Res, UI } from \"tonva-react\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\nimport { GroupStock } from \"./BruceYuMi\";\n\n/*--fields--*/\nconst fields = {\n\tix: {\n\t\t\"name\": \"ix\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Ix\"\n\t} as FieldItemId,\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\torder: {\n\t\t\"name\": \"order\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Order\"\n\t} as FieldItemInt,\n};\n/*==fields==*/\n\nexport const fieldArr: FieldItem[] = [\n\tfields.order, \n];\n\nexport const ui: UI = {\n\tlabel: \"GroupStock\",\n\tfieldArr,\n\tfields,\n};\n\nexport const res: Res<any> = {\n\tzh: {\n\t},\n\ten: {\n\t}\n};\n\nexport function render(item: GroupStock):JSX.Element {\n\treturn <>{JSON.stringify(item)}</>;\n};\n","//=== UqApp builder created on Sat Mar 27 2021 11:58:05 GMT-0400 (GMT-04:00) ===//\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { IDXValue, Uq, UqTuid, UqAction, UqQuery, UqID, UqIDX, UqIX } from \"tonva-react\";\n\n\n//===============================\n//======= UQ bruce/yumi ========\n//===============================\n\nexport enum EnumGroupType {\n\tnormal = 0,\n\tblack = -1,\n\tall = 1\n}\n\nexport interface Tuid$user {\n\tname: string;\n\tnick: string;\n\ticon: string;\n\tassigned: string;\n\tpoke: number;\n}\n\nexport interface Tuid$sheet {\n\tno: string;\n\tuser: number;\n\tdate: any;\n\tsheet: number;\n\tversion: number;\n\tflow: number;\n\tapp: number;\n\tstate: number;\n\tdiscription: string;\n\tdata: string;\n\tprocessing: number;\n}\n\nexport interface ParamWriteStock {\n\tstocks: {\n\t\tmarket: string;\n\t\tcode: string;\n\t\tname: string;\n\t\trawId: number;\n\t\tincValue: number;\n\t\tearning: number;\n\t\tdivident: number;\n\t\troe: number;\n\t\tinc1: number;\n\t\tinc2: number;\n\t\tinc3: number;\n\t\tinc4: number;\n\t\tpreInc: number;\n\t\tvolumn: number;\n\t\tsmoothness: number;\n\t}[];\n\n}\ninterface ResultWriteStock {\n}\n\nexport interface ParamWritePrice {\n\tprices: {\n\t\tmarket: string;\n\t\tcode: string;\n\t\tname: string;\n\t\trawId: number;\n\t\tprice: number;\n\t\tpvolumn: number;\n\t\tdate: number;\n\t}[];\n\n}\ninterface ResultWritePrice {\n}\n\nexport interface Param$poked {\n}\ninterface Return$pokedRet {\n\tpoke: number;\n}\ninterface Result$poked {\n\tret: Return$pokedRet[];\n}\n\nexport interface ParamSearchStock {\n\t$orderSwitch: string;\n\tkey: string;\n\tmarket: string;\n\tsmooth: number;\n}\ninterface ReturnSearchStock$page {\n\tid: number;\n\tmarket: number;\n\tcode: string;\n\tname: string;\n\trawId: number;\n\tmiValue: number;\n\tincValue: number;\n\tearning: number;\n\tdivident: number;\n\tprice: number;\n\troe: number;\n\tinc1: number;\n\tinc2: number;\n\tinc3: number;\n\tinc4: number;\n\tpreInc: number;\n\tvolumn: number;\n\tsmoothness: number;\n\tmiRate: number;\n\tdvRate: number;\n\tttm: number;\n}\ninterface ResultSearchStock {\n\t$page: ReturnSearchStock$page[];\n}\n\nexport interface ParamStockUsing {\n\tstock: number;\n}\ninterface ReturnStockUsingAccounts {\n\taccount: number;\n}\ninterface ReturnStockUsingGroups {\n\tgroup: number;\n}\ninterface ResultStockUsing {\n\taccounts: ReturnStockUsingAccounts[];\n\tgroups: ReturnStockUsingGroups[];\n}\n\nexport interface ParamSearchStock1 {\n\tkey: string;\n}\ninterface ReturnSearchStock1$page {\n\tid: number;\n}\ninterface ResultSearchStock1 {\n\t$page: ReturnSearchStock1$page[];\n}\n\nexport interface $Piecewise {\n\tid?: number;\n\tname: string;\n\tmul: number;\n\tdiv: number;\n\toffset: number;\n\tasc: number;\n}\n\nexport interface Market {\n\tid?: number;\n\tname: string;\n\tcurrency: string;\n}\n\nexport interface Transaction {\n\tid?: number;\n\tholding: number;\n\ttick: any;\n\tprice: number;\n\tquantity: number;\n\tamount: number;\n}\n\nexport interface Group {\n\tid?: number;\n\tno?: string;\n\tname: string;\n}\n\nexport interface Account {\n\tid?: number;\n\tno?: string;\n\tname: string;\n}\n\nexport interface Holding {\n\tid?: number;\n\taccount: number;\n\tstock: number;\n}\n\nexport interface $PiecewiseDetail {\n\tid?: number;\n\tparent: number;\n\trow?: number;\n\tsec: number;\n\tvalue: number;\n}\n\nexport interface Stock {\n\tid?: number;\n\tmarket: number;\n\tcode: string;\n\tname: string;\n\tsearch: string;\n\trawId: number;\n}\n\nexport interface StockValue {\n\tid: number;\n\tmiValue?: number;\n\tincValue?: number;\n\tearning?: number;\n\tdivident?: number;\n\tprice?: number;\n\tpvolumn?: number;\n\troe?: number;\n\tinc1?: number;\n\tinc2?: number;\n\tinc3?: number;\n\tinc4?: number;\n\tpreInc?: number;\n\tvolumn?: number;\n\tsmoothness?: number;\n\tdate?: any;\n\tmiRate?: number;\n\tdvRate?: number;\n\tttm?: number;\n}\n\nexport interface AccountValue {\n\tid: number;\n\tmiValue?: number;\n\tmarket?: number;\n\tcount?: number;\n\tcash?: number;\n\t$track?: number;\n}\n\nexport interface Portfolio {\n\tid: number;\n\tquantity?: number;\n\tcost?: number;\n\t$track?: number;\n}\n\nexport interface ActParamStockValue {\n\tid: number|IDXValue;\n\tmiValue?: number|IDXValue;\n\tincValue?: number|IDXValue;\n\tearning?: number|IDXValue;\n\tdivident?: number|IDXValue;\n\tprice?: number|IDXValue;\n\tpvolumn?: number|IDXValue;\n\troe?: number|IDXValue;\n\tinc1?: number|IDXValue;\n\tinc2?: number|IDXValue;\n\tinc3?: number|IDXValue;\n\tinc4?: number|IDXValue;\n\tpreInc?: number|IDXValue;\n\tvolumn?: number|IDXValue;\n\tsmoothness?: number|IDXValue;\n\tdate?: any|IDXValue;\n\tmiRate?: number|IDXValue;\n\tdvRate?: number|IDXValue;\n\tttm?: number|IDXValue;\n}\n\nexport interface ActParamAccountValue {\n\tid: number|IDXValue;\n\tmiValue?: number|IDXValue;\n\tmarket?: number|IDXValue;\n\tcount?: number|IDXValue;\n\tcash?: number|IDXValue;\n\t$track?: number;\n}\n\nexport interface ActParamPortfolio {\n\tid: number|IDXValue;\n\tquantity?: number|IDXValue;\n\tcost?: number|IDXValue;\n\t$track?: number;\n}\n\nexport interface UserBlockStock {\n\tix: number;\n\tid: number;\n}\n\nexport interface UserAccount {\n\tix: number;\n\tid: number;\n\tsort: number;\n}\n\nexport interface UserGroup {\n\tix: number;\n\tid: number;\n}\n\nexport interface UserAllStock {\n\tix: number;\n\tid: number;\n}\n\nexport interface AccountHolding {\n\tix: number;\n\tid: number;\n}\n\nexport interface GroupStock {\n\tix: number;\n\tid: number;\n\torder: number;\n}\n\nexport interface ParamActs {\n\t$Piecewise?: $Piecewise[];\n\tmarket?: Market[];\n\ttransaction?: Transaction[];\n\tgroup?: Group[];\n\taccount?: Account[];\n\tholding?: Holding[];\n\t$PiecewiseDetail?: $PiecewiseDetail[];\n\tstock?: Stock[];\n\tstockValue?: ActParamStockValue[];\n\taccountValue?: ActParamAccountValue[];\n\tportfolio?: ActParamPortfolio[];\n\tuserBlockStock?: UserBlockStock[];\n\tuserAccount?: UserAccount[];\n\tuserGroup?: UserGroup[];\n\tuserAllStock?: UserAllStock[];\n\taccountHolding?: AccountHolding[];\n\tgroupStock?: GroupStock[];\n}\n\n\nexport interface UqExt extends Uq {\n\tActs(param:ParamActs): Promise<any>;\n\n\t$user: UqTuid<Tuid$user>;\n\t$sheet: UqTuid<Tuid$sheet>;\n\tWriteStock: UqAction<ParamWriteStock, ResultWriteStock>;\n\tWritePrice: UqAction<ParamWritePrice, ResultWritePrice>;\n\t$poked: UqQuery<Param$poked, Result$poked>;\n\tSearchStock: UqQuery<ParamSearchStock, ResultSearchStock>;\n\tStockUsing: UqQuery<ParamStockUsing, ResultStockUsing>;\n\tSearchStock1: UqQuery<ParamSearchStock1, ResultSearchStock1>;\n\t$Piecewise: UqID<any>;\n\tMarket: UqID<any>;\n\tTransaction: UqID<any>;\n\tGroup: UqID<any>;\n\tAccount: UqID<any>;\n\tHolding: UqID<any>;\n\t$PiecewiseDetail: UqID<any>;\n\tStock: UqID<any>;\n\tStockValue: UqIDX<any>;\n\tAccountValue: UqIDX<any>;\n\tPortfolio: UqIDX<any>;\n\tUserBlockStock: UqIX<any>;\n\tUserAccount: UqIX<any>;\n\tUserGroup: UqIX<any>;\n\tUserAllStock: UqIX<any>;\n\tAccountHolding: UqIX<any>;\n\tGroupStock: UqIX<any>;\n}\n","//=== UqApp builder created on Sat Mar 27 2021 11:58:05 GMT-0400 (GMT-04:00) ===//\nimport * as BzHelloTonva from './BzHelloTonva';\nimport * as BruceYuMi from './BruceYuMi';\n\nexport interface UQs {\n\t//BzHelloTonva: BzHelloTonva.UqExt;\n\tBruceYuMi: BruceYuMi.UqExt;\n}\n\n//export * as BzHelloTonva from './BzHelloTonva';\nexport * as BruceYuMi from './BruceYuMi';\n\nexport function setUI(uqs:UQs) {\n\t//BzHelloTonva.setUI(uqs.BzHelloTonva);\n\tBruceYuMi.setUI(uqs.BruceYuMi);\n}\n","import { UqExt as Uq } from './BruceYuMi';\nimport * as $Piecewise from './$Piecewise.ui';\nimport * as Market from './Market.ui';\nimport * as Transaction from './Transaction.ui';\nimport * as Group from './Group.ui';\nimport * as Account from './Account.ui';\nimport * as Holding from './Holding.ui';\nimport * as $PiecewiseDetail from './$PiecewiseDetail.ui';\nimport * as Stock from './Stock.ui';\nimport * as StockValue from './StockValue.ui';\nimport * as AccountValue from './AccountValue.ui';\nimport * as Portfolio from './Portfolio.ui';\nimport * as UserBlockStock from './UserBlockStock.ui';\nimport * as UserAccount from './UserAccount.ui';\nimport * as UserGroup from './UserGroup.ui';\nimport * as UserAllStock from './UserAllStock.ui';\nimport * as AccountHolding from './AccountHolding.ui';\nimport * as GroupStock from './GroupStock.ui';\n\nexport function setUI(uq: Uq) {\n\tObject.assign(uq.$Piecewise, $Piecewise);\n\tObject.assign(uq.Market, Market);\n\tObject.assign(uq.Transaction, Transaction);\n\tObject.assign(uq.Group, Group);\n\tObject.assign(uq.Account, Account);\n\tObject.assign(uq.Holding, Holding);\n\tObject.assign(uq.$PiecewiseDetail, $PiecewiseDetail);\n\tObject.assign(uq.Stock, Stock);\n\tObject.assign(uq.StockValue, StockValue);\n\tObject.assign(uq.AccountValue, AccountValue);\n\tObject.assign(uq.Portfolio, Portfolio);\n\tObject.assign(uq.UserBlockStock, UserBlockStock);\n\tObject.assign(uq.UserAccount, UserAccount);\n\tObject.assign(uq.UserGroup, UserGroup);\n\tObject.assign(uq.UserAllStock, UserAllStock);\n\tObject.assign(uq.AccountHolding, AccountHolding);\n\tObject.assign(uq.GroupStock, GroupStock);\n}\nexport * from './BruceYuMi';\n","import { makeObservable, observable, runInAction } from 'mobx';\r\nimport {\r\n    userApi, ItemSchema, StringSchema, ImageSchema, UiTextItem, UiImageItem, nav, Page,\r\n    Edit, UiSchema, VPage, Prop, FA, IconText, PropGrid\r\n} from 'tonva-react';\r\nimport { CMe } from './CMe';\r\n\r\nexport class VEditMe extends VPage<CMe>{\r\n    async open(param: any) {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private schema: ItemSchema[] = [\r\n        { name: 'nick', type: 'string' } as StringSchema,\r\n        { name: 'icon', type: 'image' } as ImageSchema,\r\n    ];\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            nick: { widget: 'text', label: '别名', placeholder: '好的别名更方便记忆' } as UiTextItem,\r\n            icon: { widget: 'image', label: '头像' } as UiImageItem,\r\n        }\r\n    }\r\n    data: any;\r\n\r\n    constructor(props: any) {\r\n        super(props);\r\n        let { nick, icon } = nav.user;\r\n        this.data = {\r\n            nick,\r\n            icon,\r\n        };\r\n\t\tmakeObservable(this, {\r\n\t\t\tdata: observable,\r\n\t\t})\r\n    }\r\n\r\n    private onItemChanged = async (itemSchema: ItemSchema, newValue: any, preValue: any) => {\r\n        let { name } = itemSchema;\r\n        await userApi.userSetProp(name, newValue);\r\n\t\trunInAction(() => {\r\n\t\t\tthis.data[name] = newValue;\r\n\t\t\t(nav.user as any)[name] = newValue;\r\n\t\t\tnav.saveLocalUser();\r\n\t\t});\r\n    }\r\n\r\n\tprivate onExit = () => {\r\n        nav.showLogout();\r\n    }\r\n\r\n\tprivate changePassword = async () => {\r\n        await nav.changePassword();\r\n    }\r\n\r\n    private page = () => {\r\n\t\tlet { schema, uiSchema, data, onItemChanged } = this;\r\n\t\tlet gridRows: Prop[] = [\r\n\t\t\t'',\r\n\t\t\t{\r\n\t\t\t\ttype: 'component',\r\n\t\t\t\tcomponent: <IconText iconClass=\"text-info mr-2\" icon=\"key\" text={this.t('changePassword')} />,\r\n\t\t\t\tonClick: this.changePassword\r\n\t\t\t},\r\n\t\t\t'',\r\n\t\t\t'',\r\n\t\t\t{\r\n\t\t\t\ttype: 'component',\r\n\t\t\t\tbk: '',\r\n\t\t\t\tcomponent: <div className=\"w-100 text-center\">\r\n\t\t\t\t\t<button className=\"btn btn-danger w-100 w-max-20c\" onClick={this.onExit}>\r\n\t\t\t\t\t\t<FA name=\"sign-out\" size=\"lg\" /> {this.t('logout')}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t},\r\n\t\t];\r\n\r\n\r\n\t\t/*\r\n\t\tlet vAdmin: any;\r\n\t\t\r\n\t\tlet { role } = this.controller;\r\n\t\tif ((role & 2) === 2) {\r\n\t\t\tvAdmin = <div className=\"px-3 py-2 cursor-pointer bg-white border-bottom\" onClick={this.controller.showAdmin}>管理员</div>;\r\n\t\t}\r\n\t\t{vAdmin}\r\n\t\t*/\r\n        return <Page header=\"个人信息\">\r\n            <Edit schema={schema} uiSchema={uiSchema}\r\n                data={data}\r\n                onItemChanged={onItemChanged} />\r\n\t\t\t<PropGrid rows={gridRows} values={{}} />\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport const webUserSchema: ItemSchema[] = [\r\n    { name: 'firstName', type: 'string', required: true } as StringSchema,\r\n    { name: 'gender', type: 'string' } as StringSchema,\r\n    { name: 'salutation', type: 'string' } as StringSchema,\r\n    { name: 'organizationName', type: 'string', required: true } as StringSchema,\r\n    { name: 'departmentName', type: 'string' } as StringSchema,\r\n];\r\n\r\n","//=== UqApp builder created on Tue Jan 12 2021 23:14:51 GMT-0500 (GMT-05:00) ===//\nimport { AppConfig, DevConfig } from \"tonva-react\";\n\nconst bz: DevConfig = {\n\tname: 'bizdev',\n\talias: 'bz',\n}\n\nconst bruce: DevConfig = {\n\tname: 'bruce',\n\talias: undefined,\n}\n\nexport const appConfig: AppConfig = {\n\tversion: '0.1.0',\n\tapp: undefined,\n\tuqs: [\n\t\t/*\n\t\t{\n\t\t\tdev: bz,\n\t\t\tname: 'hello-tonva',\n\t\t\talias: 'HelloTonva',\n\t\t\tversion: '0.1.0',\n\t\t},\n\t\t*/\n\t\t{\n\t\t\tdev: bruce,\n\t\t\tname: 'yumi',\n\t\t\talias: 'YuMi',\n\t\t\tversion: '0.1.0',\n\t\t},\n\t],\n\tnoUnit: true,\n    tvs: {},\n\toem: undefined,\n\thtmlTitle: '鱼米乡 - 私享投资圈',\n};\n","import { VPage } from \"tonva-react\";\r\nimport { CMe } from \"./CMe\";\r\n\r\nexport class VFaq extends VPage<CMe> {\r\n\theader() {return '基本概念'}\r\n\tcontent() {\r\n\t\treturn <ul>\r\n\t\t\t<li className=\"my-3\">\r\n\t\t\t\t<div className=\"my-2\">基本公理</div>\r\n\t\t\t\t<ul className=\"px-3 text-info\">\r\n\t\t\t\t\t<li><span className=\"mr-3\">公理1: </span>进步是社会的必然</li>\r\n\t\t\t\t\t<li><span className=\"mr-3\">公理2: </span>信任是经济的基石</li>\r\n\t\t\t\t\t<li><span className=\"mr-3\">公理3: </span>价值是价格的准心</li>\r\n\t\t\t\t\t<li><span className=\"mr-3\">公理4: </span>发展是企业的基因</li>\r\n\t\t\t\t</ul>\r\n\t\t\t</li>\r\n\t\t\t<li className=\"my-3\">\r\n\t\t\t\t<div className=\"my-2\">米投定律</div>\r\n\t\t\t\t<ul className=\"px-3 text-info\">\r\n\t\t\t\t\t<li><span className=\"mr-3\">定律1: </span>投资无风险</li>\r\n\t\t\t\t</ul>\r\n\t\t\t</li>\r\n\t\t\t<li className=\"my-3\">\r\n\t\t\t\t<div className=\"my-2\">米投原则</div>\r\n\t\t\t\t<ul className=\"px-3 text-info\">\r\n\t\t\t\t\t<li><span className=\"mr-3\">原则1: </span>低估</li>\r\n\t\t\t\t\t<li><span className=\"mr-3\">原则2: </span>分散</li>\r\n\t\t\t\t\t<li><span className=\"mr-3\">原则3: </span>不深研</li>\r\n\t\t\t\t</ul>\r\n\t\t\t</li>\r\n\t\t\t<li className=\"my-3\">\r\n\t\t\t\t<div className=\"my-2\">米息定义</div>\r\n\t\t\t\t<ul className=\"px-3 text-info\">\r\n\t\t\t\t\t<li><span className=\"mr-3\">定义1: </span>米息 = 增息 + 股息</li>\r\n\t\t\t\t\t<li><span className=\"mr-3\">定义2: </span>增息 = 企业未来三年利润增长值</li>\r\n\t\t\t\t\t<li><span className=\"mr-3\">定义3: </span>米息率 = 米息 / 股价</li>\r\n\t\t\t\t\t<li><span className=\"mr-3\">定义4: </span>米息率大一倍，米息分加1</li>\r\n\t\t\t\t\t<li><span className=\"mr-3\">定义5: </span>PE = 股价 / 利润</li>\r\n\t\t\t\t</ul>\r\n\t\t\t</li>\r\n\t\t</ul>\r\n\t}\r\n}","import { VPage } from \"tonva-react\";\r\nimport { appConfig } from \"../uq-app/appConfig\";\r\nimport { CMe } from \"./CMe\";\r\n\r\nexport class VAbout extends VPage<CMe> {\r\n\theader() {return '关于APP';}\r\n\tcontent() {\r\n\t\treturn <div className=\"py-5 px-3 my-3 w-max-30c mx-auto bg-white\">\r\n\t\t\t<div className=\"text-center mb-5 position-relative\">\r\n\t\t\t\t<small className=\"text-muted position-absolute\"\r\n\t\t\t\t\tstyle={{right:'0', top:'-2.8rem'}}>\r\n\t\t\t\t\t版本: {appConfig.version}\r\n\t\t\t\t</small>\r\n\t\t\t\t<i className=\"text-danger position-absolute top-0 start-0 fa fa-fire fa-2x\" \r\n\t\t\t\t\tstyle={{left:'2rem', top:'0.5rem'}} />\r\n\t\t\t\t<b className=\"text-danger h5 mb-0\">\r\n\t\t\t\t\t<span className=\"text-primary\">鱼</span>\r\n\t\t\t\t\t<b className=\"mx-1\">米</b>\r\n\t\t\t\t\t<span className=\"text-success\">乡</span>\r\n\t\t\t\t</b>\r\n\t\t\t\t<br/>\r\n\t\t\t\t<small className=\"text-info\">私享投资圈</small>\r\n\t\t\t</div>\r\n\t\t\t<ul>\r\n\t\t\t\t<li>跟家人和好友一起分享投资思考。</li>\r\n\t\t\t\t<li>世界级投资大师年化收益率11%。</li>\r\n\t\t\t\t<li>全球最大的成长经济体GDP增长率高于5%。</li>\r\n\t\t\t\t<li>以10%为基础，期待<b className=\"text-danger mx-1\">15%以上</b>的高水平。</li>\r\n\t\t\t</ul>\r\n\t\t\t<div className=\"mt-5 text-center\">\r\n\t\t\t\t<small className=\"text-muted mr-2\">by</small>\r\n\t\t\t\t同花投顾\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { Image, VPage, nav, IconText, PropGrid, LMR, FA, Prop } from 'tonva-react';\r\nimport { CMe } from './CMe';\r\nimport { appConfig } from \"../uq-app/appConfig\";\r\nimport { VFaq } from './VFaq';\r\nimport { VAbout } from './VAbout';\r\n\r\nexport class VMe extends VPage<CMe> {\r\n\theader() {return this.t('me')}\r\n\r\n\tcontent() {\r\n        const { user } = nav;\r\n        let aboutRows: Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component',\r\n                component: <LMR className=\"w-100\" onClick={this.faq}\r\n\t\t\t\t\tright={<FA className=\"align-self-center\" name=\"angle-right\" />}>\r\n                    <IconText iconClass=\"text-info mr-2\" icon=\"comments-o\" text={this.t('基本概念')} />                    \r\n                </LMR>,\r\n            },\r\n            {\r\n                type: 'component',\r\n                component: <LMR className=\"w-100\" onClick={this.about}\r\n\t\t\t\t\tright={<FA className=\"align-self-center\" name=\"angle-right\" />}>\r\n                    <IconText iconClass=\"text-info mr-2\" \r\n\t\t\t\t\t\ticon=\"smile-o\" \r\n\t\t\t\t\t\ttext={<>{this.t('aboutTheApp')} <small>版本 {appConfig.version}</small></>} />                    \r\n                </LMR>,\r\n            },\r\n        ];\r\n\r\n        let rows: Prop[];\r\n        if (user === undefined) {\r\n            rows = aboutRows;\r\n            rows.push(\r\n                {\r\n                    type: 'component',\r\n                    component: <button className=\"btn btn-success w-100 my-2\" onClick={() => nav.logout()}>\r\n                        <FA name=\"sign-out\" size=\"lg\" /> {this.t('pleaseLogin')}\r\n                    </button>\r\n                },\r\n            );\r\n        }\r\n        else {\r\n            let logOutRows: Prop[] = [\r\n            ];\r\n\r\n            rows = [\r\n                '',\r\n                {\r\n                    type: 'component',\r\n                    component: React.createElement(this.meInfo)\r\n                },\r\n\t\t\t\t'',\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: 'component',\r\n\t\t\t\t\tcomponent: <LMR className=\"w-100\" onClick={this.controller.backend}\r\n\t\t\t\t\t\tright={<FA className=\"align-self-center\" name=\"angle-right\" />}>\r\n\t\t\t\t\t\t<IconText iconClass=\"text-info mr-2\" icon=\"comments-o\" text={this.t('用户角色')} />\r\n\t\t\t\t\t</LMR>,\r\n\t\t\t\t},\t\r\n            ]\r\n            rows.push(...aboutRows, ...logOutRows);\r\n        }\r\n        return <PropGrid rows={[...rows]} values={{}} />;\r\n\t}\r\n\r\n\tprivate meInfo = observer(() => {\r\n        let { user } = nav;\r\n        if (!user) return null;\r\n        let { id, name, nick, icon } = user;\r\n        return <LMR className=\"py-2 cursor-pointer w-100\"\r\n            left={<Image className=\"w-3c h-3c mr-3\" src={icon || '.user-o'} />}\r\n            right={<FA className=\"align-self-end\" name=\"angle-right\" />}\r\n            onClick={this.controller.showEditMe}>\r\n            <div>\r\n                <div>{userSpan(name, nick)}</div>\r\n                <div className=\"small\"><span className=\"text-muted\">ID:</span> {id > 10000 ? id : String(id + 10000).substr(1)}</div>\r\n            </div>\r\n        </LMR>;\r\n    });\r\n\r\n\tprivate faq = () => {\r\n\t\tthis.openVPage(VFaq);\r\n\t}\r\n\r\n\tprivate about = () => {\r\n\t\tthis.openVPage(VAbout);\r\n\t}\r\n}\r\n\r\nfunction userSpan(name: string, nick: string): JSX.Element {\r\n    return nick ?\r\n        <><b>{nick} &nbsp; <small className=\"muted\">{name}</small></b></>\r\n        : <b>{name}</b>\r\n}\r\n","import { QueryPager, Uq, User } from \"tonva-react\";\r\nimport { CRoles } from \"tonva-uqui\";\r\nimport { CApp, CUqBase } from \"../uq-app\";\r\nimport { VEditMe } from \"./VEditMe\";\r\nimport { VMe } from \"./VMe\";\r\n\r\nexport interface RootUnitItem {\r\n\tid: number;\t\t\t\t\t// root unit id\r\n\towner: any;\r\n\tname: string;\t\t\t\t// 唯一\r\n\tcontent: string;\r\n\ttonvaUnit: number;\t\t\t// 跟tonva机构对应的值\r\n\tx: number;\r\n}\r\n\r\nexport class CMe extends CUqBase {\r\n\tprivate uq: Uq;\r\n\trole: number;\r\n\tunitOwner: User;\r\n\trootUnits: QueryPager<any>;\r\n\troles: string[] = null;\r\n\r\n\tconstructor(cApp: CApp) {\r\n\t\tsuper(cApp);\r\n\t\tthis.uq = this.uqs.BruceYuMi;\r\n\t}\r\n\r\n    protected async internalStart() {\r\n\t}\r\n\r\n\ttab = () => this.renderView(VMe);\r\n\r\n\tload = async () => {\r\n\t\tthis.roles = await this.getUqRoles(this.uq.$.name);\r\n\t}\r\n\r\n\tshowEditMe = async () => {\r\n\t\tthis.role = undefined; // result.ret[0]?.role;\r\n\t\tthis.openVPage(VEditMe);\r\n\t}\r\n\r\n\tbackend = async () => {\r\n\t\tlet cRoles = new CRoles(this.uq);\r\n\t\tawait cRoles.start();\r\n\t}\r\n}\r\n","import { Holding, Portfolio, Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\n\r\nexport class HoldingStock implements Holding, Portfolio {\r\n\tid: number;\r\n\taccount: number;\r\n\tstock: number;\r\n\tprice: number;\r\n\tquantity: number;\r\n\tcost: number;\r\n\tmiValue: number;\t\t\t\t// 米息\r\n\tmarket: number;\t\t\t// 市值\r\n\tdivident: number;\t\t// 股息\r\n\tstockObj: Stock & StockValue;\r\n\r\n\tconstructor(holdingId: number, stock: Stock & StockValue, quantity: number, cost: number) {\r\n\t\tthis.id = holdingId;\r\n\t\tthis.stock = stock.id;\r\n\t\tthis.stockObj = stock;\r\n\t\tthis.price = stock.price;\r\n\t\tthis.cost = cost? cost : quantity * this.price;\r\n\t\tthis.setQuantity(quantity);\r\n\t}\r\n\r\n\tsetQuantity(quantity: number) {\r\n\t\tthis.quantity = quantity;\r\n\t\tlet {divident, miRate} = this.stockObj;\r\n\t\tif (miRate === undefined) miRate = 0;\r\n\t\tif (divident === undefined) divident = 0;\r\n\t\tthis.market = quantity * this.price;\r\n\t\tthis.miValue = this.market * miRate / 100;\r\n\t\tthis.divident = quantity * (divident ?? 0);\r\n\t}\r\n\r\n\tchangeCost(price: number, quantity: number) {\r\n\t\tthis.cost = this.cost + price * quantity;\r\n\t}\r\n\r\n\tsetCostPrice(costPrice: number) {\r\n\t\tthis.cost = this.quantity * costPrice;\r\n\t}\r\n}\r\n","import { action, IObservableArray, makeObservable, observable, runInAction } from \"mobx\";\r\nimport { Account, AccountValue, Holding, Portfolio } from \"uq-app/uqs/BruceYuMi\";\r\nimport { HoldingStock } from \"./holdingStock\";\r\nimport { Store } from \"./store\";\r\n\r\nexport class MiAccount  implements Account, AccountValue {\r\n\tprotected store: Store;\r\n\tid: number;\r\n\tno: string;\r\n\tname: string;\r\n\tcount: number = 0; \r\n\tmiValue: number = 0;\r\n\tmarket: number = 0;\r\n\tdivident: number = 0;\r\n\tcash: number = null;\r\n\r\n\tholdingStocks: IObservableArray<HoldingStock> = null;\r\n\r\n\tconstructor(store: Store, account: Account&AccountValue) {\r\n\t\tmakeObservable(this, {\r\n\t\t\tname: observable,\r\n\t\t\tholdingStocks: observable,\r\n\t\t\tcount: observable,\r\n\t\t\tmiValue: observable,\r\n\t\t\tmarket: observable,\r\n\t\t\tdivident: observable,\r\n\t\t\tcash: observable,\r\n\t\t\tloadItems: action,\r\n\t\t\tbuyNewHolding: action,\r\n\t\t\tbuyHolding: action,\r\n\t\t\tsellHolding: action,\r\n\t\t})\r\n\t\tthis.store = store;\r\n\t\tObject.assign(this, account);\r\n\t\tthis.cash = undefined;\r\n\t}\r\n\r\n\tasync loadItems() {\r\n\t\tlet sorter = (a:HoldingStock, b:HoldingStock) => {\r\n\t\t\tlet {stockObj:ao} = a;\r\n\t\t\tlet {stockObj:bo} = b;\r\n\t\t\tlet aMiRate = ao.miRate;\r\n\t\t\tlet bMiRate = bo.miRate;\r\n\t\t\tif (aMiRate < bMiRate) return 1;\r\n\t\t\tif (aMiRate > bMiRate) return -1;\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t\tif (this.holdingStocks) {\r\n\t\t\tthis.holdingStocks.sort(sorter);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet {yumi} = this.store;\r\n\t\tlet ret = await yumi.IX<Holding&Portfolio>({\r\n\t\t\tIX: yumi.AccountHolding,\r\n\t\t\tix: this.id,\r\n\t\t\tIDX: [yumi.Holding, yumi.Portfolio]\r\n\t\t});\r\n\t\tlet noneStocks = ret.filter(v => !this.store.stockFromId(v.stock));\r\n\t\tif (noneStocks.length > 0) {\r\n\t\t\tawait yumi.ActIX({\r\n\t\t\t\tIX: yumi.UserAllStock,\r\n\t\t\t\tvalues: noneStocks.map(v => ({ix:undefined, id: v.stock}))\r\n\t\t\t});\r\n\t\t\tawait this.store.loadMyAll();\r\n\t\t}\r\n\t\trunInAction(() => {\r\n\t\t\tlet list = ret.map(v => {\r\n\t\t\t\tlet {id, stock:stockId, cost} = v;\r\n\t\t\t\tlet stock = this.store.stockFromId(stockId);\r\n\t\t\t\tlet holdingStock = new HoldingStock(id, stock, v.quantity, cost);\r\n\t\t\t\treturn holdingStock;\r\n\t\t\t});\r\n\t\t\tlist.sort(sorter);\r\n\t\t\tthis.holdingStocks = observable(list);\r\n\t\t\tthis.count = this.holdingStocks.length;\t\r\n\t\t});\r\n\t}\r\n\r\n\tasync buyNewHolding(stockId: number, price: number, quantity: number) {\r\n\t\tlet holdingId: number;\r\n\t\tlet stock = this.store.stockFromId(stockId);\r\n\t\tif (!stock) {\r\n\t\t\tstock = await this.store.loadStock(stockId);\r\n\t\t\tif (!stock) throw new Error(`stock ${stockId} not exists`);\r\n\t\t}\r\n\t\tlet index = this.holdingStocks.findIndex(v => v.stock === stockId);\r\n\t\tif (index < 0) {\r\n\t\t\tholdingId = await this.saveHolding(stockId);\r\n\t\t\tawait this.store.addMyAll(stock);\r\n\t\t\tlet hs = new HoldingStock(holdingId, stock, quantity, price*quantity);\r\n\t\t\ths.setQuantity(quantity);\r\n\t\t\ths.changeCost(price, quantity);\r\n\t\t\tthis.holdingStocks.push(hs);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet orgHs = this.holdingStocks[index];\r\n\t\t\tholdingId = orgHs.id;\r\n\t\t\tlet holdingQuantity = orgHs.quantity + quantity;\r\n\t\t\torgHs.setQuantity(holdingQuantity);\r\n\t\t\torgHs.changeCost(price, quantity);\r\n\t\t}\r\n\t\tawait this.bookHolding(holdingId, price, quantity);\r\n\t}\r\n\r\n\tasync buyHolding(stockId: number, price: number, quantity: number) {\r\n\t\tlet index = this.holdingStocks.findIndex(v => v.stock === stockId);\r\n\t\tif (index < 0) return;\r\n\t\tlet orgHs = this.holdingStocks[index];\r\n\t\tlet holdingId = orgHs.id;\r\n\t\tlet holdingQuantity = orgHs.quantity + quantity;\r\n\t\torgHs.setQuantity(holdingQuantity);\r\n\t\torgHs.changeCost(price, quantity);\r\n\t\tawait this.bookHolding(holdingId, price, quantity);\r\n\t}\r\n\r\n\tprivate async saveHolding(stock:number): Promise<number> {\r\n\t\tlet ret = await this.store.yumi.Acts({\r\n\t\t\tholding: [{account: this.id, stock}]\r\n\t\t});\r\n\t\treturn ret.holding[0];\r\n\t}\r\n\r\n\tprivate async bookHolding(holdingId:number, price:number, quantity:number): Promise<void> {\r\n\t\tthis.recalc();\r\n\t\tawait this.store.yumi.Acts({\r\n\t\t\taccountValue: [{\r\n\t\t\t\tid: this.id,\r\n\t\t\t\tmiValue: this.miValue,\r\n\t\t\t\tmarket: this.market,\r\n\t\t\t\tcount: this.count,\r\n\t\t\t}],\r\n\t\t\taccountHolding: [{\r\n\t\t\t\tix: this.id,\r\n\t\t\t\tid: holdingId\r\n\t\t\t}],\r\n\t\t\tportfolio: [{\r\n\t\t\t\tid: holdingId,\r\n\t\t\t\tquantity: quantity,\r\n\t\t\t\tcost: price * quantity,\r\n\t\t\t}],\r\n\t\t\ttransaction: [{\r\n\t\t\t\tholding: holdingId,\r\n\t\t\t\ttick: undefined,\r\n\t\t\t\tprice, \r\n\t\t\t\tquantity,\r\n\t\t\t\tamount: price * quantity,\r\n\t\t\t}],\r\n\t\t});\r\n\t}\r\n\r\n\tprivate async bookSetCost(holdingId:number, cost:number): Promise<void> {\r\n\t\tthis.recalc();\r\n\t\tawait this.store.yumi.Acts({\r\n\t\t\taccountValue: [{\r\n\t\t\t\tid: this.id,\r\n\t\t\t\tmiValue: this.miValue,\r\n\t\t\t\tmarket: this.market,\r\n\t\t\t\tcount: this.count,\r\n\t\t\t}],\r\n\t\t\tportfolio: [{\r\n\t\t\t\tid: holdingId,\r\n\t\t\t\tcost: {value:cost, act: '='},\r\n\t\t\t}],\r\n\t\t});\r\n\t}\r\n\r\n\tasync sellHolding(stockId: number, price: number, quantity: number) {\r\n\t\tlet holding = this.holdingStocks.find(v => v.stock === stockId);\r\n\t\tif (holding === undefined) return;\r\n\t\tholding.setQuantity(holding.quantity - quantity);\r\n\t\tholding.changeCost(-price, quantity);\r\n\t\tawait this.bookHolding(holding.id, price, -quantity);\r\n\t}\r\n\r\n\tasync changeCost(stockId: number, costPrice: number) {\r\n\t\tlet holding = this.holdingStocks.find(v => v.stock === stockId);\r\n\t\tif (holding === undefined) return;\r\n\t\tholding.setCostPrice(costPrice);\r\n\t\tawait this.bookSetCost(holding.id, costPrice * holding.quantity);\r\n\t}\r\n\r\n\tprivate recalc() {\r\n\t\tthis.count = this.holdingStocks.length;\r\n\t\tlet sumMiValue = 0, sumMarket = 0, sumDivident = 0;\r\n\t\tfor (let hs of this.holdingStocks) {\r\n\t\t\tlet {stockObj, market, divident} = hs;\r\n\t\t\tlet {miRate} = stockObj;\r\n\t\t\tlet miValue = miRate * market / 100;\r\n\t\t\ths.miValue = miValue;\r\n\t\t\tsumMiValue += miValue;\r\n\t\t\tsumMarket += market;\r\n\t\t\tsumDivident += divident;\r\n\t\t}\r\n\t\tthis.miValue = sumMiValue;\r\n\t\tthis.market = sumMarket;\r\n\t\tthis.divident = sumDivident;\r\n\t}\r\n\r\n\tprivate async cashAct(amount: number, act: string):Promise<void> {\r\n\t\tawait this.store.yumi.Acts({\r\n\t\t\taccountValue: [{id: this.id, cash: amount}]\r\n\t\t});\r\n\t}\r\n\r\n\tasync cashInit(amount: number) {\r\n\t\tawait this.cashAct(amount, 'init');\r\n\t\trunInAction(() => {\r\n\t\t\tif (typeof this.cash !== 'number') this.cash = amount;\r\n\t\t});\r\n\t}\r\n\r\n\tasync cashIn(amount: number) {\r\n\t\tawait this.cashAct(amount, 'in');\r\n\t\trunInAction(() => {\r\n\t\t\tif (!this.cash) this.cash = amount;\r\n\t\t\telse this.cash += amount;\r\n\t\t});\r\n\t}\r\n\r\n\tasync cashOut(amount: number) {\r\n\t\tawait this.cashAct(-amount, 'out');\r\n\t\trunInAction(() => {\r\n\t\t\tthis.cash -= amount;\r\n\t\t});\r\n\t}\r\n\r\n\tasync cashAdjust(amount: number) {\r\n\t\tawait this.cashAct(amount, 'adjust');\r\n\t\trunInAction(() => {\r\n\t\t\tif (!this.cash) this.cash = amount;\r\n\t\t\telse this.cash += amount;\r\n\t\t});\r\n\t}\r\n}\r\n","import { action, IObservableArray, makeObservable, observable } from \"mobx\";\r\nimport { ParamIX } from \"tonva-react\";\r\nimport { AccountValue, Account } from \"uq-app/uqs/BruceYuMi\";\r\nimport { MiAccount } from \"./miAccount\";\r\nimport { Store } from \"./store\";\r\n\r\nexport class MiAccounts {\r\n\tprivate store: Store;\r\n\taccounts: IObservableArray<MiAccount> = null;\r\n\r\n\tconstructor(store: Store) {\r\n\t\tmakeObservable(this, {\r\n\t\t\taccounts: observable,\r\n\t\t\tload: action,\r\n\t\t});\r\n\t\tthis.store = store;\r\n\t}\r\n\r\n\tasync load() {\r\n\t\tlet {yumi} = this.store;\r\n\t\tlet {UserAccount, Account, AccountValue} = yumi;\r\n\t\tlet param:ParamIX = {\r\n\t\t\tIX: UserAccount,\r\n\t\t\tIDX: [Account, AccountValue],\r\n\t\t\tix: undefined,\t\t\t// auto userId\r\n\t\t};\r\n\t\tlet ret = await yumi.IX<Account&AccountValue>(param);\r\n\t\tif (ret.length === 0) {\r\n\t\t\t// 没有持仓账号，则创建默认账号\r\n\t\t\t//let accountNO = await Account.NO();\r\n\t\t\tlet accountName = '我的持仓组合';\r\n\t\t\tlet retActs = await yumi.ActIX({\r\n\t\t\t\tIX: UserAccount,\r\n\t\t\t\tID: Account,\r\n\t\t\t\tvalues: [{\r\n\t\t\t\t\tix: undefined, \r\n\t\t\t\t\tid: {\r\n\t\t\t\t\t\tname: accountName, \r\n\t\t\t\t\t}\r\n\t\t\t\t}]\r\n\t\t\t});\r\n\t\t\t//ret = await this.yumi.IDinIX(param);\r\n\t\t\tret.push({\r\n\t\t\t\tid: retActs[0],\r\n\t\t\t\tname: accountName,\r\n\t\t\t} as any);\r\n\t\t}\r\n\t\tlet accounts = ret.map(v => new MiAccount(this.store, v));\r\n\t\tthis.accounts = observable(accounts);\r\n\t}\r\n\r\n\taccountsFromIds(ids: number[]): MiAccount[] {\r\n\t\tlet ret:MiAccount[] = [];\r\n\t\tlet len = this.accounts.length;\r\n\t\tfor (let i=0; i<len; i++) {\t\t\t\r\n\t\t\tlet account = this.accounts[i];\r\n\t\t\tif (ids.findIndex(v => v === account.id) >= 0) {\r\n\t\t\t\tret.push(account);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import { IObservableArray, makeObservable, observable, runInAction} from \"mobx\";\r\nimport { Group, Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { Store } from \"./store\";\r\n\r\nexport class MiGroup implements Group {\r\n\tprotected readonly store: Store;\r\n\tid: number;\r\n\tname: string;\r\n\tcount: number;\r\n\tstocks: IObservableArray<Stock & StockValue> = null;\r\n\r\n\tconstructor(store:Store, group:Group, stockCount:number) {\r\n\t\tmakeObservable(this, {\r\n\t\t\tstocks: observable,\r\n\t\t\tcount: observable,\r\n\t\t\tname: observable,\r\n\t\t});\r\n\t\tthis.store = store;\r\n\t\tObject.assign(this, group);\r\n\t\tthis.count = stockCount;\r\n\t}\r\n\r\n\tasync loadItems() {\r\n\t\tif (this.stocks) return;\r\n\t\tlet ret = await this.store.loadGroupStocks(this.id);\r\n\t\trunInAction(() => {\r\n\t\t\tthis.stocks = observable(ret, {deep: false});\r\n\t\t\tthis.count = this.stocks.length;\r\n\t\t});\r\n\t}\r\n\r\n\taddStock(stock: Stock & StockValue, stockCount: number) {\r\n\t\tif (this.stocks) {\r\n\t\t\tthis.stocks.push(stock);\r\n\t\t\tthis.count = this.stocks.length + 1;\r\n\t\t}\r\n\t}\r\n\r\n\tremoveStock(stock: Stock & StockValue, stockCount: number) {\r\n\t\tif (this.stocks) {\r\n\t\t\tlet stockId = stock.id;\r\n\t\t\tlet index = this.stocks.findIndex(v => v.id === stockId);\r\n\t\t\tif (index >= 0) this.stocks.splice(index, 1);\r\n\t\t}\r\n\t}\r\n\r\n\texists(stockId: number) {\r\n\t\treturn this.stocks?.findIndex(v => v.id === stockId) \r\n\t}\r\n}\r\n","import { IObservableArray, observable } from \"mobx\";\r\nimport { ID } from \"tonva-react\";\r\nimport { BruceYuMi } from \"uq-app\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { MiGroup } from \"./miGroup\";\r\nimport { Store } from \"./store\";\r\n\r\nexport class MiGroups {\r\n\tprivate store: Store;\r\n\tprivate readonly ID: ID;\r\n\treadonly groups: IObservableArray<MiGroup>;\r\n\r\n\tconstructor(store: Store) {\r\n\t\tthis.store = store;\r\n\t\tthis.ID = store.yumi.Group;\r\n\t\tthis.groups = observable.array<MiGroup>([], { deep: true });\r\n\t}\r\n\r\n\tasync load(): Promise<void> {\r\n\t\tlet {yumi} = this.store;\r\n\t\tlet ret = await yumi.IX<BruceYuMi.Group>({\r\n\t\t\tIX: yumi.UserGroup,\r\n\t\t\tIDX: [yumi.Group],\r\n\t\t\tix: undefined,\r\n\t\t});\r\n\t\tlet miGroups = ret.map(v => {\r\n\t\t\tlet stockCount = this.store.calcGroupStockCount(v.id);\r\n\t\t\treturn new MiGroup(this.store, v, stockCount);\r\n\t\t});\r\n\t\tthis.groups.splice(0, this.groups.length, ...miGroups);\r\n\t}\r\n\r\n\tasync addStockToGroup(stock:Stock&StockValue, group: MiGroup) {\r\n\t\tlet {yumi} = this.store;\r\n\t\tlet {stocksMyAll, groupIXs} = this.store;\r\n\t\tlet stockId = stock.id;\r\n\t\tlet groupId = group.id;\r\n\t\tawait yumi.Acts({\r\n\t\t\tgroupStock: [{ix: groupId, id: stockId, order: undefined}],\r\n\t\t\tuserAllStock: [{ix: undefined, id: stockId}],\r\n\t\t});\r\n\t\tgroupIXs.push({ix:groupId, id:stockId});\r\n\t\tlet index = stocksMyAll.findIndex(v => v.id === stockId);\r\n\t\tif (index < 0) stocksMyAll.push(stock);\r\n\t\tlet stockCount = this.store.calcGroupStockCount(groupId);\r\n\t\tgroup.addStock(stock, stockCount);\r\n\t}\r\n\r\n\tasync removeStockFromGroup(stock:Stock&StockValue, group: MiGroup) {\r\n\t\tlet {yumi} = this.store;\r\n\t\tlet stockId = stock.id;\r\n\t\tlet groupId = group.id;\r\n\t\tawait yumi.Acts({\r\n\t\t\tgroupStock: [{ix: groupId, id: -stockId, order: undefined}],\r\n\t\t});\r\n\t\tlet {groupIXs} = this.store;\r\n\t\tfor (let i=0; i<groupIXs.length; i++) {\r\n\t\t\tlet {ix, id} = groupIXs[i];\r\n\t\t\tif (id !== stockId) continue;\r\n\t\t\tif (ix !== groupId) continue;\r\n\t\t\tgroupIXs.splice(i, 1);\r\n\t\t\tlet stockCount = this.store.calcGroupStockCount(groupId);\r\n\t\t\tgroup.removeStock(stock, stockCount);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tgroupsFromIds(ids: number[]): MiGroup[] {\r\n\t\tlet ret:MiGroup[] = [];\r\n\t\tlet len = this.groups.length;\r\n\t\tfor (let i=0; i<len; i++) {\t\t\t\r\n\t\t\tlet group = this.groups[i];\r\n\t\t\tif (ids.findIndex(v => v === group.id) >= 0) {\r\n\t\t\t\tret.push(group);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","export const marketElements:{[name:string]:JSX.Element} = {\r\n\t'sz': <small className=\"text-danger\">[深]</small>,\r\n\t'sh': <small className=\"text-danger\">[沪]</small>,\r\n\t'hk': <small className=\"text-warning\">[港]</small>,\r\n}\r\n","import { IObservableArray, makeObservable, observable } from \"mobx\";\r\nimport { IXBase } from \"tonva-uqui\";\r\nimport { UQs } from \"uq-app\";\r\nimport { MiAccounts } from \"./miAccounts\";\r\nimport { MiGroups } from \"./miGroups\";\r\nimport { Market, Stock, StockValue, UqExt } from \"uq-app/uqs/BruceYuMi\";\r\nimport { MiGroup } from \"./miGroup\";\r\nimport { MiAccount } from \"./miAccount\";\r\nimport { marketElements } from \"./market\";\r\n\r\nexport class Store {\r\n\treadonly myAllColl: {[id:number]: boolean} = {};\r\n\treadonly yumi: UqExt;\r\n\treadonly markets: {[id:number]: {id?:number;name:string;currency:string;el:JSX.Element}} = {};\r\n\tmiAccounts: MiAccounts;\r\n\tmiGroups: MiGroups;\r\n\tstocksMyAll: IObservableArray<Stock & StockValue> = null;\r\n\tstocksMyBlock: IObservableArray<Stock & StockValue> = null;\r\n\tgroupIXs: IXBase[];\r\n\t\r\n\tconstructor(uqs: UQs) {\r\n\t\tmakeObservable(this, {\r\n\t\t\tmyAllColl: observable,\r\n\t\t\tstocksMyAll: observable.shallow,\r\n\t\t\tstocksMyBlock: observable.shallow,\r\n\t\t});\r\n\t\tthis.yumi = uqs.BruceYuMi;\r\n\t\tthis.miAccounts = new MiAccounts(this);\r\n\t\tthis.miGroups = new MiGroups(this);\r\n\t}\r\n\r\n\tstockFromId(stockId: number): Stock&StockValue {\r\n\t\treturn this.stocksMyAll.find(v => v.id === stockId);\r\n\t}\r\n\r\n\tasync loadStock(stockId: number): Promise<Stock&StockValue> {\r\n\t\tlet ret = await this.yumi.ID<Stock&StockValue>({\r\n\t\t\tIDX: [this.yumi.Stock, this.yumi.StockValue],\r\n\t\t\tid: stockId,\r\n\t\t});\r\n\t\tlet stock = ret[0];\r\n\t\tthis.buildStockValues(stock);\r\n\t\treturn stock;\r\n\t}\r\n\r\n\tprivate buildStockValues(stock: Stock & StockValue) {\r\n\t\tif (stock === undefined) return;\r\n\t\tlet {market} = stock;\r\n\t\t/*\r\n\t\tlet {miValue, incValue, earning, divident, price, market} = stock;\r\n\t\tif (miValue) stock.miValue = miValue;\r\n\t\tif (incValue) stock.incValue = incValue;\r\n\t\tif (earning) stock.earning = earning;\r\n\t\tif (divident) stock.divident = divident;\r\n\t\tif (price) stock.price = price;\r\n\t\t*/\r\n\t\t(stock as any).$market = this.markets[market];\r\n\t}\r\n\t\r\n\tasync searchStock(param:any, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.yumi.SearchStock.page(param, pageStart, pageSize, true);\r\n\t\tlet {$page} = ret;\r\n\t\t$page.forEach(v => this.buildStockValues(v as unknown as (Stock & StockValue)));\r\n\t\treturn ret as any;\r\n\t}\r\n\r\n\tisMyAll(stock: Stock): boolean {\r\n\t\treturn this.myAllColl[stock.id] === true;\r\n\t}\r\n\t\r\n\tasync addMyAll(stock:Stock&StockValue) {\r\n\t\tif (!stock) return;\r\n\t\tawait this.yumi.ActIX({\r\n\t\t\tIX: this.yumi.UserAllStock, \r\n\t\t\tvalues: [\r\n\t\t\t\t{ix: undefined, id: stock.id}\r\n\t\t\t]\r\n\t\t});\r\n\t\tlet stockId = stock.id;\r\n\t\tif (this.stocksMyAll.findIndex(v => v.id === stockId) < 0) {\r\n\t\t\tthis.stocksMyAll.push(stock);\r\n\t\t}\r\n\t\tthis.myAllColl[stockId] = true;\r\n\t}\r\n\r\n\tasync removeMyAll(stock: Stock&StockValue): Promise<{miAccounts: MiAccount[], miGroups: MiGroup[]}> {\r\n\t\tif (!stock) return;\r\n\t\tlet stockId = stock.id;\r\n\t\tlet ret = await this.yumi.StockUsing.query({stock: stockId});\r\n\t\tlet {groups, accounts} = ret;\r\n\t\tif (groups.length > 0 || accounts.length > 0) {\r\n\t\t\tlet miAccounts = this.miAccounts.accountsFromIds(accounts.map(v => v.account));\r\n\t\t\tlet miGroups = this.miGroups.groupsFromIds(groups.map(v => v.group));\r\n\t\t\treturn {miAccounts, miGroups};\r\n\t\t}\r\n\r\n\t\tawait this.yumi.ActIX({\r\n\t\t\tIX: this.yumi.UserAllStock, \r\n\t\t\tvalues: [\r\n\t\t\t\t{ix: undefined, id: -stockId}\r\n\t\t\t]\r\n\t\t});\r\n\t\tlet index = this.stocksMyAll.findIndex(v => v.id === stockId);\r\n\t\tif (index >= 0) this.stocksMyAll.splice(index, 1);\r\n\t\tdelete this.myAllColl[stockId];\r\n\t}\r\n\r\n\tmyAllCaption: string = '自选股';\r\n\tmyBlockCaption: string = '黑名单';\r\n\r\n\tasync loadMyAll() {\r\n\t\tlet ret = await this.yumi.IX<(Stock&StockValue)>({\r\n\t\t\tIX: this.yumi.UserAllStock,\r\n\t\t\tIDX: [this.yumi.Stock, this.yumi.StockValue],\r\n\t\t\tix: undefined,\r\n\t\t});\r\n\t\tret.forEach(v => {\r\n\t\t\tthis.buildStockValues(v);\r\n\t\t\tthis.myAllColl[v.id] = true;\r\n\t\t});\r\n\t\tthis.stocksMyAll = observable(ret, {deep: false});\r\n\t}\r\n\r\n\tasync loadMyBlock() {\r\n\t\tif (this.stocksMyBlock) return;\r\n\t\tlet {yumi} = this;\r\n\t\tlet ret = await yumi.IX<(Stock&StockValue)>({\r\n\t\t\tIX: yumi.UserBlockStock,\r\n\t\t\tIDX: [yumi.Stock, yumi.StockValue],\r\n\t\t\tix: undefined,\r\n\t\t});\r\n\t\tret.forEach(v => this.buildStockValues(v));\r\n\t\tthis.stocksMyBlock = observable(ret, {deep: false});\r\n\t}\r\n\r\n\tasync loadGroupStocks(groupId: number):Promise<(Stock&StockValue)[]> {\r\n\t\tlet ret = this.stocksMyAll.filter(v => {\r\n\t\t\tlet stockId = v.id;\r\n\t\t\tlet ok = this.groupIXs.findIndex(gs => {\r\n\t\t\t\tlet {ix, id:gStockId} = gs;\r\n\t\t\t\treturn ix===groupId && gStockId===stockId;\r\n\t\t\t}) >= 0;\r\n\t\t\treturn ok;\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync loadMarkets() {\r\n\t\tlet {yumi} = this;\r\n\t\tlet ret = await yumi.ID<Market>({\r\n\t\t\tIDX: [yumi.Market],\r\n\t\t\tid: undefined,\r\n\t\t});\r\n\t\tfor (let m of ret) {\r\n\t\t\tlet {id, name} = m;\r\n\t\t\tthis.markets[id] = {...m, el: marketElements[name]};\r\n\t\t}\r\n\t}\r\n\r\n\tisMyBlock(stock: Stock): boolean {\r\n\t\tlet index = this.stocksMyBlock.findIndex(v => v.id === stock.id);\r\n\t\treturn index >= 0;\r\n\t}\r\n\r\n\tasync toggleBlock(stock: Stock&StockValue) {\r\n\t\tif (!stock) return;\r\n\t\tawait this.loadMyBlock();\r\n\t\tlet {id} = stock;\r\n\t\tlet index = this.stocksMyBlock.findIndex(v => v.id === id);\r\n\t\tif (index >= 0) {\r\n\t\t\tawait this.yumi.ActIX({\r\n\t\t\t\tIX: this.yumi.UserBlockStock,\r\n\t\t\t\tvalues: [{ix:undefined, id: -id}]\r\n\t\t\t})\r\n\t\t\tthis.stocksMyBlock.splice(index, 1);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tawait this.yumi.ActIX({\r\n\t\t\t\tIX: this.yumi.UserBlockStock,\r\n\t\t\t\tvalues: [{ix:undefined, id}]\r\n\t\t\t})\r\n\t\t\tthis.stocksMyBlock.push(stock);\r\n\t\t}\r\n\t}\r\n\r\n\t/*\r\n\t@observable config: MiConfigs = { \r\n\t\tgroupName: defaultGroupName, \r\n\t\tstockFind: { sortType:'pe' },\r\n\t\tuserStock: { sortType:'tagpe'},\r\n\t\tregression: {bmin:0, bmax:0.5, r2:0.7, lmin:0.01, lmax:0.5, lr2:0.7, mcount:2, lr4: 3, r210:0.6, irate:0.04}\r\n\t};\r\n\t*/\r\n\r\n\tasync load() {\r\n\t\tawait this.loadMarkets();\r\n\t\tawait Promise.all([\r\n\t\t\tthis.miAccounts.load(),\r\n\t\t\tthis.loadMyAll(),\r\n\t\t\tthis.loadGroupIXs(),\r\n\t\t\tthis.miGroups.load(),\r\n\t\t]);\r\n\t}\r\n\r\n\tprivate async loadGroupIXs() {\r\n\t\tlet {yumi} = this;\r\n\t\tlet ret = await yumi.IX<IXBase>({\r\n\t\t\tIX: yumi.UserGroup,\r\n\t\t\tIX1: yumi.GroupStock,\r\n\t\t\tix: undefined,\r\n\t\t});\r\n\t\tthis.groupIXs = ret;\r\n\t}\r\n\r\n\tstockInNGroup(stock:Stock): number {\r\n\t\tlet nGroup = 0;\r\n\t\tlet {groupIXs} = this;\r\n\t\tlet stockId = stock.id;\r\n\t\tfor (let i=0; i<groupIXs.length; i++) {\r\n\t\t\tlet {id} = groupIXs[i];\r\n\t\t\tif (id === stockId) ++nGroup;\r\n\t\t}\r\n\t\treturn nGroup;\r\n\t}\r\n\r\n\tcalcGroupStockCount(groupId: number): number {\r\n\t\tif (!this.groupIXs) return;\r\n\t\tlet count = 0;\r\n\t\tfor (let gs of this.groupIXs) {\r\n\t\t\tlet {ix} = gs;\r\n\t\t\tif (ix === groupId) ++count;\r\n\t\t}\r\n\t\treturn count;\r\n\t}\r\n\r\n\tbuildInGroup(stockId: number): {[groupId:number]:boolean} {\r\n\t\tlet inGroup:{[groupId:number]:boolean} = {};\r\n\t\tfor (let gs of this.groupIXs) {\r\n\t\t\tlet {ix, id} = gs;\r\n\t\t\tif (id === stockId) inGroup[ix] = true;\r\n\t\t}\r\n\t\treturn inGroup;\r\n\t}\r\n}\r\n","import React from \"react\";\r\nimport { observer } from \"mobx-react\";\r\nimport { DropdownAction, DropdownActions, VPage } from \"tonva-react\";\r\nimport { CHome } from \"./CHome\";\r\n\r\nexport class VHome extends VPage<CHome> {\r\n\theader() { return '首页'; }\r\n\tcontent() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet {cAccount} = this.controller;\r\n\t\t\treturn <div className=\"pb-3\">\r\n\t\t\t\t{cAccount.renderAccounts()}\r\n\t\t\t</div>;\r\n\t\t}));\r\n\t}\r\n\r\n\tright() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet {cCommon} = this.controller.cApp;\r\n\t\t\tlet actions: DropdownAction[] = [\r\n\t\t\t\t{\r\n\t\t\t\t\tcaption: '管理持仓账户',\r\n\t\t\t\t\taction: cCommon.manageAccounts,\r\n\t\t\t\t\ticon: 'money',\r\n\t\t\t\t},\r\n\t\t\t];\r\n\t\t\treturn <DropdownActions actions={actions} icon=\"bars\" className=\"mr-2 text-white bg-transparent border-0\" />;\r\n\t\t}));\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport scrollIntoView from 'scroll-into-view-if-needed';\r\nimport { DropdownAction, DropdownActions, FA, List, LMR, VPage } from \"tonva-react\";\r\nimport { nFormat0, nFormat1, smallPercent } from \"tool\";\r\nimport { HoldingStock } from \"../../store\";\r\nimport { CAccount } from \"./CAccount\";\r\n\r\nexport class VAccount extends VPage<CAccount> {\r\n\tprivate actionsElement: ChildNode;\r\n\tprivate renderPageRight: () => JSX.Element;\r\n\tinit(param: {\r\n\t\trenderPageRight: () => JSX.Element;\r\n\t}) {\r\n\t\tlet {renderPageRight} = param;\r\n\t\tthis.renderPageRight = renderPageRight;\r\n\t}\r\n\r\n\theader() {\r\n\t\treturn React.createElement(observer(() => <>{this.controller.miAccount.name}</>));\r\n\t}\r\n\tright() {return this.renderPageRight?.()}\r\n\tcontent() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tfunction valueToString(value:number, suffix: string|JSX.Element = undefined):JSX.Element {\r\n\t\t\t\tif (isNaN(value) === true) return <>-</>;\r\n\t\t\t\treturn <>{(value??0).toLocaleString(undefined, nFormat1)}{suffix}</>;\r\n\t\t\t}\r\n\t\t\tfunction renderValue(caption:string, content:string|JSX.Element, cn:string = '') {\r\n\t\t\t\treturn <div className={'my-1 mx-1 mx-sm-2 border rounded w-min-5c px-1 px-sm-2 py-2 ' + cn}>\r\n\t\t\t\t\t<small className=\"text-muted\">{caption}</small>\r\n\t\t\t\t\t<div>{content}</div>\r\n\t\t\t\t</div>;\r\n\t\t\t}\r\n\t\t\tlet renderCash = (value:number) => {\r\n\t\t\t\tlet caption = '现金';\r\n\t\t\t\tif (typeof value === 'number') return renderValue(caption, valueToString(value));\r\n\t\t\t\treturn <div className=\"my-1 mx-1 mx-sm-2 border rounded w-min-5c px-1 px-sm-2 py-2\">\r\n\t\t\t\t\t<small className=\"text-muted\">{caption}</small>\r\n\t\t\t\t\t<div className=\"text-danger small mt-1\">[无]</div>\r\n\t\t\t\t</div>;\r\n\t\t\t}\r\n\t\t\tlet {miAccount, showBuy, showCashIn, showCashOut, showCashAdjust} = this.controller;\r\n\t\t\tlet {no, name, miValue: mi, market, cash, holdingStocks} = miAccount;\r\n\r\n\t\t\tlet holdings:HoldingStock[], holdings0:HoldingStock[];\r\n\t\t\tif (holdingStocks) {\r\n\t\t\t\tholdings = [];\r\n\t\t\t\tholdings0 = [];\r\n\t\t\t\tlet len = holdingStocks.length;\r\n\t\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\t\tlet holding = holdingStocks[i];\r\n\t\t\t\t\tif (holding.quantity === 0) holdings0.push(holding);\r\n\t\t\t\t\telse holdings.push(holding);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlet actions: DropdownAction[] = [\r\n\t\t\t\t{ caption: '调入资金', action: showCashIn, icon: 'sign-in' },\r\n\t\t\t\t{ caption: '调出资金', action: showCashOut, icon: 'sign-out' },\r\n\t\t\t\t{ caption: '调整资金', action: showCashAdjust, icon: 'adjust' },\r\n\t\t\t];\r\n\t\t\treturn <div className=\"pb-3\">\r\n\t\t\t\t<div className=\"mb-3 px-3 py-2 bg-white\">\r\n\t\t\t\t\t<LMR right={<small className=\"text-muted\">组合编号: {no}</small>}>\r\n\t\t\t\t\t\t{name}\r\n\t\t\t\t\t</LMR>\r\n\t\t\t\t\t<div className=\"my-3 text-center d-flex justify-content-center flex-wrap\">\r\n\t\t\t\t\t\t{renderValue('米息', valueToString(mi), 'd-none d-sm-block')}\r\n\t\t\t\t\t\t{renderValue('米息率', valueToString(mi*100/market, smallPercent))}\r\n\t\t\t\t\t\t{renderValue('市值', valueToString(market))}\r\n\t\t\t\t\t\t{renderCash(cash)}\r\n\t\t\t\t\t\t{typeof cash === 'number' && renderValue('总值', valueToString(market + cash))}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div className=\"mb-3 mx-3 d-flex\">\r\n\t\t\t\t\t<button className=\"btn btn-outline-primary mr-3\" onClick={() => showBuy()}>买股</button>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttypeof cash === 'number'?\r\n\t\t\t\t\t\t\t<DropdownActions className=\"btn btn-outline-warning\"\r\n\t\t\t\t\t\t\t\tcontainerClass=\"ml-auto\"\r\n\t\t\t\t\t\t\t\tactions={actions} icon=\"money\" content=\"资金\" />\r\n\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\t<button className=\"btn btn-outline-info ml-auto\" onClick={this.controller.showCashInit}>\r\n\t\t\t\t\t\t\t\t<FA name=\"cog\" className=\"small text-info\" /> 初始资金\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div className=\"px-2 px-sm-3 py-1 container\">\r\n\t\t\t\t\t<div className=\"small text-muted row mx-0\">\r\n\t\t\t\t\t\t<div className=\"col-3 px-0\">持仓市值</div>\r\n\t\t\t\t\t\t<div className=\"col px-0 text-right\">持仓</div>\r\n\t\t\t\t\t\t<div className=\"col px-0 text-right\">米息率</div>\r\n\t\t\t\t\t\t<div className=\"col px-0 text-right\">\r\n\t\t\t\t\t\t\t市价<br/>\r\n\t\t\t\t\t\t\t成本价\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"col px-0 text-right\">\r\n\t\t\t\t\t\t\t盈亏<br/>\r\n\t\t\t\t\t\t\t比例\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<List items={holdings}\r\n\t\t\t\t\titem={{render: this.renderHolding}} />\r\n\t\t\t\t{\r\n\t\t\t\t\tholdings0 && holdings0.length > 0 && <>\r\n\t\t\t\t\t\t<div className=\"small text-muted px-3 py-1 mt-3\">已清仓</div>\r\n\t\t\t\t\t\t<List items={holdings0}\r\n\t\t\t\t\t\t\titem={{render: this.renderHolding}} />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t</div>;\r\n\t\t}));\r\n\t}\r\n\r\n\tprivate f0String(v:number, suffix:string|JSX.Element = ''):string|JSX.Element {\r\n\t\tif (v === null || v === undefined || isNaN(v) === true) return '-';\r\n\t\treturn <>{v.toLocaleString(undefined, nFormat0)}{suffix}</>;\r\n\t}\r\n\r\n\tprivate f1String(v:number, suffix:string|JSX.Element = ''):string|JSX.Element {\r\n\t\tif (v === null || v === undefined || isNaN(v) === true) return '-';\r\n\t\treturn <>{v.toLocaleString(undefined, nFormat1)}{suffix}</>;\r\n\t}\r\n\r\n\tprivate hideActionsElement() {\r\n\t\tif (this.actionsElement) {\r\n\t\t\t(this.actionsElement as HTMLDivElement).className = 'd-none';\r\n\t\t\tthis.actionsElement = undefined;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate renderHolding = (holding: HoldingStock, index: number) => {\r\n\t\tlet {showHolding, showBuy, showSell, showChangeCost, showTransactionDetail} = this.controller;\r\n\t\tlet {stockObj, quantity, market, cost} = holding;\r\n\t\tlet {name} = stockObj;\r\n\t\tlet onClick = (evt: React.MouseEvent) => {\r\n\t\t\tif (this.actionsElement) {\r\n\t\t\t\t(this.actionsElement as HTMLDivElement).className = 'd-none';\r\n\t\t\t}\r\n\t\t\tlet actionsElement = evt.currentTarget.nextSibling;\r\n\t\t\tif (actionsElement !== this.actionsElement) {\r\n\t\t\t\tthis.actionsElement = actionsElement;\r\n\t\t\t\t(this.actionsElement as HTMLDivElement).className = 'd-block';\r\n\t\t\t\tscrollIntoView(this.actionsElement as HTMLDivElement, { scrollMode: 'if-needed', behavior: 'smooth' });\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.actionsElement = undefined;\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet {miRate, price} = stockObj;\r\n\t\tlet cn: string;\r\n\t\tif (cost>market) {\r\n\t\t\tcn = 'text-success';\r\n\t\t}\r\n\t\telse if (cost<market) {\r\n\t\t\tcn = 'text-danger';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tcn = '';\r\n\t\t}\r\n\t\treturn <div className=\"d-block px-2 px-sm-3 py-1 container\">\r\n\t\t\t<div className={'row mx-0 cursor-pointer ' + cn}\r\n\t\t\t\tonClick={onClick}>\r\n\t\t\t\t<div className=\"col-3 px-0\">\r\n\t\t\t\t\t<div>{name}</div>\r\n\t\t\t\t\t<div className=\"\">{this.f1String(market)}</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"col px-0 text-right\">{this.f0String(quantity)}</div>\r\n\t\t\t\t<div className=\"col px-0 text-right\">{this.f1String(miRate, smallPercent)}</div>\r\n\t\t\t\t<div className=\"col px-0 text-right\">\r\n\t\t\t\t\t<div className=\"text-right\">{this.f1String(price)}</div>\r\n\t\t\t\t\t<div className=\"text-right\">{this.f1String(cost/quantity)}</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"col px-0 text-right\">\r\n\t\t\t\t\t<div className=\"text-right\">{this.f1String(market - cost)}</div>\r\n\t\t\t\t\t<div className=\"text-right\">{this.f1String((market - cost)*100/cost, smallPercent)}</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"d-none\">\r\n\t\t\t\t<div className=\"d-flex mt-2 px-2 pt-2 pb-1 align-items-center border-top\" \r\n\t\t\t\t\tonClick={()=>this.hideActionsElement()}>\r\n\t\t\t\t\t<button className=\"btn btn-sm btn-outline-info mr-3 \"\r\n\t\t\t\t\t\tonClick={() => showBuy(holding)}>买入</button>\r\n\t\t\t\t\t<button className=\"btn btn-sm btn-outline-info mr-3 \"\r\n\t\t\t\t\t\tonClick={() => showSell(holding)}>卖出</button>\r\n\t\t\t\t\t<button className=\"btn btn-sm btn-link ml-auto \"\r\n\t\t\t\t\t\tonClick={() => showChangeCost(holding)}>改成本</button>\r\n\t\t\t\t\t<button className=\"btn btn-sm btn-link ml-3 \"\r\n\t\t\t\t\t\tonClick={() => showTransactionDetail(holding)}>明细</button>\r\n\t\t\t\t\t<button className=\"btn btn-sm btn-link ml-3 \"\r\n\t\t\t\t\t\tonClick={() => showHolding(holding)}>分析</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderValue(caption:string, value: number, format: Intl.NumberFormatOptions, suffix:string, cn: string) {\r\n\t\treturn <>\r\n\t\t\t<div className={'text-right pl-2 d-block d-sm-none'}>\r\n\t\t\t\t<div className=\"d-inline-block small text-muted\">{caption}:&nbsp;</div>\r\n\t\t\t\t<div className={'d-inline-block w-min-6c'}>{value?.toLocaleString(undefined, format)}{suffix}</div>\r\n\t\t\t</div>\r\n\t\t\t<div className={'text-right pl-3 d-sm-block d-none ' + cn}>\r\n\t\t\t\t<div className=\"small text-muted\">{caption}</div>\r\n\t\t\t\t<div>{value?.toLocaleString(undefined, format)}{suffix}</div>\r\n\t\t\t</div>\r\n\t\t</>;\r\n\t}\r\n}\r\n","import { IntSchema, ButtonSchema, UiNumberItem, UiButton, Form, Schema, VPage, UiSchema, Context, NumSchema, IdSchema, UiIdItem, ItemSchema } from \"tonva-react\";\r\nimport { formatNumber } from \"tool\";\r\nimport { Stock } from \"uq-app/uqs/BruceYuMi\";\r\nimport { CAccount } from \"./CAccount\";\r\n\r\nabstract class VForm extends VPage<CAccount> {\r\n\tprotected form: Form;\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'close'}\r\n\tprotected onCheckValue(value:any): string[] | string {\r\n\t\treturn;\r\n    }\r\n\r\n\tprotected get valueLabel(): string {return '股票数量'}\r\n\tprotected get placeholder(): string {return '股票数量'}\r\n\tprotected get valueSchema(): ItemSchema {\r\n\t\treturn { name: 'value', type: 'integer', min: 0, required: true } as IntSchema;\r\n\t}\r\n\r\n\tprotected schema: Schema = [\r\n\t\tthis.valueSchema,\r\n\t\t{ name: 'submit', type: 'submit'} as ButtonSchema,\r\n\t];\r\n\r\n\tprotected uiSchema: UiSchema = {\r\n\t\titems: {\r\n\t\t\tvalue: {\r\n\t\t\t\twidget: 'number',\r\n\t\t\t\tmin: 0,\r\n\t\t\t\tstep: 1,\r\n\t\t\t\tlabel: this.valueLabel,\r\n\t\t\t\tplaceholder: this.placeholder,\r\n\t\t\t\trules: (value:any) => this.onCheckValue(value),\r\n\t\t\t} as UiNumberItem,\r\n\t\t\tsubmit: {\r\n\t\t\t\twidget: 'button', className: 'btn btn-primary w-25', label: '提交', disabled: false,\r\n\t\t\t} as UiButton,\r\n\t\t}\r\n\t}\r\n\r\n\tprotected renderStock(): JSX.Element {\r\n\t\tlet {holdingStock} = this.controller;\r\n\t\tif (!holdingStock) return null;\r\n\t\tlet {stockObj, quantity, miValue, market} = holdingStock;\r\n\t\tlet {name, code} = stockObj;\r\n\t\treturn <div className=\"py-2\">\r\n\t\t\t<div className=\"mr-auto px-3 mb-2\">\r\n\t\t\t\t<b>{name}</b> <span className=\"ml-2 small text-muted\">{code}</span>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"d-flex my-2 py-2 border-top border-bottom justify-content-center text-center bg-white\">\r\n\t\t\t\t{this.renderQuantity('股数', quantity)}\r\n\t\t\t\t{this.renderValue('米息', miValue, 2)}\r\n\t\t\t\t{this.renderValue('市值', market, 2)}\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderValue(caption:string, value: number, dec: number = 0) {\r\n\t\treturn <div className=\"mx-1 border rounded w-min-5c px-1 py-2\">\r\n\t\t\t<small className=\"text-muted\">{caption}</small>\r\n\t\t\t<div>{formatNumber(value??0)}</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprotected renderQuantity(caption:string, value: number, dec: number = 0) {\r\n\t\treturn this.renderValue(caption, value, dec);\r\n\t}\r\n\r\n\tprotected beforeRender() {}\r\n\r\n\tprotected renderForm(): JSX.Element {\r\n\t\tthis.beforeRender();\r\n\t\treturn <Form ref={f => this.form = f} className=\"mx-3\"\r\n\t\t\tonButtonClick={this.onFormSubmit}\r\n\t\t\tonEnter={this.onFormSubmit}\r\n\t\t\tfieldLabelSize={3}\r\n\t\t\tfieldLabelAlign='right'\r\n\t\t\tschema={this.schema}\r\n\t\t\tuiSchema={this.uiSchema} />;\r\n\t}\r\n\r\n\tprivate onFormSubmit = async (name:string, context: Context):Promise<void> => {\r\n\t\tcontext.setDisabled(name, true);\r\n\t\tawait this.onSubmit(context.data);\r\n\t\tcontext.setDisabled(name, false);\r\n\t\tthis.closePage();\r\n\t}\r\n\r\n\tprotected abstract onSubmit(data:any): Promise<void>;\r\n\r\n\tcontent() {\r\n\t\treturn <div className=\"my-3\">\r\n\t\t\t{this.renderStock()}\r\n\t\t\t{this.renderForm()}\r\n\t\t</div>;\r\n\t}\r\n}\r\n\r\nabstract class VStock extends VForm {\r\n\tprotected beforeRender() {\r\n\t\tsuper.beforeRender();\r\n\t\tthis.schema.unshift(\r\n\t\t\t{ name: 'price', type: 'number', min: 0, required: true } as NumSchema,\r\n\t\t);\r\n\t\tthis.uiSchema.items['price'] = {\r\n\t\t\twidget: 'number',\r\n\t\t\tmin: 0,\r\n\t\t\tstep: 1,\r\n\t\t\tlabel: '价格',\r\n\t\t\tplaceholder: '股票价格',\r\n\t\t\tdefaultValue: this.controller.holdingStock?.stockObj.price\r\n\t\t\t//rules: (value:any) => this.onCheckValue(value),\r\n\t\t} as UiNumberItem;\r\n\t}\r\n}\r\n\r\nabstract class VBuy extends VStock {\r\n\tprotected beforeRender() {\r\n\t\tsuper.beforeRender();\r\n\t\tthis.uiSchema.rules = [this.checkCash];\r\n\t}\r\n\tprotected checkCash = (context:Context): string[] | string => {\r\n\t\tlet {holdingStock, miAccount} = this.controller;\r\n\t\tlet {cash} = miAccount;\r\n\t\tif (typeof cash !== 'number') return;\r\n\t\tlet {stockObj} = holdingStock;\r\n\t\tlet quantity = context.data.quantity;\r\n\t\tlet {price} = stockObj;\r\n\t\tif ((quantity as number) * (price as number) > (cash as number))\r\n\t\t\treturn `超过账户资金余额，无法买入`;\r\n    }\r\n}\r\n\r\nexport class VBuyNew extends VBuy {\r\n\theader() {return '新买股票'}\r\n\tprotected beforeRender() {\r\n\t\tsuper.beforeRender();\r\n\t\tthis.schema.unshift(\r\n\t\t\t{ name: 'stock', type: 'id', required: true } as IdSchema,\r\n\t\t);\r\n\t\tthis.uiSchema.items['stock'] = {\r\n\t\t\twidget: 'id',\r\n\t\t\tlabel: '股票',\r\n\t\t\tpickId: this.controller.createPickStockId(),\r\n\t\t\tplaceholder: '请选择股票',\r\n\t\t\tTemplet: this.renderStockPick,\r\n\t\t} as UiIdItem;\r\n\t}\r\n\r\n\tprivate renderStockPick = (values: Stock):JSX.Element => {\r\n\t\tlet {name, code} = values;\r\n\t\treturn <>{name} <small className=\"text-muted\">{code}</small></>;\r\n\t}\r\n\r\n\tprotected async onSubmit(data:any): Promise<void> {\r\n\t\tlet {stock, price, value} = data;\r\n\t\tawait this.controller.submitBuyNew(stock.id, price, value);\r\n\t}\r\n}\r\n\r\nexport class VBuyExist extends VBuy {\r\n\theader() {return '加买股票'}\r\n\tprotected get placeholder(): string {return '加买数量'}\r\n\r\n\tprotected async onSubmit(data:any): Promise<void> {\r\n\t\tlet {price, value} = data;\r\n\t\tawait this.controller.submitBuy(price, value);\r\n\t}\r\n}\r\n\r\nexport class VSell extends VStock {\r\n\theader() {return '卖出股票'}\r\n\tprotected get placeholder(): string {return '卖出数量'}\r\n\tprotected onCheckValue(value:any): string[] | string {\r\n\t\tlet {holdingStock} = this.controller;\r\n\t\tlet {quantity} = holdingStock;\r\n\t\tif (value > quantity)\r\n\t\t\treturn `现有持股${quantity}，卖出数量超出`;\r\n    }\r\n\r\n\tprotected async onSubmit(data:any): Promise<void> {\r\n\t\tlet {price, value} = data;\r\n\t\tawait this.controller.submitSell(price, value);\r\n\t}\r\n\r\n\tprotected renderQuantity(caption:string, value: number, dec: number = 0) {\r\n\t\treturn <div className=\"mx-1 border border-info rounded w-min-5c px-1 py-2 cursor-pointer\"\r\n\t\t\tonClick={this.onClickQuantity}>\r\n\t\t\t<small className=\"text-muted\">{caption}</small>\r\n\t\t\t<div>{formatNumber(value??0)}</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate onClickQuantity = () => {\r\n\t\tthis.form.formContext.setValue('value', this.controller.holdingStock.quantity);\r\n\t}\r\n}\r\n\r\nexport class VChangeCost extends VForm {\r\n\theader() {return '修改成本'}\r\n\tprotected get valueLabel(): string {return '新成本'}\r\n\tprotected get placeholder(): string {return '新股票成本'}\r\n\tprotected get valueSchema(): ItemSchema {\r\n\t\treturn { name: 'value', type: 'number', min: 0.01, required: true } as NumSchema;\r\n\t}\r\n\tprotected beforeRender() {\r\n\t\tlet {holdingStock} = this.controller;\r\n\t\tif (!holdingStock) return;\r\n\t\tlet {price} = holdingStock;\r\n\t\tthis.uiSchema.items.value.defaultValue = price.toFixed(2);\r\n\t}\r\n\tprotected async onSubmit(data:any): Promise<void> {\r\n\t\tlet {value} = data;\r\n\t\tawait this.controller.submitChangeCost(value);\r\n\t}\r\n}\r\n\r\nabstract class VCash extends VForm {\r\n\tprotected get valueLabel(): string {return '资金数量'}\r\n\tprotected renderStock(): JSX.Element {return null}\r\n}\r\n\r\nexport class VCashInit extends VCash {\r\n\theader() {return '期初资金'}\r\n\tprotected get placeholder(): string {return '期初金额'}\r\n\tprotected async onSubmit(data:any): Promise<void> {\r\n\t\tlet {value} = data;\r\n\t\tawait this.controller.submitCashInit(value);\r\n\t}\r\n}\r\n\r\nexport class VCashIn extends VCash {\r\n\theader() {return '调入资金'}\r\n\tprotected get placeholder(): string {return '调入金额'}\r\n\tprotected async onSubmit(data:any): Promise<void> {\r\n\t\tlet {value} = data;\r\n\t\tawait this.controller.submitCashIn(value);\r\n\t}\r\n}\r\n\r\nexport class VCashOut extends VCash {\r\n\theader() {return '调出资金'}\r\n\tprotected get placeholder(): string {return '调出金额'}\r\n\tprotected onCheckValue(value:any): string[] | string {\r\n\t\tlet {cash} = this.controller.miAccount; \r\n\t\tif (value > cash)\r\n\t\t\treturn `调出金额不能超过总现金${cash}`;\r\n    }\r\n\tprotected async onSubmit(data:any): Promise<void> {\r\n\t\tlet {value} = data;\r\n\t\tawait this.controller.submitCashOut(value);\r\n\t}\r\n}\r\n\r\nexport class VCashAdjust extends VCash {\r\n\theader() {return '调整资金'}\r\n\tprotected beforeRender() {\r\n\t\t(this.schema[0] as IntSchema).min = undefined;\r\n\t}\r\n\tprotected get placeholder(): string {return '调整金额'}\r\n\tprotected onCheckValue(value:any): string[] | string {\r\n\t\tlet {cash} = this.controller.miAccount; \r\n\t\tif (value < 0 && -value > cash)\r\n\t\t\treturn `负向调整金额不能超过总现金${cash}`;\r\n    }\r\n\tprotected async onSubmit(data:any): Promise<void> {\r\n\t\tlet {value} = data;\r\n\t\tawait this.controller.submitCashAdjust(value);\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { MiAccount } from \"store\";\r\nimport { FA, List, LMR, View } from \"tonva-react\";\r\nimport { nFormat1, smallPercent } from \"tool\";\r\nimport { Account, AccountValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { CAccount } from \"./CAccount\";\r\n\r\nexport class VAccounts extends View<CAccount> {\r\n\trender():JSX.Element {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet {cApp} = this.controller;\r\n\t\t\tlet {miAccounts} = cApp.store;\r\n\t\t\tlet listHeader = (caption:string) => <div className=\"small text-muted pt-2 pb-1 px-3\">{caption}</div>;\r\n\t\t\treturn <>\r\n\t\t\t\t{listHeader('持仓')}\r\n\t\t\t\t<List items={miAccounts.accounts} item={{render: this.renderAccount, onClick: this.onClickAccount}} />\r\n\t\t\t</>;\r\n\t\t}));\r\n\t}\r\n\r\n\tprivate onClickAccount = (item: MiAccount) => {\r\n\t\tthis.controller.showAccount(item);\r\n\t}\r\n\r\n\tprivate renderAccount = (item:Account&AccountValue, index:number):JSX.Element => {\r\n\t\tfunction valueToString(value:number, suffix?:string|JSX.Element):JSX.Element {\r\n\t\t\treturn <>{(value??0).toLocaleString(undefined, nFormat1)}{suffix}</>\r\n\t\t}\r\n\t\tfunction renderValue(caption:string, content:JSX.Element, cn:string='') {\r\n\t\t\treturn <div className={'pr-3 ' + cn}>\r\n\t\t\t\t<small className=\"text-muted\">{caption}: </small>\r\n\t\t\t\t{content}\r\n\t\t\t</div>;\r\n\t\t}\r\n\t\tlet {name, miValue: mi, market, count} = item;\r\n\t\tlet left = <FA name=\"money\" className=\"text-warning align-self-start mt-3 ml-2 ml-sm-3\" size=\"lg\" fixWidth={true} />;\r\n\t\tlet right = <div className=\"px-2 d-flex align-items-center\">\r\n\t\t\t<FA className=\"align-\" name=\"angle-right\" />\r\n\t\t</div>;\r\n\t\treturn <LMR left={left} right={right}>\r\n\t\t\t<div className=\"px-2 px-sm-3 py-2 bg-white d-block\">\r\n\t\t\t{\r\n\t\t\t\tcount > 0?\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t{name}\r\n\t\t\t\t\t\t\t<small className=\"ml-3 text-danger\">{count}</small>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"mt-2 d-flex\">\r\n\t\t\t\t\t\t\t{renderValue('米息率', valueToString(mi*100/market, smallPercent), 'w-min-8c')}\r\n\t\t\t\t\t\t\t{renderValue('米息', valueToString(mi), 'd-none d-sm-block w-min-8c')}\r\n\t\t\t\t\t\t\t{renderValue('市值', valueToString(market))}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</>\r\n\t\t\t\t\t:\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<div className=\"py-1\">\r\n\t\t\t\t\t\t\t{name}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</>\r\n\t\t\t}\r\n\t\t\t</div>\r\n\t\t</LMR>;\r\n\t}\r\n}\r\n","import React from \"react\";\r\nimport { observer } from \"mobx-react\";\r\nimport { List, SearchBox, VPage } from \"tonva-react\";\r\nimport { renderStockName } from \"tool\";\r\nimport { Stock } from \"uq-app/uqs/BruceYuMi\";\r\nimport { CAccount } from \"./CAccount\";\r\n\r\nexport class VPickStock extends VPage<CAccount> {\r\n\theader() {return '选择股票'}\r\n\tright() {\r\n\t\treturn <SearchBox \r\n\t\t\tclassName=\"mr-2\"\r\n\t\t\tonSearch={this.controller.onSearchStock} \r\n\t\t\tplaceholder=\"股票名称或代码\" />;\r\n\t}\r\n\tcontent() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\treturn <div>\r\n\t\t\t\t<List items={this.controller.stocks} item={{render: this.renderStock, onClick: this.onClickStock}} />\r\n\t\t\t</div>;\r\n\t\t}));\r\n\t}\r\n\r\n\tprivate renderStock = (stock: Stock, index: number): JSX.Element => {\r\n\t\treturn <div className=\"px-3 py-2\">\r\n\t\t\t{renderStockName(stock)}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate onClickStock = (stock: Stock) => {\r\n\t\tthis.returnCall(stock);\r\n\t\tthis.closePage();\r\n\t}\r\n}\r\n","import { IObservableArray, makeObservable, observable } from \"mobx\";\r\nimport { PickId, Context, IDUI } from \"tonva-react\";\r\nimport { MiAccount, MiGroup, HoldingStock } from \"../../store\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { CApp, CUqSub, UQs } from \"../../uq-app\";\r\nimport { VAccount } from \"./VAccount\";\r\nimport { VBuyExist, VBuyNew, VCashAdjust, VCashInit, VCashIn, VCashOut, VSell, VChangeCost } from \"./VForm\";\r\nimport { CHome } from \"../CHome\";\r\nimport { VAccounts } from \"./VAccounts\";\r\nimport { VPickStock } from \"./VPickStock\";\r\n\r\nexport class CAccount extends CUqSub<CApp, UQs, CHome> {\r\n\tmiGroup: MiGroup = null;\r\n\tstocks: IObservableArray<Stock & StockValue>;\r\n\tstock: Stock & StockValue;\r\n\tmiAccount: MiAccount = null;\r\n\tholdingStock: HoldingStock;\r\n\tlistCaption: string;\r\n\r\n\tconstructor(cHome: CHome) {\r\n\t\tsuper(cHome);\r\n\t\tmakeObservable(this, {\r\n\t\t\tmiGroup: observable,\r\n\t\t\tmiAccount: observable,\r\n\t\t\tstocks: observable,\r\n\t\t});\r\n\t\t//this.cHome = cHome;\r\n\t}\r\n\r\n\tasync internalStart(param: any) {\r\n\t}\r\n\r\n\trenderAccounts() {\r\n\t\treturn this.renderView(VAccounts);\r\n\t}\r\n\r\n\tshowAccount = async (item: MiAccount) => {\r\n\t\tthis.miAccount = item;\r\n\t\tlet renderPageRight = () => {\r\n\t\t\tlet cID = this.cApp.cCommon.buildCIDUserAccount();\r\n\t\t\treturn cID.renderViewRight(item);\r\n\t\t}\r\n\t\tthis.openVPage(VAccount, {renderPageRight});\r\n\t\tawait item.loadItems();\r\n\t};\r\n\t\r\n\tshowHolding = async (item: HoldingStock) => {\r\n\t\tlet stock = item.stockObj;\r\n\t\tthis.cApp.cCommon.showStock(stock);\r\n\t}\r\n\r\n\tcreatePickStockId() {\r\n\t\tlet ret:PickId = async (context:Context, name: string, value: number) => {\r\n\t\t\tthis.stocks = this.cApp.store.stocksMyAll;\r\n\t\t\tlet v = await this.pickStock();\r\n\t\t\tif (!v) return;\r\n\t\t\tlet stock = await this.cApp.store.loadStock(v.id);\r\n\t\t\tthis.stock = stock;\r\n\t\t\tif (stock) {\r\n\t\t\t\tcontext.setValue('price', String(stock.price));\r\n\t\t\t}\r\n\t\t\treturn stock;\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate async pickStock() {\r\n\t\treturn this.vCall(VPickStock);\r\n\t}\r\n\r\n\tonSearchStock = async (key: string) => {\r\n\t\tlet ret = await this.cApp.store.searchStock({key}, undefined, 50);\r\n\t\tlet {$page} = ret;\r\n\t\tthis.stocks = observable($page);\r\n\t}\r\n\r\n\tshowBuy = async (item?: HoldingStock) => {\r\n\t\tif (item) {\r\n\t\t\tthis.holdingStock = item;\r\n\t\t\tthis.openVPage(VBuyExist);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.holdingStock = undefined;\r\n\t\t\tthis.openVPage(VBuyNew);\r\n\t\t}\r\n\t}\r\n\r\n\tsubmitBuyNew = async (stockId: number, price:number, quantity:number) => {\r\n\t\tawait this.miAccount.buyNewHolding(stockId, price, quantity);\r\n\t}\r\n\r\n\tsubmitBuy = async (price:number, quantity:number) => {\r\n\t\tawait this.miAccount.buyHolding(this.holdingStock.stock, price, quantity);\r\n\t}\r\n\r\n\tshowSell = async (item: HoldingStock) => {\r\n\t\tthis.holdingStock = item;\r\n\t\tthis.openVPage(VSell);\r\n\t}\r\n\r\n\tsubmitSell = async (price:number, quantity:number) => {\r\n\t\tawait this.miAccount.sellHolding(this.holdingStock.stock, price, quantity);\r\n\t}\r\n\t\r\n\tshowChangeCost = async (item: HoldingStock) => {\r\n\t\tthis.holdingStock = item;\r\n\t\tthis.openVPage(VChangeCost);\r\n\t}\r\n\t\r\n\tsubmitChangeCost = async (costPrice:number) => {\r\n\t\tawait this.miAccount.changeCost(this.holdingStock.stock, costPrice);\r\n\t}\r\n\r\n\tshowCashInit = async () => {\r\n\t\tthis.openVPage(VCashInit);\r\n\t}\r\n\r\n\tsubmitCashInit = async (value:number) => {\r\n\t\tawait this.miAccount.cashInit(value);\r\n\t}\r\n\r\n\tshowCashIn = async () => {\r\n\t\tthis.openVPage(VCashIn);\r\n\t}\r\n\r\n\tsubmitCashIn = async (value:number) => {\r\n\t\tawait this.miAccount.cashIn(value);\r\n\t}\r\n\t\r\n\tshowCashOut = async () => {\r\n\t\tthis.openVPage(VCashOut);\r\n\t}\r\n\r\n\tsubmitCashOut = async (value:number) => {\t\t\r\n\t\tawait this.miAccount.cashOut(value);\r\n\t}\r\n\t\r\n\tshowCashAdjust = async () => {\r\n\t\tthis.openVPage(VCashAdjust);\r\n\t}\r\n\r\n\tsubmitCashAdjust = async (value:number) => {\r\n\t\tawait this.miAccount.cashAdjust(value);\r\n\t}\r\n\r\n\tshowTransactionDetail = async (item: HoldingStock) => {\r\n\t\talert('detail');\r\n\t}\r\n}\r\n","import { IObservableArray, makeObservable, observable } from \"mobx\";\r\nimport { CApp, CUqBase } from \"uq-app\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { VHome } from \"./VHome\";\r\nimport { CAccount } from \"./account\";\r\n\r\nexport class CHome extends CUqBase {\r\n\treadonly cAccount: CAccount;\r\n\tstocks: IObservableArray<Stock & StockValue> = null;\r\n\tlistCaption: string = null;\r\n\r\n\tconstructor(cApp: CApp) {\r\n\t\tsuper(cApp);\r\n\t\tmakeObservable(this, {\r\n\t\t\tstocks: observable.ref,\r\n\t\t\tlistCaption: observable,\r\n\t\t});\r\n\t\tthis.cAccount = this.newSub(CAccount);\r\n\t}\r\n\r\n\tprotected async internalStart(param: any) {\r\n\t\tthis.openVPage(VHome);\r\n\t}\r\n\r\n\ttab = () => {\r\n\t\treturn this.renderView(VHome);\r\n\t}\r\n\r\n\tonStockClick = async (stock: Stock) => {\r\n\t\tthis.cApp.cCommon.showStock(stock);\r\n\t}\r\n}\r\n","import { Store } from \"store\";\r\nimport { PageItems } from \"tonva-react\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { SearchParam } from './CFind';\r\n\r\nexport class StockPageItems extends PageItems<Stock & StockValue> {\r\n\tprivate store: Store;\r\n\r\n\tconstructor(store: Store) {\r\n\t\tsuper(false);\r\n\t\tthis.store = store;\r\n\t\tthis.firstSize = 50;\r\n\t\tthis.pageSize = 20;\r\n\t}\r\n\t\r\n\tprotected getPageId(item:Stock):any {\r\n\t\treturn (item as unknown as any)?.$order;\r\n\t}\r\n\r\n\tprotected async loadResults (param:SearchParam, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.store.searchStock(\r\n\t\t\t{...param, smooth: param.smooth + 1}\r\n\t\t\t, pageStart, pageSize);\r\n\t\treturn ret as any;\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { DropdownAction, DropdownActions, FA, LMR, SearchBox, VPage } from \"tonva-react\";\r\nimport { CFind } from \"./CFind\";\r\n\r\nexport class VFind extends VPage<CFind> {\r\n\theader() {return '发现'}\r\n\tcontent() {\r\n\t\tlet {showA, showHK, showSH, showSZ, showAll, cGroup} = this.controller;\r\n\t\tlet buttons:[string, ()=>Promise<void>][] = [\r\n\t\t\t['A股', showA],\r\n\t\t\t['港股', showHK],\r\n\t\t\t['沪A', showSH],\r\n\t\t\t['深A', showSZ],\r\n\t\t\t['全部', showAll],\r\n\t\t];\r\n\t\tlet renderButton = (caption:string, onClick:()=>void) => <button key={caption} \r\n\t\t\tclassName=\"btn btn-outline-info mr-1 mr-sm-3 mb-3\" \r\n\t\t\tonClick={onClick}>\r\n\t\t\t{caption}\r\n\t\t</button>;\r\n\t\treturn <div>\r\n\t\t\t<div className=\"px-3 pt-3\">\r\n\t\t\t\t<SearchBox className=\"mb-3\" onSearch={this.controller.onSearch} placeholder=\"股票代码，名称\" />\r\n\t\t\t\t<div className=\"d-flex flex-wrap\">\r\n\t\t\t\t\t{buttons.map(v => {\r\n\t\t\t\t\t\tlet [caption, show] = v;\r\n\t\t\t\t\t\treturn renderButton(caption, show);\r\n\t\t\t\t\t})}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t{cGroup.renderGroups()}\r\n\t\t\t{this.renderMyAll()}\r\n\t\t\t{this.renderMyBlock()}\r\n\t\t</div>\r\n\t}\r\n\r\n\tprivate renderMyAll() {\r\n\t\tlet {cApp, cGroup} = this.controller;\r\n\t\tlet {showStocksAll} = cGroup;\r\n\t\tlet {stocksMyAll, myAllCaption} = cApp.store;\r\n\t\treturn this.renderSpec(stocksMyAll?.length, myAllCaption, 'home', 'text-primary', showStocksAll);\r\n\t}\r\n\r\n\tprivate renderMyBlock() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet {cApp, cGroup} = this.controller;\r\n\t\t\tlet {showStocksBlock} = cGroup;\r\n\t\t\tlet {stocksMyBlock, myBlockCaption} = cApp.store;\r\n\t\t\treturn this.renderSpec(stocksMyBlock?.length, <>\r\n\t\t\t\t<span className=\"mr-3\">{myBlockCaption}</span>\r\n\t\t\t\t<small className=\"text-muted\">选股时不列出</small>\r\n\t\t\t</>,\r\n\t\t\t'ban', 'text-black', showStocksBlock);\r\n\t\t}));\r\n\t}\r\n\r\n\tprivate renderSpec(count:number, text:string|JSX.Element, icon:string, color:string, click:()=>void) {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet right = count > 0 && <small className=\"align-self-center mx-3 text-muted\">{count}</small>;\r\n\t\t\tlet cn = \"align-self-center ml-3 \" + color;\r\n\t\t\treturn <div className=\"mt-2 bg-white cursor-pointer\" onClick={click}>\r\n\t\t\t\t<LMR left={<FA name={icon} className={cn} size=\"lg\" fixWidth={true} />} right={right}>\r\n\t\t\t\t\t<div className=\"px-3 py-2\">{text}</div>\r\n\t\t\t\t</LMR>\r\n\t\t\t</div>\r\n\t\t}));\r\n\t}\r\n\r\n\tright() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet {cCommon} = this.controller.cApp;\r\n\t\t\tlet actions: DropdownAction[] = [\r\n\t\t\t\t{\r\n\t\t\t\t\tcaption: '管理股票分组',\r\n\t\t\t\t\taction: cCommon.manageGroups,\r\n\t\t\t\t\ticon: 'object-group',\r\n\t\t\t\t},\r\n\t\t\t];\r\n\t\t\treturn <DropdownActions actions={actions} icon=\"bars\" className=\"mr-2 text-white bg-transparent border-0\" />;\r\n\t\t}));\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { FA, List, Scroller, SearchBox, VPage } from \"tonva-react\";\r\nimport { renderStockRow } from \"tool\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { CFind } from \"./CFind\";\r\n\r\nconst cnStar = 'small border rounded py-1 px-2 mr-3 ';\r\n\r\nexport class VStocksPage extends VPage<CFind> {\r\n\theader() {return React.createElement(observer(() => <span className=\"\">{this.controller.header}</span>))}\r\n\tcontent() {\r\n\t\tlet { pageStocks, onClickStock } = this.controller;\r\n\t\treturn <div className=\"pt-1 pb-3\">\r\n\t\t\t{this.renderStars()}\r\n\t\t\t<List items={pageStocks} item={{render: this.renderStock, onClick: onClickStock}} />\r\n\t\t</div>\r\n\t}\r\n\tright():JSX.Element {\r\n\t\tlet {key} = this.controller.searchParam;\r\n\t\treturn <SearchBox className=\"mr-2\"\r\n\t\t\tonSearch={this.searchInGroup} \r\n\t\t\tinitKey={key}\r\n\t\t\tplaceholder={key? '搜索' : this.controller.header+'中搜索'} />;\r\n\t}\r\n\r\n\tprivate searchInGroup = async (key: string) => {\r\n\t\tlet {searchParam} = this.controller;\r\n\t\tsearchParam.key = key;\r\n\t\tawait this.controller.research();\r\n\t}\r\n\r\n\tprivate renderStars():JSX.Element {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet { smooth } = this.controller;\r\n\t\t\tlet stars:number[] = [];\r\n\t\t\tfor (let i=0;i<5; i++) stars[i] = 4-i;\r\n\t\t\treturn <div className=\"px-3 py-1 d-sm-flex d-block\">\r\n\t\t\t\t<div className=\"d-flex py-1\">\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tstars.map(v => {\r\n\t\t\t\t\t\t\tlet cn:string, icon:string;\r\n\t\t\t\t\t\t\tif (v === smooth) {\r\n\t\t\t\t\t\t\t\ticon = 'star';\r\n\t\t\t\t\t\t\t\tcn = cnStar + ' text-warning border-primary bg-white';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if (v<smooth) {\r\n\t\t\t\t\t\t\t\tcn = cnStar + ' cursor-pointer text-muted ';\r\n\t\t\t\t\t\t\t\ticon = 'star-o';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tcn = cnStar + ' cursor-pointer text-warning bg-white';\r\n\t\t\t\t\t\t\t\ticon = 'star';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn <div key={v} className={cn} onClick={() => this.controller.changeSmooth(v)}>\r\n\t\t\t\t\t\t\t\t{v===0? '全部' : <>{v}<FA name={icon} /></>}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"text-muted small py-1 ml-auto align-self-center\">\r\n\t\t\t\t\t<FA name=\"star-o\" /> 近五年分红增长持续度\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\r\n\t\t}));\r\n\t}\r\n\r\n\tprivate renderStock = (stock: Stock & StockValue): JSX.Element => {\r\n\t\tlet pinStock = this.controller.cApp.cCommon.renderPinStock(stock);\r\n\t\tlet {$order} = stock as any;\r\n\t\treturn renderStockRow($order, stock, this.onClickName, pinStock);\r\n\t}\r\n\r\n\tprivate onClickName = (stock: Stock & StockValue) => {\r\n\t\tthis.controller.cApp.openStock(stock);\r\n\t}\r\n\r\n\tprotected async onPageScrollBottom(scroller: Scroller): Promise<void> {\r\n\t\tawait this.controller.pageStocks.more();\r\n\t}\r\n}\r\n/*\r\n<button className=\"btn btn-sm btn-outline-primary\" \r\nonClick={() => this.controller.selectStock(stock)}>\r\n<FA name=\"cog\" className=\"text-warning small\" /> 设自选\r\n</button>\r\n*/","import React from \"react\";\r\nimport { observer } from \"mobx-react\";\r\nimport { FA, List, LMR, View } from \"tonva-react\";\r\nimport { CGroup } from \"./CGroup\";\r\nimport { MiGroup } from \"store/miGroup\";\r\n\r\nexport class VGroups extends View<CGroup> {\r\n\trender():JSX.Element {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet {cApp} = this.controller;\r\n\t\t\tlet {miGroups} = cApp.store;\r\n\t\t\tlet {groups } = miGroups;\r\n\t\t\t//let listHeader = (caption:string) => <div className=\"small text-muted pt-2 pb-1 px-3\">{caption}</div>;\r\n\t\t\t//{listHeader('分组')}\r\n\t\t\treturn <>\r\n\t\t\t\t<List items={groups} item={{render: this.renderGroup, onClick:this.controller.showMiGroup}} className=\"mb-3\" />\r\n\t\t\t</>;\r\n\t\t}));\r\n\t}\r\n\r\n\tprivate renderGroup = (group:MiGroup, index: number):JSX.Element => {\r\n\t\tlet {name, count} = group;\r\n\t\tlet left = <FA name=\"list-alt\" className=\"text-info align-self-center ml-3\" size=\"lg\" fixWidth={true} />;\r\n\t\tlet right = count > 0 && <small className=\"align-self-center mx-3 text-muted\">{count}</small>;\r\n\t\treturn <LMR left={left} right={right}>\r\n\t\t\t<div className=\"px-3 py-2\">{name}</div>\r\n\t\t</LMR>;\r\n\t}\r\n}\r\n","import React from \"react\";\r\nimport { observer } from \"mobx-react\";\r\nimport { List, VPage } from \"tonva-react\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { renderStockRow } from \"tool\";\r\nimport { CGroup } from \"./CGroup\";\r\n\r\nexport class VStockList extends VPage<CGroup> {\r\n\tprivate renderRowRight: (stock: Stock & StockValue) => JSX.Element;\r\n\tprivate renderPageRight: () => JSX.Element;\r\n\tinit(param: {\r\n\t\trenderRowRight: (stock: Stock & StockValue) => JSX.Element;\r\n\t\trenderPageRight: () => JSX.Element;\r\n\t}) {\r\n\t\tlet {renderRowRight, renderPageRight} = param;\r\n\t\tthis.renderRowRight = renderRowRight;\r\n\t\tthis.renderPageRight = renderPageRight;\r\n\t}\r\n\r\n\theader() {\r\n\t\treturn React.createElement(observer(() => <>{this.controller.listCaption}</>));\r\n\t}\r\n\tright(): JSX.Element {\r\n\t\treturn this.renderPageRight?.();\r\n\t}\r\n\tcontent() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet {stocks} = this.controller;\r\n\t\t\treturn <div>\r\n\t\t\t\t<List items={stocks} item={{render: this.renderStock}} />\r\n\t\t\t</div>;\r\n\t\t}));\r\n\t}\r\n\r\n\tprivate onClickName = (stock:Stock) => {\r\n\t\tthis.controller.onStockClick(stock);\r\n\t}\r\n\r\n\tprivate renderStock = (stock:Stock & StockValue, index:number) => {\r\n\t\tlet right = this.renderRowRight?.(stock);\r\n\t\tlet {$order} = stock as unknown as any;\r\n\t\treturn renderStockRow($order, stock as Stock & StockValue, this.onClickName, right);\r\n\t}\r\n}\r\n","import { computed, IObservableArray, makeObservable, observable, runInAction } from \"mobx\";\r\nimport { MiAccount, MiGroup, HoldingStock } from \"../../store\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { CApp, CUqSub, UQs } from \"../../uq-app\";\r\nimport { CFind } from \"../CFind\";\r\nimport { VGroups } from \"./VGroups\";\r\nimport { VStockList } from \"./VStockList\";\r\n\r\nexport class CGroup extends CUqSub<CApp, UQs, CFind> {\r\n\tmiGroup: MiGroup = null;\r\n\tmiAccount: MiAccount = null;\r\n\tholdingStock: HoldingStock;\r\n\tstocks: IObservableArray<Stock & StockValue>;\r\n\r\n\tconstructor(cFind: CFind) {\r\n\t\tsuper(cFind);\r\n\t\tmakeObservable(this, {\r\n\t\t\tmiGroup: observable,\r\n\t\t\tmiAccount: observable,\r\n\t\t\tstocks: observable,\r\n\t\t\tlistCaption: computed,\r\n\t\t});\r\n\t}\r\n\r\n\tasync internalStart(param: any) {\r\n\t}\r\n\r\n\tprivate _listCaption: string;\r\n\tget listCaption(): string {\r\n\t\treturn this._listCaption?? this.miGroup?.name;\r\n\t}\r\n\r\n\trenderGroups() {return this.renderView(VGroups);}\r\n\r\n\tshowMiGroup = async (miGroup: MiGroup) => {\r\n\t\tthis._listCaption = undefined;\r\n\t\tthis.miGroup = miGroup;\r\n\r\n\t\tlet renderPageRight = () => {\r\n\t\t\tlet cID = this.cApp.cCommon.buildCIDUserGroup();\r\n\t\t\treturn cID.renderViewRight(miGroup);\r\n\t\t}\r\n\t\tthis.openStocksList(undefined, renderPageRight);\r\n\t\tawait miGroup.loadItems();\r\n\t\tthis.setStocksList(miGroup.stocks);\r\n\t}\r\n\r\n\tshowStocksAll = async () => {\r\n\t\tlet {store} = this.cApp;\r\n\t\tthis._listCaption = store.myAllCaption;\r\n\t\tthis.miGroup = undefined;\r\n\t\tthis.openStocksList();\r\n\t\tthis.setStocksList(store.stocksMyAll);\r\n\t}\r\n\r\n\tshowStocksBlock = async () => {\r\n\t\tlet {store} = this.cApp;\r\n\t\tlet renderRowRight = this.cApp.cCommon.renderBlockStock;\r\n\t\tthis._listCaption = store.myBlockCaption;\r\n\t\tthis.miGroup = undefined;\r\n\t\tthis.openStocksList(renderRowRight);\r\n\t\tawait this.cApp.store.loadMyBlock();\r\n\t\tthis.setStocksList(store.stocksMyBlock);\r\n\t}\r\n\r\n\tprivate openStocksList(renderRowRight?: (stock:Stock & StockValue) => JSX.Element, \r\n\t\trenderPageRight?: () => JSX.Element) {\r\n\t\trunInAction(() => {\r\n\t\t\t//this.listCaption = caption;\r\n\t\t\tthis.stocks = undefined;\r\n\t\t\tthis.openVPage(VStockList, {renderRowRight, renderPageRight});\r\n\t\t});\r\n\t}\r\n\r\n\tprivate setStocksList(stocks: IObservableArray<Stock&StockValue>) {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.stocks = stocks.sort((a, b) => {\r\n\t\t\t\tlet am = a.miRate;\r\n\t\t\t\tlet bm = b.miRate;\r\n\t\t\t\tif (am < bm) return 1;\r\n\t\t\t\tif (am > bm) return -1;\r\n\t\t\t\treturn 0;\r\n\t\t\t});\r\n\t\t\tlet len = this.stocks.length;\r\n\t\t\tfor (let i=0; i<len; i++) (this.stocks[i] as any).$order = i+1;\r\n\t\t})\r\n\t}\r\n\r\n\tonStockClick = async (stock: Stock) => {\r\n\t\tthis.cApp.cCommon.showStock(stock);\r\n\t}\r\n}\r\n","import { action, makeObservable, observable } from \"mobx\";\r\nimport { CApp, CUqBase } from \"uq-app\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { StockPageItems } from \"./stockPageItems\";\r\nimport { VFind } from \"./VFind\";\r\nimport { VStocksPage } from \"./VStocksPage\";\r\nimport { CGroup } from \"./group\";\r\n\r\ntype SearchOrder = 'miRateDesc' | 'miRateAsc' | 'dvRateDesc' | 'dvRateAsc' | 'roeDesc' | 'roeAsc';\r\nconst defaultSmooth = 0;\r\nexport interface SearchParam {\r\n\tkey: string; \r\n\tmarket: string;\r\n\t$orderSwitch: SearchOrder;\r\n\tsmooth: number;\r\n}\r\n\r\nexport class CFind extends  CUqBase {\r\n\treadonly cGroup: CGroup;\r\n\theader: string = null;\r\n\tpageStocks: StockPageItems = null;\r\n\tsearchOrder: SearchOrder = 'miRateDesc';\r\n\tsearchParam: SearchParam;\r\n\tsmooth: number;\r\n\r\n\tconstructor(cApp: CApp) {\r\n\t\tsuper(cApp);\r\n\t\tmakeObservable(this, {\r\n\t\t\theader: observable,\r\n\t\t\tsmooth: observable,\r\n\t\t\tloadSmooth: action,\r\n\t\t\tchangeSmooth: action,\r\n\t\t});\r\n\t\tthis.cGroup = this.newSub(CGroup);\r\n\t\tthis.loadSmooth();\r\n\t}\r\n\r\n\ttab = () => {\r\n\t\treturn this.renderView(VFind);\r\n\t}\r\n\r\n\tasync internalStart(param: any) {\r\n\t\tthis.openVPage(VFind);\r\n\t}\r\n\r\n\tloadSmooth() {\r\n\t\tlet t = localStorage.getItem('smooth');\r\n\t\tif (!t) this.smooth = defaultSmooth;\r\n\t\telse {\r\n\t\t\ttry {\r\n\t\t\t\tthis.smooth = Number.parseInt(t);\r\n\t\t\t}\r\n\t\t\tcatch {\r\n\t\t\t\tthis.smooth = defaultSmooth;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tasync changeSmooth(value: number) {\r\n\t\tif (this.smooth === value) return;\r\n\t\tthis.smooth = value;\r\n\t\tlocalStorage.setItem('smooth', String(value));\r\n\t\tthis.searchParam['smooth'] = value;\r\n\t\tawait this.research();\r\n\t}\r\n\r\n\tload = async() => {}\r\n\t\r\n\tasync research() {\r\n\t\tawait this.pageStocks.first(this.searchParam);\r\n\t}\r\n\r\n\tprivate async searchStock(header: string, market?:string[], key?:string) {\r\n\t\tthis.header = header;\r\n\t\tthis.searchParam = {\r\n\t\t\tkey, \r\n\t\t\tmarket: market?.join('\\n'),\r\n\t\t\t$orderSwitch: this.searchOrder,\r\n\t\t\tsmooth: key? 0 : this.smooth,\r\n\t\t};\r\n\t\tthis.pageStocks = new StockPageItems(this.cApp.store);\r\n\t\tawait this.pageStocks.first(this.searchParam);\r\n\t\tthis.openVPage(VStocksPage);\r\n\t}\r\n\r\n\tonSearch = async (key:string) => {\r\n\t\tawait this.searchStock('搜索', ['sh', 'sz', 'hk'], key);\r\n\t}\r\n\r\n\tshowA = async () => {\r\n\t\tawait this.searchStock('A股', ['sh', 'sz']);\r\n\t}\r\n\tshowHK = async () => {\r\n\t\tawait this.searchStock('港股', ['hk']);\r\n\t}\r\n\tshowSH = async () => {\r\n\t\tawait this.searchStock('沪股', ['sh']);\r\n\t}\r\n\tshowSZ = async () => {\r\n\t\tawait this.searchStock('深股', ['sz']);\r\n\t}\r\n\tshowAll = async () => {\r\n\t\tawait this.searchStock('全部股票', ['sh', 'sz', 'hk']);\r\n\t}\r\n\r\n\tonClickStock = (stock: Stock & StockValue) => {\r\n\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { View } from \"tonva-react\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { CCommon } from \"./CCommon\";\r\n\r\nexport class VBlockStock extends View<CCommon> {\r\n\trender(stock: Stock & StockValue):JSX.Element {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet isBlock = this.controller.isMyBlock(stock);\r\n\t\t\tlet cn:string, content:string;\r\n\t\t\tif (isBlock === true) {\r\n\t\t\t\tcontent = '取消拉黑';\r\n\t\t\t\tcn = 'btn-outline-danger';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tcontent = '拉黑';\r\n\t\t\t\tcn = 'btn-outline-secondary';\r\n\t\t\t}\r\n\t\t\treturn <button className={'btn btn-sm align-self-start ' + cn}\r\n\t\t\t\tonClick={() => this.controller.toggleBlock(stock)}>\r\n\t\t\t\t{content}\r\n\t\t\t</button>;\r\n\t\t}));\r\n\t}\r\n}\r\n","import { MiAccount, MiGroup } from \"store\";\r\nimport { FA, VPage } from \"tonva-react\";\r\nimport { Stock } from \"uq-app/uqs/BruceYuMi\";\r\nimport { CCommon } from \"./CCommon\";\r\n\r\nexport class VKeepStock extends VPage<CCommon> {\r\n\tprivate param: {stock: Stock; miAccounts: MiAccount[]; miGroups: MiGroup[]};\r\n\tinit(param: any) {\r\n\t\tthis.param = param;\r\n\t}\r\n\theader() {return '删除选股'}\r\n\tcontent() {\r\n\t\tlet {stock, miAccounts, miGroups} = this.param;\r\n\t\treturn <div className=\"py-3\">\r\n\t\t\t<div className=\"bg-white px-3 py-2 text-info\">\r\n\t\t\t\t<FA name=\"exclamation-circle\" className=\"mr-3 text-danger\" />\r\n\t\t\t\t<b className=\"text-primary\">{stock.name}</b> 无法从自选股删除\r\n\t\t\t</div>\r\n\t\t\t{\r\n\t\t\t\tmiAccounts.length > 0 && <>\r\n\t\t\t\t\t<div className=\"small px-3 mt-3 mb-1\">持仓</div>\r\n\t\t\t\t\t<div className=\"p-3 bg-white\">\r\n\t\t\t\t\t\t{miAccounts.map((v, index) => <span key={index} className=\"mr-3\">{v.name}</span>)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\t\t\t{\r\n\t\t\t\tmiGroups.length > 0 && <>\r\n\t\t\t\t\t<div className=\"small px-3 mt-3 mb-1\">分组</div>\r\n\t\t\t\t\t<div className=\"p-3 bg-white\">\r\n\t\t\t\t\t\t{miGroups.map((v, index) => <span key={index} className=\"mr-3\">{v.name}</span>)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\t\t</div>\r\n\t}\r\n}","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { DropdownActions, FA, View } from \"tonva-react\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { CCommon } from \"./CCommon\";\r\n\r\nexport class VPinStock extends View<CCommon> {\r\n\trender(stock: Stock & StockValue):JSX.Element {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet isSelected = this.controller.isMyAll(stock);\r\n\t\t\tif (isSelected === true) {\r\n\t\t\t\treturn <DropdownActions actions={[\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcaption: '修改分组',\r\n\t\t\t\t\t\taction: () => this.controller.setStockToGroup(stock),\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcaption: '删除自选',\r\n\t\t\t\t\t\taction: () => this.controller.removeMyAll(stock),\r\n\t\t\t\t\t},\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcaption: '取消操作',\r\n\t\t\t\t\t\taction: () => {},\r\n\t\t\t\t\t}\r\n\t\t\t\t]} icon=\"cog\" content=\"分组\"\r\n\t\t\t\tclassName=\"cursor-pointer btn btn-sm btn-outline-info align-self-start\" />;\r\n\t\t\t\t// dropdown-toggle \r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn <button className=\"btn btn-sm btn-outline-primary align-self-start\" \r\n\t\t\t\t\tonClick={() => this.controller.toggleMyAll(stock)}>\r\n\t\t\t\t\t<FA name=\"plus\" className=\"small mr-1\" fixWidth={true} />自选\r\n\t\t\t\t</button>;\r\n\t\t\t}\t\r\n\t\t}));\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { VPage } from \"tonva-react\";\r\nimport { CCommon } from \"./CCommon\";\r\n\r\nexport class VStockInGroup extends VPage<CCommon> {\r\n\theader() {return '设置分组'}\r\n\tright() {\r\n\t\treturn <button className=\"btn btn-sm btn-info mr-2\" onClick={this.controller.manageGroups}>管理分组</button>;\r\n\t}\r\n\tcontent() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet {stock, cApp, setGroup} = this.controller;\r\n\t\t\tif (!stock) return <div>no stock, can set group</div>;\r\n\t\t\tlet {id:stockId, name, code} = stock;\r\n\t\t\tlet {store} = cApp;\r\n\t\t\tlet {miGroups} = store;\r\n\t\t\tlet {groups} = miGroups;\r\n\t\t\tlet inGroup = store.buildInGroup(stockId);\r\n\t\t\treturn <div>\r\n\t\t\t\t<div className=\"p-3\">\r\n\t\t\t\t\t<b>{name}</b> \r\n\t\t\t\t\t<span className=\"ml-3\">{code}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"d-flex flex-wrap py-1 border-top border-bottom\">\r\n\t\t\t\t\t{groups.map(v => {\r\n\t\t\t\t\t\tlet {id, name} = v;\r\n\t\t\t\t\t\treturn <label key={id} className=\"mb-0 w-8c px-3 py-2\">\r\n\t\t\t\t\t\t\t<input className=\"mr-1\" \r\n\t\t\t\t\t\t\t\ttype=\"checkbox\" \r\n\t\t\t\t\t\t\t\tdefaultChecked={inGroup[id]}\r\n\t\t\t\t\t\t\t\tonChange={evt => setGroup(evt.currentTarget.checked, v)} />\r\n\t\t\t\t\t\t\t{name}\r\n\t\t\t\t\t\t</label>;\r\n\t\t\t\t\t})}\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\r\n\t\t}));\r\n\t}\r\n}","import { View } from \"tonva-react\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { CCommon } from \"./CCommon\";\r\n\r\nexport class VStockLink extends View<CCommon> {\r\n\trender(stock: Stock & StockValue):JSX.Element {\r\n\t\tlet {code} = stock;\r\n\t\tlet $market = (stock as any).$market;\r\n\t\tlet mn = $market.name;\r\n\t\tlet symbol = mn + code;\r\n\t\tlet url:string, title:string;\r\n\t\tswitch (mn) {\r\n\t\t\tcase 'hk':\r\n\t\t\t\turl = `https://xueqiu.com/S/${code}`;\r\n\t\t\t\ttitle = '雪球';\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\turl = `https://finance.sina.com.cn/realstock/company/${symbol}/nc.shtml`;\r\n\t\t\t\ttitle = '新浪财经';\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn <a className=\"btn btn-link d-sm-inline d-none\" href={url} target=\"_blank\" rel=\"noreferrer\">\r\n\t\t\t{title}\r\n\t\t</a>;\r\n\t}\r\n}\r\n","import { MiGroup } from \"store\";\r\nimport { IDUI } from \"tonva-react\";\r\nimport { CID, MidIXID } from \"tonva-uqui\";\r\nimport { renderGroup } from \"tool\";\r\nimport { CUqBase } from \"uq-app\";\r\nimport { Account, Group, Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { VBlockStock } from \"./VBlockStock\";\r\nimport { VKeepStock } from \"./VKeepStock\";\r\nimport { VPinStock } from \"./VPinStock\";\r\nimport { VStockInGroup } from \"./VStockInGroup\";\r\nimport { VStockLink } from \"./VStockLink\";\r\n\r\nexport class CCommon extends CUqBase {\r\n\tstock: Stock & StockValue;\r\n\t\r\n\tprotected async internalStart(param: any) {\r\n\t}\r\n\r\n\tisMyAll(stock: Stock & StockValue):boolean {\r\n\t\treturn this.cApp.store.isMyAll(stock);\r\n\t}\r\n\r\n\tasync addMyAll(stock: Stock & StockValue) {\r\n\t\tawait this.cApp.store.addMyAll(stock);\r\n\t}\r\n\r\n\tasync removeMyAll(stock: Stock & StockValue) {\r\n\t\tlet ret = await this.cApp.store.removeMyAll(stock);\r\n\t\tif (ret) {\r\n\t\t\t(ret as any).stock = stock;\r\n\t\t\tthis.openVPage(VKeepStock, ret);\r\n\t\t}\r\n\t}\r\n\r\n\ttoggleMyAll(stock: Stock & StockValue) {\r\n\t\tif (this.isMyAll(stock)) {\r\n\t\t\tthis.removeMyAll(stock);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.addMyAll(stock);\r\n\t\t}\r\n\t}\r\n\r\n\tisMyBlock(stock: Stock & StockValue):boolean {\r\n\t\treturn this.cApp.store.isMyBlock(stock);\r\n\t}\r\n\r\n\ttoggleBlock = async (stock: Stock & StockValue) => {\r\n\t\tlet {store} = this.cApp;\r\n\t\t// block 操作之前，确保载入。还有显示之前，确保载入\r\n\t\tawait store.toggleBlock(stock);\r\n\t}\r\n\r\n\tsetStockToGroup = (stock: Stock&StockValue) => {\r\n\t\tthis.stock = stock;\r\n\t\tthis.openVPage(VStockInGroup);\r\n\t}\r\n\r\n\tsetGroup = async (checked:boolean, group: MiGroup) => {\r\n\t\tlet {miGroups} = this.cApp.store;\r\n\t\tif (checked === true) {\r\n\t\t\tawait miGroups.addStockToGroup(this.stock, group);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tawait miGroups.removeStockFromGroup(this.stock, group);\r\n\t\t}\r\n\t}\r\n\r\n\trenderPinStock = (stock: Stock & StockValue) => {\r\n\t\tif (!stock) return null;\r\n\t\treturn this.renderView(VPinStock, stock);\r\n\t}\r\n\r\n\trenderBlockStock = (stock: Stock & StockValue) => {\r\n\t\tif (!stock) return null;\r\n\t\treturn this.renderView(VBlockStock, stock);\r\n\t}\r\n\r\n\tshowStock = async (stock: Stock) => {\r\n\t\tlet {name, code, market, rawId} = stock;\r\n\t\tlet date = new Date();\r\n\t\tlet year = date.getFullYear();\r\n\t\tlet month = date.getMonth() + 1;\r\n\t\tlet dt = date.getDate();\r\n\t\tthis.cApp.showStock({\r\n\t\t\tid: rawId, \r\n\t\t\tname,\r\n\t\t\tcode,\r\n\t\t\tsymbol: market,\r\n\t\t\tday: year*10000 + month*100 + dt,\r\n\t\t\tstock\r\n\t\t} as any);\r\n\t}\r\n\r\n\tbuildCIDUserGroup(): CID<Group> {\r\n\t\tlet uq = this.uqs.BruceYuMi;\r\n\t\tlet IDUI: IDUI = {\r\n\t\t\tID: uq.Group,\r\n\t\t\tfieldCustoms: {\r\n\t\t\t\tno: {hiden: true},\r\n\t\t\t\ttype: {hiden: true, defaultValue: '0'}\r\n\t\t\t},\r\n\t\t\tt: this.t,\r\n\t\t}\r\n\t\tlet mId = new MidIXID<Group>(uq, IDUI, uq.UserGroup);\r\n\t\tmId.listHeader = '管理股票分组';\r\n\t\tmId.itemHeader = '股票分组';\r\n\t\tlet cID = new CID(mId);\r\n\t\treturn cID;\r\n\t}\r\n\r\n\tmanageGroups = async () => {\r\n\t\tlet cID = this.buildCIDUserGroup();\r\n\t\tlet {renderItem, onItemClick} = cID;\r\n\t\tcID.renderItem = (item: Group, index:number) => renderGroup(item, index, renderItem);\r\n\t\tcID.onItemClick = (item: Group):void => onItemClick(item);\r\n\t\tlet changed = await cID.call();\r\n\t\tif (changed === true) {\r\n\t\t\tawait this.cApp.store.miGroups.load();\r\n\t\t}\r\n\t}\r\n\r\n\tbuildCIDUserAccount(): CID<Account> {\r\n\t\tlet uq = this.uqs.BruceYuMi;\r\n\t\tlet IDUI:IDUI = {\r\n\t\t\tID: uq.Account,\r\n\t\t\tfieldCustoms: {\r\n\t\t\t\tno: {hiden: true},\r\n\t\t\t},\r\n\t\t\tt: this.t,\r\n\t\t}\r\n\t\tlet mId = new MidIXID<Account>(uq, IDUI, uq.UserAccount);\r\n\t\tmId.listHeader = '管理持仓账号';\r\n\t\tmId.itemHeader = '持仓账号';\r\n\t\tlet cID = new CID(mId);\r\n\t\treturn cID;\r\n\t}\r\n\r\n\tmanageAccounts = async () => {\r\n\t\tlet cID = this.buildCIDUserAccount();\r\n\t\tlet changed = await cID.call();\r\n\t\tif (changed === true) {\r\n\t\t\tawait this.cApp.store.miAccounts.load();\r\n\t\t}\r\n\t}\r\n\r\n\trenderStockLink(stock:Stock) {\r\n\t\treturn this.renderView(VStockLink, stock);\r\n\t}\r\n}\r\n","import { CBug } from \"./bug\";\r\nimport { CUqApp } from \"./CBase\";\r\nimport { res } from \"./res\";\r\nimport { VMain } from \"./VMain\";\r\nimport { CTester } from \"./test-uqui\";\r\nimport { setUI } from \"./uqs\";\r\nimport { CMe } from '../me';\r\nimport { Store } from 'store';\r\nimport { CHome } from '../home';\r\nimport { CStockInfo, NStockInfo } from \"stockinfo\";\r\nimport { CFind } from \"find\";\r\nimport { Stock, StockValue } from \"./uqs/BruceYuMi\";\r\nimport { CCommon } from \"../common\";\r\n\r\nconst gaps = [10, 3,3,3,3,3,5,5,5,5,5,5,5,5,10,10,10,10,15,15,15,30,30,60];\r\n\r\nexport class CApp extends CUqApp {\r\n\t//cHome: CHome;\r\n\tcBug: CBug;\r\n\tcMe: CMe;\r\n\tcUI: CTester;\r\n\t//cGroup: CGroup;\r\n\tcHome: CHome;\r\n\tcFind: CFind;\r\n\tcCommon: CCommon;\r\n\tstore: Store;\r\n\r\n\tprotected async internalStart(isUserLogin: boolean) {\r\n\t\tthis.setRes(res);\r\n\t\tsetUI(this.uqs);\r\n\t\tthis.store = new Store(this.uqs);\r\n\t\tawait this.store.load();\r\n\t\t\r\n\t\tthis.cHome = this.newC(CHome);\r\n\t\tthis.cFind = this.newC(CFind);\r\n\t\tthis.cMe = this.newC(CMe);\r\n\t\tthis.cCommon = this.newC(CCommon);\r\n\t\tif (this.isDev === true) {\r\n\t\t\tthis.cBug = this.newC(CBug);\r\n\t\t\tthis.cUI = this.newC(CTester) as CTester;\r\n\t\t}\r\n\r\n\t\tthis.openVPage(VMain, undefined, this.dispose);\r\n\t\t// 加上下面一句，可以实现主动页面刷新\r\n\t\t// this.timer = setInterval(this.callTick, 1000);\r\n\t\t// uq 里面加入这一句，会让相应的$Poked查询返回poke=1：\r\n\t\t// TUID [$User] ID (member) SET poke=1;\r\n\t}\r\n\r\n\tprivate timer:any;\r\n\tprotected onDispose() {\r\n\t\tclearInterval(this.timer);\r\n\t\tthis.timer = undefined;\r\n\t}\r\n\r\n\tprivate tick = 0;\r\n\tprivate gapIndex = 0;\r\n\t/*\r\n\tprivate callTick = async () => {\r\n\t\ttry {\r\n\t\t\tif (!this.user) return;\r\n\t\t\t++this.tick;\r\n\t\t\tif (this.tick<gaps[this.gapIndex]) return;\r\n\t\t\t//console.error('tick ', new Date());\r\n\t\t\tthis.tick = 0;\r\n\t\t\tif (this.gapIndex < gaps.length - 1) ++this.gapIndex;\r\n\t\t\tlet ret = await this.uqs.BzHelloTonva.$poked.query(undefined, false);\r\n\t\t\tlet v = ret.ret[0];\r\n\t\t\tif (v === undefined) return;\r\n\t\t\tif (!v.poke) return;\r\n\t\t\tthis.gapIndex = 1;\r\n\r\n\t\t\t// 数据服务器提醒客户端刷新，下面代码重新调入的数据\r\n\t\t\t//this.cHome.refresh();\r\n\t\t}\r\n\t\tcatch {\r\n\t\t}\r\n\t}\r\n\t*/\r\n\r\n\tshowStock = async (item: NStockInfo) => {\r\n\t\tawait this.store.loadMyBlock();\r\n\t\tlet cStockInfo = this.newC(CStockInfo);\r\n\t\tcStockInfo.start(item);\r\n\t}\r\n\r\n\topenStock = (stock: Stock & StockValue) => {\r\n\t\tlet {name, code, market, rawId} = stock;\r\n\t\tlet date = new Date();\r\n\t\tlet year = date.getFullYear();\r\n\t\tlet month = date.getMonth() + 1;\r\n\t\tlet dt = date.getDate();\r\n\t\tthis.showStock({\r\n\t\t\tid: rawId, \r\n\t\t\tname,\r\n\t\t\tcode,\r\n\t\t\tsymbol: market,\r\n\t\t\tday: year*10000 + month*100 + dt,\r\n\t\t\tstock\r\n\t\t} as any);\r\n\t}\r\n}\r\n","//=== UqApp builder created on Wed Mar 10 2021 16:02:48 GMT-0500 (GMT-05:00) ===//\nimport { NavView, start, nav } from 'tonva-react';\nimport { CApp } from './CApp';\nimport { appConfig } from './appConfig';\n\nexport const App: React.FC = () => {\n\tnav.setSettings(appConfig);\n\tconst onLogined = async (isUserLogin?:boolean) => {\n\t\tawait start(CApp, appConfig, isUserLogin);\n\t}\n\treturn <NavView onLogined={onLogined} />;\n}\n\n","import { capitalCase } from \"../../tool\";\r\nimport { FieldItem, FieldUIType } from \"../../ui\";\r\n\r\nexport function buildFieldItem(field:any, isKey:boolean):FieldItem {\r\n\tlet $FieldItemType: string, fieldItemType: string, widget:FieldUIType;\r\n\tlet {name, type} = field;\r\n\tswitch (type) {\r\n\t\tcase 'id':\r\n\t\t\t$FieldItemType = 'FieldItemId';\r\n\t\t\tfieldItemType = 'id';\r\n\t\t\tbreak;\r\n\t\tcase 'char':\r\n\t\t\t$FieldItemType = 'FieldItemString';\r\n\t\t\tfieldItemType = 'string';\r\n\t\t\twidget = 'string';\r\n\t\t\tbreak;\r\n\t\tcase 'smallint':\r\n\t\tcase 'int':\r\n\t\tcase 'bigint':\r\n\t\t\t$FieldItemType = 'FieldItemInt';\r\n\t\t\tfieldItemType = 'integer';\r\n\t\t\twidget = 'updown';\r\n\t\t\tbreak;\r\n\t\tcase 'dec':\r\n\t\tcase 'float':\r\n\t\tcase 'double':\r\n\t\t\t$FieldItemType = 'FieldItemNum';\r\n\t\t\tfieldItemType = 'number';\r\n\t\t\twidget = 'number';\r\n\t\t\tbreak;\r\n\t}\r\n\treturn {\r\n\t\tname,\r\n\t\ttype: fieldItemType,\r\n\t\tisKey,\r\n\t\twidget,\r\n\t\tlabel: capitalCase(name),\r\n\t\t$FieldItemType,\r\n\t} as FieldItem;\r\n}\r\n","import React from 'react';\r\nimport { nav } from '../components';\r\nimport { VPage } from '../vm';\r\nimport { CLogin } from './CLogin';\r\n\r\nexport class VLogout extends VPage<CLogin> {\r\n\tprivate onLogout: ()=>void;\r\n\r\n\tinit(param: any) {\r\n\t\tthis.onLogout = param;\r\n\t}\r\n\theader() {return this.isWebNav === true? false : '安全退出';}\r\n\tfooter() {\r\n\t\treturn <div className=\"mt-5 text-center justify-content-center\">\r\n\t\t\t<button className=\"btn btn-outline-warning\" onClick={nav.resetAll}>升级软件</button>\r\n\t\t</div>;\r\n\t}\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'close'}\r\n\tcontent() {\r\n\t\treturn <div className=\"m-5 border border-info bg-white rounded-3 p-5 text-center\">\r\n\t\t\t<div>退出当前账号不会删除任何历史数据，下次登录依然可以使用本账号</div>\r\n\t\t\t<div className=\"mt-5 text-center\">\r\n\t\t\t\t<button className=\"btn btn-danger\" onClick={this.onLogout}>安全退出</button>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport {Form, Schema, UiSchema, UiTextItem, UiPasswordItem, Context, UiButton, StringSchema, Ax, nav} from '../components';\r\nimport { tonvaTop, getSender } from './tools';\r\nimport { CLogin } from './CLogin';\r\nimport { VPage } from '../vm';\r\n\r\nconst schema: Schema = [\r\n    {name: 'username', type: 'string', required: true, maxLength: 100} as StringSchema,\r\n    {name: 'password', type: 'string', required: true, maxLength: 100} as StringSchema,\r\n    {name: 'login', type: 'submit'},\r\n];\r\n\r\nexport class VLogin extends VPage<CLogin> {\r\n    private onLogin: (un:string, pwd:string) => Promise<boolean>;\r\n    private withBack: boolean;\r\n\r\n\tinit({onLogin, withBack}:{onLogin: (un:string, pwd:string) => Promise<boolean>; withBack: boolean;}) {\r\n\t\tthis.onLogin = onLogin;\r\n\t\tthis.withBack = withBack;\r\n\t}\r\n\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            username: {placeholder: '手机/邮箱/用户名', label: '登录账号'} as UiTextItem,\r\n            password: {widget: 'password', placeholder: '密码', label: '密码'} as UiPasswordItem,\r\n            login: {widget: 'button', className: 'btn btn-primary btn-block mt-3', label: '登录'} as UiButton,\r\n        }\r\n    }\r\n\r\n    private onSubmit = async (name:string, context:Context):Promise<string> => {\r\n        let values = context.form.data;\r\n        let un = values['username'];\r\n        let pwd = values['password'];\r\n        if (pwd === undefined) {\r\n            return 'something wrong, pwd is undefined';\r\n\t\t}\r\n\t\tlet ret = await this.onLogin(un, pwd);\r\n\t\tif (ret === true) return;\r\n\r\n\t\tlet sender = getSender(un);\r\n\t\tlet type:string = sender !== undefined? sender.caption : '用户名';\r\n\t\treturn type + '或密码错！';\r\n    }\r\n    private onEnter = async (name:string, context:Context):Promise<string> => {\r\n        if (name === 'password') {\r\n            return await this.onSubmit('login', context);\r\n        }\r\n\t}\r\n\r\n\theader() {\r\n        if (this.withBack === true) {\r\n            return '登录';\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcontent() {\r\n        return <div className=\"d-flex p-5 flex-column justify-content-center align-items-center\">\r\n\t\t\t<div className=\"flex-fill\" />\r\n\t\t\t<div className=\"w-20c\">\r\n\t\t\t\t{tonvaTop()}\r\n\t\t\t\t<div className=\"h-2c\" />\r\n\t\t\t\t<Form schema={schema} uiSchema={this.uiSchema} \r\n\t\t\t\t\tonButtonClick={this.onSubmit} \r\n\t\t\t\t\tonEnter={this.onEnter}\r\n\t\t\t\t\trequiredFlag={false} />\r\n\t\t\t\t<div className=\"text-center\">\r\n\t\t\t\t\t<Ax className=\"btn btn-link\" href=\"/forget\">\r\n\t\t\t\t\t\t忘记密码\r\n\t\t\t\t\t</Ax>\r\n\t\t\t\t\t<Ax href=\"/register\" className=\"btn btn-link\">\r\n\t\t\t\t\t\t注册账号\r\n\t\t\t\t\t</Ax>\r\n\t\t\t\t</div>\r\n\t\t\t\t{nav.privacyEntry()}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"flex-fill\" />\r\n\t\t\t<div className=\"flex-fill\" />\r\n\t\t</div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { VPage } from '../vm';\r\nimport { Page, Form, ItemSchema, UiSchema, StringSchema, UiPasswordItem, Context, ButtonSchema, UiButton, nav } from '../components';\r\n//import { CenterAppApi } from '../net';\r\nimport { CLogin } from './CLogin';\r\n\r\nexport class VChangePassword extends VPage<CLogin> {\r\n    private schema: ItemSchema[] = [\r\n        {name:'orgPassword', type: 'string', maxLength: 60, required: true} as StringSchema,\r\n        {name:'newPassword', type: 'string', maxLength: 60, required: true} as StringSchema,\r\n        {name:'newPassword1', type: 'string', maxLength: 60, required: true} as StringSchema,\r\n        {name:'submit', type: 'submit'} as ButtonSchema\r\n    ];\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            orgPassword: {\r\n                widget: 'password',\r\n                label: '原密码',\r\n                placeholder: '输入原来的密码'\r\n            } as UiPasswordItem,\r\n            newPassword: {\r\n                widget: 'password',\r\n                label: '新密码',\r\n                placeholder: '输入新设的密码'\r\n            } as UiPasswordItem,\r\n            newPassword1: {\r\n                widget: 'password',\r\n                label: '确认密码', \r\n                placeholder: '再次输入新设密码'\r\n            } as UiPasswordItem,\r\n            submit: {\r\n                widget: 'button',\r\n                label: '提交',\r\n                className: 'btn btn-primary'\r\n            } as UiButton,\r\n        }\r\n\t};\r\n\t\r\n\tprivate onChange: (orgPassword:string, newPassword:string) => Promise<boolean>\r\n\tinit(onChange: (orgPassword:string, newPassword:string) => Promise<boolean>) {\r\n\t\tthis.onChange = onChange;\r\n\t}\r\n\r\n    private onSubmit = async (name:string, context: Context):Promise<any> => {\r\n        let {orgPassword, newPassword, newPassword1} = context.data;\r\n        if (newPassword !== newPassword1) {\r\n            context.setError('newPassword1', '新密码错误，请重新输入');\r\n            return;\r\n        }\r\n        //let centerAppApi = new CenterAppApi('tv/', undefined);\r\n\t\t//let ret = await centerAppApi.changePassword({orgPassword, newPassword});\r\n\t\tlet ret = await this.onChange(orgPassword, newPassword);\r\n        if (ret === false) {\r\n            context.setError('orgPassword', '原密码错误');\r\n            return;\r\n        }\r\n        nav.replace(<Page header=\"修改密码\" back=\"close\">\r\n            <div className=\"m-3  text-success\">\r\n                密码修改成功！\r\n            </div>\r\n        </Page>);\r\n        return;\r\n    }\r\n\r\n\theader() {return '修改密码'}\r\n\r\n    content() {\r\n        return <Form\r\n\t\t\tclassName=\"m-3\" \r\n\t\t\tschema={this.schema}\r\n\t\t\tuiSchema={this.uiSchema}\r\n\t\t\tonButtonClick={this.onSubmit}\r\n\t\t\tfieldLabelSize={2} />\r\n    }\r\n}\r\n","import { User } from '../tool';\r\nimport { nav, Login } from '../components';\r\nimport { Controller, VPage } from \"../vm\";\r\nimport { VLogout } from './VLogout';\r\nimport { VLogin } from './VLogin';\r\nimport { CenterAppApi, userApi } from '../net';\r\nimport { VChangePassword } from './VChangePassword';\r\n\r\nexport class CLogin extends Controller implements Login {\r\n\tprotected async internalStart() {\r\n\t}\r\n\r\n\tasync showLogin(callback?: (user:User)=>Promise<void>, withBack?:boolean):Promise<void> {\r\n\t\tlet onLogin = async (un:string, pwd:string):Promise<boolean> => {\r\n\t\t\tlet user = await userApi.login({\r\n\t\t\t\tuser: un,\r\n\t\t\t\tpwd: pwd,\r\n\t\t\t\tguest: nav.guest,\r\n\t\t\t});\r\n\t\r\n\t\t\tif (user === undefined) return false;\r\n\t\t\tconsole.log(\"onLoginSubmit: user=%s pwd:%s\", user.name, user.token);\r\n\t\t\tawait nav.userLogined(user, callback);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tthis.openVPage(VLogin, {onLogin, withBack});\r\n    }\r\n\r\n    async showLogout(callback?: ()=>Promise<void>) {\r\n\t\tthis.openVPage(VLogout, () => {\r\n\t\t\tnav.logout(callback);\r\n\t\t});\r\n\t}\r\n\t/*\r\n\tasync showRegister() {\r\n\t\tlet cRegister = new (await import('./register')).CRegister(this.res);\r\n\t\tawait cRegister.start();\r\n\t}\r\n\r\n\tasync showForget() {\r\n\t\tlet cForget = new (await import('./register')).CForget(this.res);\r\n\t\tawait cForget.start();\r\n\t}\r\n\t*/\r\n\r\n\tprotected getVChangePassword():new (cLogin:CLogin) => VPage<CLogin> {\r\n\t\treturn VChangePassword;\r\n\t}\r\n\tasync showChangePassword() {\r\n\t\tlet vPage = this.getVChangePassword();\r\n\t\tthis.openVPage(vPage, async (orgPassword:string, newPassword:string):Promise<boolean> => {\r\n\t\t\tlet centerAppApi = new CenterAppApi('tv/', undefined);\r\n\t\t\tlet ret = await centerAppApi.changePassword({orgPassword, newPassword});\r\n\t\t\treturn ret;\r\n\t\t});\r\n    }\r\n}\r\n","export default __webpack_public_path__ + \"static/media/logo.2d27ead7.svg\";","import * as React from 'react';\r\nimport { nav } from '../components';\r\nimport { mobileRegex, emailRegex } from '../tool';\r\nimport logo from '../img/logo.svg';\r\n\r\nexport function tonvaTop() {\r\n    return nav.loginTop(<div className=\"d-flex align-items-center position-relative\">\r\n        <img className=\"App-logo h-3c position-absolute\" src={logo} alt=\"img\" />\r\n        <div className=\"h3 flex-fill text-center\"><span className=\"text-primary mr-3\">同</span>\r\n            <span className=\"text-danger\">花</span>\r\n        </div>\r\n    </div>);\r\n}\r\n\r\ninterface Sender {\r\n    type: string;\r\n    caption: string;\r\n    regex: RegExp;\r\n}\r\n\r\nconst senders:Sender[] = [\r\n    {type:'mobile', caption:'手机号', regex: mobileRegex},\r\n    {type:'email', caption:'邮箱', regex: emailRegex}\r\n];\r\n\r\nexport function getSender(un: string):Sender {\r\n    let sender = senders.find(v => v.regex.test(un) === true);\r\n    return sender;\r\n}","export * from './page';\r\nexport * from './tabs';\r\nexport * from './scrollView';\r\nexport * from './pageHeader';","export * from './schema';\r\nexport * from './uiSchema';\r\nexport * from './toUiSelectItems';\r\nexport * from './IValuesView';","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport interface DropdownAction {\r\n    icon?: string;\r\n    caption?: string;\r\n\taction?: () => void;\r\n\ticonClass?: string;\r\n\tcaptionClass?: string;\r\n}\r\n\r\nexport interface DropdownActionsProps {\r\n    icon?: string;\r\n\tcontent?: string|JSX.Element;\r\n    actions: DropdownAction[];\r\n    isRight?: boolean;\r\n\tclassName?: string;\r\n\tcontainerClass?: string;\r\n\titemIconClass?: string;\r\n\titemCaptionClass?: string;\r\n}\r\n\r\nexport interface DropdownActionsState {\r\n    dropdownOpen: boolean;\r\n}\r\n\r\nexport class DropdownActions extends React.Component<DropdownActionsProps, DropdownActionsState> {\r\n    private menu: HTMLDivElement;\r\n    private button: HTMLElement;\r\n    constructor(props:DropdownActionsProps) {\r\n        super(props);\r\n        this.state = {\r\n            dropdownOpen: false\r\n        };\r\n    }\r\n\r\n    componentDidMount() {\r\n        document.addEventListener('click', this.handleDocumentClick);\r\n        document.addEventListener('touchstart', this.handleDocumentClick);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        document.removeEventListener('click', this.handleDocumentClick);\r\n        document.removeEventListener('touchstart', this.handleDocumentClick);\r\n    }\r\n\r\n    private handleDocumentClick = (evt:any) => {\r\n        if (this.state.dropdownOpen === false) return;\r\n        if (this.button && this.button.contains(evt.target)) return;\r\n        if (!this.menu) return;\r\n        //if (!this.menu.contains(evt.target)) \r\n        this.toggle();\r\n    }\r\n\r\n    private toggle = () => {\r\n        this.setState({\r\n            dropdownOpen: !this.state.dropdownOpen\r\n        });\r\n    }\r\n\r\n    render() {\r\n        let {icon, content, actions, isRight, className, containerClass, itemIconClass, itemCaptionClass} = this.props;\r\n        if (isRight === undefined) isRight = true;\r\n        let hasIcon = actions.some(v => {\r\n\t\t\tif (!v) return false;\r\n\t\t\treturn v.icon !== undefined\r\n\t\t});\r\n        let {dropdownOpen} = this.state;\r\n\t\t//isOpen={this.state.dropdownOpen} toggle={this.toggle}\r\n\t\tlet cn = className || 'cursor-pointer dropdown-toggle btn btn-sm';\r\n\t\t//if (className) cn += className;\r\n        return <div className={classNames('dropdown', containerClass)}>\r\n\t\t\t<button ref={v=>this.button=v} \r\n\t\t\t\tclassName={cn}\r\n                data-toggle=\"dropdown\"\r\n                aria-expanded={dropdownOpen}\r\n                onClick={this.toggle}>\r\n                {icon!==null && <i className={classNames('fa fa-fw ', 'fa-'+(icon||'ellipsis-v'))} />}\r\n\t\t\t\t{content && <span className=\"ml-1\">{content}</span>}\r\n            </button>\r\n            <div ref={v => this.menu=v} className={classNames({\"dropdown-menu\":true, \"dropdown-menu-right\":isRight, \"show\":dropdownOpen})}>\r\n                {\r\n                    actions.map((v,index) => {\r\n\t\t\t\t\t\tif (!v) {\r\n                            return <div className=\"dropdown-divider\" key={index}/>;\r\n\t\t\t\t\t\t}\r\n                        let {icon, caption, action, iconClass, captionClass} = v;\r\n                        if (icon === undefined && caption === undefined) \r\n                            return <div className=\"dropdown-divider\" />;\r\n                        let i:any;\r\n                        if (hasIcon === true) {\r\n                            if (icon !== undefined) icon = 'fa-' + icon;\r\n\t\t\t\t\t\t\tif (!iconClass) iconClass = 'text-info';\r\n\t\t\t\t\t\t\ti = <i className={classNames('mr-2', 'fa', icon, 'fa-fw', iconClass || itemIconClass)}\r\n\t\t\t\t\t\t\t\taria-hidden={true}></i>;\r\n                        }\r\n                        if (action === undefined) \r\n                            return <h6 className=\"dropdown-header\">{i} {caption}</h6>;\r\n                        let onMenuItemClick = (evt:React.MouseEvent<HTMLAnchorElement>)=>{\r\n                            evt.preventDefault();\r\n                            action();\r\n                        }\r\n                        let onTouchStart = (evt: React.TouchEvent<HTMLAnchorElement>) => {\r\n                            action();\r\n                        }\r\n                            // eslint-disable-next-line\r\n                        return <a className=\"dropdown-item\" key={index} href=\"#/\" \r\n                            onClick={onMenuItemClick} onTouchStart={onTouchStart}\r\n                            >{i} <span className={captionClass || itemCaptionClass}>{caption}</span></a>\r\n                    })\r\n                }\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { setRes } from '../../res';\r\n\r\nexport interface EasyDateProps {\r\n    date: Date | number;\r\n}\r\n\r\n//type YMD = (year:number, month:number, date:number) => string;\r\n//type MD = (month:number, date:number) => string;\r\n\r\nconst timeRes:{[prop:string]:any} = {\r\n\tmd: (month:number, date:number) => `${month}-${date}`,\r\n\tymd: (year:number, month:number, date:number) => `${year}-${month}-${date}`,\r\n\tyesterday: 'Yday',\r\n\ttoday: 'Today',\r\n\ttomorrow: 'Tmw',\r\n\t$zh: {\r\n\t\tmd: (month:number, date:number) => `${month}月${date}日`,\r\n\t\tymd: (year:number, month:number, date:number) => `${year}年${month}月${date}日`,\r\n\t\tyesterday: '昨天',\r\n\t\ttoday: '今天',\r\n\t\ttomorrow: '明天',\r\n\t},\r\n\t$en: {\r\n\t\tmd: (month:number, date:number) => `${month}-${date}`,\r\n\t\tymd: (year:number, month:number, date:number) => `${year}-${month}-${date}`,\r\n\t\tyesterday: 'Yday',\r\n\t\ttoday: 'Today',\r\n\t\ttomorrow: 'Tmw',\r\n\t}\r\n}\r\n\r\nsetRes(timeRes, timeRes);\r\n\r\nfunction tt(str:string):any {\r\n\treturn timeRes[str];\r\n}\r\n\r\nfunction renderDate(vDate:Date|number, withTime:boolean, always:boolean = false) {\r\n    if (!vDate) return null;\r\n    let date: Date;\r\n    switch (typeof vDate) {\r\n        default: date = vDate as Date; break;\r\n        case 'string': date = new Date(vDate); break;\r\n        case 'number': date = new Date((vDate as number)*1000); break;\r\n    }\r\n\r\n    let now = new Date();\r\n    let tick:number, nDate:number, _date:number, month:number, year:number, nowYear:number;\r\n    let d = date;\r\n    tick = now.getTime() - d.getTime();\r\n    let hour=d.getHours(), minute=d.getMinutes();\r\n    nDate=now.getDate();\r\n    _date=d.getDate();\r\n    month=d.getMonth()+1;\r\n    year=d.getFullYear();\r\n\tnowYear = now.getFullYear();\r\n\r\n\tlet appendTime:boolean = false;\r\n\tlet dPart:string = (function() {\r\n\t\tif (tick < -24*3600*1000) {\r\n\t\t\tif (year === nowYear) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt('md')(month, _date);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt('ymd')(year, month, _date);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (tick < 24*3600*1000) {\r\n\t\t\tif (_date!==nDate) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt(tick < 0? 'tomorrow' : 'yesterday');\r\n\t\t\t}\r\n\t\t\tif (withTime===true) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\t\t\treturn tt('today');\r\n\t\t}\r\n\t\tif (year === nowYear) {\r\n\t\t\treturn tt('md')(month, _date);\r\n\t\t}\r\n\t\treturn tt('ymd')(year, month, _date);\r\n\t})();\r\n\r\n\tlet hm = hour + ((minute<10?':0':':') + minute);\r\n\r\n\t/*\r\n    if (tick < -24*3600*1000) {\r\n        if (year === nowYear)\r\n            return tt('md')(month, _date) + ' ' + hm;\r\n        else\r\n            return tt('ymd')(year, month, _date) + ' ' + hm;\r\n    }\r\n    if (always === true || tick < 24*3600*1000) {\r\n        return _date!==nDate? \r\n            tt(tick < 0? 'tomorrow' : 'yesterday') + ' ' + hm \r\n            : withTime===true? hm : tt('today');\r\n    }\r\n    if (year === nowYear) {\r\n        return tt('md')(month, _date);\r\n    }\r\n\treturn tt('ymd')(year, month, _date);\r\n\t*/\r\n\tif (appendTime === true || always === true) {\r\n\t\treturn dPart + ' ' + hm;\r\n\t}\r\n\treturn dPart;\r\n}\r\n\r\n\r\nexport class EasyDate extends React.Component<EasyDateProps> {\r\n    render() {\r\n        return renderDate(this.props.date, false);\r\n    }\r\n}\r\n\r\ninterface EasyTimeProps extends EasyDateProps {\r\n\talways?: boolean;\r\n}\r\nexport class EasyTime extends React.Component<EasyTimeProps> {\r\n    render() {\r\n\t\tlet {date, always} = this.props;\r\n        return renderDate(date, true, always);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Image } from '.';\r\n\r\nexport interface MediaProps {\r\n    icon: string;\r\n    main: string|JSX.Element;\r\n    discription?: string | JSX.Element;\r\n    px?: number;\r\n    py?: number;\r\n}\r\n\r\nexport class Media extends React.Component<MediaProps> {\r\n    render() {\r\n        let {icon, main, discription, px, py} = this.props;\r\n        let disp:any;\r\n        if (typeof discription === 'string')\r\n            disp = <div>{discription}</div>;\r\n        else\r\n            disp = discription;\r\n        let cn = classNames(\r\n            'media', \r\n            px===undefined? 'px-0':'px-'+px, \r\n            py===undefined? 'py-2':'py-'+py);\r\n        return <div className={cn}>\r\n            <Image className=\"mr-3 w-4c h-4c\" src={icon} />\r\n            <div className=\"media-body\">\r\n                <h5 className=\"mt-0\">{main}</h5>\r\n                {disp}\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport interface SearchBoxProps {\r\n    className?: string;\r\n    label?: string;\r\n    initKey?: string;\r\n    placeholder?: string;\r\n    buttonText?: string;\r\n    maxLength?: number;\r\n    size?: 'sm' | 'md' | 'lg';\r\n    inputClassName?: string;\r\n    onSearch: (key:string)=>Promise<void>;\r\n    onFocus?: ()=>void;\r\n    allowEmptySearch?: boolean;\r\n}\r\n\r\n/*\r\nexport interface SearchBoxState {\r\n    disabled: boolean;\r\n}*/\r\n\r\nexport class SearchBox extends React.Component<SearchBoxProps> { //}, SearchBoxState> {\r\n    private input: HTMLInputElement;\r\n\tprivate button: HTMLButtonElement;\r\n    private key: string = null;\r\n\t\r\n    private onChange = (evt: React.ChangeEvent<any>) => {\r\n        this.key = evt.target.value;\r\n        if (this.key !== undefined) {\r\n            this.key = this.key.trim();\r\n            if (this.key === '') this.key = undefined;\r\n        }\r\n\t\tconsole.log('key = ' + this.key);\r\n        if (this.props.allowEmptySearch === true) {\r\n\t\t}\r\n\t\telse {\r\n            this.button.disabled = this.key === undefined || this.key.length === 0;\r\n        }\r\n    }\r\n    private onSubmit = async (evt: React.FormEvent<any>) => {\r\n        evt.preventDefault();\r\n        if (this.key === null) this.key = this.props.initKey || '';\r\n        if (this.props.allowEmptySearch !== true) {\r\n            if (!this.key) return;\r\n            if (this.input) this.input.disabled = true;\r\n\t\t\tif (this.button) this.button.disabled = true;\r\n        }\r\n        await this.props.onSearch(this.key);\r\n        if (this.input) this.input.disabled = false;\r\n\t\tif (this.button) this.button.disabled = false;\r\n    }\r\n    clear() {\r\n        if (this.input) this.input.value = '';\r\n    }\r\n    render() {\r\n\t\tlet {className, inputClassName, onFocus,\r\n\t\t\tlabel, placeholder, buttonText, maxLength, size} = this.props;\r\n\t\tlet inputSize:string;\r\n\t\tswitch (size) {\r\n\t\t\tdefault:\r\n\t\t\tcase 'sm': inputSize = 'input-group-sm'; break;\r\n\t\t\tcase 'md': inputSize = 'input-group-md'; break;\r\n\t\t\tcase 'lg': inputSize = 'input-group-lg'; break;\r\n\t\t}\r\n\t\treturn <form className={className} onSubmit={this.onSubmit} >\r\n\t\t\t<div className={classNames(\"input-group\", inputSize)}>\r\n\t\t\t\t{label && <div className=\"input-group-addon align-self-center mr-2\">{label}</div>}\r\n\t\t\t\t<input ref={v=>this.input=v} onChange={this.onChange}\r\n\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\tname=\"key\"\r\n\t\t\t\t\tonFocus={onFocus}\r\n\t\t\t\t\tclassName={classNames('form-control', inputClassName || 'border-primary')}\r\n\t\t\t\t\tplaceholder={placeholder}\r\n\t\t\t\t\tdefaultValue={this.props.initKey}\r\n\t\t\t\t\tmaxLength={maxLength} />\r\n\t\t\t\t<div className=\"input-group-append\">\r\n\t\t\t\t\t<button ref={v=>this.button=v} className=\"btn btn-primary\"\r\n\t\t\t\t\t\ttype=\"submit\"\r\n\t\t\t\t\t\tdisabled={this.props.allowEmptySearch !== true}>\r\n\t\t\t\t\t\t<i className='fa fa-search' />\r\n\t\t\t\t\t\t<i className=\"fa\"/>\r\n\t\t\t\t\t\t{buttonText}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</form>;\t\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { nav } from './nav';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\nimport { userApi } from '../net';\r\nimport { User } from '../tool';\r\n\r\nexport type UserLoader = (userId:number)=>Promise<any>;\r\n\r\nexport class UserCache<T> {\r\n\tprivate loader: UserLoader;\r\n\tprivate onLoaded: (user:User) => void;\r\n\tprivate map = observable(new Map<number, T|number>());\r\n\r\n\tconstructor(loader: UserLoader) {\r\n\t\tif (loader === undefined) loader = (userId:number)=>userApi.user(userId);\r\n\t\tthis.loader = loader;\r\n\t}\r\n\r\n\tuse(id:number|any, onLoaded?:(user:User)=>void) {\t\t\r\n\t\tif (!id) return;\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tif (!id) return;\r\n\t\tthis.onLoaded = onLoaded;\r\n\t\tid = Number(id);\r\n\t\tlet ret = this.map.get(id);\r\n\t\tif (ret === undefined) {\r\n\t\t\tthis.map.set(id, id);\r\n\t\t}\r\n\t}\r\n\r\n\tgetValue(id:number|any):any {\r\n\t\tif (!id) return;\r\n\t\tswitch (typeof(id)) {\r\n\t\t\tcase 'object': \r\n\t\t\t\tid = id.id; \r\n\t\t\t\tif (!id) return;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tlet ret = this.map.get(id);\r\n\t\tif (!ret) return;\r\n\t\tswitch (typeof(ret)) {\r\n\t\tdefault:\r\n\t\t\treturn ret;\r\n\t\tcase 'number':\r\n\t\t\tif (ret < 0) return id;\r\n\t\t\tthis.map.set(id, -id);\r\n\t\t\tthis.loader(id).then(v => {\r\n\t\t\t\tif (!v) v = null;\r\n\t\t\t\tthis.map.set(id, v);\r\n\t\t\t\tif (this.onLoaded) this.onLoaded(v);\r\n\t\t\t}).catch(reason => {\r\n\t\t\t\tconsole.error(reason);\r\n\t\t\t});\r\n\t\t\treturn id;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst userCache = new UserCache(undefined);\r\n\r\nexport interface UserIconProps {\r\n    id: number;\r\n    className?: string;\r\n    style?: React.CSSProperties;\r\n    altImage?: string;\r\n    noneImage?: any;\r\n}\r\n\r\nexport const UserIcon = observer((props: UserIconProps):JSX.Element => {\r\n    let {className, style, id, altImage, noneImage} = props;\r\n    let user = userCache.getValue(id);\r\n    switch (typeof user) {\r\n\tcase 'undefined':\r\n\tcase 'number':\r\n        return <div className={classNames(className, 'image-none')} style={style}>\r\n            {noneImage || <i className=\"fa fa-file-o\" />}\r\n        </div>;\r\n    }\r\n    let {icon} = user;\r\n    if (!icon) {\r\n        return <div className={classNames(className, 'image-none')} style={style}>\r\n            <i className=\"fa fa-file-o\" />\r\n        </div>;\r\n    }\r\n    if (icon.startsWith(':') === true) {\r\n        icon = nav.resUrl + icon.substr(1);\r\n    }\r\n    return <img src={icon} className={className} alt=\"img\"\r\n        style={style}\r\n        onError={evt=>{\r\n            if (altImage) evt.currentTarget.src=altImage;\r\n            else evt.currentTarget.src = 'https://tv.jkchemical.com/imgs/0001.png';\r\n        }} />;\r\n});\r\n\r\nexport interface UserViewProps {\r\n\tid?: number;\r\n\tuser?: number|User;\r\n\trender: (user:User) => JSX.Element;\r\n\tonLoaded?: (user:User) => void\r\n}\r\n\r\nexport const UserView = observer((props: UserViewProps):JSX.Element => {\r\n\tlet {id:idProp, user, render, onLoaded} = props;\r\n\tif (user === null) return <>null</>;\r\n\tswitch (typeof user) {\r\n\t\tcase 'undefined': \r\n\t\t\tuser = userCache.getValue(idProp);\r\n\t\t\tbreak;\r\n\t\tcase 'object': \r\n\t\t\tlet {/*obj, */id} = user as any;\r\n\t\t\t//if (typeof obj !== 'object') {\r\n\t\t\t\tuseUser(id, onLoaded);\r\n\t\t\t\tuser = userCache.getValue(id);\r\n\t\t\t//}\r\n\t\t\tbreak;\r\n\t\tcase 'number':\r\n\t\t\tuseUser(user as number, onLoaded);\r\n\t\t\tuser = userCache.getValue(user as number);\r\n\t\t\tbreak;\r\n\t\tcase 'string':\r\n\t\t\tuseUser(Number(user), onLoaded);\r\n\t\t\tuser = userCache.getValue(Number(user));\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tuser = undefined;\r\n\t\t\tbreak;\r\n\t}\r\n    switch (typeof user) {\r\n\t\tcase 'undefined':\r\n\t\tcase 'number':\r\n        \treturn <>{user}</>;\r\n    }\r\n    return render(user);\r\n});\r\n\r\nexport function useUser(id: number|object, onLoaded?: (user:User)=>void) {\r\n\tif (!id) return;\r\n\tif (typeof(id) === 'object') {\r\n\t\tid = (id as any).id;\r\n\t}\r\n\tuserCache.use(id, onLoaded);\r\n}\r\n","import React from \"react\";\r\nimport classNames from 'classnames';\r\nimport { nav } from \"../nav\";\r\n\r\nexport interface AxProps extends React.DetailedHTMLProps<React.AnchorHTMLAttributes<HTMLAnchorElement>, HTMLAnchorElement> {\r\n\t//children: React.ReactNode;\r\n\t//href: string;\r\n\t//onClick?: (event:React.MouseEvent) => void;\r\n\t//className?: string;\r\n\taClassName?: string;\r\n\tnaClassName?: string;\r\n\t//target?: string;\r\n\t//props?: any;\r\n}\r\n\r\n// 如果是web方式，用webNav方式route网页\r\n// 如果是app方式，用click方式压栈页面\r\nexport const Ax = (axProps: AxProps) => {\r\n\tlet {href, children, className, onClick} = axProps;\r\n\tif (nav.isWebNav === true) {\r\n\t\tlet {aClassName } = axProps;\r\n\t\tif (!href) return <span className=\"text-danger\">Error: href not defined in Ax</span>;\r\n\t\tlet onAxClick = (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n\t\t\tevt.preventDefault();\r\n\t\t\tlet ret:boolean;\r\n\t\t\tif (onClick) {\r\n\t\t\t\tret = onClick(evt) as unknown as boolean;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tnav.navigate(href);\r\n\t\t\t\tret = false;\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t\treturn <a {...axProps} className={classNames(className, aClassName)} onClick={onAxClick}>{children}</a>;\r\n\t}\r\n\telse {\r\n\t\tlet {naClassName} = axProps;\r\n\t\tif (!onClick) {\r\n\t\t\tonClick = () => {\r\n\t\t\t\tif (nav.openSysPage(href) === false) {\r\n\t\t\t\t\tnav.navigate(href);\r\n\t\t\t   };\r\n\t\t\t   return false;\r\n\t\t   }\r\n\t\t}\r\n\t\treturn <span className={classNames(className, 'cursor-pointer', naClassName)} onClick={onClick}>{children}</span>;\r\n\t}\r\n}\r\n\r\n// 同普通的a tag\r\n// 会自动处理href，处理生产版跟测试版之间的不同\r\nexport const A = (props: React.DetailedHTMLProps<React.AnchorHTMLAttributes<HTMLAnchorElement>, HTMLAnchorElement>) => {\r\n\tlet {children} = props;\r\n\tif (nav.isWebNav === false) {\r\n\t\treturn <a {...props}>{children}</a>;\r\n\t}\r\n\tlet {href} = props;\r\n\t//if (nav.testing === true) href += '#test';\r\n\tlet onClick = (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n\t\tevt.preventDefault();\r\n\t\tnav.navigate(href);\r\n\t\treturn false;\r\n\t}\r\n\treturn <a {...props} href={href} onClick={onClick}>{children}</a>;\r\n}\r\n","import React from 'react';\r\nimport { observer } from \"mobx-react\";\r\nimport { IObservableValue } from 'mobx';\r\n\r\nexport function autoHideTips(\r\n\ttips: IObservableValue<boolean|string|JSX.Element>, \r\n\ttemplet?:string|JSX.Element|((v:string|JSX.Element)=>JSX.Element), \r\n\ttimeout?:number):React.FunctionComponentElement<any> \r\n{\r\n\tlet timer:any;\r\n\treturn React.createElement(observer(():JSX.Element => {\r\n\t\tif (timer) {\r\n\t\t\tclearTimeout(timer);\r\n\t\t\ttimer = undefined;\r\n\t\t}\r\n\t\tlet t = tips.get();\r\n\t\tif (!t) return null;\r\n\t\tif (timeout === undefined) timeout = 3000;\r\n\r\n\t\tif (timeout > 0) {\r\n\t\t\ttimer = setTimeout(() => {\r\n\t\t\t\ttips.set(null);\r\n\t\t\t}, timeout);\r\n\t\t}\r\n\t\tswitch (typeof templet) {\r\n\t\t\tcase 'undefined': return <>{t}</>;\r\n\t\t\tcase 'function': return templet(t as string);\r\n\t\t\tcase 'string': return <>{templet}</>;\r\n\t\t\tdefault: return templet;\r\n\t\t}\r\n\t}));\r\n};\r\n","import { UqMan, TuidModify } from '../uqMan';\r\nimport { Tuid } from \"./tuid\";\r\nimport { env } from '../../tool';\r\n\r\ninterface Modify {\r\n    id: number;\r\n    entity: string;\r\n    key: string;\r\n}\r\n\r\nexport class TuidsCache {\r\n    private readonly uq: UqMan;\r\n    private modifyMax: TuidModify;\r\n    private cacheTimer: any;\r\n    constructor(uq: UqMan) {\r\n        this.uq = uq;\r\n    }\r\n\r\n    cacheTuids(defer:number) {\r\n        this.clearCacheTimer();\r\n        this.cacheTimer = env.setTimeout('TuidsCache.cacheTuids', this.loadIds, defer);\r\n    }\r\n    private clearCacheTimer() {\r\n        if (this.cacheTimer === undefined) return;\r\n        env.clearTimeout(this.cacheTimer);\r\n        this.cacheTimer = undefined;\r\n    }\r\n    private loadIds = () => {\r\n        this.clearCacheTimer();\r\n        let {tuids} = this.uq;\r\n        for (let i in tuids) {\r\n            let tuid = tuids[i];\r\n            tuid.cacheIds();\r\n        }\r\n    }\r\n    \r\n    pullModify(modifyMax:number) {\r\n        if (modifyMax === undefined) return;\r\n        let now = Math.floor(Date.now() / 1000);\r\n        if (this.modifyMax === undefined) {\r\n            this.modifyMax = this.uq.localModifyMax.get();\r\n            if (this.modifyMax === undefined) {\r\n                this.modifyMax = {\r\n                    max: modifyMax,\r\n                    seconds: now,\r\n                };\r\n                this.uq.localModifyMax.set(this.modifyMax);\r\n            }\r\n        }\r\n        let {max, seconds} = this.modifyMax;\r\n        let lockGap = 3600;\r\n        if (now - seconds < lockGap) return;\r\n        if (modifyMax <= max) return;\r\n        let tuidCached:string[] = [];\r\n        let {tuids} = this.uq;\r\n        for (let i in tuids) {\r\n            //if (tuids[i].cached === true) \r\n            tuidCached.push(i);\r\n        }\r\n        if (tuidCached.length === 0) return;\r\n        this.modifyMax.seconds = now;\r\n        this.innerPullModify(tuidCached.join('\\t'));\r\n    }\r\n\r\n    private async innerPullModify(tuidLists:string):Promise<void> {\r\n        let {uqApi, tuids} = this.uq;\r\n        let {max} = this.modifyMax;\r\n        let ret:{queue:Modify[], queueMax:number} = await uqApi.queueModify(max, 30, tuidLists);\r\n        let group:{[entity:string]: {tuid:Tuid; ids: string[]}} = {};\r\n        let modifyMax:number = 0;\r\n        for (let modify of ret.queue) {\r\n\t\t\tlet {id, entity, key} = modify;\r\n\t\t\tif (!key) continue;\r\n            let tuid = tuids[entity];\r\n            if (tuid === undefined) continue;\r\n            let item = group[entity];\r\n            if (item === undefined) {\r\n                item = group[entity] = {tuid: tuid, ids:[]};\r\n            }\r\n            item.ids.push(key);\r\n            if (id > modifyMax) modifyMax = id;\r\n        }\r\n        for (let i in group) {\r\n            let {tuid, ids} = group[i];\r\n            await tuid.modifyIds(ids);\r\n        }\r\n        let now = Math.floor(Date.now() / 1000);\r\n        this.modifyMax = {\r\n            max: modifyMax,\r\n            seconds: now,\r\n        }\r\n        this.uq.localModifyMax.set(this.modifyMax);\r\n    }\r\n}\r\n","export * from './ui';\r\nexport * from './fieldItem';\r\nexport * from './fieldUI';\r\nexport * from './IDUI';\r\n","import { ButtonSchema, FieldItem, FieldItemId, FieldItemString, IDUI, IDXEntity, PickId, Prop, Schema, UI, UiButton, UiSchema, Uq } from \"tonva-react\";\r\n\r\nexport abstract class Mid {\r\n\treadonly uq: Uq;\r\n\treadonly res: any;\r\n\tconstructor(uq: Uq, res?: any) {\r\n\t\tthis.uq = uq;\r\n\t\tthis.res = res;\r\n\t}\r\n\r\n\tabstract init():Promise<void>;\r\n\r\n\tprotected async buildItemSchema(IDUI: IDUI): Promise<Schema> {\r\n\t\tlet {ID} = IDUI;\r\n\t\tlet ret:Schema = [];\r\n\t\tlet {fieldArr} = ID.ui;\r\n\t\tfor (let f of fieldArr) {\r\n\t\t\tlet {type, isKey} = f;\r\n\t\t\tlet required = isKey; // (keys as any[]).findIndex(v => v.name === name) >= 0;\r\n\t\t\tlet fieldItem = {\r\n\t\t\t\t...f,\r\n\t\t\t\trequired,\r\n\t\t\t};\r\n\t\t\tswitch (type) {\r\n\t\t\t\tdefault: ret.push(fieldItem); break;\r\n\t\t\t}\r\n\t\t\tlet {ID} = fieldItem;\r\n\t\t\tif (ID) {\r\n\t\t\t\tlet importSelect = await import('../select');\r\n\t\t\t\tthis.setIDUi(fieldItem, importSelect.createPickId(this.uq, ID), ID.render);\r\n\t\t\t}\r\n\t\t}\r\n\t\tret.push({\r\n\t\t\tname: 'submit',\r\n\t\t\ttype: 'submit',\r\n\t\t} as ButtonSchema);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected buildUISchema(IDUI:IDUI):UiSchema {\r\n\t\tlet {ID} = IDUI;\r\n\t\tlet {fields} = ID.ui;\r\n\t\tlet items = {...fields as any};\r\n\t\tlet uiButton: UiButton = {\r\n\t\t\tlabel: '提交',\r\n\t\t\tclassName: 'btn btn-primary',\r\n\t\t\twidget: 'button',\r\n\t\t};\r\n\t\titems['submit'] = uiButton;\r\n\t\tlet ret = {items};\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected buildGridProps(IDX: IDXEntity<any>):Prop[] {\r\n\t\tlet ret:Prop[] = [];\r\n\t\tlet {ui, t} = IDX;\r\n\t\tlet {fieldArr } = ui;\r\n\t\tfor (let f of fieldArr) {\r\n\t\t\tlet prop = {\r\n\t\t\t\t...f,\r\n\t\t\t\tlabel: t(f.label),\r\n\t\t\t};\r\n\t\t\tret.push(prop as any);\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\t\r\n\tprotected setIDUi(fieldItem:FieldItem, pickId: PickId, render: (values:any) => JSX.Element) {\r\n\t\tif (fieldItem.type !== 'id') {\r\n\t\t\talert(`${fieldItem.name} is not id UI`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet idField = fieldItem as FieldItemId;\r\n\t\tidField.widget = 'id';\r\n\t\tidField.pickId = pickId;\r\n\t\t(idField as any).Templet = render;\r\n\t}\r\n\r\n\tprotected setNO(no:string, noFieldItem: FieldItem) {\r\n\t\tif (!noFieldItem) return;\r\n\t\tif (noFieldItem.type !== 'string') return;\r\n\t\tlet noField = noFieldItem as FieldItemString;\r\n\t\tnoField.readOnly = true;\r\n\t\tnoField.defaultValue = no;\r\n\t}\r\n\r\n}\r\n","import _ from 'lodash';\r\nimport { Context } from '../context';\r\nimport { FormRes } from '../../../res/formRes';\r\n\r\nexport abstract class Rule {\r\n    abstract check(defy:string[], value:any):void;\r\n}\r\n\r\nexport type ContextRule = (context:Context)=>{[target:string]:string[]|string} | string[] | string;\r\nexport type FieldRule = (value:any) => string[] | string;\r\n\r\nexport class RuleCustom extends Rule {\r\n    private func: FieldRule;\r\n    constructor(func: FieldRule) {\r\n        super();\r\n        this.func = func;\r\n    }\r\n    check(defy:string[], value:any) {\r\n        let ret = this.func(value);\r\n        if (ret === undefined) return;\r\n        switch (typeof ret) {\r\n            case 'undefined': return;\r\n            case 'string': defy.push(ret as string); return;\r\n            default: defy.push(...ret); return;\r\n        }        \r\n    }\r\n}\r\n\r\nexport abstract class RulePredefined extends Rule {\r\n    protected res: FormRes;\r\n    constructor(res: FormRes) {\r\n        super();\r\n        this.res = res;\r\n    }\r\n}\r\n\r\nexport class RuleRequired extends RulePredefined {\r\n    check(defy:string[], value:any) {\r\n        switch (typeof value) {\r\n            default:\r\n            case 'boolean': return;\r\n            case 'object':\r\n                if (value !== null) return;\r\n                break;\r\n            case 'string':\r\n                if ((value as string).trim().length > 0) return;\r\n                break;\r\n            case 'number':\r\n                if (isNaN(value as number) === false) return;\r\n                break;\r\n            case 'undefined':\r\n                break;\r\n        }\r\n        defy.push(this.res.required);\r\n    }\r\n}\r\n\r\nexport class RuleNum extends RulePredefined {\r\n    private minMsg: _.TemplateExecutor;\r\n    private maxMsg: _.TemplateExecutor;\r\n    protected min: number;\r\n    protected max: number\r\n    constructor(res: FormRes, min?: number, max?: number) {\r\n        super(res);\r\n        this.minMsg = _.template(res.min);\r\n        this.maxMsg = _.template(res.max);\r\n        this.min = min;\r\n        this.max = max;\r\n    }\r\n    check(defy:string[], value:any) {\r\n        if (value === undefined || value === null) return;\r\n        let n = Number(value);\r\n        if (isNaN(n) === true) {\r\n            defy.push(this.res.number);\r\n        }\r\n        else {\r\n            this.checkMore(defy, n);\r\n        }\r\n    }\r\n\r\n    protected checkMore(defy:string[], value: number) {\r\n        if (this.min !== undefined && Number(value) < this.min) {\r\n            defy.push(this.minMsg({min:this.min}));\r\n        }\r\n        if (this.max !== undefined && Number(value) > this.max) {\r\n            defy.push(this.maxMsg({max:this.max}));\r\n        }\r\n    }\r\n}\r\n\r\nexport class RuleInt extends RuleNum {\r\n    protected checkMore(defy:string[], n: number) {\r\n        super.checkMore(defy, n);\r\n        if (Number.isInteger(n) === false) {\r\n            defy.push(this.res.integer);\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiItem, ChangingHandler, ChangedHandler } from '../../schema';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { ItemSchema } from '../../schema';\r\nimport { Rule, RuleRequired, RuleCustom, FieldRule } from '../rules';\r\nimport { computed, makeObservable, observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport abstract class Widget {\r\n    name: string;\r\n    protected context: Context;\r\n    protected fieldProps:FieldProps;\r\n    protected children: React.ReactNode;\r\n    protected _itemSchema: ItemSchema;\r\n    protected _ui: UiItem;\r\n\tprotected defaultValue: any;\r\n    protected rules: Rule[];\r\n    protected readOnly:boolean;\r\n\t\r\n\tdisabled:boolean = false;\r\n    errors: string[] = [];\r\n    contextErrors: string[] = [];\r\n    get hasError():boolean {return (this.errors.length + this.contextErrors.length)>0}\r\n    visible:boolean = null;\r\n\tvalue: any = null;\r\n\r\n    constructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n\t\tmakeObservable(this, {\r\n\t\t\terrors: observable,\r\n\t\t\tcontextErrors: observable,\r\n\t\t\thasError: computed,\r\n\t\t\tvisible: observable,\r\n\t\t\tvalue: observable,\r\n\t\t\tdisabled: observable,\r\n\t\t});\r\n        this.context = context;\r\n        let {name} = itemSchema;\r\n        this.name = name;\r\n        this._itemSchema = itemSchema;\r\n        this.fieldProps = fieldProps;\r\n        this.children = children;\r\n        this._ui = context.getUiItem(name);\r\n        if (this.ui === undefined) {\r\n            this.readOnly = false;\r\n            this.disabled = false;\r\n            this.visible = true;\r\n        }\r\n        else {\r\n            let {readOnly, disabled, visible} = this.ui;\r\n            this.readOnly = (readOnly === true);\r\n            this.disabled = (disabled === true);\r\n            this.visible = !(visible === false);\r\n        }\r\n        this.value = this.defaultValue =  context.getValue(name); //defaultValue;\r\n        // this.init();\r\n    }\r\n\r\n    protected get itemSchema(): ItemSchema {return this._itemSchema};\r\n    protected get ui(): UiItem {return this._ui};\r\n\r\n    init() {\r\n        this.rules = [];\r\n        if (this.itemSchema.required === true) {\r\n            this.rules.push(new RuleRequired(this.context.form.res));\r\n        }\r\n        this.buildRules();\r\n        if (this.ui === undefined) return;\r\n        let {rules} = this.ui;\r\n        if (rules === undefined) return;\r\n        if (Array.isArray(rules) === false) {\r\n            this.rules.push(new RuleCustom(rules as FieldRule));\r\n            return;\r\n        }\r\n        for (let rule of rules as FieldRule[]) {\r\n            this.rules.push(new RuleCustom(rule));\r\n        }\r\n    }\r\n\r\n    protected buildRules() {\r\n    }\r\n\r\n    checkRules() {\r\n        let defy:string[] = [];\r\n        for (let r of this.rules) r.check(defy, this.value);\r\n        if (defy.length === 0) {\r\n            this.context.removeErrorWidget(this);\r\n        }\r\n        else {\r\n            this.context.addErrorWidget(this);\r\n            this.errors.push(...defy);\r\n        }\r\n    }\r\n\r\n    @computed get isOk() {\r\n        return this.errors.length ===0;\r\n    }\r\n\r\n    setError(err:string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.errors.push(err);\r\n        else this.errors.push(...err);\r\n    }\r\n\r\n    setContextError(err:string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.contextErrors.push(err);\r\n        else this.contextErrors.push(...err);\r\n    }\r\n\r\n    clearError() {\r\n        this.errors.splice(0);\r\n    }\r\n\r\n    clearContextError() {\r\n        this.contextErrors.splice(0);\r\n    }\r\n\r\n    protected parse(value:any):any {return value}\r\n\r\n    protected setElementValue(value:any) {}\r\n    protected setDataValue(value:any) {\r\n        if (this.isChanging === true) return;\r\n        this.context.initData[this.name] = this.value = this.parse(value);\r\n    }\r\n\r\n    setValue(value:any) {\r\n        if (this.isChanging === true) return;\r\n        this.changeValue(value, false);\r\n    }\r\n\r\n    getValue() {\r\n        return this.context.getValue(this.name);\r\n    }\r\n\r\n    getReadOnly():boolean {return this.readOnly}\r\n    getDisabled():boolean {return this.disabled}\r\n    getVisible():boolean {return this.visible}\r\n    setReadOnly(value:boolean) {this.readOnly = value}\r\n    setDisabled(value:boolean) {\r\n\t\tthis.disabled = value;\r\n\t}\r\n    setVisible(value:boolean) {this.visible = value}\r\n\r\n    private isChanging: boolean;\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n        this.changeValue(evt.target.value, true);\r\n    }\r\n\r\n    protected changeValue(newValue: any, fromElement: boolean) {\r\n        let prev = this.value;\r\n        let onChanging: ChangingHandler;\r\n        let onChanged: ChangedHandler;\r\n        if (this.ui !== undefined) {\r\n            onChanging = this.ui.onChanging;\r\n            onChanged = this.ui.onChanged;\r\n        }\r\n        let allowChange = true;\r\n        if (onChanging !== undefined) {\r\n            this.isChanging = true;\r\n            allowChange = onChanging(this.context, this.value, prev);\r\n            this.isChanging = false;\r\n        }\r\n        if (allowChange === true) {\r\n            this.setDataValue(newValue);\r\n            if (fromElement !== true) this.setElementValue(newValue);\r\n            if (onChanged !== undefined) {\r\n                this.isChanging = true;\r\n                onChanged(this.context, this.value, prev);\r\n                this.isChanging = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected get className():string {\r\n        let fieldClass:string;\r\n        if (this.context.inNode === false) fieldClass = 'form-control';\r\n        return classNames(fieldClass, this.context.form.FieldClass, this.ui && this.ui.className);\r\n    }\r\n\r\n    protected abstract render():JSX.Element;\r\n\r\n    protected renderBody():JSX.Element {\r\n        let elDiscription;\r\n        if (this.hasError === false && this.ui) {\r\n            let {discription, discriptionClassName} = this.ui;\r\n            if (discriptionClassName === undefined) discriptionClassName = 'small text-muted';\r\n            elDiscription = <span className={discriptionClassName}>\r\n                {discription}\r\n            </span>;\r\n        }\r\n        return <>\r\n            {this.render()}\r\n            {elDiscription}\r\n        </>;\r\n    }\r\n\r\n    container = observer(():JSX.Element => {\r\n        if (this.visible === false) return null;\r\n        let {form, inNode} = this.context;\r\n        if (inNode === true) return this.render();\r\n        let label:any = this.label;\r\n        if (this.itemSchema.required === true && form.props.requiredFlag !== false) {\r\n            if (label !== null) label = <>{label}&nbsp;<span className=\"text-danger\">*</span></>;\r\n        }\r\n        return form.FieldContainer(label, this.renderBody());\r\n    })\r\n\r\n    protected get label():string {\r\n        let label:any;\r\n        if (this.ui === undefined) {\r\n            label = this.name;\r\n        }\r\n        else {\r\n            let uiLabel = this.ui.label;\r\n            if (uiLabel === null) label = null;\r\n            else label = uiLabel || this.name;\r\n        }\r\n        return label;\r\n    }\r\n\r\n    protected renderTemplet():JSX.Element | undefined {\r\n        if (this.children !== undefined) {\r\n            return <>{this.children}</>;\r\n        }\r\n        if (this.ui === undefined) return undefined;\r\n        let {Templet} = this.ui;\r\n        if (typeof Templet === 'function') return Templet(this.value);\r\n        return Templet;\r\n    }\r\n\r\n    protected renderErrors() {\r\n        let errorList:string[] = [...this.errors, ...this.contextErrors];\r\n        if (errorList.length === 0) return null;\r\n        let {inNode} = this.context;\r\n        let tag = inNode === true? 'span' : 'div';\r\n        return errorList.map(err => React.createElement(tag, \r\n            {\r\n                key: err, \r\n                className: 'text-danger d-inline-block my-2 ml-3'\r\n            },\r\n            <><i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}</>\r\n        ));\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { makeObservable, observable, runInAction } from 'mobx';\r\nimport { UiTextItem, StringSchema, ItemSchema } from '../../schema';\r\nimport { Context } from '../context';\r\nimport { FieldProps } from '../field';\r\nimport { Widget } from './widget';\r\n\r\nexport class TextWidget extends Widget {\r\n    protected inputType = 'text';\r\n    protected get ui(): UiTextItem {return this._ui as UiTextItem};\r\n    protected input: HTMLInputElement;\r\n    hasFocus: boolean = false;\r\n\r\n\tconstructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n\t\tsuper(context, itemSchema, fieldProps, children);\r\n\t\tmakeObservable(this, {\r\n\t\t\thasFocus: observable,\r\n\t\t})\r\n\t}\r\n\r\n    protected setElementValue(value:any) {\r\n        if (this.input === null) return;\r\n        this.input.value = value;\r\n    }\r\n    protected get placeholder() {\r\n\t\tif (this.ui) {\r\n\t\t\tlet {placeholder} = this.ui;\r\n\t\t\tif (placeholder) return placeholder;\r\n\t\t\tlet {label} = this.ui;\r\n\t\t\tif (label) return label;\r\n\t\t}\r\n\t\treturn this.name\r\n\t}\r\n    protected onKeyDown = async (evt:React.KeyboardEvent<HTMLInputElement>) => {\r\n        this.internalOnKeyDown(evt);\r\n        if (evt.keyCode !== 13) return;\r\n        let {onEnter} = this.context.form.props;\r\n        if (onEnter === undefined) return;\r\n\r\n        this.changeValue(evt.currentTarget.value, true);\r\n\r\n        //this.checkRules();\r\n        //this.context.checkContextRules();\r\n        this.input.blur();\r\n\r\n        let ret = await onEnter(this.name, this.context);\r\n        if (ret !== undefined) {\r\n            this.context.setError(this.name, ret);\r\n        }\r\n    }\r\n\r\n    protected internalOnKeyDown(evt:React.KeyboardEvent<HTMLInputElement>) {\r\n    }\r\n\r\n    protected onBlur = (evt: React.FocusEvent<any>) => {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.onInputChange(evt);\r\n\t\t\tthis.checkRules();\r\n\t\t\tthis.context.checkContextRules();\r\n\t\t\tthis.hasFocus = false;\r\n\t\t});\r\n    }\r\n    protected onFocus = (evt: React.FocusEvent<any>) => {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.clearError();\r\n\t\t\tthis.context.removeErrorWidget(this);\r\n\t\t\tthis.context.clearErrors();\r\n\t\t\tthis.hasFocus = true;\t\r\n\t\t});\r\n    }\r\n    protected onChange(evt: React.ChangeEvent<any>) {\r\n    }\r\n\r\n    setReadOnly(value:boolean) {\r\n        if (this.input === null) return;\r\n        this.input.readOnly = this.readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        if (this.input === null) return;\r\n        this.input.disabled = this.disabled = value;\r\n    }\r\n\r\n    render() {\r\n        let renderTemplet = this.renderTemplet();\r\n        if (renderTemplet !== undefined) return renderTemplet;\r\n        let cn:any = {\r\n            //'form-control': true,\r\n        };\r\n        if (this.hasError === true) {\r\n            cn['is-invalid'] = true;\r\n        }\r\n        else {\r\n            cn['required-item'] = this.itemSchema.required === true;\r\n        }\r\n        return <><input ref={input=>this.input = input}\r\n            className={classNames(this.className, cn)}\r\n            type={this.inputType}\r\n            defaultValue={this.value}\r\n            onChange={(evt: React.ChangeEvent<any>) => this.onChange(evt)}\r\n            placeholder={typeof this.placeholder === 'string'? this.placeholder : undefined}\r\n            readOnly={this.readOnly}\r\n            disabled={this.disabled}\r\n            onKeyDown = {this.onKeyDown}\r\n            onFocus = {this.onFocus}\r\n            onBlur={this.onBlur}\r\n            maxLength={(this.itemSchema as StringSchema).maxLength} />\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTextAreaItem } from '../../schema';\r\nimport { StringSchema } from '../../schema';\r\n\r\nexport class TextAreaWidget extends Widget {\r\n    protected get itemSchema(): StringSchema {return this._itemSchema as StringSchema};\r\n    protected input: HTMLTextAreaElement;\r\n    protected get ui(): UiTextAreaItem {return this._ui as UiTextAreaItem};\r\n\r\n    protected setElementValue(value:any) {this.input.value = value}\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.setValue(evt.currentTarget.value);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n\tprotected onBlur = (evt: React.FocusEvent<any>) => {\r\n        this.onInputChange(evt);\r\n        this.checkRules();\r\n        this.context.checkContextRules();\r\n    }\r\n    protected onFocus = (evt: React.FocusEvent<any>) => {\r\n        this.clearError();\r\n        this.context.removeErrorWidget(this);\r\n        this.context.clearErrors();\r\n    }\r\n\r\n    render() {\r\n        let renderTemplet = this.renderTemplet();\r\n        if (renderTemplet !== undefined) return renderTemplet;\r\n        let cn:any = {};\r\n        if (this.hasError === true) {\r\n            cn['is-invalid'] = true;\r\n        }\r\n        else {\r\n            cn['required-item'] = this.itemSchema.required === true;\r\n        }\r\n        return <>\r\n\t\t\t<textarea ref={(input) => this.input=input}\r\n\t\t\t\tonBlur={this.onBlur} \r\n\t\t\t\tonFocus={this.onFocus}\r\n                className={classNames(this.className, cn)}\r\n                rows={this.ui && this.ui.rows}\r\n                maxLength={this.itemSchema.maxLength}\r\n                defaultValue={this.defaultValue} onChange={this.onInputChange} />\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\n\r\nexport class PasswordWidget extends TextWidget {\r\n    protected inputType = 'password';\r\n}\r\n\r\nexport class UrlWidget extends TextWidget {\r\n    protected inputType = 'url';\r\n}\r\n\r\nexport class EmailWidget extends TextWidget {\r\n    protected inputType = 'email';\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\nimport { RuleNum, RuleInt } from '../rules';\r\nimport { NumBaseSchema } from '../../schema';\r\n\r\nexport class NumberWidget extends TextWidget {\r\n    protected inputType = 'number';\r\n    protected get itemSchema(): NumBaseSchema {return this._itemSchema as NumBaseSchema};\r\n\r\n    protected buildRules() {\r\n        super.buildRules();\r\n        let res = this.context.form.res;\r\n        let {min, max} = this.itemSchema;\r\n        this.rules.push(\r\n            this.itemSchema.type === 'integer'?\r\n\t\t\t\tnew RuleInt(res, min, max) :\r\n\t\t\t\tnew RuleNum(res, min, max)\r\n        );\r\n    }\r\n\r\n    protected parse(value:any):any {\r\n\t\tswitch (typeof value) {\r\n\t\t\tdefault: return;\r\n\t\t\tcase 'undefined': return;\r\n\t\t\tcase 'number': return value;\r\n\t\t\tcase 'string':\r\n\t\t\t\tif ((value as string).trim().length === 0) return;\r\n\t\t\t\treturn Number(value);\r\n\t\t}\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { NumberWidget } from './numberWidget';\r\n\r\nexport class UpdownWidget extends NumberWidget {\r\n    protected inputType = 'number';\r\n\r\n    protected isValidKey(key:number):boolean {\r\n        return key===46 || key===8 || key===37 || key===39\r\n            || (key>=48 && key<=57)\r\n            || (key>=96 && key<=105)\r\n            || key===109 || key===189;\r\n    }\r\n    \r\n    protected internalOnKeyDown(evt:React.KeyboardEvent<HTMLInputElement>) {\r\n        let key = evt.keyCode;\r\n        window.event.returnValue = this.isValidKey(key);\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\n\r\nexport class DateWidget extends TextWidget {\r\n    protected inputType = 'date';\r\n}\r\n\r\nexport class DateTimeWidget extends TextWidget {\r\n    protected inputType = 'datetime';\r\n}\r\n\r\nexport class TimeWidget extends TextWidget {\r\n    protected inputType = 'time';\r\n}\r\n\r\nexport class MonthWidget extends TextWidget {\r\n    protected inputType = 'month';\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiCheckItem } from '../../schema';\r\n\r\nexport class CheckBoxWidget extends Widget {\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiCheckItem {return this._ui as UiCheckItem};\r\n    protected trueValue: any;\r\n    protected falseValue: any;\r\n\r\n    init() {\r\n        super.init();\r\n        if (this.ui !== undefined) {\r\n            let {trueValue, falseValue} = this.ui;\r\n            if (trueValue === undefined) this.trueValue = true;\r\n            else this.trueValue = trueValue;\r\n            if (falseValue === undefined) this.falseValue = false;\r\n            else this.falseValue = falseValue;\r\n        }\r\n        else {\r\n            this.trueValue = true;\r\n            this.falseValue = false;\r\n        }\r\n    }\r\n    protected setElementValue(value:any) {\r\n        this.input.checked = value === this.trueValue;\r\n    }\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let v = evt.target.checked === true? this.trueValue : this.falseValue;\r\n        this.setDataValue(v);\r\n    }\r\n\r\n    protected onClick = () => {\r\n        this.context.clearErrors();\r\n    }\r\n\r\n    render() {\r\n        let cn = classNames(this.className, 'form-check-inline p-0');\r\n        let input = <input\r\n            ref={(input)=>this.input = input}\r\n            className={'align-self-center'}\r\n            type=\"checkbox\"\r\n            defaultChecked={this.defaultValue} \r\n            onChange={this.onInputChange}\r\n            onClick={this.onClick} />;\r\n        if (this.context.inNode === true) {\r\n            return <label className={cn}>\r\n                {input} {(this.ui&&this.ui.label) || this.name}\r\n            </label>\r\n        }\r\n        else {\r\n            return <div className={cn}>\r\n                <label className=\"w-100 h-100 mb-0 d-flex justify-content-center\">{input}</label>\r\n            </div>;\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { Widget } from './widget';\r\nimport { ItemSchema, UiSelect } from '../../schema';\r\nimport { Context } from '../context';\r\nimport { FieldProps } from '../field';\r\n\r\nexport class SelectWidget extends Widget {\r\n    protected select: HTMLSelectElement;\r\n    protected get ui(): UiSelect {return this._ui as UiSelect};\r\n    readOnly: boolean = false;\r\n\r\n\tconstructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n\t\tsuper(context, itemSchema, fieldProps, children);\r\n\t\tmakeObservable(this, {\r\n\t\t\treadOnly: observable,\r\n\t\t})\r\n\t}\r\n\r\n    protected setElementValue(value:any) {this.select.value = value}\r\n    protected onInputChange = (evt:React.ChangeEvent<HTMLSelectElement>) => {\r\n        this.setDataValue(evt.target.value);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.select.disabled = this.readOnly = !value}\r\n    setDisabled(value:boolean) {this.select.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        if (this.readOnly === true) {\r\n            let option = this.ui.list.find(v => v.value === this.value);\r\n            let title = (option === undefined)? '(???)' : option.title;\r\n            return <span className=\"form-control w-min-6c\">{title}</span>;\r\n        }\r\n        return <select\r\n            ref={(select)=>this.select = select}\r\n            className={classNames(this.className, 'form-control')}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onInputChange}>\r\n            {this.ui.list.map((v,index) => {\r\n                let {title, value} = v;\r\n                let cn:string;\r\n                //if (value === undefined || value === null) cn = 'text-light small';\r\n                //else cn = 'text-danger';\r\n                return <option className={cn} key={index} value={value}>{title || value}</option>\r\n            })}\r\n        </select>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n//import { TextWidget } from './textWidget';\r\nimport { Widget } from './widget';\r\nimport { UiRadio } from '../../schema';\r\nimport { RowContext } from '../context';\r\n\r\n\r\nconst radioStyle:React.CSSProperties = {height: 'auto'};\r\n\r\nexport class RadioWidget extends Widget {\r\n    protected inputs: {[index:number]: HTMLInputElement} = {};\r\n    protected get ui(): UiRadio {return this._ui as UiRadio};\r\n\r\n    protected setElementValue(value:any) {\r\n        for (let i in this.inputs) {\r\n            let input = this.inputs[i];\r\n            input.checked = value === input.value;\r\n        }\r\n    }\r\n    setReadOnly(value:boolean) {\r\n        this.readOnly = value;\r\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        this.disabled = value;\r\n        for (let i in this.inputs) this.inputs[i].disabled = value\r\n    }\r\n\r\n    /*\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n        this.changeValue(evt.target.value, true);\r\n    }\r\n    */\r\n\r\n    render() {\r\n        let {defaultValue, list} = this.ui;\r\n        let {isRow} = this.context;\r\n        let rowKey:number;\r\n        if (isRow === true) {\r\n            rowKey = (this.context as RowContext).rowKey;\r\n        }\r\n        let cn = classNames(this.className, 'py-0');\r\n        return <span className={cn} style={radioStyle}>\r\n                {list.map((v,index) => {\r\n                    let {value, title} = v;\r\n                    let name = this.name;\r\n                    if (rowKey !== undefined) name += '-' + rowKey;\r\n                    return <label key={index} className=\"form-radio-inline\">\r\n                        <input ref={input=>this.inputs[index]=input} type=\"radio\" name={name}\r\n                            value={value} defaultChecked={(this.defaultValue || defaultValue)===value}\r\n                            onChange={this.onInputChange} />\r\n                        {title || value}\r\n                    </label>;\r\n                    //</span>\r\n                })}\r\n            </span>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiRange } from '../../schema';\r\nimport { Widget } from './widget';\r\n\r\nexport class RangeWidget extends Widget {\r\n    protected inputType = 'range';\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiRange {return this._ui as UiRange};\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        let {min, max, step} = this.ui;\r\n        return <><input ref={input=>this.input = input}\r\n            className={classNames(this.className, 'form-control', 'w-min-6c')}\r\n            type={this.inputType}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onInputChange}\r\n            max={max}\r\n            min={min}\r\n            step={step}\r\n            />\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiIdItem, TempletType } from '../../schema';\r\nimport { runInAction } from 'mobx';\r\n\r\nconst none = <small className=\"text-muted\">[无]</small>;\r\n\r\nexport class IdWidget extends Widget {\r\n    protected get ui(): UiIdItem {return this._ui as UiIdItem};\r\n\r\n    setReadOnly(value:boolean) {this.readOnly = value}\r\n    setDisabled(value:boolean) {this.disabled = value}    \r\n\r\n    protected onClick = async () => {\r\n        let pickId = this.ui && this.ui.pickId;\r\n        if (pickId === undefined) {\r\n            alert('no pickId defined!');\r\n            return;\r\n        }\r\n\t\tlet id = await pickId(this.context, this.name, this.value);\r\n\t\trunInAction(() => {\r\n\t\t\tthis.setDataValue(id);\r\n\t\t\tthis.clearError();\r\n\t\t\tthis.clearContextError();\r\n\t\t\tthis.checkRules();\t\r\n\t\t});\r\n    }\r\n\r\n\tsetValue(value:any) {\r\n\t\tsuper.setValue(value);\r\n\t}\r\n\r\n    render() {\r\n        let placeholder:string|JSX.Element, Templet: TempletType;\r\n        if (this.ui !== undefined) {\r\n            placeholder = this.ui.placeholder;\r\n            Templet = this.ui.Templet;\r\n        }\r\n        let cn:any = {\r\n            'form-control': true,\r\n            'required-item': this.itemSchema.required === true,\r\n            'cursor-pointer': true,\r\n            'is-invalid': this.hasError,\r\n        };\r\n        let content;\r\n        if (this.value === undefined || this.value === null) {\r\n            content = placeholder || none;\r\n            cn['text-muted'] = true;\r\n        }\r\n        else if (Templet === undefined) {\r\n            let c: any;\r\n            if (this.value === null) {\r\n                c = 'null';\r\n            }\r\n            else {\r\n                switch (typeof this.value) {\r\n                    case 'undefined': c = none; break;\r\n                    case 'object': c = (this.value as any).id; break;\r\n                    default: c = this.value; break;\r\n                }\r\n            }\r\n            content = <>{c}</>;\r\n        }\r\n        else if (typeof Templet === 'function') {\r\n            content = Templet(this.value);\r\n        }\r\n        else {\r\n            content = Templet;\r\n        }\r\n        return <>\r\n            <div className={classNames(cn)} onClick={this.onClick}>{content}</div>\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { DataType } from '../../schema';\r\nimport { UiType } from '../../schema';\r\n\r\nexport const Unknown = (dataType:DataType, uiType:UiType, dataTypes:DataType[]) => {\r\n    return <span className=\"text-danger\">!!data type {dataType} only support {(dataTypes || []).join(', ')}, can't use ui {uiType}!!</span>;\r\n};\r\n","import * as React from 'react';\r\nimport { UiButton, TempletType } from '../../schema';\r\nimport { Unknown } from './unknown';\r\nimport { Widget } from './widget';\r\nimport { observer } from 'mobx-react';\r\nimport { runInAction } from 'mobx';\r\n\r\nexport class ButtonWidget extends Widget {\r\n    protected get ui(): UiButton {return this._ui as UiButton};\r\n\r\n    protected onClick = async () => {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.clearError();\r\n\t\t\tthis.clearContextError();\r\n\t\t})\r\n        let {name, type} = this.itemSchema;\r\n        if (type === 'submit') {\r\n\t\t\tawait this.context.submit(name);\r\n\t\t\treturn;\r\n        }\r\n        let {onButtonClick} = this.context.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`button ${name} clicked. you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(name, this.context);\r\n        if (ret === undefined) return;\r\n\t\trunInAction(() => {\r\n\t\t\tthis.context.setError(name, ret);\r\n\t\t});\r\n    }\r\n\r\n    private observerRender = observer(() => {\r\n        let {name, type} = this.itemSchema;\r\n        let Templet:TempletType, cn:string, caption:string|JSX.Element;\r\n        if (this.ui !== undefined) {\r\n            let {widget:widgetType} = this.ui;\r\n            if (widgetType !== 'button') return Unknown(type, widgetType, ['button']);\r\n            Templet = this.ui.Templet;\r\n            cn = this.ui.className;\r\n            caption = this.ui.label;\r\n        }\r\n        let {form, hasError} = this.context;\r\n        let context = this.context;\r\n        let disabled = (type==='submit' && hasError) || this.disabled;\r\n        let content:any;\r\n        if (this.children !== undefined) content = this.children;\r\n        else if (typeof Templet === 'function') content = Templet();\r\n        else if (Templet !== undefined) content = Templet;\r\n        else content = caption; \r\n        let button = <button \r\n            className={cn} \r\n            type=\"button\"\r\n            disabled={disabled}\r\n            onClick={this.onClick}>\r\n            {content || name}\r\n        </button>;\r\n        if (context.inNode === true) return <>{button}{this.renderErrors()}</>;\r\n        return <div className={form.ButtonClass}>\r\n            <div>{this.renderErrors()}</div>\r\n            {button}\r\n        </div>;\r\n    });\r\n    \r\n    protected get label():string {return null}\r\n\r\n    render() {\r\n        return React.createElement(this.observerRender);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Form } from './form';\r\nimport { UiSchema, UiArr, UiItem } from '../schema';\r\nimport { ArrSchema, ItemSchema } from '../schema';\r\nimport { Widget } from './widgets/widget';\r\n//import { ArrRow } from './arrRow';\r\nimport { observable, computed, makeObservable, runInAction } from 'mobx';\r\nimport { ContextRule } from './rules';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport abstract class Context {\r\n    private subContexts:{[name:string]:{[rowKey:string]:Context}};\r\n    readonly form: Form;\r\n    readonly uiSchema: UiSchema;\r\n    readonly initData: any;\r\n    readonly inNode: boolean;           // true: 在</> 流中定义Field\r\n    readonly widgets: {[name:string]: Widget} = {};\r\n    readonly rules: ContextRule[];\r\n\treadonly isRow: boolean;\r\n\t\r\n    errors: string[] = [];\r\n    errorWidgets:Widget[] = [];\r\n\r\n    constructor(form: Form, uiSchema: UiSchema, data: any, inNode: boolean, isRow: boolean) {\r\n\t\tmakeObservable(this, {\r\n\t\t\terrors: observable,\r\n\t\t\terrorWidgets: observable,\r\n\t\t});\r\n        this.form = form;\r\n        this.uiSchema = uiSchema;\r\n        this.initData = data;\r\n        this.inNode = inNode;\r\n        this.isRow = isRow;\r\n        if (uiSchema !== undefined) {\r\n            let {rules} = uiSchema;\r\n            if (rules !== undefined) {\r\n                this.rules = [];\r\n                if (Array.isArray(rules) === false)\r\n                    this.rules.push(rules as ContextRule);\r\n                else\r\n                    this.rules.push(...rules as ContextRule[]);\r\n            }\r\n        }\r\n    }\r\n\r\n    getArrRowContexts(arrName: string) {\r\n        if (this.subContexts === undefined) this.subContexts = {};\r\n        let arrRowContexts = this.subContexts[arrName];\r\n        if (arrRowContexts === undefined) this.subContexts[arrName] = arrRowContexts = {};\r\n        return arrRowContexts;\r\n    }\r\n\r\n    abstract get data():any;\r\n    abstract getItemSchema(itemName:string):ItemSchema;\r\n    abstract getUiItem(itemName:string):UiItem;\r\n    get arrName():string {return undefined}\r\n    getValue(itemName:string):any {return this.initData[itemName]}\r\n    setValue(itemName:string, value:any) {\r\n        this.initData[itemName] = value;\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setValue(value);\r\n    }\r\n    getDisabled(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) return widget.getDisabled();\r\n        return undefined;\r\n    }\r\n    setDisabled(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setDisabled(value);\r\n    }\r\n    getReadOnly(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.getReadOnly();\r\n        return undefined;\r\n    }\r\n    setReadOnly(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setReadOnly(value);\r\n    }\r\n    getVisible(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.getVisible();\r\n        return undefined;\r\n    }\r\n    setVisible(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setVisible(value);\r\n    }\r\n\r\n    async submit(buttonName: string) {\r\n        this.checkRules()\r\n        if (this.hasError === true) {\r\n            let err = '';\r\n            for (let ew of this.errorWidgets) {\r\n                err += ew.name + ':\\n' + ew.errors.join('\\n');\r\n            }\r\n            console.error(err);\r\n            return;\r\n        }\r\n        let {onButtonClick} = this.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`button ${buttonName} clicked. you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(buttonName, this);\r\n        if (ret === undefined) return;\r\n        this.setError(buttonName, ret);\r\n\r\n    }\r\n\r\n    checkFieldRules() {\r\n        for (let i in this.widgets) {\r\n            this.widgets[i].checkRules();\r\n        }\r\n        if (this.subContexts === undefined) return;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                arrRowContexts[j].checkFieldRules();\r\n            }\r\n        }\r\n    }\r\n\r\n    checkContextRules() {\r\n        this.clearErrors();\r\n        if (this.rules === undefined) return;\r\n        for (let rule of this.rules) {\r\n            let ret = rule(this);\r\n            if (ret === undefined) continue;\r\n            if (Array.isArray(ret) === true) {\r\n                this.errors.push(...ret as string[]);\r\n            }\r\n            else if (typeof ret === 'string') {\r\n                this.errors.push(ret as string);\r\n            }\r\n            else {\r\n                for (let i in ret as object) this.setError(i, (ret as any)[i]);\r\n            }\r\n        }\r\n        if (this.subContexts === undefined) return;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                let rowContext = arrRowContexts[j];\r\n                rowContext.clearErrors();\r\n                rowContext.checkContextRules();\r\n            }\r\n        }\r\n    }\r\n\r\n    setError(itemName:string, error:string) {\r\n\t\trunInAction(() => {\r\n\t\t\tlet widget = this.widgets[itemName];\r\n\t\t\tif (widget === undefined) return;\r\n\t\t\twidget.setContextError(error);\r\n\t\t\tthis.addErrorWidget(widget);\t\r\n\t\t})\r\n    }\r\n\r\n    clearContextErrors() {\r\n\t\trunInAction(() => {\r\n\t\t\tfor (let i in this.widgets) {\r\n\t\t\t\tlet widget = this.widgets[i];\r\n\t\t\t\tif (widget === undefined) continue;\r\n\t\t\t\twidget.clearContextError();\r\n\t\t\t}\t\r\n\t\t});\r\n    }\r\n\r\n    clearWidgetsErrors() {\r\n\t\trunInAction(() => {\r\n\t\t\tfor (let i in this.widgets) {\r\n\t\t\t\tlet widget = this.widgets[i];\r\n\t\t\t\tif (widget === undefined) continue;\r\n\t\t\t\twidget.clearError();\r\n\t\t\t}\t\r\n\t\t});\r\n    }\r\n\r\n    checkRules() {\r\n        this.clearErrors();\r\n        this.clearWidgetsErrors();\r\n        this.checkFieldRules();\r\n        if (this.hasError === true) return;\r\n        this.checkContextRules();\r\n    }\r\n\r\n    addErrorWidget(widget:Widget) {\r\n        let pos = this.errorWidgets.findIndex(v => v === widget);\r\n        if (pos < 0) this.errorWidgets.push(widget);\r\n    }\r\n    removeErrorWidget(widget:Widget) {\r\n        let pos = this.errorWidgets.findIndex(v => v === widget);\r\n        if (pos >= 0) this.errorWidgets.splice(pos, 1);\r\n    }\r\n\r\n    protected checkHasError():boolean {\r\n        let ret = (this.errorWidgets.length + this.errors.length) > 0;\r\n        if (ret === true) return true;\r\n        if (this.subContexts === undefined) return false;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                if (arrRowContexts[j].hasError === true) return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    @computed get hasError():boolean {\r\n        return this.checkHasError();\r\n    };\r\n\r\n    clearErrors() {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.errors.splice(0);\r\n\t\t\tthis.errorWidgets.splice(0);\r\n\t\t\tthis.clearContextErrors();\t\r\n\t\t});\r\n    }\r\n\r\n    renderErrors = observer((): JSX.Element => {\r\n        let {errors} = this;\r\n        if (errors.length === 0) return null;\r\n        return <>\r\n            {errors.map(err => <span key={err} className=\"text-danger inline-block my-1 ml-3\">\r\n                <i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}\r\n            </span>)}\r\n        </>\r\n    });\r\n}\r\n\r\nlet rowKeySeed:number = 1;\r\nexport class RowContext extends Context {\r\n    readonly parentContext: Context;\r\n    readonly arrSchema: ArrSchema;\r\n    readonly rowKey: number;\r\n\treadonly data: any;\r\n    //readonly uiSchema: UiArr;\r\n\t\r\n    constructor(parentContext:Context, arrSchema: ArrSchema, data: any, inNode: boolean) {\r\n        let uiArr:UiArr;\r\n        let {uiSchema} = parentContext;\r\n        if (uiSchema !== undefined) {\r\n            let {items} = uiSchema;\r\n            if (items !== undefined) uiArr = items[arrSchema.name] as UiArr;\r\n        }\r\n        super(parentContext.form, uiArr, data, inNode, true);\r\n        this.parentContext = parentContext;\r\n        this.arrSchema = arrSchema;\r\n        this.rowKey = rowKeySeed++;\r\n        this.data = data;\r\n    }\r\n    getItemSchema(itemName:string):ItemSchema {return this.arrSchema.itemSchemas[itemName]}\r\n    getUiItem(itemName:string):UiItem {\r\n        if (this.uiSchema === undefined) return undefined;\r\n        let {items} = this.uiSchema;\r\n        if (items === undefined) return undefined;\r\n        return items[itemName]\r\n    }\r\n    get arrName():string {return this.arrSchema.name}\r\n    clearErrors() {\r\n        super.clearErrors();\r\n        this.parentContext.clearErrors();\r\n    }\r\n\r\n    get parentData():any {return this.parentContext.data;}\r\n}\r\n\r\nexport class FormContext extends Context {\r\n    constructor(form:Form, inNode:boolean) {\r\n        super(form, form.uiSchema, form.data, inNode, false);\r\n    }\r\n    get data():any {return this.form.data}\r\n    getItemSchema(itemName:string):ItemSchema {return this.form.itemSchemas[itemName]}\r\n    getUiItem(itemName:string):UiItem {\r\n        let {uiSchema} = this.form;\r\n        if (uiSchema === undefined) return undefined;\r\n        let {items} = uiSchema;\r\n        if (items === undefined) return undefined;\r\n        return items[itemName];\r\n    }\r\n}\r\n\r\nexport const ContextContainer = React.createContext<Context>({} as any);\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\n//import { ArrRow } from '../arrRow';\r\nimport { Context, RowContext, ContextContainer } from '../context';\r\nimport { ArrSchema } from '../../schema';\r\nimport { UiArr, TempletType } from '../../schema';\r\nimport { Unknown } from './unknown';\r\nimport { factory } from './factory';\r\n\r\nexport const ArrComponent = observer((\r\n    {parentContext, arrSchema, children}:{parentContext: Context, arrSchema: ArrSchema, children: React.ReactNode}) => \r\n{\r\n    let {name, arr} = arrSchema;\r\n    let data = parentContext.initData[name] as any[];\r\n    let {form} = parentContext;\r\n    let arrRowContexts = parentContext.getArrRowContexts(name);\r\n\tlet ui = parentContext.getUiItem(name) as UiArr;\r\n\tlet {onDeleted, onRestored} = ui;\r\n    let arrLabel:string|JSX.Element = name;\r\n    let Templet:TempletType;\r\n    let selectable:boolean, deletable:boolean, restorable:boolean;\r\n    let {ArrContainer, RowContainer, RowSeperator, uiSchema} = form;\r\n    if (uiSchema !== undefined) {\r\n        let {selectable:formSelectable, deletable:formDeletable, restorable:formRestorable} = uiSchema;\r\n        if (selectable !== true) selectable = formSelectable;\r\n        if (deletable !== true) deletable = formDeletable;\r\n        if (restorable !== true) restorable = formRestorable;\r\n    }\r\n    if (ui !== undefined) {\r\n        let {widget:widgetType, label, \r\n            selectable:arrSelectable, deletable:arrDeletable, restorable:arrRestorable,\r\n            ArrContainer:ac, RowContainer:rc, RowSeperator:rs\r\n        } = ui;\r\n        if (arrSelectable !== undefined) selectable = arrSelectable;\r\n        if (arrDeletable !== undefined) deletable = arrDeletable;\r\n        if (arrRestorable !== undefined) restorable = arrRestorable;\r\n        if (ac !== undefined) ArrContainer = ac;\r\n        if (rc !== undefined) RowContainer = rc;\r\n        if (rs !== undefined) RowSeperator = rs;\r\n        Templet = ui.Templet;\r\n        if (widgetType !== 'arr') return Unknown(arrSchema.type, widgetType, ['arr']);\r\n        arrLabel = label || arrLabel;\r\n    }\r\n    let first = true;\r\n    return ArrContainer(arrLabel, <>\r\n        {data.map((row:any, index) => {\r\n            let rowContext: RowContext;\r\n            let rowContent: JSX.Element;\r\n            let sep = undefined;\r\n            if (first === false) sep = RowSeperator;\r\n            else first = false;\r\n            if (children !== undefined) {\r\n                rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                rowContent = <>{children}</>;\r\n            }\r\n            else {\r\n                let typeofTemplet = typeof Templet;\r\n                if (typeofTemplet === 'function') {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                    rowContent = React.createElement(observer(Templet as React.StatelessComponent), row);\r\n                }\r\n                else if (typeofTemplet === 'object') {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                    rowContent = Templet as JSX.Element;\r\n                }\r\n                else {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, false);\r\n                    rowContent = <>{\r\n                        arr.map((v, index) => {\r\n                            return <React.Fragment key={v.name}>\r\n                                {factory(rowContext, v, undefined)}\r\n                            </React.Fragment>\r\n                        })}\r\n                    </>;\r\n                }\r\n            }\r\n            let {rowKey} = rowContext;\r\n            arrRowContexts[rowKey] = rowContext;\r\n\r\n            let selectCheck:JSX.Element, deleteIcon:JSX.Element;\r\n            if (selectable === true) {\r\n                let onClick = (evt: React.MouseEvent<HTMLInputElement>)=>{\r\n                    let {checked} = (evt.target as HTMLInputElement);\r\n                    row.$isSelected = checked;\r\n                    let {$source} = row;\r\n                    if ($source !== undefined) $source.$isSelected = checked;\r\n                    rowContext.clearErrors();\r\n                }\r\n                selectCheck = <div className=\"form-row-checkbox\">\r\n                    <input type=\"checkbox\" onClick={onClick} defaultChecked={row.$isSelected} />\r\n                </div>;\r\n            }\r\n            let isDeleted = !(row.$isDeleted===undefined || row.$isDeleted===false);\r\n            if (deletable === true) {\r\n                let icon = isDeleted? 'fa-undo' : 'fa-trash';\r\n                let onDelClick = () => {\r\n                    if (restorable === true) {\r\n                        row.$isDeleted = !isDeleted;\r\n                        let {$source} = row;\r\n\t\t\t\t\t\tif ($source !== undefined) $source.$isDeleted = !isDeleted;\r\n\t\t\t\t\t\tif (onRestored) onRestored(row);\r\n                    }\r\n                    else {\r\n                        let p = data.indexOf(row);\r\n\t\t\t\t\t\tif (p>=0) data.splice(p, 1);\r\n\t\t\t\t\t\tif (onDeleted) onDeleted(row);\r\n                    }\r\n                    rowContext.clearErrors();\r\n                }\r\n                deleteIcon = <div className=\"form-row-edit text-info\" onClick={onDelClick}>\r\n                    <i className={classNames('fa', icon, 'fa-fw')} />\r\n                </div>;\r\n            }\r\n            let editContainer = selectable===true || deletable===true?\r\n                (content:any) => <fieldset disabled={isDeleted}><div className={classNames('d-flex', {'deleted':isDeleted, 'row-selected':row.$isSelected})}>\r\n                    {selectCheck}\r\n                    <div className={selectable===true && deletable===true? \"form-row-content\":\"form-row-content-1\"}>{content}</div>\r\n                    {deleteIcon}\r\n                </div></fieldset>\r\n                :\r\n                (content:any) => content;\r\n\r\n            return <ContextContainer.Provider key={rowKey} value={rowContext}>\r\n                {sep}\r\n                {RowContainer(editContainer(<><rowContext.renderErrors />{rowContent}</>))}\r\n            </ContextContainer.Provider>;\r\n        })}\r\n    </>);\r\n});\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { ItemSchema, UiImageItem } from '../../schema';\r\nimport { Image } from '../../image';\r\nimport { ImageItemEdit } from '../../edit/imageItemEdit';\r\nimport { observer } from 'mobx-react';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { Context } from '../context';\r\nimport { FieldProps } from '../field';\r\n\r\nexport class ImageWidget extends Widget {\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiImageItem {return this._ui as UiImageItem};\r\n\r\n\timageSrc: string = null;\r\n\r\n\tconstructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n\t\tsuper(context, itemSchema, fieldProps, children);\r\n\t\tmakeObservable(this, {\r\n\t\t\timageSrc: observable,\r\n\t\t})\r\n\t}\r\n\r\n    init() {\r\n        super.init();\r\n        this.imageSrc = this.value;\r\n    }\r\n\r\n    protected onClick = async () => {\r\n        let edit = new ImageItemEdit(undefined, this.itemSchema, this.ui, this.ui.label, this.value);\r\n        let ret = await edit.start();\r\n        if (ret !== null) {\r\n            this.setValue(ret);\r\n            this.imageSrc = ret;\r\n        }\r\n        await edit.end();\r\n    }\r\n\r\n    render() {\r\n        return React.createElement(this.observerRender);\r\n    }\r\n\r\n    private observerRender = observer(() => {\r\n        let cn = [\r\n            'bg-white p-1 d-flex justify-content-center',\r\n        ];\r\n        let onClick: any;\r\n        if (!this.readOnly && !this.disabled) {\r\n            cn.push('cursor-pointer');\r\n            onClick = this.onClick;\r\n        }\r\n        return <div className={classNames(cn)} onClick={onClick}>\r\n            <Image src={this.imageSrc} className=\"w-4c h-4c\"/>\r\n        </div>;\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTag, IValuesViewRenderOptions } from '../../schema';\r\nimport { RowContext } from '../context';\r\n\r\nabstract class TagWidget extends Widget {\r\n    protected inputs: {[index:number]: HTMLInputElement} = {};\r\n    protected get ui(): UiTag {return this._ui as UiTag};\r\n\r\n    protected setElementValue(value:any) {\r\n        for (let i in this.inputs) {\r\n            let input = this.inputs[i];\r\n            input.checked = value === input.value;\r\n        }\r\n    }\r\n    setReadOnly(value:boolean) {\r\n        this.readOnly = value;\r\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        this.disabled = value;\r\n        for (let i in this.inputs) this.inputs[i].disabled = value\r\n\t}\r\n\t\r\n\tabstract render():JSX.Element;\r\n}\r\n\r\nexport class TagSingleWidget extends TagWidget {\r\n\trender() {\r\n\t\tlet {valuesView, wrapClassName} = this.ui;\r\n\t\tif (valuesView === undefined) return <>valuesView must be defined</>;\r\n        let {isRow} = this.context;\r\n        let rowKey:number;\r\n        if (isRow === true) {\r\n            rowKey = (this.context as RowContext).rowKey;\r\n        }\r\n        let cn = classNames(this.className, 'py-0');\r\n\t\tlet name = this.name;\r\n\t\tif (rowKey !== undefined) name += '-' + rowKey;\r\n\t\tlet options:IValuesViewRenderOptions = {\r\n\t\t\tclassName: cn,\r\n\t\t\tinputName: name,\r\n\t\t\twrapClassName,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t}\r\n\t\treturn valuesView.renderRadios(this.defaultValue, options);\r\n    }\r\n}\r\n\r\nexport class TagMultiWidget extends TagWidget {\r\n\tprivate defaultArr:number[];\r\n\tinit() {\r\n\t\tsuper.init();\r\n\t\tlet def = this.defaultValue;\r\n\t\tswitch (typeof def) {\r\n\t\t\tdefault:\r\n\t\t\t\tthis.defaultArr = [];\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'string':\r\n\t\t\t\tthis.defaultArr = def.split('|').map(v => Number(v));\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n\t\tlet values:string[] = [];\r\n\t\tfor (let i in this.inputs) {\r\n\t\t\tlet input = this.inputs[i];\r\n\t\t\tif (input.checked === true) values.push(input.value);\r\n\t\t}\r\n        this.changeValue(values.join('|'), true);\r\n\t}\r\n\trender() {\r\n\t\tlet {valuesView, wrapClassName} = this.ui;\r\n\t\tif (valuesView === undefined) return <>valuesView must be defined</>;\r\n        let cn = classNames(this.className, 'py-0');\r\n\t\tlet options:IValuesViewRenderOptions = {\r\n\t\t\tclassName: cn,\r\n\t\t\tinputs: this.inputs,\r\n\t\t\twrapClassName,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t}\r\n\t\treturn valuesView.renderChecks(this.defaultValue, options);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { ArrSchema, DataType, ItemSchema } from '../../schema';\r\nimport { TypeWidget, UiCustom } from '../../schema';\r\nimport { TextWidget } from './textWidget';\r\nimport { TextAreaWidget } from './textareaWidget';\r\nimport { PasswordWidget, UrlWidget, EmailWidget } from './passwordWidget';\r\nimport { UpdownWidget } from './updownWidget';\r\nimport { NumberWidget } from './numberWidget';\r\nimport { DateWidget, DateTimeWidget, TimeWidget, MonthWidget } from './dateWidget';\r\nimport { CheckBoxWidget } from './checkBoxWidget';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { SelectWidget } from './selectWidget';\r\nimport { RadioWidget } from './radioWidget';\r\nimport { RangeWidget } from './rangeWidget';\r\nimport { IdWidget } from './idWidget';\r\nimport { ButtonWidget } from './buttonWidget';\r\nimport { ArrComponent } from './arrComponent';\r\nimport { ImageWidget } from './imageWidget';\r\nimport { TagSingleWidget, TagMultiWidget } from './tagWidget';\r\n\r\ninterface WidgetFactory {\r\n\twidget?: TypeWidget;\r\n\tdataTypes?: DataType[];\r\n};\r\n\r\nconst stringWidget: WidgetFactory = {\r\n\tdataTypes: ['integer', 'number', 'string'],\r\n\twidget: TextWidget\r\n};\r\n\r\nconst widgetFactories: {[type: string]: WidgetFactory} = {\r\n    id: {\r\n        dataTypes: ['id'],\r\n        widget: IdWidget,\r\n    },\r\n    text: stringWidget,\r\n\tstring: stringWidget,\r\n    textarea: {\r\n        dataTypes: ['string'],\r\n        widget: TextAreaWidget\r\n    },\r\n    password: {\r\n        dataTypes: ['string'],\r\n        widget: PasswordWidget\r\n    },\r\n    date: {\r\n        dataTypes: ['date'],\r\n        widget: DateWidget\r\n    },\r\n    datetime: {\r\n        dataTypes: ['date'],\r\n        widget: DateTimeWidget\r\n    },\r\n    time: {\r\n        dataTypes: ['date'],\r\n        widget: TimeWidget\r\n    },\r\n    month: {\r\n        dataTypes: ['date'],\r\n        widget: MonthWidget\r\n    },\r\n    select: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: SelectWidget\r\n    },\r\n    url: {\r\n        dataTypes: ['string'],\r\n        widget: UrlWidget\r\n    },\r\n    email: {\r\n        dataTypes: ['string'],\r\n        widget: EmailWidget\r\n    },\r\n    number: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: NumberWidget\r\n    },\r\n    updown: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: UpdownWidget\r\n    },\r\n    color: {\r\n\r\n    },\r\n    checkbox: {\r\n        dataTypes: ['boolean', 'integer', 'number'],\r\n        widget: CheckBoxWidget\r\n    },\r\n    image: {\r\n        dataTypes: ['string'],\r\n        widget: ImageWidget,\r\n    },\r\n    checkboxes: {\r\n\r\n    },\r\n    radio: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: RadioWidget\r\n\t},\r\n\ttagSingle: {\r\n\t\tdataTypes: ['integer'],\r\n\t\twidget: TagSingleWidget\r\n\t},\r\n\ttagMulti: {\r\n\t\tdataTypes: ['string'],\r\n\t\twidget: TagMultiWidget\r\n\t},\r\n    range: {\r\n        dataTypes: ['integer'],\r\n        widget: RangeWidget,\r\n    },\r\n    button: {\r\n        dataTypes: ['button', 'submit'],\r\n        widget: ButtonWidget,\r\n    }\r\n}\r\n\r\nexport function factory(context: Context, itemSchema: ItemSchema, children:React.ReactNode, fieldProps?: FieldProps):JSX.Element {\r\n    if (context === undefined) {\r\n        debugger;\r\n        return null;\r\n    }\r\n    if (itemSchema === undefined) return undefined;\r\n    let {name, type} = itemSchema;\r\n    switch (type) {\r\n    case 'arr':\r\n        let arrSchema = context.getItemSchema(name) as ArrSchema;\r\n        return <ArrComponent parentContext={context} arrSchema={arrSchema} children={children} />;\r\n    default:\r\n        break;\r\n    }\r\n\r\n    let typeWidget: TypeWidget;\r\n    let ui = context.getUiItem(name);\t\r\n    function getTypeWidget(t:DataType): TypeWidget {\r\n        switch(t) {\r\n        default: return TextWidget; \r\n        case 'id': return IdWidget;\r\n        case 'integer': return UpdownWidget;\r\n        case 'number': return NumberWidget; \r\n        case 'string': return TextWidget; \r\n        case 'date': return DateWidget; \r\n        case 'boolean': return CheckBoxWidget; \r\n        case 'button':\r\n        case 'submit': return ButtonWidget;\r\n        }\r\n    }\r\n    if (ui === undefined) { \r\n        typeWidget = getTypeWidget(type);\r\n    }\r\n    else {\r\n        let {widget:widgetType, hiden} = ui;\r\n\t\tif (hiden === true) return null;\r\n        switch (widgetType) {\r\n        default:\r\n            if (widgetType !== undefined) {\r\n                let widgetFactory = widgetFactories[widgetType];\r\n\t\t\t\tif (!widgetFactory) {\r\n\t\t\t\t\tdebugger;\r\n\t\t\t\t\tthrow new Error(`unknown widget ${widgetType}`);\r\n\t\t\t\t}\r\n                typeWidget = widgetFactory.widget;\r\n            }\r\n            if (typeWidget === undefined) typeWidget = getTypeWidget(type);\r\n            break;\r\n        case 'custom':\r\n            typeWidget = (ui as UiCustom).WidgetClass;\r\n            break;\r\n        case 'group':\r\n            return <span>impletment group</span>;\r\n        }\r\n        //label = uiLabel || name;\r\n    }\r\n    \r\n\tlet {widgets} = context;\r\n\tlet widget = widgets[name];\r\n\tif (!widget) {\r\n\t\twidget = new typeWidget(context, itemSchema, fieldProps, children);\r\n\t\twidget.init();\r\n\t\twidgets[name] = widget;\r\n\t}\r\n\r\n    return <widget.container />;\r\n    /*\r\n    if (isRow === false) {\r\n        let WidgetElement = observer(() => widget.container());\r\n        return <WidgetElement />;\r\n    }\r\n    else {\r\n        let widgetElement = widget.container();\r\n        return widgetElement;\r\n    }\r\n    */\r\n}\r\n\r\n","import * as React from 'react';\r\nimport {observable, IReactionDisposer, autorun} from 'mobx';\r\nimport classNames from 'classnames';\r\nimport { Schema, ItemSchema, ArrSchema, UiSchema, TempletType } from '../schema';\r\nimport { factory } from './widgets';\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport { ContextContainer, FormContext, Context } from './context';\r\nimport { FormRes, formRes, resLang } from '../../res';\r\n\r\nexport type FormButtonClick = (name:string, context: Context) => Promise<any>;\r\nexport type InputEnter = (name:string, context: Context) => Promise<any>;\r\n\r\nexport interface FormProps {\r\n    className?: string;\r\n    schema: Schema;\r\n    uiSchema?: UiSchema;\r\n    formData?: any;\r\n    onButtonClick?: FormButtonClick;\r\n    onEnter?: InputEnter;\r\n    fieldLabelSize?: number;            // col-sm-2 for label\r\n\tfieldLabelAlign?: 'left'|'center'|'right';\r\n    requiredFlag?: boolean;             // default=true\r\n    beforeShow?: (formContext:FormContext) => void;\r\n    res?: FormRes;\r\n\r\n    Container?: (content:JSX.Element) => JSX.Element;\r\n    FieldContainer?: (label:string|JSX.Element, content:JSX.Element) => JSX.Element;\r\n    FieldClass?: string;\r\n    ButtonClass?: string;\r\n}\r\n\r\nexport class Form extends React.Component<FormProps> {\r\n    readonly schema: Schema;\r\n    readonly itemSchemas: {[name:string]: ItemSchema};\r\n    readonly uiSchema: UiSchema;\r\n    readonly res?: FormRes;\r\n    formContext: FormContext;\r\n    private disposer: IReactionDisposer;\r\n    readonly data:any;\r\n\r\n    readonly Container: (content:JSX.Element) => JSX.Element;\r\n    readonly FieldContainer: (label:any, content:JSX.Element) => JSX.Element;\r\n    readonly FieldClass: string;\r\n    readonly ButtonClass: string;\r\n    \r\n    constructor(props:FormProps) {\r\n        super(props);\r\n        let {schema, uiSchema, \r\n            Container, FieldContainer, FieldClass, \r\n            ButtonClass, res,\r\n\t\t} = props;\r\n        this.Container = Container || this.DefaultContainer;\r\n        this.FieldContainer = FieldContainer || this.DefaultFieldContainer;\r\n        this.FieldClass = FieldClass!==undefined && FieldClass!==''&&FieldClass!==null? FieldClass : this.DefaultFieldClass;\r\n        this.res = res || this.DefaultRes;\r\n        this.ButtonClass = ButtonClass || this.DefaultButtonClass;\r\n\r\n        this.schema = schema;\r\n        this.itemSchemas = {};\r\n        for (let itemSchema of this.schema) {\r\n            this.itemSchemas[itemSchema.name] = itemSchema;\r\n        }\r\n        this.uiSchema = uiSchema;\r\n\r\n        this.disposer = autorun(this.watch);\r\n        this.data = {};\r\n    }\r\n\r\n    private renderContent():any {\r\n        this.initData(this.props.formData);\r\n        let {children} = this.props;\r\n        if (children !== undefined) {\r\n            this.formContext = new FormContext(this, true);\r\n            return <>{children}</>;\r\n        }\r\n\r\n        let Templet: TempletType;\r\n        if (this.uiSchema !== undefined) {\r\n            Templet = this.uiSchema.Templet;\r\n        }\r\n        if (Templet !== undefined) {\r\n            this.formContext = new FormContext(this, true);\r\n            return typeof(Templet) === 'function'? Templet(this.data) : Templet;\r\n        }\r\n\r\n\t\tif (!this.formContext) {\r\n\t\t\tthis.formContext = new FormContext(this, false);\r\n\t\t}\r\n        return <>{this.schema.map((v, index) => {\r\n            return <React.Fragment key={index}>{factory(this.formContext, v, children)}</React.Fragment>\r\n        })}</>;\r\n    }\r\n\r\n    private initData(formData: any) {\r\n        if (formData === undefined) formData = {};\r\n        if (this.uiSchema !== undefined) {\r\n            let {items} = this.uiSchema;\r\n            if (items !== undefined) {\r\n                for (let i in items) {\r\n                    let ui = items[i];\r\n                    let dv = ui.defaultValue;\r\n                    if (dv !== undefined) {\r\n                        if (formData[i] === undefined) {\r\n                            formData[i] = dv;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        for (let itemSchema of this.schema) {\r\n            this.initDataItem(itemSchema, this.data, formData);\r\n        }\r\n    }\r\n\r\n    private initDataItem(itemSchema: ItemSchema, data:any, formData: any):any {\r\n        let {name, type} = itemSchema;\r\n        if (type === 'button') return;\r\n        if (type !== 'arr') {\r\n            data[name] = formData[name];\r\n            return;\r\n        }\r\n\r\n        let arrItem:ArrSchema = itemSchema as ArrSchema;\r\n        let {arr:arrItems} = arrItem;\r\n        if (arrItems === undefined) return;\r\n        let arrDict:any = arrItem.itemSchemas = {};\r\n        for (let item of arrItems) {\r\n            arrDict[item.name] = item;\r\n        }\r\n        let val:any[] = formData[name];\r\n        if (val === undefined) val = [];\r\n        else if (Array.isArray(val) === false) val = [val];\r\n        let arr:any[] = [];\r\n        for (let row of val) {\r\n            let {$isSelected, $isDeleted} = row;\r\n            let r = {\r\n                $source: row,\r\n                $isSelected: $isSelected,\r\n                $isDeleted: $isDeleted,\r\n            };\r\n            for (let item of arrItems) {\r\n                this.initDataItem(item, r, row);\r\n            }\r\n            arr.push(r);\r\n        }\r\n        // 如果没有observable，行删除标志点击不管用\r\n        // 不知道这里为什么要去掉observable。有可能会有别的问题\r\n        data[name] = observable(arr);\r\n        //data[name] = arr;\r\n        return;\r\n    }\r\n\r\n    private watch = () => {\r\n        let {formData} = this.props;\r\n        if (formData === undefined) return;\r\n        //this.initData(formData);\r\n        this.calcSelectOrDelete();\r\n    }\r\n    private calcSelectOrDelete() {\r\n        for (let itemSchema of this.schema) {\r\n            this.arrItemOperated(itemSchema);\r\n        }\r\n    }\r\n\r\n    private arrItemOperated(itemSchema: ItemSchema) {\r\n        let {name, type} = itemSchema;\r\n        if (type !== 'arr') return;\r\n        if (this.data === undefined) return;\r\n        let formArrVal = this.data[name];\r\n        if (formArrVal === undefined) return;\r\n        let {arr: arrItems} = itemSchema as ArrSchema;\r\n        for (let row of formArrVal) {\r\n            let {$source} = row;\r\n            if ($source === undefined) continue;\r\n            let {$isSelected, $isDeleted} = $source;\r\n            row.$isSelected = $isSelected;\r\n            row.$isDeleted = $isDeleted;\r\n            //console.log($isSelected, $isDeleted);\r\n            for (let item of arrItems) {\r\n                this.arrItemOperated(item);\r\n            }\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        let {beforeShow} = this.props;\r\n        if (beforeShow !== undefined) beforeShow(this.formContext);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        if (this.disposer !== undefined) this.disposer();\r\n    }\r\n\r\n    render() {\r\n        let content = this.renderContent();\r\n        return <ContextContainer.Provider value={this.formContext}>\r\n            {React.createElement(this.formContext.renderErrors)}\r\n            {this.Container(content)}\r\n        </ContextContainer.Provider>;\r\n    }\r\n\r\n    async buttonClick(buttonName:string) {\r\n        this.formContext.checkRules()\r\n        if (this.formContext.hasError === true) return;\r\n\r\n        let {onButtonClick} = this.formContext.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(buttonName, this.formContext);\r\n        if (ret === undefined) return;\r\n        this.formContext.setError(buttonName, ret);\r\n    }\r\n\r\n    protected DefaultContainer = (content:JSX.Element): JSX.Element => {\r\n        return <form className={classNames(this.props.className)} onSubmit={e=>e.preventDefault()}>\r\n            {content}\r\n        </form>;\r\n    }\r\n    protected DefaultFieldContainer = (label:string|JSX.Element, content:JSX.Element): JSX.Element => {\r\n        let {fieldLabelSize, fieldLabelAlign} = this.props;\r\n\r\n        if (fieldLabelSize > 0) {\r\n            let labelView:any;\r\n            if (label === null) {\r\n                fieldLabelSize = 0;\r\n            }\r\n            else {\r\n\t\t\t\tlet cnAlign: string;\r\n\t\t\t\tswitch (fieldLabelAlign) {\r\n\t\t\t\t\tcase 'right': cnAlign = 'text-sm-right'; break;\r\n\t\t\t\t\tcase 'center': cnAlign = 'text-sm-center'; break;\r\n\t\t\t\t}\r\n                labelView = <label className={classNames('col-sm-' + fieldLabelSize, 'col-form-label', cnAlign)}>{label}</label>\r\n            }\r\n            let fieldCol = 'col-sm-' + (12 - fieldLabelSize);\r\n            return <div className=\"form-group row\">\r\n                {labelView}\r\n                <div className={fieldCol}>{content}</div>\r\n            </div>;\r\n        }\r\n        return <div className=\"form-group\">\r\n            {label===null? null:<label className=\"col-form-label\">{label}</label>}\r\n            {content}\r\n        </div>;\r\n    }\r\n    protected DefaultFieldClass:string = undefined;\r\n    protected DefaultButtonClass = 'text-center py-2';\r\n    protected DefaultRes:FormRes = resLang<FormRes>(formRes);\r\n\r\n    ArrContainer = (label:any, content:JSX.Element): JSX.Element => {\r\n        return <div>\r\n            <div className={classNames('small text-muted text-center bg-light py-1 px-3 mt-4 mb-1')}>{label}</div>\r\n            {content}\r\n        </div>;\r\n    }\r\n    RowContainer = (content:JSX.Element): JSX.Element => {\r\n        let cn = classNames({\r\n            'py-3': true\r\n        });\r\n        return <div className={cn}>{content}</div>\r\n    }\r\n    RowSeperator = <div className=\"border border-gray border-top\" />;\r\n}\r\n","import * as React from 'react';\r\nimport { factory } from './widgets';\r\nimport { ContextContainer, Context } from './context';\r\n\r\nexport interface FieldProps {\r\n    name: string;\r\n}\r\n\r\nexport class FormField extends React.Component<FieldProps> {\r\n    static contextType = ContextContainer;\r\n    render() {\r\n        let {name, children } = this.props;\r\n        let context:Context = this.context;\r\n        if (context === undefined) return <span className=\"text-danger\">!only in Form!</span>;\r\n        let itemSchema = context.getItemSchema(name);\r\n        let content = factory(context, itemSchema, children, this.props);\r\n        if (content === undefined) {\r\n            return <span className=\"text-danger\">!!{name} is not defined!!</span>;\r\n        }\r\n        return content;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { UiTextItem } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport interface InputOptions {\r\n\ttype: string;\r\n\tmin?: number;\r\n\tmax?: number;\r\n\tstep?: number;\r\n}\r\n\r\nexport class StringItemEdit extends ItemEdit {\r\n    get uiItem(): UiTextItem {return this._uiItem as UiTextItem}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve, reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.newValue = evt.target.value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.verifyValue();\r\n    }\r\n\r\n    private onFocus = () => {\r\n        this.error = undefined;\r\n\t}\r\n\t\r\n\tprotected inputOptions():InputOptions {\r\n\t\treturn {\r\n\t\t\ttype: 'text',\r\n\t\t}\r\n\t}\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n\t\tlet {resolve} = props;\r\n\t\tlet onSave = () => {\r\n\t\t\tthis.verifyValue();\r\n\t\t\tif (this.error === undefined) {\r\n\t\t\t\tlet val = this.newValue;\r\n\t\t\t\tresolve(val);\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={onSave}>保存</button>;\r\n\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\r\n\t\t\tif (evt.keyCode === 13) onSave();\r\n\t\t}\r\n\t\tlet {type, max, min, step} = this.inputOptions();\r\n        return <Page header={this.label} right={right}>\r\n            <div className=\"m-3\">\r\n\t\t\t\t<input type={type}\r\n\t\t\t\t\tonChange={this.onChange}\r\n\t\t\t\t\tonKeyDown={onKeyDown}\r\n                    onBlur={this.onBlur}\r\n                    onFocus={this.onFocus}\r\n                    className=\"form-control\" \r\n                    defaultValue={this.value} min={min} max={max} step={step} />\r\n                {\r\n                    this.uiItem && <div className=\"small muted m-2\">{this.uiItem.placeholder}</div>\r\n                }\r\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiRadio } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class RadioItemEdit extends ItemEdit {\r\n    get uiItem(): UiRadio {return this._uiItem as UiRadio}\r\n\r\n\tinit() {\r\n        if (this.value === undefined) {\r\n            this.value = this._uiItem===undefined? undefined : this._uiItem.defaultValue;\r\n        }\r\n\t}\r\n\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (value: any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let {name} = this.itemSchema;\r\n        let {list} = this.uiItem;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>{\r\n                this.verifyValue();\r\n                if (this.error === undefined) resolve(this.newValue);\r\n            }}>保存</button>;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"col\"><label className=\"px-3 py-2 cursor-pointer\">\r\n                    <input name={name} type=\"radio\" value={value} \r\n                        onClick={()=>this.onChange(value)} \r\n                        defaultChecked={value === this.value} /> {title || value} &nbsp;\r\n                </label></div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label} right={right}>\r\n            <div className=\"m-3\">\r\n\t\t\t\t<div className=\"row row-cols-2 row-cols-sm-3 row-cols-md-4\">{content}</div>\r\n\t\t\t</div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiSelect } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class SelectItemEdit extends ItemEdit {\r\n    get uiItem(): UiSelect {return this._uiItem as UiSelect}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (value:any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let {list} = this.uiItem;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"px-3 py-2 cursor-pointer bg-white mb-1\" onClick={()=>{this.onChange(value); resolve(this.newValue)}}>\r\n                    {title || value}\r\n                </div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label}>\r\n            <div className=\"my-3\">\r\n                {content}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiIdItem } from '../schema';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class IdItemEdit extends ItemEdit {\r\n    get uiItem(): UiIdItem {return this._uiItem as UiIdItem}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            //let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            //nav.push(element,reject);\r\n\r\n            let {pickId} = this.uiItem;\r\n            if (pickId === undefined) {\r\n                alert('IdItemEdit.pickId = undefined');\r\n                return;\r\n            }\r\n            let boxId = await pickId(undefined, undefined, this.value);\r\n            //if (typeof id === 'object') {\r\n            //    id = (id as any).id;\r\n            //}\r\n            this.onChange(boxId.id);\r\n            resolve(boxId);\r\n            //this.newValue = id;\r\n        });\r\n    }\r\n\r\n    protected async internalEnd():Promise<void> {}\r\n\r\n    private onChange = (value:any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        /*\r\n        let {resolve, reject} = props;\r\n        let {list} = this.uiItem;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"px-3 py-2 cursor-pointer bg-white mb-1\" onClick={()=>{this.onChange(value); resolve(this.newValue)}}>\r\n                    {title || value}\r\n                </div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label}>\r\n            <div className=\"my-3\">\r\n                {content}\r\n            </div>\r\n        </Page>;\r\n        */\r\n        return <Page header={'更改' + this.label}>\r\n            ddd\r\n        </Page>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiTag } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nabstract class TagItemEdit extends ItemEdit {\r\n\tprotected inputs: {[index:number]: HTMLInputElement} = {};\r\n\tprotected inputType: 'checkbox' | 'radio';\r\n    get uiItem(): UiTag {return this._uiItem as UiTag};\r\n\r\n\tinit() {\r\n        if (this.value === undefined) {\r\n            this.value = this._uiItem===undefined? undefined : this._uiItem.defaultValue;\r\n        }\r\n\t}\r\n\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            nav.push(element,reject);\r\n        });\r\n\t}\r\n\t\r\n\trenderContent() {\r\n\t\tlet valuesView = this.uiItem.valuesView;\r\n\t\tif (valuesView === undefined) return super.renderContent();\r\n\t\treturn valuesView.render(this.value);\r\n\t}\r\n\r\n\tprotected abstract renderInputs():JSX.Element;\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>{\r\n                this.verifyValue();\r\n                if (this.error === undefined) resolve(this.newValue);\r\n\t\t\t}}>保存</button>;\r\n\t\t/*\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {name:itemName, id} = v;\r\n                return <div key={index} className=\"col\"><label className=\"px-3 py-2 cursor-pointer\">\r\n                    <input ref={input=>this.inputs[id] = input} name={name} type={this.inputType} value={id} \r\n\t\t\t\t\t\tonClick={(e)=>this.onChange(e.currentTarget.checked, id)}\r\n                        defaultChecked={this.defaultChecked(id)} /> {itemName} &nbsp;\r\n                </label></div>;\r\n            })\r\n            :\r\n\t\t\t<>no list defined</>;\r\n\t\t*/\r\n        return <Page header={'更改' + this.label} right={right}>\r\n\t\t\t<div className=\"p-3\">\r\n\t\t\t\t{this.renderInputs()}\r\n\t\t\t</div>\r\n        </Page>;\r\n    })\r\n}\r\n\r\nexport class TagSingleItemEdit extends TagItemEdit {\r\n\tprotected inputType:'radio'|'checkbox' = 'radio';\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet {currentTarget} = evt;\r\n\t\tif (currentTarget.checked === false) return;\r\n        this.newValue = Number(currentTarget.value);\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\t\r\n\tprotected renderInputs():JSX.Element {\r\n\t\tlet {valuesView} = this.uiItem;\r\n\t\tlet options = {\r\n\t\t\tinputs: this.inputs,\r\n\t\t\tonInputChange: this.onInputChange,\r\n\t\t};\r\n\t\treturn valuesView.renderRadios(this.value, options);\r\n\t}\r\n}\r\n\r\nexport class TagMultiItemEdit extends TagItemEdit {\r\n\t//private arr:number[];\r\n\tprotected inputType:'radio'|'checkbox' = 'checkbox';\r\n\r\n\tprivate onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet values:string[] = [];\r\n\t\tfor (let i in this.inputs) {\r\n\t\t\tlet input = this.inputs[i];\r\n\t\t\tif (input.checked === true) values.push(input.value);\r\n\t\t}\r\n        this.newValue = values.join('|');\r\n        //this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\tprotected renderInputs():JSX.Element {\r\n\t\tlet {valuesView} = this.uiItem;\r\n\t\tlet options = {\r\n\t\t\tinputs: this.inputs,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t};\r\n\t\treturn valuesView.renderChecks(this.value, options);\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { UiTextItem } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class TextAreaItemEdit extends ItemEdit {\r\n    get uiItem(): UiTextItem {return this._uiItem as UiTextItem}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve, reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.newValue = evt.target.value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.verifyValue();\r\n    }\r\n\r\n    private onFocus = () => {\r\n        this.error = undefined;\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n\t\tlet {resolve} = props;\r\n\t\tlet onSave = () => {\r\n\t\t\tthis.verifyValue();\r\n\t\t\tif (this.error === undefined) {\r\n\t\t\t\tlet val = this.newValue;\r\n\t\t\t\tresolve(val);\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={onSave}>保存</button>;\r\n\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLTextAreaElement>) => {\r\n\t\t\t// if (evt.keyCode === 13) onSave();\r\n\t\t}\r\n        return <Page header={this.label} right={right}>\r\n            <div className=\"m-3\">\r\n                <textarea\r\n\t\t\t\t\tonChange={this.onChange}\r\n\t\t\t\t\tonKeyDown={onKeyDown}\r\n                    onBlur={this.onBlur}\r\n                    onFocus={this.onFocus}\r\n                    className=\"form-control\" \r\n\t\t\t\t\tdefaultValue={this.value}\r\n\t\t\t\t\trows={6} />\r\n                {\r\n                    this.uiItem && <div className=\"small muted m-2\">{this.uiItem.placeholder}</div>\r\n                }\r\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import React from 'react';\r\nimport { UiCheckItem } from '../schema';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class CheckBoxItemEdit extends ItemEdit {\r\n\tprivate input: HTMLInputElement;\r\n    get uiItem(): UiCheckItem {return this._uiItem as UiCheckItem}\r\n\tget editInRow(): boolean {return true;}\r\n    protected async internalStart():Promise<any> {\r\n\t\tif (!this.input) return;\r\n\t\tlet uiItem = this.uiItem;\r\n\t\tif (uiItem === undefined) return this.input.checked;\r\n\t\tlet {checked} = this.input;\r\n\t\treturn this.getValue(checked);\r\n    }\r\n\tasync end():Promise<any> {}\r\n\trenderContent() {\r\n\t\tlet {readOnly} = this.uiItem;\r\n\t\tlet disabled = readOnly === true;\r\n\t\tlet onChange:any;\r\n\t\tif (readOnly !== true) onChange = this.onChange;\r\n\t\treturn <input ref={r => this.input=r} type=\"checkbox\" \r\n\t\t\tdefaultChecked={this.value} disabled={disabled}\r\n\t\t\tonChange={onChange} />\r\n\t}\r\n\r\n\tprivate getValue(checked: boolean) {\r\n\t\tlet {trueValue, falseValue} = this.uiItem;\r\n        return checked === true? (trueValue??true) : (falseValue??false);\r\n\t}\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.newValue = this.getValue(evt.target.checked);\r\n        let preValue = this.value;\r\n\t\tthis.isChanged = (this.newValue !== preValue);\r\n\t\tthis.edit.onItemChanged(this, this.newValue);\r\n    }\r\n}\r\n","import { UiRange } from \"../schema\";\r\nimport { InputOptions, StringItemEdit } from \"./stringItemEdit\";\r\n\r\nexport class RangeItemEdit extends StringItemEdit {\r\n\tprotected inputOptions():InputOptions {\r\n\t\tlet min:number, max:number, step:number;\r\n\t\tif (this._uiItem) {\r\n\t\t\tmin = (this._uiItem as UiRange).min\r\n\t\t\tmax = (this._uiItem as UiRange).max\r\n\t\t\tstep = (this._uiItem as UiRange).step\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttype: 'range',\r\n\t\t\tmin, max, step\r\n\t\t}\r\n\t}\r\n}\r\n","import { UiNumberItem } from \"../schema\";\r\nimport { InputOptions, StringItemEdit } from \"./stringItemEdit\";\r\n\r\nexport class NumberItemEdit extends StringItemEdit {\r\n\tprotected inputOptions():InputOptions {\r\n\t\tlet min:number, max:number, step:number;\r\n\t\tif (this._uiItem) {\r\n\t\t\tmin = (this._uiItem as UiNumberItem).min\r\n\t\t\tmax = (this._uiItem as UiNumberItem).max\r\n\t\t\tstep = (this._uiItem as UiNumberItem).step\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttype: 'number',\r\n\t\t\tmin, max, step\r\n\t\t}\r\n\t}\r\n}\r\n","import * as React from 'react';\r\n//import _ from 'lodash';\r\nimport { observer } from 'mobx-react';\r\nimport { Schema, UiSchema, ItemSchema, UiItem, UiRadio, UiTagSingle, UiTagMulti } from '../schema';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { StringItemEdit } from './stringItemEdit';\r\nimport { ImageItemEdit } from './imageItemEdit';\r\nimport { RadioItemEdit } from './radioItemEdit';\r\nimport { SelectItemEdit } from './selectItemEdit';\r\nimport { IdItemEdit } from './idItemEdit';\r\nimport { TagSingleItemEdit, TagMultiItemEdit } from './tagItemEdit';\r\nimport { TextAreaItemEdit } from './textAreaItemEdit';\r\nimport { CheckBoxItemEdit } from './checkBoxItemEdit';\r\nimport { RangeItemEdit } from './rangeItemEdit';\r\nimport { NumberItemEdit } from './numberItemEdit';\r\n\r\nexport interface EditProps {\r\n    className?: string;\r\n    schema: Schema;\r\n    data: any;\r\n    onItemClick?: (itemSchema: ItemSchema, uiItem: UiItem, value: any) => Promise<void>;\r\n    onItemChanged?: (itemSchema: ItemSchema, newValue:any, preValue:any) => Promise<void>;\r\n    stopEdit?: boolean;\r\n    uiSchema?: UiSchema;\r\n    sepClassName?: string;\r\n    topBorderClassName?: string;\r\n    bottomBorderClassName?: string;\r\n    rowContainerClassName?: string;\r\n}\r\n\r\n@observer\r\nexport class Edit extends React.Component<EditProps> {\r\n    private defaultSepClassName = 'border-top edit-sep-light-gray';\r\n    private defaultRowContainerClassName = 'd-flex px-3 py-2 bg-white align-items-center';\r\n    private topBorder:JSX.Element;\r\n    private bottomBorder:JSX.Element;\r\n    private rowContainerClassName?: string;\r\n    private sep:JSX.Element;\r\n\tprivate uiSchema: {[name:string]: UiItem};\r\n\r\n    constructor(props: EditProps) {\r\n        super(props);\r\n        let {topBorderClassName, bottomBorderClassName, sepClassName, rowContainerClassName, uiSchema} = props;\r\n        this.topBorder = <div className={topBorderClassName || this.defaultSepClassName} />;\r\n        this.bottomBorder = <div className={bottomBorderClassName || this.defaultSepClassName} />;\r\n        this.rowContainerClassName = rowContainerClassName || this.defaultRowContainerClassName;\r\n        //if (stopEdit !== true) this.rowContainerClassName += ' cursor-pointer';\r\n        this.sep = <div className={sepClassName || this.defaultSepClassName} />;\r\n\t\tthis.uiSchema = (uiSchema && uiSchema.items) || {};\r\n    }\r\n\r\n    render() {\r\n        let {schema} = this.props;\r\n\t\tlet sep:any;\r\n        return <div>\r\n\t\t\t{this.topBorder}\r\n            {schema.map((itemSchema, index) => {\r\n\t\t\t\tlet {stopEdit} = this.props;\r\n\t\t\t\tlet {name} = itemSchema;\r\n\t\t\t\tlet uiItem = this.uiSchema===undefined? undefined : this.uiSchema[name];\r\n\t\t\t\tlet label:string|JSX.Element, labelHide:any;\r\n\t\t\t\tif (uiItem !== undefined) {\r\n\t\t\t\t\tlabel = uiItem.label || name;\r\n\t\t\t\t\tlabelHide = uiItem.labelHide;\r\n\t\t\t\t};\r\n\t\t\t\tlet value = this.props.data[name];\r\n\t\t\t\tlet itemEdit = createItemEdit(this, itemSchema, uiItem, label, value);\r\n\t\t\t\tlet rowContainerClassName = this.rowContainerClassName;\r\n\t\t\t\tlet {editInRow} = itemEdit;\r\n\t\t\t\tif (editInRow === false) {\r\n\t\t\t\t\tif (stopEdit !== true) editInRow = false;\r\n\t\t\t\t}\r\n\t\t\t\tif (editInRow === false) rowContainerClassName += ' cursor-pointer';\r\n\r\n\t\t\t\tlet {required} = itemSchema;\r\n\t\t\t\tlet requireFlag = required===true && <span className=\"text-danger\">*</span>;\r\n\t\t\t\tlet divLabel:any, cn:string = 'flex-fill d-flex ';\r\n\t\t\t\tif (labelHide === true) {\r\n\t\t\t\t\tdivLabel = undefined;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tdivLabel = <div>{label} {requireFlag}</div>;\r\n\t\t\t\t\tcn += 'justify-content-end';\r\n\t\t\t\t}\r\n\t\t\t\tlet ret = <React.Fragment key={index}>\r\n\t\t\t\t\t{sep}\r\n\t\t\t\t\t<div className={'d-flex align-items-center' + rowContainerClassName} \r\n\t\t\t\t\t\tonClick={async ()=>await this.rowClick(itemEdit)}>\r\n\t\t\t\t\t\t{divLabel}\r\n\t\t\t\t\t\t<div className={cn}>{\r\n\t\t\t\t\t\t\titemEdit===undefined? undefined: itemEdit.renderContent()\r\n\t\t\t\t\t\t}</div>\r\n\t\t\t\t\t\t{editInRow === false && <div className=\"w-2c text-right\"><i className=\"fa fa-angle-right\" /></div>}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</React.Fragment>;\r\n\t\t\t\tsep = this.sep;\r\n\t\t\t\treturn ret;\r\n\t\t\t})}\r\n\t\t\t{this.bottomBorder}\r\n\t\t</div>;\r\n    }\r\n\r\n\tasync onItemChanged(itemEdit:ItemEdit, newValue:any) {\r\n\t\tlet {itemSchema, uiItem, value} = itemEdit;\r\n\t\tthis.props.data[itemSchema.name] = newValue;\r\n        let {onItemChanged, stopEdit} = this.props;\r\n\t\tif (stopEdit === true) return;\r\n\t\tif (uiItem?.readOnly === true) return;\r\n\t\tif (onItemChanged === undefined) {\r\n\t\t\talert(`${itemSchema.name} value changed, new: ${newValue}, pre: ${value}`);\r\n\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以这一句移到前面去\r\n\t\t\t//this.props.data[itemSchema.name] = changeValue;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tawait onItemChanged(itemSchema, newValue, value);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate rowClick = async (itemEdit:ItemEdit) => {\r\n\t\tif (itemEdit === undefined) {\r\n\t\t\talert('item has no edit');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet {itemSchema, uiItem, value, editInRow} = itemEdit;\r\n\t\tif (editInRow === true) return;\r\n        let {onItemChanged, onItemClick, stopEdit} = this.props;\r\n\t\tif (stopEdit === true) return;\r\n\t\tif (uiItem?.readOnly === true) return;\r\n        let changeValue:any;\r\n        if (onItemClick !== undefined) {\r\n            await onItemClick(itemSchema, uiItem, value);\r\n            return;\r\n        }\r\n        //let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);\r\n        if (itemEdit === undefined) {\r\n            alert('undefined: let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);');\r\n            return;\r\n        }\r\n        try {\r\n            changeValue = await itemEdit.start();\r\n            if (changeValue !== value) {\r\n\t\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以移到这里来\r\n\t\t\t\tthis.props.data[itemSchema.name] = changeValue;\r\n                if (onItemChanged === undefined) {\r\n                    alert(`${itemSchema.name} value changed, new: ${changeValue}, pre: ${value}`);\r\n\t\t\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以这一句移到前面去\r\n                    //this.props.data[itemSchema.name] = changeValue;\r\n                }\r\n                else {\r\n                    await onItemChanged(itemSchema, changeValue, value);\r\n                }\r\n            }\r\n            await itemEdit.end();\r\n        }\r\n        catch (err) {\r\n            // 如果直接back，会触发reject，就到这里了\r\n\t\t\tconsole.log('no value changed');\r\n\t\t\tconsole.error(err);\r\n        }\r\n    }\r\n}\r\n\r\ntype NewItemEdit = new (edit: Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string|JSX.Element, value: any) => ItemEdit;\r\n\r\nfunction createItemEdit(edit: Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string|JSX.Element, value: any):ItemEdit {\r\n\tlet ie: ItemEdit;\r\n    let itemEdit: NewItemEdit;\r\n    if (uiItem !== undefined) {\r\n        switch (uiItem.widget) {\r\n            default: break;\r\n            case 'id': itemEdit = IdItemEdit; break;\r\n\t\t\tcase 'text': itemEdit = StringItemEdit; break;\r\n\t\t\tcase 'textarea': itemEdit = TextAreaItemEdit; break;\r\n            case 'image': itemEdit = ImageItemEdit; break;\r\n\t\t\tcase 'select': itemEdit = SelectItemEdit; break;\r\n\t\t\tcase 'range': itemEdit = RangeItemEdit; break;\r\n\t\t\tcase 'number':\r\n\t\t\tcase 'updown': itemEdit = NumberItemEdit; break;\r\n\t\t\tcase 'checkbox': itemEdit = CheckBoxItemEdit; break;\r\n            case 'radio': \r\n\t\t\t\tie = new RadioItemEdit(edit, itemSchema, uiItem as UiRadio, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'tagSingle':\r\n\t\t\t\tie = new TagSingleItemEdit(edit, itemSchema, uiItem as UiTagSingle, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'tagMulti':\r\n\t\t\t\tie = new TagMultiItemEdit(edit, itemSchema, uiItem as UiTagMulti, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t}\r\n\tif (ie === undefined) {\r\n\t\tif (itemEdit === undefined) {\r\n\t\t\tswitch (itemSchema.type) {\r\n\t\t\t\tcase 'string': itemEdit = StringItemEdit; break;\r\n\t\t\t\tcase 'image': itemEdit = ImageItemEdit; break;\r\n\t\t\t\tcase 'boolean': itemEdit = CheckBoxItemEdit; break;\r\n\t\t\t\tcase 'number':\r\n\t\t\t\tcase 'integer': itemEdit = RangeItemEdit; break;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (itemEdit === undefined) return;\r\n\t\tie = new itemEdit(edit, itemSchema, uiItem, label, value);\r\n\t}\r\n\tie.init();\r\n\treturn ie;\r\n}\r\n","import { ID, IDX, Uq } from \"tonva-react\";\r\nimport { IDBase } from \"../base\";\r\nimport { MidIDListBase } from \"../list\";\r\n\r\nexport class MidIDXList<T extends IDBase> extends MidIDListBase<T> {\r\n\treadonly ID:ID;\r\n\treadonly IDX: IDX;\r\n\tconstructor(uq:Uq, ID:ID, IDX:IDX) {\r\n\t\tsuper(uq, undefined);\r\n\t\tthis.ID = ID;\r\n\t\tthis.IDX = IDX;\r\n\t}\r\n\r\n\tasync init() {\r\n\t\tawait Promise.all([\r\n\t\t\tthis.ID.loadSchema(),\r\n\t\t\tthis.IDX.loadSchema(),\r\n\t\t]);\r\n\t}\r\n\r\n\tprotected async loadPageItems(pageStart:any, pageSize:number):Promise<T[]> {\r\n\t\tlet ret = await this.uq.ID<T>({\r\n\t\t\tIDX: this.ID,\r\n\t\t\tid: undefined,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import { zh } from \"./zh\";\r\nimport { en } from \"./en\";\r\n\r\nexport const res = {\r\n\t$zh: zh,\r\n\t$en: en,\r\n}\r\n","export const zh = {\r\n\tday: '日',\r\n\tweek: '周',\r\n\tmonth: '月',\r\n\tyear: '年',\r\n}","export const en = {\r\n\tday: 'Day',\r\n\tweek: 'Week',\r\n\tmonth: 'Month',\r\n\tyear: 'Year',\r\n}\r\n","import { makeObservable, observable } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\nimport { FA, left0, LMR, NumberProp, StringProp, VPage } from \"tonva-react\";\r\nimport { CIDX } from \"./CIDX\";\r\n\r\nexport class VEdit extends VPage<CIDX> {\r\n\theader() {return 'Edit'}\r\n\tcontent() {\r\n\t\tlet {midIDX} = this.controller;\r\n\t\tlet {props} = midIDX;\r\n\t\treturn <div className=\"py-3\">\r\n\t\t\t{props.map((v, index) => {\r\n\t\t\t\tlet {type} = v as any;\r\n\t\t\t\tswitch (type) {\r\n\t\t\t\t\tdefault: return null;\r\n\t\t\t\t\tcase 'string': \r\n\t\t\t\t\t\treturn this.renderStringProp(v as StringProp);\r\n\t\t\t\t\tcase 'integer':\r\n\t\t\t\t\tcase 'number': \r\n\t\t\t\t\t\treturn this.renderNumberProp(v as NumberProp);\r\n\t\t\t\t}\r\n\t\t\t})}\r\n\t\t</div>\r\n\t}\r\n\r\n\tprivate renderStringProp(prop:StringProp) {\r\n\t\treturn <div key={prop.name} className=\"px-3 py-2 bg-white mb-1 cursor-pointer\">\r\n\t\t\t{JSON.stringify(prop)}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderNumberProp(prop: NumberProp) {\r\n\t\tlet V = observer(() => {\r\n\t\t\tlet {name} = prop;\r\n\t\t\tlet {spanValues} = this.controller;\r\n\t\t\tif (!spanValues) return null;\r\n\t\t\treturn <div key={name} className=\"px-3 py-2 bg-white mb-1 cursor-pointer\" \r\n\t\t\t\tonClick={()=>this.openVPage(VEditNumberField, prop)}>\r\n\t\t\t\t<LMR left={<b>{prop.label}</b>} \r\n\t\t\t\t\tright={<FA name=\"pencil-square-o\" className=\"align-self-center\" />}>\r\n\t\t\t\t\t<div className=\"mr-5 text-right\">{this.controller.spanValues[name]}</div>\r\n\t\t\t\t</LMR>\r\n\t\t\t</div>;\r\n\t\t});\r\n\t\treturn <V />;\r\n\t}\r\n}\r\n\r\nclass VEditNumberField extends VPage<CIDX> {\r\n\tprivate prop: NumberProp;\r\n\tprivate date: Date;\r\n\tprivate value: number;\r\n\tprivate dateInput: HTMLInputElement;\r\n\tprivate timeInput: HTMLInputElement;\r\n\tdisabled: boolean = true;\r\n\tconstructor(controller: CIDX) {\r\n\t\tsuper(controller);\r\n\t\tmakeObservable(this, {\r\n\t\t\tdisabled: observable\r\n\t\t});\r\n\t}\r\n\tinit(prop: NumberProp) {\r\n\t\tthis.prop = prop;\r\n\t\tthis.date = new Date();\r\n\t}\r\n\theader() {return this.prop.label}\r\n\tright() {\r\n\t\tlet V = observer(() => <button \r\n\t\t\tclassName=\"btn btn-sm btn-success mr-2\" \r\n\t\t\tdisabled={this.disabled}\r\n\t\t\tonClick={this.onSave}>\r\n\t\t\t{this.t('submit')}\r\n\t\t</button>);\r\n\t\treturn <V />;\r\n\t}\r\n\tcontent() {\r\n\t\tlet {time} = this.prop;\r\n\t\tlet year = this.date.getFullYear();\r\n\t\tlet month = this.date.getMonth() + 1;\r\n\t\tlet day = this.date.getDate();\r\n\t\tlet hour = this.date.getHours();\r\n\t\tlet minute = this.date.getMinutes();\r\n\t\tlet defDate = `${year}-${left0(month, 2)}-${left0(day, 2)}`;\r\n\t\tlet vDateTime:any;\r\n\t\tif (time === true) {\r\n\t\t\tvDateTime = <div className=\"input-group mb-3\">\r\n\t\t\t\t<span className=\"w-8c input-group-text\">{this.t('date')}</span>\r\n\t\t\t\t<input ref={d => this.dateInput=d} type=\"date\" \r\n\t\t\t\t\tclassName=\"form-control\" defaultValue={defDate} />\r\n\t\t\t\t<input ref={t => this.timeInput=t} type=\"time\" className=\"form-control\" \r\n\t\t\t\t\tdefaultValue={`${left0(hour, 2)}:${left0(minute, 2)}`} />\r\n\t\t\t</div>;\r\n\t\t}\r\n\t\treturn <div className=\"p-3\">\r\n\t\t\t{vDateTime}\r\n\t\t\t<div className=\"input-group\">\r\n\t\t\t\t<span className=\"w-8c input-group-text\">{this.t('value')}</span>\r\n\t\t\t\t<input type=\"number\" className=\"form-control\" \r\n\t\t\t\t\tonChange={this.onValueChange} />\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate onValueChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet v = evt.currentTarget.value.trim();\r\n\t\tthis.disabled = v.length === 0;\r\n\t\tlet n = Number(v);\r\n\t\tif (Number.isNaN(n) === false) this.value = n;\r\n\t}\r\n\r\n\tprivate onSave = async () => {\r\n\t\tlet t: number;\r\n\t\tif (this.dateInput) {\r\n\t\t\tlet date = this.dateInput.valueAsDate;\r\n\t\t\tlet dateTicks = this.dateInput?.valueAsNumber;\r\n\t\t\tlet timeTicks = this.timeInput?.valueAsNumber;\r\n\t\t\tt = dateTicks + timeTicks + date.getTimezoneOffset()*60*1000;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tt = Date.now();\r\n\t\t}\r\n\t\tawait this.controller.saveFieldValue(this.prop.name, t, this.value);\r\n\t\tthis.closePage();\r\n\t}\r\n}\r\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { VPage, List, LMR, EasyTime, UserView, User } from \"tonva-react\";\r\nimport { CIDX } from \"./CIDX\";\r\n\r\nexport class VHistory extends VPage<CIDX> {\r\n\theader() {return this.controller.field}\r\n\tcontent() {\r\n\t\treturn <div>\r\n\t\t\t<List items={this.controller.historyItems} item={{render: this.renderItem, key:(item)=>item.t}} />\r\n\t\t</div>\r\n\t}\r\n\r\n\tprivate renderItem = (item:any, index:number) => {\r\n\t\tlet {t, v, u} = item;\r\n\t\tlet left = <div className=\"w-12c\"><EasyTime date={new Date(t)} /></div>;\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {name, nick} = user;\r\n\t\t\treturn <small className=\"text-muted\">{nick || name}</small>\r\n\t\t}\r\n\t\tlet right = <UserView user={u} render={renderUser} />;\r\n\t\treturn <div className=\"px-3 py-2\">\t\t\t\r\n\t\t\t<LMR className=\"w-100\" left={left} right={right}>{v}</LMR>\r\n\t\t</div>\r\n\t}\r\n}\r\n","import { makeObservable, observable, runInAction, toJS } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\nimport { CSSProperties } from \"react\";\r\nimport { Bar } from \"react-chartjs-2\";\r\nimport { FA, LMR, NumberProp, Prop, VPage } from \"tonva-react\";\r\nimport { CIDX } from \"./CIDX\";\r\n\r\nconst spans = ['week', 'month'];\r\n\r\nconst graphOptions = {\r\n\ttitle: {\r\n\t\tdisplay: false,\r\n\t},\r\n\tmaintainAspectRatio: false,\r\n}\r\n\r\nexport class VView extends VPage<CIDX> {\r\n\tcurrentIndex: number = 0;\r\n\tconstructor(controller:CIDX) {\r\n\t\tsuper(controller);\r\n\t\tmakeObservable(this, {\r\n\t\t\tcurrentIndex: observable,\r\n\t\t});\r\n\t}\r\n\r\n\theader() {return 'View'}\r\n\tright() {\r\n\t\treturn <button\r\n\t\t\tclassName=\"btn btn-sm btn-primary mr-2\" \r\n\t\t\tonClick={() => this.controller.onItemEdit()}>\r\n\t\t\t<FA name=\"pencil-square-o\" />\r\n\t\t</button>;\r\n\t}\r\n\tcontent() {\t\t\r\n\t\tlet V = observer(() => {\r\n\t\t\tlet {spanValues, midIDX, timeSpan, prevTimeSpan, nextTimeSpan, dayValues} = this.controller;\r\n\t\t\tif (spanValues === null) return null; \r\n\t\t\tlet {props} = midIDX;\r\n\t\t\tconst data = {\r\n\t\t\t\tlabels: timeSpan.labels,\r\n\t\t\t\tdatasets: [{\r\n\t\t\t\t\tlabel: '',\r\n\t\t\t\t\tdata: toJS(dayValues),\r\n\t\t\t\t\tbackgroundColor: 'lightgreen',\r\n\t\t\t\t\tborderWidth: 1\r\n\t\t\t\t}],\r\n\t\t\t};\r\n\t\t\tlet curProp = props[this.currentIndex] as NumberProp;\r\n\t\t\tlet {label, name} = curProp;\r\n\t\t\tlet moveStep = (icon:string, spanStep: ()=>Promise<void>) => <div \r\n\t\t\t\tclassName={'p-3 ' + (spanStep? 'cursor-pointer' : 'text-muted')} \r\n\t\t\t\tonClick={spanStep}>\r\n\t\t\t\t\t<FA name={icon} />\r\n\t\t\t\t</div>;\r\n\t\t\tlet left = moveStep('chevron-left', prevTimeSpan);\r\n\t\t\tlet right = timeSpan.canNext === true?\r\n\t\t\t\tmoveStep('chevron-right', nextTimeSpan)\r\n\t\t\t\t:\r\n\t\t\t\tmoveStep('square-o', undefined);\r\n\t\t\t\t//<div><FA className=\"text-muted\" name=\"square-o\" /></div>;\r\n\t\t\treturn <div className=\"py-3\">\r\n\t\t\t\t<div className=\"container\">\r\n\t\t\t\t\t<div className=\"row\">\r\n\t\t\t\t\t\t{spans.map(v => {\r\n\t\t\t\t\t\t\tlet cn = 'col text-center p-2 cursor-pointer ';\r\n\t\t\t\t\t\t\tlet style:CSSProperties = {\r\n\t\t\t\t\t\t\t\tborderBottomWidth: '0.15rem',\r\n\t\t\t\t\t\t\t\tborderBottomStyle: 'solid',\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tif (this.controller.timeSpan.type === v) {\r\n\t\t\t\t\t\t\t\tcn += 'text-primary font-weight-bold';\r\n\t\t\t\t\t\t\t\tstyle.borderBottomColor = 'blue';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tcn += 'text-muted';\r\n\t\t\t\t\t\t\t\tstyle.borderBottomColor = 'lightgray';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn <div key={v} className={cn} style={style} \r\n\t\t\t\t\t\t\t\tonClick={()=>this.tabClick(v as any)}>{this.t(v)}</div>;\r\n\t\t\t\t\t\t})}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<LMR className=\"text-center align-items-center\" left={left} right={right} >\r\n\t\t\t\t\t{timeSpan.title}\r\n\t\t\t\t</LMR>\r\n\t\t\t\t<div className=\"mt-3 mx-3 text-center cursor-pointer\"\r\n\t\t\t\t\tonClick={() => this.onFieldHistory(name)}>\r\n\t\t\t\t\t<h4 className=\"d-inline\">{label}</h4>\r\n\t\t\t\t\t<span className=\"text-info small\"> <FA name=\"angle-double-right\" /> 查看明细</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"p-3 h-12c\">\r\n\t\t\t\t\t<Bar data={data} width={100} height={50} options={graphOptions} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"d-flex flex-wrap p-1\"> \r\n\t\t\t\t\t{props.map((v, index) => {\r\n\t\t\t\t\t\tlet {name, label} = v as any;\r\n\t\t\t\t\t\tlet sv = spanValues[name];\r\n\t\t\t\t\t\tlet val = sv?\r\n\t\t\t\t\t\t\t<b className=\"h3 mb-0\">{sv}</b>\r\n\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\t<small className=\"text-muted\">0</small>\r\n\t\t\t\t\t\tlet cn = 'm-1 w-8c h-8c d-flex flex-column align-items-center justify-content-center bg-white px-3 cursor-pointer border rounded ';\r\n\t\t\t\t\t\tcn += (index === this.currentIndex)? ' border-primary' : ' ';\r\n\t\t\t\t\t\treturn <div key={index} className={cn} onClick={() => this.onFieldClick(v, index)}>\r\n\t\t\t\t\t\t\t<div className=\"my-3 h-4c d-flex align-items-center\">{val}</div>\r\n\t\t\t\t\t\t\t<div className=\"mb-3\">{label}</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t})}\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\r\n\t\t});\r\n\t\treturn <V />;\r\n\t}\r\n\r\n\tprivate tabClick(span:'day'|'week'|'month'|'year') {\r\n\t\tthis.controller.setTimeSpan(span);\r\n\t}\r\n\r\n\tprivate async onFieldClick(prop:Prop, index:number) {\r\n\t\tlet {midIDX} = this.controller;\r\n\t\tlet {props} = midIDX;\r\n\t\tif (this.currentIndex === index) {\r\n\t\t\tlet curProp = props[this.currentIndex] as NumberProp;\r\n\t\t\tlet {name} = curProp;\r\n\t\t\tawait this.controller.onFieldHistory(name);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\trunInAction(() => {\r\n\t\t\tthis.currentIndex = index;\r\n\t\t\tlet curProp = props[this.currentIndex] as NumberProp;\r\n\t\t\tlet {name} = curProp;\r\n\t\t\tthis.controller.setCurrentField(name);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate async onFieldHistory(field:string) {\r\n\t\tawait this.controller.onFieldHistory(field);\r\n\t}\r\n}\r\n","import { makeObservable, observable, runInAction } from \"mobx\";\r\nimport { Controller, PageItems } from \"tonva-react\";\r\nimport { HistoryPageItems, TimeSpan } from \"../tools\";\r\nimport { CList } from \"../list\";\r\nimport { MidIDX } from \"./MidIDX\";\r\nimport { MidIDXList } from \"./MidIDXList\";\r\nimport { res } from \"./res\";\r\nimport { VEdit } from \"./VEdit\";\r\nimport { VHistory } from \"./VHistory\";\r\nimport { VView } from \"./VView\";\r\n\r\nexport class CIDX extends Controller {\r\n\ttimeSpan:TimeSpan = null;\r\n\tspanValues: any = null;\r\n\tdayValues: number[] = null;\r\n\tmidIDX: MidIDX;\r\n\tprivate historyPageItems: HistoryPageItems<any>\r\n\tconstructor(midIDX: MidIDX) {\r\n\t\tsuper();\r\n\t\tmakeObservable(this, {\r\n\t\t\ttimeSpan: observable,\r\n\t\t\tspanValues: observable,\r\n\t\t\tdayValues: observable.ref,\r\n\t\t});\r\n\t\tthis.setRes(res);\r\n\t\tthis.setRes(midIDX.res);\r\n\t\tthis.midIDX = midIDX;\r\n\t\tthis.historyPageItems = new HistoryPageItems<any>(midIDX.historyLoader);\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tawait this.midIDX.init();\r\n\t\tlet {uq, ID, IDX} = this.midIDX;\r\n\t\tlet midIDXList = new MidIDXList(uq, ID, IDX);\r\n\t\tmidIDXList.onItemClick = this.onItemClick;\r\n\t\tlet cList = new CList(midIDXList);\r\n\t\tawait cList.start();\r\n\t}\r\n\r\n\titem:any;\r\n\tonItemClick: (item:any) => void = async (item:any) => {\r\n\t\tthis.item = item;\r\n\t\tawait this.setTimeSpan('month');\r\n\t\tthis.openVPage(VView);\r\n\t}\r\n\r\n\tonItemEdit = async ():Promise<void> => {\r\n\t\tthis.openVPage(VEdit);\r\n\t}\r\n\r\n\tasync setTimeSpan(span: 'day'|'week'|'month'|'year') {\r\n\t\tlet timeSpan = TimeSpan.create(span);\r\n\t\trunInAction(async () => {\r\n\t\t\tthis.timeSpan = timeSpan;\r\n\t\t\tawait this.loadSum(timeSpan);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate async loadSum(timeSpan?: TimeSpan) {\r\n\t\tlet {far, near} = timeSpan ?? this.timeSpan;\r\n\t\tlet ret = await this.midIDX.loadSum(this.item.id, far, near);\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\tlet [values, sums] = ret;\r\n\t\tlet sum = sums[0];\r\n\t\trunInAction(() => {\r\n\t\t\tthis.spanValues = sum ?? {};\r\n\t\t});\r\n\t\tawait this.loadDayValues();\r\n\t}\r\n\r\n\tprevTimeSpan = async () => {\r\n\t\tthis.timeSpan.prev();\r\n\t\tawait this.loadSum();\r\n\t}\r\n\r\n\tnextTimeSpan = async () => {\r\n\t\tthis.timeSpan.next();\r\n\t\tawait this.loadSum();\r\n\t}\r\n\r\n\tget historyItems():PageItems<any> {return this.historyPageItems;}\r\n\tfield:string;\r\n\tasync onFieldHistory(field:string) {\r\n\t\tthis.field = field;\r\n\t\tawait this.midIDX.init();\r\n\t\tthis.historyPageItems.first({\r\n\t\t\tid: this.item.id,\r\n\t\t\tfar: this.timeSpan.far,\r\n\t\t\tnear: this.timeSpan.near,\r\n\t\t\tfield\r\n\t\t});\r\n\t\tthis.openVPage(VHistory);\r\n\t}\r\n\r\n\tasync loadDayValues() {\r\n\t\tlet {far, near} = this.timeSpan;\r\n\t\tlet ret = await this.midIDX.loadDayValues(this.item.id, this.field, far, near);\r\n\t\tlet dayValues = this.timeSpan.getDayValues(ret);\r\n\t\trunInAction(() => {\r\n\t\t\tthis.dayValues = dayValues;\r\n\t\t});\r\n\t}\r\n\r\n\tsetCurrentField(field:string) {\r\n\t\tthis.field = field;\r\n\t\tthis.loadDayValues();\r\n\t}\r\n\r\n\tasync saveFieldValue(field:string, t:number, value:number|string) {\r\n\t\tlet {id} = this.item;\r\n\t\tawait this.midIDX.saveFieldValue(id, field, t, value);\r\n\t\tlet ret = await this.midIDX.loadFieldSum(id, field, this.timeSpan);\r\n\t\tlet v= ret[field];\r\n\t\tthis.spanValues[field] = v;\r\n\t\treturn;\r\n\t}\r\n}\r\n","import { ID, Schema, UiSchema, Uq, Prop, IDX } from \"tonva-react\";\r\nimport { TimeSpan } from \"../tools\";\r\nimport { Mid } from \"../base\";\r\n\r\nexport class MidIDX extends Mid {\r\n\treadonly IDX: IDX;\r\n\treadonly ID: ID;\r\n\treadonly timeZone: number;\r\n\tconstructor(uq: Uq, IDX: IDX, ID: ID, timeZone:number) {\r\n\t\tsuper(uq);\r\n\t\tthis.IDX = IDX;\r\n\t\tthis.ID = ID;\r\n\t\tthis.timeZone = timeZone;\r\n\t}\r\n\t\r\n\tasync init():Promise<void> {\r\n\t\tawait this.loadSchema();\r\n\t}\r\n\r\n\tprotected async loadSchema() {\r\n\t\tawait Promise.all([\r\n\t\t\tthis.IDX.loadSchema(),\r\n\t\t\tthis.ID.loadSchema(),\r\n\t\t]);\r\n\t\tlet IDUI = {ID: this.ID};\r\n\t\tthis._itemSchema = await this.buildItemSchema(IDUI);\r\n\t\tthis._uiSchema = this.buildUISchema(IDUI);\r\n\t\tthis._props = this.buildGridProps(this.IDX);\r\n\t\tlet {exFields} = this.IDX.schema;\r\n\t\tfor (let prop of this._props) {\r\n\t\t\tlet {name} = prop as any;\r\n\t\t\tif (!name) continue;\r\n\t\t\tlet ex = (exFields as any[])?.find(v => v.field === name);\r\n\t\t\tlet time = ex?.time;\r\n\t\t\tif (!time) continue;\r\n\t\t\t(prop as any).time = time;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tasync load(id:number): Promise<any[]> {\r\n\t\tlet ret = await this.uq.ID({\r\n\t\t\tIDX: [this.ID, this.IDX],\r\n\t\t\tid,\r\n\t\t\tpage: undefined,\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\thistoryLoader = async (id:number, field:string, far:number, near:number, pageStart:any, pageSize:number):Promise<any[]> => {\r\n\t\tlet ret = await this.uq.IDLog({\r\n\t\t\tIDX: this.IDX,\r\n\t\t\tfield,\r\n\t\t\tid,\r\n\t\t\tlog: 'each',\r\n\t\t\tfar,\r\n\t\t\tnear,\r\n\t\t\tpage: {\r\n\t\t\t\tstart: pageStart,\r\n\t\t\t\tsize: pageSize,\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync saveID(data:any):Promise<number> {\r\n\t\tlet param: any = {};\r\n\t\tparam[this.ID.name] = [data];\r\n\t\tlet ret = await this.uq.Acts(param);\r\n\t\tlet id = ret[this.ID.name];\r\n\t\treturn id[0];\r\n\t}\r\n\r\n\tasync saveFieldValue(id:number, fieldName:string, t:any, value:string|number):Promise<void> {\r\n\t\tlet param: any = {};\r\n\t\tlet val: any = {id};\r\n\t\tval[fieldName] = {\r\n\t\t\t$time: t,\r\n\t\t\tvalue,\r\n\t\t}\r\n\t\tparam[this.IDX.name] = [val];\r\n\t\tlet ret = await this.uq.Acts(param);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync loadFieldSum(id:number, field:string, timeSpan:TimeSpan):Promise<any> {\r\n\t\tlet {far, near} = timeSpan;\r\n\t\tlet retSum = await this.uq.IDSum({\r\n\t\t\tIDX: this.IDX,\r\n\t\t\tfield: [field],\r\n\t\t\tid,\r\n\t\t\tfar,\r\n\t\t\tnear,\r\n\t\t});\r\n\t\tlet ret = retSum[0];\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync loadSum(id:number, far:number, near:number):Promise<[any[], any[]]> {\r\n\t\tlet valueFields:string[] = [];\r\n\t\tlet {fields, exFields} = this.IDX.schema;\r\n\t\tif (exFields === undefined) {\r\n\t\t\tthrow new Error('no valid sum field in exFields');\r\n\t\t}\r\n\t\tfor (let ex of exFields) {\r\n\t\t\tlet {field, log} =  ex;\r\n\t\t\tif (log !== true) continue;\r\n\t\t\tlet f = (fields as any[]).find(v => v.name === field);\r\n\t\t\tif (f === undefined) continue;\r\n\t\t\tlet {name, type} = f;\r\n\t\t\tif (['int', 'tinyint', 'smallint', 'bigint', 'dec', 'float', 'double'].indexOf(type) < 0) continue;\r\n\t\t\tvalueFields.push(name);\r\n\t\t}\r\n\t\treturn await Promise.all([\r\n\t\t\tthis.uq.ID({\r\n\t\t\t\tIDX: this.IDX,\r\n\t\t\t\tid,\r\n\t\t\t}),\r\n\t\t\tthis.uq.IDSum({\r\n\t\t\t\tIDX: this.IDX,\r\n\t\t\t\tfield: valueFields,\r\n\t\t\t\tid,\r\n\t\t\t\tfar,\r\n\t\t\t\tnear,\r\n\t\t\t}),\r\n\t\t]);\r\n\t}\r\n\r\n\tasync loadDayValues(id:number, field: string, far:number, near:number):Promise<any[]> {\r\n\t\tif (!field) {\r\n\t\t\tfield = (this._props[0] as any)?.name;\r\n\t\t\tif (!field) {\r\n\t\t\t\tdebugger;\r\n\t\t\t\talert('no field in loadDayValues');\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet ret = await this.uq.IDLog({\r\n\t\t\tIDX: this.IDX,\r\n\t\t\tfield,\r\n\t\t\tlog: 'day',\r\n\t\t\ttimeZone: this.timeZone,\r\n\t\t\tid,\r\n\t\t\tfar,\r\n\t\t\tnear,\r\n\t\t\tpage: {\r\n\t\t\t\tstart: near,\r\n\t\t\t\tend: far,\r\n\t\t\t\tsize: 100,\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate _itemSchema: Schema;\r\n\tget itemSchema(): Schema { return this._itemSchema; }\r\n\r\n\tprivate _uiSchema: UiSchema;\r\n\tget uiSchema(): UiSchema { return this._uiSchema; }\r\n\r\n\tprivate _props: Prop[];\r\n\tget props():Prop[] { return this._props; }\r\n}\r\n","import { ID, IX, Uq } from \"tonva-react\";\r\nimport { Mid } from \"../base\";\r\n\r\ninterface TagTree {\r\n\tid: number;\r\n\tparent: number;\r\n\tname: string;\r\n\tsub: {[id:number]: TagTree};\r\n\tcount: number;\r\n}\r\n\r\ninterface TagItem {\r\n\tid: number;\r\n\tparent: number;\r\n\tname: string;\r\n}\r\n\r\nexport interface Tag {\r\n\tid: number;\r\n\tname: string;\r\n\tparent: number;\r\n\tsub: Tag[];\r\n}\r\n\r\nexport class MidTag extends Mid {\r\n\treadonly ID: ID;\r\n\treadonly IX: IX;\r\n\treadonly tag: ID;\r\n\treadonly type: string;\r\n\t\r\n\ttypeArr: Tag[];\r\n\ttypeColl: {[id:number]: Tag};\r\n\r\n\tconstructor(uq: Uq, ID:ID, IX:IX, tag:ID, type: string) {\r\n\t\tsuper(uq);\r\n\t\tthis.ID = ID;\r\n\t\tthis.IX = IX;\r\n\t\tthis.tag = tag;\r\n\t\tthis.type = type;\r\n\t}\r\n\r\n\tasync init():Promise<void> {\r\n\t\tawait this.load();\r\n\t}\r\n\r\n\tprotected async load(): Promise<void> {\r\n\t\tif (this.typeArr) return;\r\n\t\tlet ret = await Promise.all([\r\n\t\t\tthis.ID.loadSchema(),\r\n\t\t\tthis.IX.loadSchema(),\r\n\t\t\tthis.tag.loadSchema(),\r\n\t\t\tthis.uq.IDTree<TagItem>({\r\n\t\t\t\tID: this.tag,\r\n\t\t\t\tparent: 0,\r\n\t\t\t\tkey: this.type,\r\n\t\t\t\tlevel: 3,\r\n\t\t\t\tpage: {start:0, size:1000},\r\n\t\t\t})\r\n\t\t]);\r\n\t\tthis.buildTagTypes(ret[3]);\r\n\t}\r\n\r\n\tprivate buildTagTypes(items: TagItem[]) {\r\n\t\tlet root:TagTree;\r\n\t\tlet tree:TagTree = {id:0, parent:-1, name:undefined, sub:{}, count:0};\r\n\t\tfor (let item of items) {\r\n\t\t\tlet {id, parent, name} = item;\r\n\t\t\tif (parent === 0) {\r\n\t\t\t\ttree.sub[id] = root = {id, parent, name, sub: {}, count:0};\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tlet p = tree.sub[parent];\r\n\t\t\tlet tag:TagTree = {id, parent, name, sub: {}, count:0};\r\n\t\t\ttree.sub[id] = tag;\r\n\t\t\tif (p !== undefined) {\r\n\t\t\t\tp.sub[id] = tag;\r\n\t\t\t\tp.count++;\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (let i in tree.sub) {\r\n\t\t\tlet tag = tree.sub[i];\r\n\t\t\tlet {parent} = tag;\r\n\t\t\tif (parent > 0) {\r\n\t\t\t\tlet p = tree.sub[parent];\r\n\t\t\t\tif (p) p.sub[Number(i)] = tag;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.typeArr = [];\r\n\t\tthis.typeColl = {};\r\n\t\tif (!root) return;\r\n\t\tfor (let i in root.sub) {\r\n\t\t\tlet tree = root.sub[i];\r\n\t\t\tlet {id, name} = tree;\r\n\t\t\tlet type:Tag = {id, name, sub:[], parent: undefined};\r\n\t\t\tthis.typeArr.push(type);\r\n\t\t\tthis.typeColl[id] = type;\r\n\t\t\tfor (let j in tree.sub) {\r\n\t\t\t\tlet s = tree.sub[j];\r\n\t\t\t\tlet {id, name} = s;\r\n\t\t\t\ttype.sub.push({id, name, sub:undefined, parent:type.id})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","import { VPage } from \"tonva-react\";\r\nimport { CSelect } from \"./CSelect\";\r\nimport { Tag } from '../MidTag';\r\nimport { ItemTags } from '../CIDTagList';\r\n\r\ninterface TagGroup {\r\n\tid: number;\r\n\tname:string;\r\n\tchecks: {tag: Tag, selected: boolean}[];\r\n}\r\n\r\nexport class VSelect extends VPage<CSelect> {\r\n\tprivate tagGroups:TagGroup[];\r\n\tinit() {\r\n\t\tlet {midTag, itemTags} = this.controller;\r\n\t\tlet {typeColl} = itemTags as ItemTags<any>;\r\n\t\tthis.tagGroups = [];\r\n\t\tfor (let midType of midTag.typeArr) {\r\n\t\t\tlet {id, name} = midType;\r\n\t\t\tlet type = typeColl[id];\r\n\t\t\tlet checks: {tag:Tag; selected: boolean}[] = [];\r\n\t\t\tlet tagGroup = {id, name, checks};\r\n\t\t\tfor (let s of midType.sub) {\r\n\t\t\t\tlet {id: tagId} = s;\r\n\t\t\t\tlet selected = \r\n\t\t\t\t\ttype === undefined?\r\n\t\t\t\t\tfalse\r\n\t\t\t\t\t:\r\n\t\t\t\t\ttype.sub.findIndex(v => v.id === tagId) >= 0;\r\n\t\t\t\tchecks.push({tag:s, selected});\r\n\t\t\t}\r\n\t\t\tthis.tagGroups.push(tagGroup);\r\n\t\t}\r\n\t}\r\n\r\n\theader() {return 'select'}\r\n\tcontent() {\r\n\t\tlet {midTag, itemTags} = this.controller;\r\n\t\tlet {item} = itemTags;\r\n\t\t//let {tags} = midTag;\r\n\t\treturn <div className=\"px-3\">\r\n\t\t\t<div className=\"my-3\">{midTag.ID.render(item)}</div>\r\n\t\t\t{this.tagGroups.map(v => this.renderType(v))}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderType(group: TagGroup) {\r\n\t\tlet {id, name, checks}  = group;\r\n\t\treturn <div key={id} className=\"my-3\">\r\n\t\t\t<div><b>{name}</b></div>\r\n\t\t\t<div className=\"form-check form-check-inline mt-1\">\r\n\t\t\t{checks.map(v => {\r\n\t\t\t\tlet {tag, selected} = v;\r\n\t\t\t\tlet {id, name} = tag;\r\n\t\t\t\treturn <>\r\n\t\t\t\t\t<label key={id} className=\"form-check-label mr-3\">\r\n\t\t\t\t\t<input type=\"checkbox\" className=\"form-check-input\"\r\n\t\t\t\t\t\tonChange={(evt) => this.controller.onTagSelectChanged(tag, evt.currentTarget.checked)}\r\n\t\t\t\t\t\tdefaultChecked={selected} />\r\n\t\t\t\t\t{name}</label>\r\n\t\t\t\t</>\r\n\t\t\t})}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t}\r\n}","import { Controller } from \"tonva-react\";\r\nimport { MidTag, Tag } from \"../MidTag\";\r\nimport { CIDTagList } from '../CIDTagList';\r\nimport { VSelect } from \"./VSelect\";\r\n\r\nexport class CSelect extends Controller {\r\n\tprivate cIDTagList: CIDTagList<any>;\r\n\titemTags: any;\r\n\tmidTag: MidTag;\r\n\tconstructor(cIDTagList: CIDTagList<any>, itemTags:any, midTag: MidTag) {\r\n\t\tsuper();\r\n\t\tthis.setRes(midTag.res);\r\n\t\tthis.cIDTagList = cIDTagList;\r\n\t\tthis.itemTags = itemTags;\r\n\t\tthis.midTag = midTag;\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tthis.openVPage(VSelect);\r\n\t}\r\n\r\n\tprotected onItemClick(item:any):void {\r\n\t\treturn; //this.props.onItemClick(item);\r\n\t}\r\n\r\n\tprotected renderRight():JSX.Element {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tonTagSelectChanged = async (tag:Tag, selected:boolean) => {\r\n\t\tawait this.cIDTagList.onTagSelectChanged(this.itemTags, tag, selected);\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport { FA } from \"tonva-react\";\r\nimport { IDBase } from \"../base\";\r\nimport { MidIDTagList, ItemTags } from \"./CIDTagList\";\r\nimport { Tag } from \"./MidTag\";\r\n\r\nexport function renderRight(onClick: () => void) {\r\n\treturn <button className=\"btn btn-sm btn-primary mr-2\" onClick={onClick}>\r\n\t\t<FA name=\"plus\" />\r\n\t</button>;\r\n}\r\n\r\nexport function renderItemTags<T extends IDBase>(midIDTagList: MidIDTagList<T>, itemTags:ItemTags<T>, index:number):JSX.Element {\r\n\tlet V = observer(() => {\r\n\t\tlet {midTag, renderItem, renderTags} = midIDTagList;\r\n\t\t//let {renderItem} = midTag;\r\n\t\tlet {ID} = midTag;\r\n\t\tlet {item, typeArr} = itemTags;\r\n\t\treturn <div className=\"d-block\">\r\n\t\t\t<div>{(renderItem ??  ID.render)(item as any, index)}</div>\r\n\t\t\t<div className=\"text-muted mt-1\">{(renderTags ?? defaultRenderTags)(typeArr)}</div>\r\n\t\t</div>;\t\r\n\t});\r\n\treturn <V />;\r\n}\r\n\r\nfunction defaultRenderTags(typeArr:Tag[]):JSX.Element {\r\n\treturn <>\r\n\t\t{\r\n\t\t\ttypeArr.map(type => {\r\n\t\t\t\tlet {id, name} = type;\r\n\t\t\t\treturn <span key={id} className=\"mr-3\">\r\n\t\t\t\t\t<b>{name}</b>: {renderType(type)}\r\n\t\t\t\t</span>;\r\n\t\t\t})\r\n\t\t}\r\n\t</>;\r\n}\r\n\r\nfunction renderType(type:Tag):JSX.Element {\r\n\tlet V = observer(() => {\r\n\t\tlet {sub} = type;\r\n\t\treturn <>{sub.map(tag => {\r\n\t\t\tlet {id, name} = tag;\r\n\t\t\treturn <span className=\"mr-1\" key={id}>{name}</span>\r\n\t\t})}</>;\r\n\t});\r\n\treturn <V />;\r\n}","import { CList, MidList } from \"../list\";\r\nimport { IXBase, IDBase } from \"../base\";\r\nimport { ListPageItems } from \"../tools\";\r\nimport { CSelect } from \"./select\";\r\nimport { MidTag, Tag } from \"./MidTag\";\r\nimport { renderItemTags } from \"./parts\";\r\nimport { observable } from \"mobx\";\r\n\r\nexport interface ItemTags<T> {\r\n\titem: T;\r\n\ttypeArr: Tag[];\r\n\ttypeColl: {[id:number]:Tag};\r\n}\r\n\r\nexport class CIDTagList<T extends IDBase> extends CList<ItemTags<T>> {\r\n\tprivate midIDTagList: MidIDTagList<T>;\r\n\tconstructor(midIDTagList: MidIDTagList<T>) {\r\n\t\tsuper(midIDTagList);\r\n\t\tthis.setRes(midIDTagList.res);\r\n\t\tthis.midIDTagList = midIDTagList;\r\n\t}\r\n\r\n\tasync beforeStart():Promise<boolean> {\r\n\t\tawait this.midIDTagList.midTag.init();\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprotected onItemClick(item:any):void {\r\n\t\tlet {midTag} = this.midIDTagList;\r\n\t\tlet cSelect = new CSelect(this, item, midTag);\r\n\t\tcSelect.start();\r\n\t}\r\n\r\n\tprotected renderItem(itemTags:ItemTags<T>, index:number):JSX.Element {\r\n\t\treturn renderItemTags(this.midIDTagList, itemTags, index);\r\n\t}\r\n\r\n\tasync onTagSelectChanged(item:any, tag:Tag, selected:boolean) {\r\n\t\tawait this.midIDTagList.onTagSelectChanged(item, tag, selected);\r\n\t}\r\n}\r\n\r\nexport class MidIDTagList<T extends IDBase> extends MidList<ItemTags<T>> {\r\n\treadonly midTag: MidTag;\r\n\tprivate itemTagsColl:{[id:number]:ItemTags<T>};\r\n\trenderTags: (types:Tag[]) => JSX.Element;\r\n\tconstructor(midTag:MidTag) {\r\n\t\tsuper(midTag.uq, undefined);\r\n\t\tthis.midTag = midTag;\r\n\t\tthis.createPageItems();\r\n\t}\r\n\r\n\tasync init() {\r\n\t\tawait this.midTag.IX.loadSchema();\r\n\t}\r\n\r\n\tprotected createPageItems():ItemTagsListPageItems<T> {\r\n\t\tlet listPageItems = new ItemTagsListPageItems<T>(\r\n\t\t\t(pageStart:any, pageSize:number) => this.loadPageItems(pageStart, pageSize)\r\n\t\t);\r\n\t\treturn listPageItems;\r\n\t}\r\n\r\n\tkey:((item:ItemTags<T>) => number|string) = item => item.item.id;\r\n\r\n\tprotected async loadPageItems(pageStart:any, pageSize:number):Promise<ItemTags<T>[]> {\r\n\t\tlet result = await this.uq.IDxID<T, any>({\r\n\t\t\tID: this.midTag.ID,\r\n\t\t\tIX: this.midTag.IX,\r\n\t\t\tID2: this.midTag.tag,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\tlet [ret, ret2] = result;\r\n\t\tlet itemTagsList:ItemTags<T>[] = [];\r\n\t\tthis.itemTagsColl = {}\r\n\t\tfor (let item of ret) {\r\n\t\t\tlet p:ItemTags<T> = {item, typeArr:[], typeColl:{}};\r\n\t\t\tthis.itemTagsColl[item.id] = p;\r\n\t\t\titemTagsList.push(p);\r\n\t\t}\r\n\t\tfor (let tagItem of ret2) {\r\n\t\t\tlet {$xid, parent, id} = tagItem;\r\n\t\t\tlet itemTags = this.itemTagsColl[$xid];\r\n\t\t\tthis.addTag(itemTags, parent, id);\r\n\t\t\t/*\r\n\t\t\tlet {typeColl, typeArr} = itemTags;\r\n\t\t\tlet type = typeColl[parent];\r\n\t\t\tlet midType = this.midTag.typeColl[parent];\r\n\t\t\tif (type === undefined) {\r\n\t\t\t\ttype = {id:midType.id, name:midType.name, sub:[], parent:undefined};\r\n\t\t\t\ttypeColl[parent] = type;\r\n\t\t\t\ttypeArr.push(type);\r\n\t\t\t}\r\n\t\t\ttype.sub.push(midType.sub.find(v => v.id === id));\r\n\t\t\t*/\r\n\t\t}\r\n\t\treturn itemTagsList;\r\n\t}\r\n\r\n\tprivate addTag(itemTags:ItemTags<T>, typeId:number, tagId:number) {\r\n\t\tlet {typeColl, typeArr} = itemTags;\r\n\t\tlet midType = this.midTag.typeColl[typeId];\r\n\t\tlet type = typeColl[typeId];\r\n\t\tlet tag = midType.sub.find(v => v.id === tagId);\r\n\t\tif (type === undefined) {\r\n\t\t\ttype = observable.object({id:midType.id, name:midType.name, sub:[tag], parent:undefined});\r\n\t\t\ttypeColl[typeId] = type;\r\n\t\t\ttypeArr.push(type);\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttype.sub.push(tag);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate delTag(itemTags:ItemTags<T>, typeId:number, tagId:number) {\r\n\t\tlet {typeColl, typeArr} = itemTags;\r\n\t\tlet type = typeColl[typeId];\r\n\t\tif (type === undefined) return;\r\n\t\tlet {sub} = type;\r\n\t\tlet index = sub.findIndex(v => v.id === tagId);\r\n\t\tif (index < 0) return;\r\n\t\tsub.splice(index, 1);\r\n\t\tif (sub.length === 0) {\r\n\t\t\tlet typeIndex = typeArr.findIndex(v => v.id === type.id);\r\n\t\t\tif (typeIndex >= 0) typeArr.splice(typeIndex, 1);\r\n\t\t\tdelete typeColl[typeId];\r\n\t\t}\r\n\t}\r\n\r\n\tonTagSelectChanged = async (itemTags:ItemTags<T>, tag:Tag, selected:boolean) => {\r\n\t\tlet {item} = itemTags;\r\n\t\tlet {id:itemId} = item;\r\n\t\tlet {id, parent} = tag;\r\n\t\tlet ix:IXBase = {ix:undefined, id};\r\n\t\tlet acts:{[name:string]: IXBase[]} = {};\r\n\t\tacts[this.midTag.tag.name] = [ix];\r\n\t\tif (selected === true) {\r\n\t\t\tix.id = itemId;\r\n\t\t\tawait this.uq.Acts(acts);\r\n\t\t\tthis.addTag(itemTags, parent, id);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tix.id = -itemId;\r\n\t\t\tawait this.uq.Acts(acts);\r\n\t\t\tthis.delTag(itemTags, parent, id);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass ItemTagsListPageItems<T extends IDBase> extends ListPageItems<ItemTags<T>> {\r\n\titemId(item:ItemTags<T>):number {return item.item.id}\r\n\tnewItem(id:number, itemTags:ItemTags<T>):ItemTags<T> {\r\n\t\tlet {item, typeArr, typeColl} = itemTags;\r\n\t\treturn {\r\n\t\t\titem: {...item, id},\r\n\t\t\ttypeArr,\r\n\t\t\ttypeColl,\r\n\t\t}\r\n\t}\r\n\tupdate(item: ItemTags<T>):Promise<void> {\r\n\t\treturn;\r\n\t}\r\n}\r\n","import { LMR, VPage } from \"tonva-react\";\r\nimport { CTagIDList } from \"./CTagIDList\";\r\nimport { Tag } from \"./MidTag\";\r\n\r\nexport class VTags extends VPage<CTagIDList<any>> {\r\n\tprivate tags: Tag[] = [];\r\n\r\n\theader() {return 'tags'}\r\n\tcontent() {\r\n\t\tlet {midTag} = this.controller;\r\n\t\tlet {typeArr} = midTag;\r\n\t\tlet left = <button className=\"btn btn-primary\" \r\n\t\t\tonClick={() => this.controller.showID(this.tags)}>\r\n\t\t\t查看\r\n\t\t</button>;\r\n\t\tlet right = <>\r\n\t\t\t<button className=\"btn btn-sm btn-outline-primary mr-3\" onClick={()=>this.allTags(true)}>全选</button>\r\n\t\t\t<button className=\"btn btn-sm btn-outline-info\" onClick={()=>this.allTags(false)}>全清</button>\r\n\t\t</>;\r\n\t\treturn <div className=\"px-3\" id=\"$all$tags$\">\r\n\t\t\t{typeArr.map(v => this.renderType(v))}\r\n\t\t\t<div className=\"border-top py-3\">\r\n\t\t\t\t<LMR left={left} right={right} />\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate allTags = (selected:boolean) => {\r\n\t\tlet el = document.getElementById('$all$tags$');\r\n\t\tlet checkInputs = el.getElementsByTagName('input');\r\n\t\tfor (let i=0; i<checkInputs.length; i++) {\r\n\t\t\tlet checkInput = checkInputs[i];\r\n\t\t\tcheckInput.checked = selected;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate renderType(type: Tag) {\r\n\t\tlet {id, name, sub}  = type;\r\n\t\treturn <div key={id} className=\"my-3\">\r\n\t\t\t<div><b>{name}</b></div>\r\n\t\t\t<div className=\"form-check form-check-inline mt-1\">\r\n\t\t\t{sub.map(v => {\r\n\t\t\t\tlet {id, name} = v;\r\n\t\t\t\treturn <>\r\n\t\t\t\t\t<label key={id} className=\"form-check-label mr-3\">\r\n\t\t\t\t\t<input type=\"checkbox\" className=\"form-check-input\"\r\n\t\t\t\t\t\tonChange={(evt) => this.onTagSelectChanged(evt, v)}\r\n\t\t\t\t\t\t />\r\n\t\t\t\t\t{name}</label>\r\n\t\t\t\t</>\r\n\t\t\t})}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t}\r\n\r\n\tprivate onTagSelectChanged(evt: React.ChangeEvent<HTMLInputElement>, tag:Tag) {\r\n\t\tif (evt.currentTarget.checked === true) {\r\n\t\t\tthis.tags.push(tag);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet index = this.tags.findIndex(v => v === tag);\r\n\t\t\tif (index >= 0) this.tags.splice(index, 1);\r\n\t\t}\r\n\t}\r\n}\r\n","import { Controller } from \"tonva-react\";\r\nimport { IDBase } from \"../base\";\r\nimport { listRight } from \"../tools\";\r\nimport { CList } from \"../list\";\r\nimport { MidTag, Tag } from \"./MidTag\";\r\nimport { CID, MidID, MidIDList } from \"../ID\";\r\nimport { VTags } from \"./VTags\";\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nexport class CTagIDList<T extends IDBase> extends  Controller {\r\n\treadonly midTag: MidTag;\r\n\tconstructor(midTag: MidTag) {\r\n\t\tsuper();\r\n\t\tthis.setRes(midTag.res);\r\n\t\tthis.midTag = midTag;\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tawait this.midTag.init();\r\n\t\tthis.openVPage(VTags);\r\n\t}\r\n\r\n\tasync showID(tags: Tag[]) {\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\tlet midIDList: MidTagIDList<T> = new MidTagIDList<any>(\r\n\t\t\tthis.midTag, tags.map(v => v.id)\r\n\t\t);\r\n\t\tlet cShowTagIDList = new CShowTagIDList(midIDList);\r\n\t\tawait cShowTagIDList.start();\r\n\t}\r\n}\r\n\r\nclass CShowTagIDList<T extends IDBase> extends CList<T> {\r\n\tprotected midIDList: MidTagIDList<T>;\r\n\tconstructor(midIDList: MidTagIDList<T>) {\r\n\t\tsuper(midIDList);\r\n\t\tthis.midIDList = midIDList;\r\n\t}\r\n\r\n\tasync beforeStart():Promise<boolean> {\r\n\t\tawait this.midIDList.midTag.init();\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprotected async onItemClick(item:any):Promise<void> {\r\n\t\tlet {midTag} = this.midIDList;\r\n\t\tlet mid = new MidID(midTag.uq, {ID: midTag.ID});\r\n\t\tawait mid.init();\r\n\t\tlet cID = new CID(mid);\r\n\t\tcID.onItemClick(item);\r\n\t\t//let cSelect = new CSelect(this, item, midTag, this.res);\r\n\t\t//cSelect.start();\r\n\t}\r\n\t\r\n\r\n\tprotected renderRight():JSX.Element {\r\n\t\tlet {onRightClick, renderRight} = this.midIDList;\r\n\t\tif (!onRightClick) return null;\r\n\t\treturn (renderRight ?? listRight)(onRightClick);\r\n\t}\r\n\r\n\tprotected renderItem(item:T, index:number):JSX.Element {\r\n\t\tlet {midTag, renderItem} = this.midIDList;\r\n\t\tlet {ID} = midTag;\r\n\t\t//let {item, typeArr} = itemTags;\r\n\t\treturn (renderItem ??  ID.render)(item, index);\r\n\t\t//return renderItemTags(this.props, itemTags, index);\r\n\t}\r\n}\r\n\r\nexport class MidTagIDList<T extends IDBase> extends MidIDList<T> {\r\n\treadonly midTag: MidTag;\r\n\treadonly ids: number[];\r\n\tconstructor(midTag:MidTag, ids:number[]) {\r\n\t\tlet {uq, ID} = midTag;\r\n\t\tsuper(uq, ID);\r\n\t\tthis.ids = ids;\r\n\t}\r\n \r\n\tasync init() {\r\n\t\tawait this.midTag.IX.loadSchema();\r\n\t}\r\n\r\n\tprotected async loadPageItems(pageStart:any, pageSize:number):Promise<T[]> {\r\n\t\tlet result = await this.uq.IXr<T>({\r\n\t\t\tIX: this.midTag.IX,\r\n\t\t\tIDX: [this.ID],\r\n\t\t\tix: this.ids,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n}\r\n","export const consts = {\r\n    uqBasedata: \"bruce/mi\",\r\n    appIcon: 'https://tv.jkchemical.com/imgs/Bear-icon.png',\r\n    miApiHost: 'https://mi.jjol.cn/',\r\n    miApiHostDebug: 'http://localhost:6011/',\r\n}\r\n","import {FetchError} from './fetchError';\r\nimport {HttpChannelUI} from './httpChannelUI';\r\nimport {env, nav} from 'tonva-react';\r\nimport { consts } from './consts';\r\n\r\nexport async function httpGet(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(url, undefined, undefined);\r\n    let ret = await channel.get('', params);\r\n    return ret;\r\n}\r\n\r\nexport async function httpPost(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(url, undefined, undefined);\r\n    let ret = await channel.post('', params);\r\n    return ret;\r\n}\r\n\r\nexport class HttpChannel {\r\n    private hostUrl: string;\r\n    private apiToken: string;\r\n    private ui?: HttpChannelUI;\r\n    private timeout: number;\r\n\r\n    constructor(hostUrl: string, apiToken:string, ui?: HttpChannelUI) {\r\n        this.hostUrl = hostUrl;\r\n        this.apiToken = apiToken;\r\n        this.ui = ui;\r\n        this.timeout = env.isDevelopment === true? 500000:20000;\r\n    }\r\n\r\n    private startWait = () => {\r\n        if (this.ui !== undefined) this.ui.startWait();\r\n    }\r\n\r\n    private endWait = (url?:string, reject?:(reason?:any)=>void) => {\r\n        if (this.ui !== undefined) this.ui.endWait();\r\n        if (reject !== undefined) reject('访问webapi超时 ' + url);\r\n    }\r\n\r\n    private showError = async (error:FetchError) => {\r\n        if (this.ui !== undefined) await this.ui.showError(error);\r\n    }\r\n\r\n    used() {\r\n        this.post('', {});\r\n    }\r\n\r\n    async get(url: string, params: any = undefined): Promise<any> {\r\n        if (params) {\r\n            let keys = Object.keys(params);\r\n            if (keys.length > 0) {\r\n                let c = '?';\r\n                for (let k of keys) {\r\n                    let v = params[k];\r\n                    if (v === undefined) continue;\r\n                    url += c + k + '=' + params[k];\r\n                    c = '&';\r\n                }\r\n            }\r\n        }\r\n        let options = this.buildOptions();\r\n        options.method = 'GET';\r\n        return await this.innerFetch(url, options);\r\n    }\r\n\r\n    async post(url: string, params: any): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'POST';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetch(url, options);\r\n    }\r\n\r\n    async put(url: string, params: any): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'PUT';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetch(url, options);\r\n    }\r\n\r\n    async delete(url: string, params: any): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'DELETE';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetch(url, options);\r\n    }\r\n    async fetch(url: string, options: any, resolve:(value?:any)=>any, reject:(reason?:any)=>void):Promise<void> {\r\n        let that = this;\r\n        this.startWait();\r\n        let path = url;\r\n        function buildError(err: string) {\r\n            return {\r\n                channel: that,\r\n                url: path,\r\n                options: options,\r\n                resolve: resolve,\r\n                reject: reject,\r\n                error: err,\r\n            }\r\n        }\r\n        try {\r\n            console.log('%s %s', options.method, path);\r\n            let timeOutHandler = setTimeout(() => that.endWait(url, reject), this.timeout);\r\n            let res = await fetch(encodeURI(path), options);\r\n            if (res.ok === false) {\r\n                clearTimeout(timeOutHandler);\r\n                that.endWait();\r\n                console.log('call error %s', res.statusText);\r\n                throw res.statusText;\r\n            }\r\n            let ct = res.headers.get('content-type');\r\n            if (ct && ct.indexOf('json')>=0) {\r\n                return res.json().then(async retJson => {\r\n                    clearTimeout(timeOutHandler);\r\n                    that.endWait();\r\n                    if (retJson.ok === true) {\r\n                        return resolve(retJson.res);\r\n                    }\r\n                    if (retJson.error === undefined) {\r\n                        await that.showError(buildError('not valid tonva json'));\r\n                    }\r\n                    else {\r\n                        await that.showError(buildError(retJson.error));\r\n                        reject(retJson.error);\r\n                    }\r\n                    //throw retJson.error;\r\n                }).catch(async error => {\r\n                    await that.showError(buildError(error.message));\r\n                });\r\n            }\r\n            else {\r\n                let text = await res.text();\r\n                clearTimeout(timeOutHandler);\r\n                that.endWait();\r\n                resolve(text);\r\n            }\r\n        }\r\n        catch(error) {\r\n            if (typeof error === 'string') {\r\n                if (error.toLowerCase().startsWith('unauthorized') === true) {\r\n                    nav.logout();\r\n                    return;\r\n                }\r\n            }\r\n            await this.showError(buildError(error.message));\r\n        };\r\n    }\r\n\r\n    private async innerFetch(url: string, options: any): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, resolve, reject);\r\n        });\r\n    }\r\n\r\n    async callFetch(url:string, method:string, body:any):Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = method;\r\n        options.body = body;\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(url, options, resolve, reject);\r\n        });\r\n    }\r\n\r\n    private buildOptions(): any {\r\n        let {language, culture} = nav;\r\n        let headers = new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n        headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n        headers.append('Accept-Language', lang);\r\n        if (this.apiToken) { \r\n            headers.append('Authorization', this.apiToken); \r\n        }\r\n        let options = {\r\n            headers: headers,\r\n            // cache: 'no-cache',\r\n        };\r\n        return options;\r\n    }\r\n}\r\n","import {nav} from 'tonva-react';\r\n\r\nexport interface HttpChannelUI {\r\n    startWait():void;\r\n    endWait():void;\r\n    showError(error:any):Promise<void>;\r\n}\r\n\r\nexport class HttpChannelNavUI implements HttpChannelUI {\r\n    startWait() {\r\n        nav.startWait();\r\n    }\r\n    endWait() {\r\n        nav.endWait();\r\n    }\r\n    async showError(error:any):Promise<void> {\r\n        nav.endWait();\r\n        /*\r\n        if (error.name === 'SyntaxError') {\r\n            error = {\r\n                name: error.name,\r\n                message: error.message,\r\n            }\r\n        }*/\r\n        await nav.onError(error);\r\n    }\r\n}\r\n\r\n","//import {isDevelopment} from '../local';\r\nimport {HttpChannel} from './httpChannel';\r\n\r\nexport async function refetchApi(channel:HttpChannel, url:any, options:any, resolve:any, reject:any) {\r\n    await channel.fetch(url, options, resolve, reject);\r\n}\r\n\r\nexport abstract class ApiBase {\r\n    protected token: string;\r\n    protected path: string;\r\n    protected showWaiting: boolean;\r\n\r\n    constructor(path: string, showWaiting: boolean) {\r\n        this.path = path || '';\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    protected abstract getHttpChannel(): Promise<HttpChannel>;\r\n\r\n    public async call(url:string, method:string, body:any):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.callFetch(url, method, body);\r\n    }\r\n\r\n    public async get(path:string, params:any=undefined): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.get(this.path + path, params);\r\n    }\r\n\r\n    public async post(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.post(this.path + path, params);\r\n    }\r\n\r\n    public async put(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.put(this.path + path, params);\r\n    }\r\n\r\n    public async delete(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.delete(this.path + path, params);\r\n    }\r\n}\r\n","import _ from 'lodash';\r\nimport { HttpChannel } from './httpChannel';\r\nimport { HttpChannelNavUI } from './httpChannelUI';\r\nimport { ApiBase } from './apiBase';\r\n\r\nlet channelUIs: { [name: string]: HttpChannel } = {};\r\nlet channelNoUIs: { [name: string]: HttpChannel } = {};\r\n\r\nclass MiApiChannel extends ApiBase {\r\n\tprivate apiName: string;\r\n\turl: string;\r\n\r\n\tconstructor(url: string, basePath: string, apiName: string, uqToken: string, showWaiting?: boolean) {\r\n\t\tsuper(basePath, showWaiting);\r\n\t\tthis.showWaiting = showWaiting;\r\n\t\tthis.apiName = apiName;\r\n\t\tthis.token = uqToken;\r\n\t\tthis.url = url;\r\n\t}\r\n\r\n\tprotected async getHttpChannel(): Promise<HttpChannel> {\r\n\t\tlet channels: { [name: string]: HttpChannel };\r\n\t\tlet channelUI: HttpChannelNavUI;\r\n\t\tif (this.showWaiting === true || this.showWaiting === undefined) {\r\n\t\t\tchannels = channelUIs;\r\n\t\t\tchannelUI = new HttpChannelNavUI();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tchannels = channelNoUIs;\r\n\t\t}\r\n\t\tlet channel = channels[this.apiName];\r\n\t\tif (channel !== undefined) return channel;\r\n\t\tchannel = new HttpChannel(this.url, this.token, channelUI);\r\n\t\treturn channels[this.apiName] = channel;\r\n\t}\r\n}\r\n\r\nexport class MiApi {\r\n\tprivate channel: MiApiChannel;\r\n\r\n\tconstructor(url: string, basePath: string, apiName: string, uqToken: string, showWaiting?: boolean) {\r\n\t\tthis.channel = new MiApiChannel(url, basePath, apiName, uqToken, showWaiting);\r\n\t}\r\n\r\n\tasync call(name: string, params: any[]): Promise<any> {\r\n\t\tlet pbody = { call: name, params: params };\r\n\t\treturn await this.channel.post('sql/call', pbody);\r\n\t}\r\n\r\n\tasync query(name: string, params: any[]): Promise<any> {\r\n\t\tlet pbody = { call: name, params: params };\r\n\t\treturn await this.channel.post('sql/call', pbody);\r\n\t}\r\n\r\n\tasync page(name: string, params: any[], pageStart: number, pageSize: number): Promise<any> {\r\n\t\tlet p: any[];\r\n\t\tswitch (typeof params) {\r\n\t\t\tcase 'undefined': p = []; break;\r\n\t\t\tdefault: p = _.clone(params); break;\r\n\t\t}\r\n\t\tp.push(pageStart);\r\n\t\tp.push(pageSize);\r\n\t\tlet pbody = { call: name, params: p };\r\n\t\treturn await this.channel.post('sql/call', pbody);\r\n\t}\r\n\r\n\tasync process(proc: any, params: any[]): Promise<any> {\r\n\t\tlet pbody = { proc: proc, params: params };\r\n\t\treturn await this.channel.post('sql/query', pbody);\r\n\t}\r\n}\r\n","import { consts } from \"stockinfo/net/consts\";\r\nimport { User } from \"tonva-react\";\r\nimport { MiApi } from \"./miApi\";\r\n\r\nexport class MiNet {\r\n\tprivate miApi: MiApi;\r\n\tprivate user: User;\r\n\r\n\tconstructor(user: User) {\r\n\t\tlet miHost = consts.miApiHost;\r\n\t\tif (document.baseURI.indexOf('localmiserver') > 0) {\r\n\t\t\tmiHost = consts.miApiHostDebug;\r\n\t\t}\r\n\t\tthis.user = user;\r\n\t\tthis.miApi = new MiApi(miHost, 'miscan/', 'miapi', user.token, false);\r\n\t}\r\n\r\n\tget userId():number {return this.user.id;}\r\n\r\n\tasync process(proc:any, params:any[]) {\r\n\t\treturn await this.miApi.process(proc, params);\r\n\t}\r\n\r\n\tasync q_marketpe(param:any):Promise<{day:number, pe:number, e:number}[]> {\r\n\t\tlet rets = await this.miApi.query('q_marketpe', param) as {day:number, pe:number, e:number}[];\r\n\t\treturn rets;\r\n\t}\r\n\r\n\tasync t_toppredictavg$query(day:any):Promise<any[]> {\r\n\t\tlet ret = await this.miApi.call('t_toppredictavg$query', [day]);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync q_stocks$page(p:any, pageStart:any, pageSize:any):Promise<any> {\r\n\t\tlet ret = await this.miApi.page('q_stocks$page', p, pageStart, pageSize);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync q_stockallinfo(id:any, day:any) {\r\n\t\treturn this.miApi.query('q_stockallinfo', [id, day]);\r\n\t}\r\n\r\n\tasync t_tagstock$query(tagId:any, id:any) {\r\n\t\treturn this.miApi.query('t_tagstock$query', [this.user.id, tagId, id]) //this.uqs.mi.TagStock.query({ user: nav.user.id, stock: id })\r\n\t}\r\n\r\n\tasync t_tag$all() {\r\n\t\treturn await this.miApi.query('t_tag$all', [this.user.id]);\r\n\t}\r\n\r\n\tasync t_tag$save(name:string) {\r\n\t\treturn await this.miApi.call('t_tag$save', [this.user.id, undefined, name]);\r\n\t}\r\n\r\n\tasync t_tagstock$add(tagId:any, baseId:any) {\r\n\t\treturn await this.miApi.call('t_tagstock$add', [this.user.id, tagId, baseId]); //.uqs.mi.TagStock.add(param);\r\n\t}\r\n\r\n\tasync t_tagstock$del(tagId:any, baseId:any) {\r\n\t\treturn await this.miApi.call('t_tagstock$del', [this.user.id, tagId, baseId]); // //await this.uqs.mi.TagStock.del(param);\r\n\t}\r\n\r\n\tasync t_stockwarning$all() {\r\n\t\treturn await this.miApi.call('t_stockwarning$all', [this.user.id]);//await this.uqs.mi.StockWarningAll.query(undefined);\r\n\t}\r\n\r\n\tasync t_stockwarning$add(id:any, type:any, price:any) {\r\n\t\treturn await this.miApi.call('t_stockwarning$add', [this.user.id, id, type, price]);\r\n\t}\r\n\r\n\tasync t_usersettings$save(v:string) {\r\n\t\treturn await this.miApi.call('t_usersettings$save', [this.user.id, 'config', v]);\r\n\t}\r\n\r\n\tasync t_usersettings$query() {\r\n\t\treturn await this.miApi.query('t_usersettings$query', [this.user.id, 'config']);\r\n\t}\r\n\r\n\t// async t_allaccounts() {\r\n\t// \treturn await this.miApi.query('t_allaccounts', [this.user.id]);\r\n\t// }\r\n\r\n\tasync q_getlasttradeday() {\r\n\t\treturn await this.miApi.call('q_getlasttradeday', []);\r\n\t}\r\n}\r\n","/*eslint @typescript-eslint/no-unused-vars: [\"off\", { \"vars\": \"all\" }]*/\r\nimport { observable, IObservableArray, computed, makeObservable } from 'mobx';\r\nimport { CUqBase } from \"../uq-app\";\r\nimport { GFunc } from './GFunc';\r\nimport { VStockInfo } from './VStockInfo'\r\nimport { NStockInfo, StockPrice, StockCapitalearning, StockBonus, StockDivideInfo } from './StockInfoType';\r\nimport { Stock, StockValue } from 'uq-app/uqs/BruceYuMi';\r\nimport { ErForEarning } from './ErForEarning';\r\nimport { SlrForEarning } from './SlrForEarning';\r\nimport { MiNet } from './net';\r\n\r\nexport class CStockInfo extends CUqBase {\r\n\tstock: Stock & StockValue;\r\n    @observable baseItem: NStockInfo;\r\n    @observable protected loaded: boolean = false;\r\n\r\n    @observable price: StockPrice;\r\n    //@observable roe: StockRoe;\r\n    //@observable tags: any[] = undefined;\r\n    @observable stockTags: any[];\r\n    selectedTags: any[];\r\n\r\n    protected exrightForEarning: { day: number, factor: number }[] = [];\r\n    protected exrightInfo: { day: number, bonus: number, factor: number, factore: number }[] = [];\r\n    @observable seasonData: { season: number, c: number, e: number, esum: number, corg: number, eorg: number, esumorg: number }[] = [];\r\n    @observable predictSeasonData: { season: number, c: number, e: number, esum: number, corg: number, eorg: number, esumorg: number }[] = [];\r\n    @observable predictSeasonDataFull: { season: number, c: number, e: number, esum: number, corg: number, eorg: number, esumorg: number }[] = [];\r\n    @observable predictData: { e: number, b: number, r2: number, epre: number, l: number, lr2: number, lpre: number };\r\n    @observable ypredict: number[] = [];\r\n    // @observable historyData:{day:number, price:number, ttm:number}[] =  [];\r\n    // protected historyDataOrg:{day:number, price:number, dayno:number}[] = [];\r\n\r\n    //protected _earning: IObservableArray<StockEarning> = observable.array<StockEarning>([], { deep: true });\r\n    protected _capitalearning: IObservableArray<StockCapitalearning> = observable.array<StockCapitalearning>([], { deep: true });\r\n    protected _bonus: IObservableArray<StockBonus> = observable.array<StockBonus>([], { deep: true });\r\n    protected _divideInfo: IObservableArray<StockDivideInfo> = observable.array<StockDivideInfo>([], { deep: true });\r\n\r\n    @computed get capitalearning(): IObservableArray<StockCapitalearning> {\r\n        if (this.loaded === false) return undefined;\r\n        return this._capitalearning;\r\n    }\r\n\r\n    @computed get bonus(): IObservableArray<StockBonus> {\r\n        if (this.loaded === false) return undefined;\r\n        return this._bonus;\r\n    }\r\n\r\n    @computed get divideInfo(): IObservableArray<StockDivideInfo> {\r\n        if (this.loaded === false) return undefined;\r\n        return this._divideInfo;\r\n    }\r\n\r\n\tprivate miNet: MiNet;\r\n    constructor(cApp: any) {\r\n        super(cApp);\r\n        makeObservable(this);\r\n\t\tthis.miNet = new MiNet(this.user);\r\n    }\r\n    initLoad = () => {\r\n        this.load();\r\n    }\r\n\r\n    private load = async () => {\r\n        if (!this.baseItem) return;\r\n\r\n        let { id, day,  } = this.baseItem;\r\n        let rets = await Promise.all([\r\n            this.miNet.q_stockallinfo(id, day),\r\n            this.miNet.t_tagstock$query(undefined, id),\r\n        ]);\r\n        this.stockTags = rets[1];\r\n        let ret = rets[0];\r\n        if (Array.isArray(ret[0])) {\r\n            let arr1 = ret[1];\r\n            if (Array.isArray(arr1)) {\r\n                this.price = arr1[0];\r\n            }\r\n\r\n            this._bonus.clear();\r\n            this._divideInfo.clear();\r\n            this._capitalearning.clear();\r\n            let arr3 = ret[3];\r\n            if (Array.isArray(arr3)) {\r\n                this._divideInfo.push(...arr3);\r\n                let barr = arr3.filter((v: any) =>　{\r\n                    return v.派息 as number > 0;\r\n                }).map((v: any) => {\r\n                    return {day:v.day, bonus:v.派息};\r\n                })\r\n                this._bonus.push(...barr);\r\n            }\r\n\r\n            await this.loadTTMEarning(ret[2]);\r\n        }\r\n\r\n        //this.isMySelect = this.cApp.store.isMyAll(this.stock);\r\n        this.loaded = true;\r\n    }\r\n\r\n    protected async loadTTMEarning(list: { seasonno: number, capital: number, earning: number, es: number, shares: number }[]) {\r\n        this.seasonData.splice(0);\r\n        let seasonlist: { [index: number]: { season: number, c: number, e: number, esum: number, corg: number, eorg: number, esumorg: number } } = {};\r\n        let len = list.length;\r\n        if (len <= 0) return;\r\n        let minNo = list[len - 1].seasonno;\r\n        let lastItem = list[0];\r\n        let lastShares = lastItem.shares;\r\n        let maxNo = lastItem.seasonno;\r\n\r\n        for (let item of list) {\r\n            let no = item.seasonno;\r\n            let sItem = {\r\n                season: no, c: item.capital * item.shares / lastShares, e: item.es * item.shares / lastShares, esum: item.earning * item.shares / lastShares,\r\n                corg: item.capital, eorg: item.es, esumorg: item.earning\r\n            }\r\n            seasonlist[no] = sItem;\r\n\r\n            let yearmonth = GFunc.GetSeasonnoYearMonth(no);\r\n            if (yearmonth.month === 12) {\r\n                let ci = {year: yearmonth.year, capital: item.capital, earning: item.earning };\r\n                this._capitalearning.push(ci);\r\n            }\r\n        }\r\n\r\n        let i = 0;\r\n        for (let seasonno = minNo; seasonno <= maxNo; ++seasonno, ++i) {\r\n            let si = seasonlist[seasonno];\r\n            if (si === undefined) {\r\n                continue;\r\n            }\r\n            this.seasonData.splice(0, 0, si);\r\n        }\r\n\r\n        let noBegin = maxNo - 19;\r\n        this.predictData = undefined;\r\n        this.predictSeasonData.splice(0);\r\n        this.predictSeasonDataFull.splice(0);\r\n        if (noBegin < minNo) return;\r\n        noBegin += 3;\r\n        this.ypredict = [];\r\n        for (let x = noBegin; x <= maxNo; x += 4) {\r\n            let item = seasonlist[x];\r\n            if (item === undefined) break;\r\n            this.predictSeasonData.splice(0, 0, item);\r\n            this.ypredict.push(item.esum);\r\n        }\r\n\r\n        for (let x = maxNo; x >= minNo; x -= 4) {\r\n            let item = seasonlist[x];\r\n            if (item === undefined) break;\r\n            this.predictSeasonDataFull.push(item);\r\n        }\r\n\r\n        if (this.ypredict.length === 5) {\r\n            let er = new ErForEarning(this.ypredict);\r\n            let lr = new SlrForEarning(this.ypredict);\r\n            this.predictData = { e: this.ypredict[4], b: er.B, r2: er.r2, epre: er.predict(4), l: lr.slopeR, lr2: lr.r2, lpre: lr.predict(4) };\r\n        }\r\n        else {\r\n            this.predictSeasonData.splice(0);\r\n        }\r\n    }\r\n\r\n    protected ExrightEarning(endDay: number, season: number, item: { c: number, e: number, esum: number }) {\r\n        let { end } = GFunc.SeasonnoToBeginEnd(season);\r\n        for (let i = 0; i < this.exrightForEarning.length; ++i) {\r\n            let exitem = this.exrightForEarning[i];\r\n            let day = exitem.day;\r\n            if (day > endDay) break;\r\n            if (day < end) continue;\r\n            let factor = exitem.factor;\r\n            item.c = item.c * factor;\r\n            item.e = item.e * factor;\r\n            item.esum = item.esum * factor;\r\n        }\r\n    }\r\n\r\n    // loadHistoryData(showAll: boolean) {\r\n    //     let list = this.historyDataOrg;\r\n    //     let length = list.length;\r\n    //     if (length <= 10) {\r\n    //         this.historyData = [];\r\n    //         return;\r\n    //     }\r\n\r\n    //     if (!showAll) {\r\n    //         let day = this.baseItem.day;\r\n    //         if (day !== undefined) {\r\n    //             let i = length - 1;\r\n    //             for (; i >= 0; --i) {\r\n    //                 let item = list[i];\r\n    //                 if (item.day <= day) break;\r\n    //             }\r\n    //             length = i + 1;\r\n    //         }\r\n    //     }\r\n    //     let endIndex = length - 1;\r\n    //     let lastItem = list[endIndex];\r\n    //     let lastdayno = lastItem.dayno;\r\n    //     if (lastdayno === undefined) {\r\n    //         while (endIndex > 0) {\r\n    //             --endIndex;\r\n    //             lastItem = list[endIndex];\r\n    //             lastdayno = lastItem.dayno;\r\n    //             if (lastdayno !== undefined) break;\r\n    //         }\r\n    //     }\r\n    //     let lastDay = lastItem.day;\r\n    //     let not = lastdayno % 5;\r\n    //     let historyList: any[] = [];\r\n    //     for (let i = 0; i <= endIndex; ++i) {\r\n    //         let { day, price, dayno } = list[i];\r\n    //         if (dayno % 5 === not) {\r\n    //             historyList.push({ day: day, price: this.RestorePrice(price, day, lastDay), ttm: this.CalculateHistoryPE(price, day) });\r\n    //         }\r\n    //     }\r\n    //     this.historyData = historyList;\r\n    // }\r\n\r\n    RestorePrice(price: number, dayFrom: number, dayIndex: number) {\r\n        let bsum = 0;\r\n        let pricere = price;\r\n        if (dayFrom < dayIndex) {\r\n            for (let i = 0; i < this.exrightInfo.length; ++i) {\r\n                let { day, bonus, factor, factore } = this.exrightInfo[i];\r\n                if (day <= dayFrom)\r\n                    continue;\r\n                if (day > dayIndex)\r\n                    break;\r\n                pricere = pricere * factor;\r\n                bsum = (bsum + bonus) * factore;\r\n            }\r\n            pricere = pricere - bsum;\r\n        }\r\n        else {\r\n            for (let i = 0; i < this.exrightInfo.length; ++i) {\r\n                let { day, bonus, factor, factore } = this.exrightInfo[i];\r\n                if (day <= dayIndex)\r\n                    continue;\r\n                if (day > dayFrom)\r\n                    break;\r\n                pricere = pricere / factor;\r\n                bsum = bsum / factore + bonus;\r\n            }\r\n            pricere = pricere + bsum;\r\n        }\r\n        return pricere;\r\n    }\r\n\r\n    CalculateHistoryPE(price: number, day: number) {\r\n        let season = GFunc.SeasonnoFromDay(day);\r\n        let len = this.seasonData.length;\r\n        for (let i = 0; i < len; ++i) {\r\n            let item = this.seasonData[i];\r\n            if (item.season >= season) continue;\r\n            if (item.esumorg === undefined) return undefined;\r\n            let { end } = GFunc.SeasonnoToBeginEnd(item.season);\r\n            let pricere = this.RestorePrice(price, day, end);\r\n            return pricere / item.esumorg;\r\n        }\r\n\r\n        return undefined;\r\n    }\r\n\r\n    async internalStart(param: any) {\r\n        this.baseItem = param as NStockInfo;\r\n\t\tthis.stock = param.stock;\r\n        let { id } = this.baseItem;\r\n        //this.isMySelect = this.cApp.store.isMyAll(this.stock);\r\n        this.initLoad();\r\n        this.openVPage(VStockInfo);\r\n    }\r\n\r\n    openMetaView = () => {\r\n    }\r\n\r\n\t/*\r\n    onSelectTag = async () => {\r\n        //await this.loadTags();\r\n        this.selectedTags = this.cApp.store.stockGroups.getSelected(this.stockTags);\r\n        this.openVPage(VTags);\r\n    }\r\n\r\n    onNewTag = () => {\r\n        this.openVPage(VNewTag);\r\n    }\r\n\r\n    onEditTag = (param: any) => {\r\n        this.openVPage(VEditTag, param);\r\n    }\r\n\r\n    onSaveNewTag = async (data: any) => {\r\n        let { name } = data;\r\n        //let param = { id: undefined, name: name };\r\n        //let ret = await this.cApp.store.miApi.call('t_tag$save', [this.user.id, undefined, name]);\r\n        let ret = await this.miNet.t_tag$save(name);\r\n        let { retId } = ret;\r\n        if (retId < 0) {\r\n            alert(name + ' 已经被使用了');\r\n            return false;\r\n        }\r\n        this.cApp.store.stockGroups.add(\r\n            new StockGroup(name, name, this.miNet)\r\n        );\r\n        return true;\r\n    }\r\n\r\n    onSaveTag = async (data: any) => {\r\n        let { id, name } = data;\r\n        let { stockGroups } = this.cApp.store;\r\n        let param = { id: id, name: name };\r\n        let exists = stockGroups.exists(id, name);\r\n        if (exists === true) {\r\n            alert(name + ' 已经被使用了');\r\n            return false;\r\n        }\r\n        let ret = await this.miNet.t_tag$save(name);\r\n        let { retId } = ret;\r\n        if (retId === undefined || retId < 0) {\r\n            alert(name + ' 已经被使用了');\r\n            return false;\r\n        }\r\n        let group = stockGroups.groupFromId(id);\r\n        if (group) {\r\n            group.name = name;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    onClickSelectTag = async (tag: any, isSelected: boolean) => {\r\n        let param = {\r\n            user: nav.user.id,\r\n            tag: tag.id,\r\n            arr1: [\r\n                { stock: this.baseItem.id }\r\n            ]\r\n        };\r\n        if (isSelected === true) {\r\n            //let ret = await this.cApp.store.miApi.call('t_tagstock$add', [this.user.id, tag.id, this.baseItem.id]); //.uqs.mi.TagStock.add(param);\r\n            await this.cApp.store.addTagStock(this.baseItem as any);\r\n            //let ret = this.cApp.miNet.t_tagstock$add(tag.id, this.baseItem.id);\r\n            let newTag = {\r\n                tag: {\r\n                    id: tag.id,\r\n                }\r\n            }\r\n            this.stockTags.push(newTag);\r\n        }\r\n        else {\r\n            //let ret = await this.cApp.store.miApi.call('t_tagstock$del', [this.user.id, tag.id, this.baseItem.id]); // //await this.uqs.mi.TagStock.del(param);\r\n            //let ret = this.cApp.miNet.t_tagstock$del(tag.id, this.baseItem.id);\r\n            await this.cApp.store.removeTagStock(this.baseItem as any);\r\n            let i = this.stockTags.findIndex(v => v.tag.id === tag.id);\r\n            this.stockTags.splice(i, 1);\r\n        }\r\n    }\r\n\r\n    onClickDefaultTag = async (isSelected: boolean) => {\r\n        //let tagid = this.cApp.store.defaultListTagID;\r\n        let { store } = this.cApp;\r\n        let { id: groupId } = store.stockGroups.defaultGroup;\r\n        if (isSelected === true) {\r\n            //let ret = this.cApp.miNet.t_tagstock$add(tagid, this.baseItem.id);\r\n            await store.addTagStock(this.baseItem as any);\r\n            let newTag = {\r\n                tag: {\r\n                    id: store.stockGroups.defaultGroup.id,\r\n                }\r\n            }\r\n            this.stockTags.push(newTag);\r\n        }\r\n        else {\r\n            //let ret = await this.cApp.store.miApi.call('t_tagstock$del', [this.user.id, tagid, this.baseItem.id]); // //await this.uqs.mi.TagStock.del(param);\r\n            await this.cApp.store.removeTagStock(this.baseItem as any);\r\n            //let ret = this.cApp.miNet.t_tagstock$del(tagid, this.baseItem.id);\r\n            let i = this.stockTags.findIndex(v => v.tag.id === groupId);\r\n            this.stockTags.splice(i, 1);\r\n        }\r\n    }\r\n\t*/\r\n}\r\n","import { IDUI, Uq } from \"tonva-react\";\r\nimport { Detail, Master, Mid } from \"../base\";\r\n\r\nexport interface SheetUI {\r\n\tmaster: IDUI;\r\n\tdetail: IDUI;\r\n}\r\n\r\nexport class MidSheet<M extends Master, D extends Detail> extends Mid {\r\n\treadonly master: IDUI;\r\n\treadonly detail: IDUI;\r\n\r\n\tconstructor(uq:Uq, ui: SheetUI, res?:any) {\r\n\t\tsuper(uq, res);\r\n\t\tlet {master, detail} = ui;\r\n\t\tthis.master = master;\r\n\t\tthis.detail = detail;\r\n\t}\r\n\r\n\tasync init(): Promise<void> {\r\n\t}\r\n\r\n\tasync load(id:number):Promise<[M[],D[]]> {\r\n\t\treturn [[], []];\r\n\t}\r\n\r\n\tasync save(master:M, details:D[]):Promise<any> {\r\n\t\tlet ret = await this.uq.ActDetail({\r\n\t\t\tmaster: {\r\n\t\t\t\tID: this.master.ID,\r\n\t\t\t\tvalue: master,\r\n\t\t\t},\r\n\t\t\tdetail: {\r\n\t\t\t\tID: this.detail.ID,\r\n\t\t\t\tvalues: details,\r\n\t\t\t},\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n};\r\n","import { makeObservable, observable } from \"mobx\";\r\nimport { Context, Controller } from \"tonva-react\";\r\nimport { createPickId } from \"../select\";\r\nimport { CFormPage, FormUI } from \"../form\";\r\nimport { Detail, Master } from \"../base\";\r\nimport { MidSheet } from \"./MidSheet\";\r\n\r\nexport abstract class CSheet<M extends Master, D extends Detail> extends Controller {\r\n\treadonly midSheet: MidSheet<M, D>;\r\n\tid: number;\r\n\tmaster: M = null;\r\n\tdetails: D[] = [];\r\n\tdetail: D = null;\r\n\r\n\tconstructor(mid: MidSheet<M, D>) {\r\n\t\tsuper();\r\n\t\tmakeObservable(this, {\r\n\t\t\tmaster: observable,\r\n\t\t\tdetails: observable,\r\n\t\t});\r\n\t\tthis.setRes(mid.res);\r\n\t\tthis.midSheet = mid;\r\n\t}\r\n\r\n\tprotected async load(id:number) {\r\n\t\tthis.id = id;\r\n\t\tlet [master, details] = await this.midSheet.load(id);\r\n\t\tthis.master = master[0];\r\n\t\tthis.details = details;\r\n\t}\r\n\r\n\tasync saveSheet() {\r\n\t\tlet ret = await this.midSheet.save(this.master, this.details);\r\n\t\treturn ret;\r\n\t}\r\n\t\r\n\tafterMasterNew() {\r\n\r\n\t}\r\n\r\n\tprivate serial:number = 1;\r\n\teditDetail = async (detail: D) => {\r\n\t\tlet {uq, detail:detailFormUI} = this.midSheet;\r\n\t\tlet {ID, fieldCustoms} = detailFormUI;\r\n\t\tlet uiForm = new FormUI(ID.ui, fieldCustoms);\r\n\t\tif (fieldCustoms) {\r\n\t\t\tfor (let i in fieldCustoms) {\r\n\t\t\t\tlet field = fieldCustoms[i];\r\n\t\t\t\tlet {ID} = field;\r\n\t\t\t\tif (ID) {\r\n\t\t\t\t\tuiForm.setIDUi(i, createPickId(uq, ID), ID.render);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tuiForm.hideField('master', 'row');\r\n\t\tlet cForm = new CFormPage(uiForm, detail);\r\n\t\tcForm.onSubmit = async (name:string, context: Context) => {\r\n\t\t\tlet values = context.data;\r\n\t\t\tlet serial = values['#'];\r\n\t\t\tif (!serial) {\r\n\t\t\t\tvalues['#'] = this.serial++;\r\n\t\t\t\tthis.details.push(values);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet index = this.details.findIndex(v => (v as any)['#'] === serial);\r\n\t\t\t\tif (index >= 0) {\r\n\t\t\t\t\tObject.assign(this.details[index], values);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.closePage();\r\n\t\t\tif (detail === undefined) {\r\n\t\t\t\tlet cForm = new CFormPage(uiForm, detail);\r\n\t\t\t\tawait cForm.start();\r\n\t\t\t}\r\n\t\t}\r\n\t\tawait cForm.start();\r\n\t}\r\n}\r\n","import { FA, List, LMR, Page, VPage } from \"tonva-react\";\r\nimport { CSheet } from \"./CSheet\";\r\n\r\nexport class VSheetEdit extends VPage<CSheet<any, any>> {\r\n\theader() {return 'sheet';}\r\n\tright() {\r\n\t\treturn <button className=\"btn btn-primary btn-sm mr-2\"\r\n\t\t\tonClick={this.saveSheet}>\r\n\t\t\t整单完成\r\n\t\t</button>;\r\n\t}\r\n\tcontent() {\r\n\t\tlet {midSheet: mid, master, details} = this.controller;\r\n\t\tlet {ID} = mid.master;\r\n\t\tlet right = <button className=\"btn btn-success btn-sm\"\r\n\t\t\tonClick={() => this.controller.editDetail(undefined)}>\r\n\t\t\t<FA name=\"plus\" />\r\n\t\t</button>;\r\n\t\treturn <div className=\"my-3\">\r\n\t\t\t<div className=\"p-3\">\r\n\t\t\t\t{ID.render(master)}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"mt-3 pb-1 mb-1 px-3 small text-muted border-bottom\">\r\n\t\t\t\t<LMR right={right} className=\"align-items-end\">明细</LMR>\r\n\t\t\t</div>\r\n\t\t\t<List items={details} item={{render: this.renderDetail, onClick: this.onDetailClick}} />\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate onDetailClick = (item: any) => {\r\n\t\tthis.controller.editDetail(item);\r\n\t}\r\n\r\n\tprivate renderDetail = (item:any, index:number) => {\r\n\t\treturn <div className=\"px-3 py-2\">\r\n\t\t\t{this.controller.midSheet.detail.ID.render(item)}\r\n\t\t</div>\r\n\t}\r\n//\t{JSON.stringify(item)}\r\n\r\n\tprivate saveSheet = async () => {\r\n\t\tlet ret = await this.controller.saveSheet();\r\n\t\tthis.closePage();\r\n\t\tthis.openPageElement(<Page header=\"单据完成\">\r\n\t\t\t<div className=\"p-3 text-center\">\r\n\t\t\t\t<div className=\"my-3\">单据保存成功！</div>\r\n\t\t\t\t<div className=\"my-3\">{ret.master}</div>\r\n\t\t\t\t<button className=\"btn btn-primary\" onClick={()=>this.closePage()}>返回</button>\r\n\t\t\t</div>\r\n\t\t</Page>)\r\n\t}\r\n}\r\n","import { VPage } from \"tonva-react\";\r\nimport { CSheet } from \"./CSheet\";\r\n\r\nexport class VSheetView extends VPage<CSheet<any, any>> {\r\n\theader() {return this.controller.midSheet.master.ID.ui.label}\r\n\tcontent() {\r\n\t\tlet {midSheet: mid, master} = this.controller;\r\n\t\tlet {ID} = mid.master;\r\n\t\treturn <div className=\"p-3\">\r\n\t\t\t{ID.render(master)}\r\n\t\t</div>;\r\n\t}\r\n}","import { observer } from \"mobx-react\";\r\nimport { FA, LMR, VPage } from \"tonva-react\";\r\nimport { CRoles } from \"./CRoles\";\r\n\r\ninterface RoleItem {\r\n\tcaption: string;\r\n\tonClick: () => Promise<void>;\r\n}\r\n\r\nexport class VRoles extends VPage<CRoles> {\r\n\tprivate onRoleAdmin = async () => {\r\n\t\tthis.controller.showRoleAdmin();\r\n\t}\r\n\tprivate onAccountant = async () => {\r\n\t\t//this.openVPage(VAccountant);\r\n\t}\r\n\r\n\tprivate onManager = async () => {\r\n\t\t//this.openVPage(VManager);\r\n\t}\r\n\tprivate roleItems:{[role:string]: RoleItem} = {\r\n\t\t$: {\r\n\t\t\tcaption: '设置用户角色',\r\n\t\t\tonClick: this.onRoleAdmin,\r\n\t\t},\r\n\t\taccountant: {\r\n\t\t\tcaption: '会计',\r\n\t\t\tonClick: this.onAccountant,\r\n\t\t},\r\n\t\tmanager: {\r\n\t\t\tcaption: '经理',\r\n\t\t\tonClick: this.onManager,\r\n\t\t},\r\n\t};\r\n\r\n\theader() {\r\n\t\treturn this.t('backend')\r\n\t}\r\n\tcontent() {\r\n\t\tlet VContent = observer(() => {\r\n\t\t\tlet {roles} = this.controller;\r\n\t\t\treturn <div>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t{roles.map(this.renderRoleItem)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\t\r\n\t\t});\r\n\t\treturn <VContent />;\r\n\t}\r\n\r\n\tprivate renderRoleItem = (role:string, index:number):JSX.Element => {\r\n\t\tlet item = this.roleItems[role];\r\n\t\tif (!item) return null;\r\n\t\tlet {caption, onClick} = item;\r\n\t\tlet right = <FA name=\"angle-right\" />;\r\n\t\treturn <LMR key={index} className=\"px-3 py-2 cursor-pointer mt-1 bg-white\"\r\n\t\t\tonClick={onClick}\r\n\t\t\tright={right}>\r\n\t\t\t<div>{caption}</div>\r\n\t\t</LMR>;\r\n\t}\r\n}","import { Form, ItemSchema, VPage, StringSchema, ButtonSchema, UiButton, UiTextItem, Context } from \"tonva-react\";\r\nimport { CRoleAdmin } from \"./CRoleAdmin\";\r\n\r\nexport class VAddUser extends VPage<CRoleAdmin> {\r\n\theader() {return '新增角色用户'}\r\n\tcontent() {\r\n\t\tlet schema:ItemSchema[] = [\r\n\t\t\t{ name: 'userName', required: true, type: 'string', maxLength: 60 } as StringSchema,\r\n\t\t\t{ name: 'ok', type: 'button' } as ButtonSchema,\r\n\t\t];\r\n\t\tlet uiSchema = {\r\n\t\t\titems: {\r\n\t\t\t\tuserName: { widget: 'text', label:'用户账号', placeholder: '请输入用户的账号' } as UiTextItem,\r\n\t\t\t\tok: { widget: 'button', className: 'btn btn-primary', label: '提交' } as UiButton,\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn <div className=\"p-3\">\r\n\t\t\t<Form schema={schema} uiSchema={uiSchema} onButtonClick={this.onClick} onEnter={this.onEnter} />\r\n\t\t</div>\r\n\t}\r\n\r\n\tprivate onClick = async (name:string, context: Context) => {\r\n\t\tlet error = await this.controller.newUser(context.data['userName']);\r\n\t\tif (error) {\r\n\t\t\tcontext.setError('userName', error);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.closePage();\r\n\t}\r\n\r\n\tprivate onEnter = async (name:string, context: Context) => {\r\n\t\tawait this.onClick(name, context);\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport { FA, LMR, VPage } from \"tonva-react\";\r\nimport { CRoleAdmin, UserRole } from \"./CRoleAdmin\";\r\nimport { VAddUser } from \"./VAddUser\";\r\n\r\nexport class VRoleAdmin extends VPage<CRoleAdmin> {\r\n\theader() {return '设置用户角色'}\r\n\tcontent() {\r\n\t\tlet {userRoles} = this.controller;\r\n\t\tlet VItem = observer((v:{userRole:UserRole;isMe:boolean}) => this.renderItem(v.userRole, v.isMe));\r\n\t\tlet VUserRoles = observer(() => <>{\r\n\t\t\tuserRoles.map(v => {\r\n\t\t\t\treturn <VItem key={v.user} userRole={v} isMe={false} />;\r\n\t\t\t})\r\n\t\t}</>);\r\n\t\tlet MeItem = observer(() => <VItem userRole={this.controller.meRoles} isMe={true} />);\r\n\t\treturn <div>\r\n\t\t\t<div className=\"mx-3 mt-3 mb-1 d-flex align-items-end\">\r\n\t\t\t\t<div className=\"mr-auto\">用户角色</div>\r\n\t\t\t\t<button className=\"btn btn-sm btn-outline-primary\" onClick={()=>this.openVPage(VAddUser)}><FA name=\"plus\" /> 增加</button>\r\n\t\t\t</div>\r\n\t\t\t<MeItem />\r\n\t\t\t<VUserRoles />\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderItem = (userRole: UserRole, isMe: boolean) => {\r\n\t\tif (!userRole) return null;\r\n\t\tlet {user, roles, isDeleted} = userRole;\r\n\t\tlet {roleCaptions, ixOfUsers} = this.controller;\r\n\t\tlet onUndo = () => this.controller.restoreUser(userRole);\r\n\t\tlet onDelete = () => this.controller.deleteUser(userRole);\r\n\t\tlet onRightClick: () => void;\r\n\t\tlet rightIcon:string;\r\n\t\tlet vUser = this.renderUser(user);\r\n\t\tlet cn = 'bg-white border-top ';\r\n\t\tif (isMe === true) {\r\n\t\t\tcn += 'mb-1';\r\n\t\t\tvUser = <>{vUser}<small className=\"ml-1 text-success\">[自己]</small></>;\r\n\t\t}\r\n\t\tif (isDeleted === true) {\r\n\t\t\tonRightClick = onUndo;\r\n\t\t\trightIcon = 'undo';\r\n\t\t\tvUser = <del>{vUser}</del>\r\n\t\t}\r\n\t\telse {\r\n\t\t\tonRightClick = onDelete;\r\n\t\t\trightIcon = 'times';\r\n\t\t}\r\n\t\tlet right = <div className=\"p-3 cursor-pointer text-info\" onClick={onRightClick}><FA name={rightIcon} /></div>;\r\n\t\treturn <LMR key={user} \r\n\t\t\tclassName={cn}\r\n\t\t\tleft = {<div className=\"p-3 w-12c\">{vUser}</div>}\r\n\t\t\tright = {right}\r\n\t\t\t>\t\t\t\r\n\t\t\t<div className=\"d-flex flex-wrap\">\r\n\t\t\t\t{roles.map((v, i) => {\r\n\t\t\t\t\tlet vCap:any = roleCaptions[i];\r\n\t\t\t\t\tif (isDeleted === true) vCap = <del>{vCap}</del>\r\n\t\t\t\t\treturn <label className=\"m-3\" key={i}>\r\n\t\t\t\t\t\t<input className=\"mr-2\" type='checkbox' \r\n\t\t\t\t\t\t\tdisabled={isDeleted} defaultChecked={v} \r\n\t\t\t\t\t\t\tonChange={e => this.onRoleChange(e, i, userRole)} />\r\n\t\t\t\t\t\t{vCap}\r\n\t\t\t\t\t</label>;\r\n\t\t\t\t})}\r\n\t\t\t\t{\r\n\t\t\t\t\tixOfUsers?.map(v => {\r\n\t\t\t\t\t\treturn <button key={v} onClick={() => this.controller.ixUserBind(user, v)}\r\n\t\t\t\t\t\t\tclassName=\"btn btn-sm btn-outline-info mx-3 my-2\">\r\n\t\t\t\t\t\t\t<small>关联</small> {v}\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t</LMR>;\r\n\t}\r\n\r\n\tprivate async onRoleChange(event: React.ChangeEvent<HTMLInputElement>, iRole: number, userRole:UserRole) {\r\n\t\tlet {target} = event;\r\n\t\ttarget.disabled = true;\r\n\t\tawait this.controller.setUserRole(target.checked, iRole, userRole);\r\n\t\ttarget.disabled = false;\r\n\t}\r\n}\r\n","import { makeObservable, observable, runInAction } from \"mobx\";\r\nimport { centerApi, Controller, UqApi, Uq } from \"tonva-react\";\r\nimport { CIXEdit, MidIX } from \"../../IX\";\r\nimport { VRoleAdmin } from \"./VRoleAdmin\";\r\n\r\nexport interface UserRole {\r\n\tuser:number; \r\n\troles:boolean[];\r\n\tisDeleted?: boolean;\r\n}\r\n\r\nexport class CRoleAdmin extends Controller {\r\n\tprivate readonly uq:Uq;\r\n\tprivate readonly uqApi: UqApi;\r\n\treadonly allRoles: string[];\r\n\treadonly roleCaptions: string[];\r\n\tmeRoles: UserRole = null;\r\n\tuserRoles: UserRole[] = null;\r\n\tixOfUsers: string[];\r\n\tprivate myRolesChanged:(roles:string[])=>void;\r\n\r\n\tconstructor(uq:Uq, myRolesChanged?:(roles:string[])=>void, roleCaptionMap?:{[role:string]:string}) {\r\n\t\tsuper();\r\n\t\tmakeObservable(this, {\r\n\t\t\tmeRoles: observable,\r\n\t\t\tuserRoles: observable,\r\n\t\t});\r\n\t\tthis.uq = uq;\r\n\t\tlet {$:uqMan} = uq;\r\n\t\tthis.uqApi = uqMan.uqApi;\r\n\t\tthis.allRoles = uqMan.allRoles;\r\n\t\tif (!this.allRoles || this.allRoles.length === 0) {\r\n\t\t\tthrow new Error(`uq ${uqMan.name} allRoles not defined. No RoleAdmin needed.`);\r\n\t\t}\r\n\t\tthis.myRolesChanged = myRolesChanged;\r\n\t\tif (roleCaptionMap) {\r\n\t\t\tthis.roleCaptions = this.allRoles.map(v => roleCaptionMap[v] || v);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.roleCaptions = this.allRoles;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tlet allUserRoles = await this.uqApi.getAllRoleUsers();\r\n\t\trunInAction(() => {\r\n\t\t\tlet r0 = allUserRoles.shift();\r\n\t\t\tlet {roles} = r0;\r\n\t\t\tif (roles) {\r\n\t\t\t\tthis.ixOfUsers = roles.split('|');\r\n\t\t\t}\r\n\t\t\tlet arr:string[] = this.allRoles.map(v => `|${v}|`);\r\n\t\t\tfunction rolesBool(t:string): boolean[] {\r\n\t\t\t\tif (!t) return arr.map(v => false);\r\n\t\t\t\treturn arr.map(v => t.indexOf(v) >= 0);\r\n\t\t\t}\r\n\t\t\tthis.userRoles = [];\r\n\t\t\tlet meId = this.user.id;\r\n\t\t\tfor (let ur of allUserRoles) {\r\n\t\t\t\tlet {user, roles} = ur;\r\n\t\t\t\tlet item:UserRole = ur as any;\r\n\t\t\t\titem.roles = rolesBool(roles);\r\n\t\t\t\tif (user === meId)\r\n\t\t\t\t\tthis.meRoles = item;\r\n\t\t\t\telse\r\n\t\t\t\t\tthis.userRoles.push(item);\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.openVPage(VRoleAdmin);\r\n\t}\r\n\tasync setUserRole(checked:boolean, iRole:number, userRole:UserRole) {\r\n\t\tlet {roles} = userRole;\r\n\t\tlet len = roles.length;\r\n\t\tlet text:string = '';\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet yes = i===iRole? checked : roles[i];\r\n\t\t\tif (yes === true) text += '|' + this.allRoles[i];\r\n\t\t}\r\n\t\ttext += '|';\r\n\t\tawait this.uqApi.setUserRoles(userRole.user, text);\r\n\t\troles[iRole] = checked;\r\n\t\tthis.fireMyRolesChanged(userRole);\r\n\t}\r\n\r\n\tprivate fireMyRolesChanged(userRole: UserRole, newRoles?:boolean[]) {\r\n\t\tif (!this.myRolesChanged) return;\r\n\t\tif (userRole !== this.meRoles) return;\r\n\t\tlet {roles} = userRole;\r\n\t\tif (newRoles) roles = newRoles;\r\n\t\tlet roleNames:string[] = ['$'];\r\n\t\tfor (let i=0; i<roles.length; i++) {\r\n\t\t\tif (roles[i] === true) roleNames.push(this.allRoles[i]);\r\n\t\t}\r\n\t\tthis.myRolesChanged(roleNames);\r\n\t}\r\n\r\n\tprivate buildRolesText(userRole:UserRole) {\r\n\t\tlet ret = userRole.roles.map((v, index) => v===true? this.allRoles[index]:'').join('|');\r\n\t\treturn `|${ret}|`;\r\n\t}\r\n\r\n\tasync newUser(userName: string): Promise<string> {\r\n\t\tlet ret = await centerApi.userFromKey(userName);\r\n\t\tif (!ret) {\r\n\t\t\treturn '这个用户名没有注册';\r\n\t\t}\r\n\t\tlet user = ret.id;\r\n\t\tlet roles: string;\r\n\t\tif (this.isMe(user) === true) {\r\n\t\t\tif (this.meRoles) {\r\n\t\t\t\tthis.meRoles.isDeleted = false;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.meRoles = {\r\n\t\t\t\t\tuser,\r\n\t\t\t\t\troles:  this.allRoles.map(v => false)\r\n\t\t\t\t};\t\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet userRole = this.userRoles.find(v => v.user === user);\r\n\t\t\tif (userRole) {\r\n\t\t\t\tif (userRole.isDeleted === true) {\r\n\t\t\t\t\tuserRole.isDeleted = false;\r\n\t\t\t\t\troles = this.buildRolesText(userRole);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\treturn '这个用户已经是角色用户了';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tuserRole = {\r\n\t\t\t\t\tuser,\r\n\t\t\t\t\troles: this.allRoles.map(v => false),\r\n\t\t\t\t};\r\n\t\t\t\tthis.userRoles.push(userRole);\r\n\t\t\t\troles = '';\r\n\t\t\t}\r\n\t\t}\r\n\t\tawait this.uqApi.setUserRoles(user, roles);\r\n\t\tif (this.isMe(user) === true) {\r\n\t\t\tthis.fireMyRolesChanged(this.meRoles);\r\n\t\t}\r\n\t}\r\n\r\n\tasync deleteUser(userRole: UserRole) {\r\n\t\tlet {user} = userRole;\r\n\t\tuserRole.isDeleted = true; \r\n\t\tawait this.uqApi.deleteUserRoles(user);\r\n\t\tthis.fireMyRolesChanged(userRole, this.allRoles.map(v => false));\r\n\t}\r\n\r\n\tasync restoreUser(userRole: UserRole) {\r\n\t\tlet {user} = userRole;\r\n\t\tuserRole.isDeleted = false; \r\n\t\tlet roles = this.buildRolesText(userRole)\r\n\t\tawait this.uqApi.setUserRoles(user, roles);\r\n\t\tthis.fireMyRolesChanged(userRole);\r\n\t}\r\n\r\n\tixUserBind = async (user:number, ixName:string) => {\r\n\t\tlet IX = this.uq.$.getIX(ixName);\r\n\t\tawait IX.loadSchema();\r\n\t\tlet {id2Name} = IX.schema;\r\n\t\tlet ID = this.uq.$.getID(id2Name);\r\n\t\tlet midIX = new MidIX(this.uq, IX, ID, user);\r\n\t\tlet cIXEdit = new CIXEdit(midIX);\r\n\t\tawait cIXEdit.start();\r\n\t}\r\n}\r\n","import { Controller, nav, Uq } from \"tonva-react\";\r\nimport { VRoles } from \"./VRoles\";\r\nimport { CRoleAdmin } from './roleAdmin';\r\n\r\nconst roleCaptionMap:{[role:string]: string} = {\r\n\taccountant: '会计',\r\n\tmanager: '经理',\r\n}\r\n\r\nexport class CRoles extends Controller {\r\n\tprivate uq: Uq;\r\n\troles: string[] = null;\r\n\tconstructor(uq:Uq) {\r\n\t\tsuper();\t\t\r\n\t\tthis.uq = uq;\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tthis.roles = await this.uq.$.getRoles();\r\n\t\tif (!this.roles) this.roles = [];\r\n\t\tthis.openVPage(VRoles)\r\n\t}\r\n\r\n\tasync showRoleAdmin() {\r\n\t\tlet  uqMan = this.uq.$;\r\n\t\tlet {allRoles} = uqMan;\r\n\t\tif (!allRoles || allRoles.length === 0) {\r\n\t\t\talert(`uq ${uqMan.name} has not defined roles`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet cRoleAdmin = new CRoleAdmin(this.uq, this.myRolesChanged, roleCaptionMap);\r\n\t\tcRoleAdmin.setRes(this.getRes());\r\n\t\tawait cRoleAdmin.start();\r\n\t}\r\n\r\n\tprivate myRolesChanged = (roles:string[]) => {\r\n\t\tthis.roles = roles;\r\n\t\tthis.user.roles[this.uq.$.name] = roles;\r\n\t\tnav.saveLocalUser();\r\n\t}\r\n}","import * as React from 'react';\r\nimport { IObservableArray, computed } from 'mobx';\r\nimport { PageItems } from '../../tool/pageItems';\r\nimport {List} from './index';\r\n\r\nexport abstract class ListBase {\r\n    protected list: List;\r\n    constructor(list: List) {\r\n        this.list = list;\r\n    }\r\n    get isPaged():boolean {\r\n        let items = this.list.props.items;\r\n        return (items !== null && items !== undefined && Array.isArray(items) === false);\r\n    }\r\n    get items():any[]|IObservableArray<any> {\r\n        let items = this.list.props.items;\r\n        if (items === null) return null;\r\n        if (items === undefined) return undefined;\r\n        if (Array.isArray(items) === true)\r\n            return items as IObservableArray<any>;\r\n        else\r\n            return (items as PageItems<any>).items;\r\n    }\r\n    @computed get loading():boolean {\r\n        let items = this.list.props.items;\r\n        if (items === null) return false;\r\n        if (items === undefined) return true;\r\n        let pageItems = items as PageItems<any>;\r\n        if (pageItems.items === undefined) return false;\r\n        return pageItems.loading;\r\n    }\r\n    get selectedItems():any[] { return undefined; }\r\n    //updateProps(nextProps:any) {}\r\n    dispose() {};\r\n    abstract render: (item:any, index:number) => JSX.Element;\r\n    protected renderContent(item:any, index:number) {\r\n        let {render} = this.list.props.item;\r\n        if (render === undefined) return <div className=\"px-3 py-2\">{JSON.stringify(item)}</div>;\r\n        return render(item, index);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {ListBase} from './base';\r\n\r\nexport class Clickable extends ListBase {\r\n    render = (item:any, index:number):JSX.Element => {\r\n        let {className, key, onClick} = this.list.props.item;\r\n        return <li key={key===undefined?index:key(item)} className={classNames('va-row-clickable', className)} onClick={()=>onClick && onClick(item)}>\r\n            {this.renderContent(item, index)}\r\n        </li>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { ListBase } from './base';\r\nimport { uid } from '../../tool/uid';\r\n\r\nexport class Static extends ListBase {\r\n    render = (item:any, index:number):JSX.Element => {\r\n        let {className, key} = this.list.props.item;\r\n        if (typeof item === 'string') {\r\n            let cn = classNames('va-list-gap', 'px-3', 'pt-1');\r\n            return <li key={uid()} className={cn}>{item}</li>;\r\n        }\r\n        return <li key={key===undefined?index:key(item)} className={classNames(className)}>\r\n            {this.renderContent(item, index)}\r\n        </li>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observable, IObservableArray, isObservableArray, observe, makeObservable} from 'mobx';\r\nimport classNames from 'classnames';\r\nimport {ListBase} from './base';\r\nimport {uid} from '../../tool/uid';\r\nimport { PageItems } from '../../tool/pageItems';\r\nimport { List } from './index';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport interface SelectableItem {\r\n    selected: boolean;\r\n    item: any;\r\n    labelId: string;\r\n}\r\n\r\nexport class Selectable extends ListBase {\r\n    _items: SelectableItem[] = null;\r\n    private inputItems:{[uid:string]: HTMLInputElement} = {};\r\n\r\n    constructor(list: List) {\r\n\t\tsuper(list);\r\n\t\tmakeObservable(this, {\r\n\t\t\t_items: observable\r\n\t\t})\r\n        this.buildItems();\r\n        this.listenArraySplice();\r\n    }    \r\n\r\n    private listenArraySplice() {\r\n        let {items} = this.list.props;\r\n        if (items === undefined) return;\r\n        if (items === null) return;\r\n        let itemsArray:any;\r\n        if (Array.isArray(items) === true) {\r\n            itemsArray = items as any;\r\n        }\r\n        else {\r\n            itemsArray = (items as PageItems<any>).items;\r\n        }\r\n        if (isObservableArray(items) === true) {\r\n            observe(itemsArray as IObservableArray<any>, (change) => {                \r\n                if (change.type === 'splice') {\r\n                    let {index, removedCount, added} = change;\r\n                    let _added = added && added.map(v => {\r\n                        return {\r\n                            selected: false, \r\n                            item: v, \r\n                            labelId:uid()\r\n                        }\r\n                    });\r\n                    this._items.splice(index, removedCount, ..._added);\r\n                    this.buildItems();\r\n                }\r\n            }, true);\r\n        }\r\n    }\r\n\r\n    private buildItems = () => {\r\n        let {items, isItemSelected, selectedItems, compare} = this.list.props;\r\n        let itemsArray:any[] | IObservableArray<any>;\r\n        if (items === undefined) {\r\n            this._items = undefined;\r\n            return;\r\n        }\r\n        if (items === null) {\r\n            this._items = null;\r\n            return;\r\n        }\r\n        \r\n        if (Array.isArray(items) === true) {\r\n            itemsArray = items as any;\r\n        }\r\n        else {\r\n            itemsArray = (items as PageItems<any>).items;\r\n        }\r\n\r\n\t\tif (isItemSelected) {\r\n\t\t\tlet retItems = itemsArray.map(v => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tselected: isItemSelected(v),\r\n\t\t\t\t\titem: v, \r\n\t\t\t\t\tlabelId:uid()\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tthis._items = retItems;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet comp: ((item:any, selectItem:any)=>boolean);\r\n\t\t\tif (compare === undefined) {\r\n\t\t\t\tcomp = (item:any, selectItem:any) => item === selectItem;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tcomp = compare;\r\n\t\t\t}\r\n\t\t\tlet retItems = itemsArray.map(v => {\r\n\t\t\t\t//let isObserved = isObservable(v);\r\n\t\t\t\t//let obj = isObserved === true? toJS(v) : v;\r\n\t\t\t\t//let obj = v;\r\n\t\t\t\tlet selected = selectedItems === undefined?\r\n\t\t\t\t\tfalse\r\n\t\t\t\t\t: selectedItems.find(si => comp(v, si)) !== undefined;\r\n\t\t\t\treturn {\r\n\t\t\t\t\tselected: selected, \r\n\t\t\t\t\titem: v, \r\n\t\t\t\t\tlabelId:uid()\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tthis._items = retItems;\r\n\t\t}\r\n    }\r\n\r\n    get items() {\r\n        //if (this._items === undefined) \r\n        //this.buildItems();\r\n        return this._items;\r\n    }\r\n    private checkAll(on: boolean) {\r\n        for (let i in this.inputItems) this.inputItems[i].checked = on;\r\n        for (let item of this._items) item.selected = on;\r\n    }\r\n    selectAll() {\r\n        //if (this._items) this._items.forEach(v => v.selected = true);\r\n        this.checkAll(true);\r\n        this.list.props.item.onSelect(undefined, true, this.anySelected);\r\n    }\r\n    unselectAll() {\r\n        this.checkAll(false);\r\n        this.list.props.item.onSelect(undefined, false, this.anySelected);\r\n    }\r\n\r\n\tprivate get anySelected():boolean {return this._items.some(v => v.selected)}\r\n    private onSelect(item:SelectableItem, selected:boolean) {\r\n        item.selected = selected;\r\n        this.list.props.item.onSelect(item.item, selected, this.anySelected);\r\n    }\r\n    \r\n    get selectedItems():any[] {\r\n        return this._items.filter(v => v.selected === true).map(v => v.item);\r\n    }\r\n\r\n\trender = (item:SelectableItem, index:number):JSX.Element => {\r\n        let {key} = this.list.props.item;\r\n\t\treturn React.createElement(this.row, {item, index, key:key===undefined?index:key(item)});\r\n    }\r\n\r\n    private row = observer((props: {item:SelectableItem, index:number}):JSX.Element => {\r\n        let {item, index} = props;\r\n        let {className} = this.list.props.item;\r\n        let {labelId, selected, item:obItem} = item;\r\n        return <li className={classNames(className)}>\r\n            <div className=\"d-flex align-items-center px-3\">\r\n                <input ref={input=>{if (input) this.inputItems[labelId] = input;}}\r\n                    className=\"\" type=\"checkbox\" value=\"\" id={labelId}\r\n                    defaultChecked={selected}\r\n                    onChange={(e)=>{\r\n                        this.onSelect(item, e.target.checked)} \r\n                    }/>\r\n                <label className=\"\" style={{flex:1, marginBottom:0}} htmlFor={labelId}>\r\n                    {this.renderContent(obItem, index)}\r\n                </label>\r\n            </div>\r\n        </li>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {observer} from 'mobx-react';\r\nimport _ from 'lodash';\r\nimport {PageItems} from '../../tool/pageItems';\r\nimport {ListBase} from './base';\r\nimport {Clickable} from './clickable';\r\nimport {Static} from './static';\r\nimport {Selectable} from './selectable';\r\nimport '../../css/va-list.css';\r\nimport { IObservableArray } from 'mobx';\r\nimport { resLang } from '../../res/res';\r\nimport { ListRes, listRes } from '../../res';\r\n\r\ntype StaticRow = string|JSX.Element|(()=>string|JSX.Element);\r\ninterface ItemProps {\r\n\tclassName?: string|string[];\r\n\trender?: (item:any, index:number) => JSX.Element;\r\n\tonSelect?: (item:any, isSelected:boolean, anySelected:boolean)=>void;\r\n\tonClick?: (item:any)=>void;\r\n\tkey?: (item:any)=>string|number;\r\n}\r\n\r\nexport interface ListProps {\r\n    className?: string|string[];\r\n    items: any[] | IObservableArray<any> | PageItems<any>;\r\n    item: ItemProps;\r\n\tisItemSelected?: (item:any) => boolean;\r\n    compare?: (item:any, selectItem:any) => boolean;\r\n\tselectedItems?:any[];\r\n    header?: StaticRow;\r\n    footer?: StaticRow;\r\n    before?: StaticRow;\r\n    loading?: StaticRow;\r\n\tnone?: StaticRow;\r\n\tonFocus?: (evt: React.FocusEvent<HTMLUListElement>)=>void;\r\n}\r\n\r\n@observer\r\nexport class List extends React.Component<ListProps> {\r\n\tprivate static res:ListRes = resLang<ListRes>(listRes);\r\n\r\n\tprivate listBase: ListBase;\r\n\tprivate selectable: Selectable;\r\n    constructor(props:ListProps) {\r\n\t\tsuper(props);\r\n        this.buildBase();\r\n    }\r\n    _$scroll = (direct: 'top'|'bottom') => {\r\n        console.log('############### items scroll to ' + direct);\r\n    }\r\n    private buildBase() {\r\n        let {item} = this.props;\r\n        let {onClick, onSelect} = item;\r\n        if (onSelect !== undefined)\r\n            this.selectable = this.listBase = new Selectable(this);\r\n        else if (onClick !== undefined)\r\n            this.listBase = new Clickable(this);\r\n        else\r\n            this.listBase = new Static(this);\r\n\t}\r\n\tcomponentDidUpdate(prevProps: Readonly<ListProps>, prevState: Readonly<any>) {\r\n\t\tif (_.isEqual(this.props.item, prevProps.item) === false) {\r\n\t\t\tthis.buildBase();\r\n\t\t\tthis.forceUpdate();\r\n\t\t}\r\n\t}\r\n    componentWillUnmount() {\r\n        this.listBase.dispose();\r\n    }\r\n    selectAll() {\r\n        if (this.selectable) this.selectable.selectAll();\r\n    }\r\n    unselectAll() {\r\n        if (this.selectable) this.selectable.unselectAll();\r\n    }\r\n    get selectedItems():any[] {\r\n        return this.listBase.selectedItems;\r\n    }\r\n    render() {\r\n        let {className, header, footer, before, loading, none, onFocus} = this.props;\r\n        if (before === undefined) before = '-';\r\n        if (loading === undefined) loading = () => <i className=\"fa fa-spinner fa-spin fa-2x fa-fw text-info\" />;\r\n        if (none === undefined) none = List.res.none;\r\n        let {items, loading:isLoading} = this.listBase;\r\n        function staticRow(row:StaticRow, type:string) {\r\n            if (!row) return;\r\n            switch (typeof row) {\r\n                default:\r\n                case 'string': return <li className={\"va-list-\"+type}>{row}</li>;\r\n                case 'function': return <li className={\"va-list-\"+type}>{(row as ()=>string|JSX.Element)()}</li>;\r\n                case 'object': return <li>{row}</li>\r\n            } \r\n        }\r\n        let content:any, waitingMore:any;\r\n        if (items === null)\r\n            content = staticRow(before, 'before');\r\n        else if (items === undefined)\r\n            content = staticRow(loading, 'loading');\r\n        else if (items.length === 0)\r\n            content = staticRow(none, 'none');\r\n        else {\r\n            content = items.map((item, index) => {\r\n                return this.listBase.render(item, index);\r\n            });\r\n        }\r\n        if (isLoading === true && items) {\r\n            waitingMore = staticRow(loading, 'loading');\r\n\t\t}\r\n\t\tlet tabIndex:number;\r\n\t\tif (onFocus !== undefined) tabIndex = -1;\r\n        return <ul className={classNames('va-list', className)} onFocus={onFocus} tabIndex={tabIndex}>\r\n            {staticRow(header, 'header')}\r\n            {content}\r\n            {waitingMore}\r\n            {staticRow(footer, 'footer')}\r\n        </ul>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport className from 'classnames';\r\nimport {PropGridProps} from './PropGrid';\r\nimport {LabeledProp, StringProp, NumberProp, ListProp, ComponentProp} from './propView';\r\n\r\nexport abstract class PropRow {\r\n    setValues(values: any) {}\r\n    abstract render(key:string): any;\r\n}\r\n\r\nexport class PropBorder extends PropRow {\r\n    render(key:string): JSX.Element {\r\n        return <div key={'_b_' + key} className=\"\">\r\n            <div className=\"w-100\">\r\n                <div style={{borderTop: '1px solid #f0f0f0'}} />\r\n            </div>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class PropGap extends PropRow {\r\n    private param: string;\r\n    constructor(param?: string) {\r\n        super();\r\n        this.param = param;\r\n    }\r\n    render(key:string): JSX.Element {\r\n        let w: string;\r\n        switch (this.param) {\r\n            default: w = 'py-2'; break;\r\n            case '=': w = 'py-1'; break;\r\n            case '-': w = 'pb-1'; break;\r\n        }\r\n        let cn = className(w);\r\n        return <div key={'_g_' + key} className={cn} />;\r\n    }\r\n}\r\n\r\nconst valueAlignStart = 'justify-content-start';\r\nconst valueAlignCenter = 'justify-content-center';\r\nconst valueAlignEnd = 'justify-content-end';\r\nexport abstract class LabeledPropRow extends PropRow {\r\n    protected gridProps: PropGridProps;\r\n    protected _prop: LabeledProp;\r\n    protected get prop():LabeledProp {return this._prop}\r\n    protected content: any;\r\n    protected col: string;\r\n    //protected values: any;\r\n    constructor(gridProps:PropGridProps, prop: LabeledProp) {\r\n        super();\r\n        this.gridProps = gridProps;\r\n        this._prop = prop;\r\n        this.col = gridProps.labelFixLeft === true? 'col' : 'col-sm';\r\n        //this.values = values;\r\n    }\r\n    render(key:string):any {\r\n        let {onClick, bk} = this.prop;\r\n        let cn = className({\r\n            \"cursor-pointer\": onClick !== undefined,\r\n            \"bg-white\": bk === undefined, \r\n            \"row\": true\r\n        });\r\n        return <div key={key} className={cn} onClick={onClick}>\r\n            {this.renderLabel()}\r\n            {this.renderProp()}\r\n        </div>;\r\n    }\r\n    protected renderLabel():any {\r\n        let {label} = this.prop;\r\n        if (label === undefined) return null;\r\n        return <label className={this.col + '-3 col-form-label'}>\r\n            {label}\r\n        </label>;\r\n    }\r\n    protected renderProp():any {\r\n        let {label} = this.prop;\r\n        let align, vAlign;\r\n        switch (this.gridProps.alignValue) {\r\n            case 'left': align = valueAlignStart; break;\r\n            case 'center': align = valueAlignCenter; break;\r\n            case 'right': align = valueAlignEnd; break;\r\n        }\r\n        switch (this.prop.vAlign) {\r\n            case 'top': vAlign = 'align-items-start'; break;\r\n            default:\r\n            case 'center': vAlign = 'align-items-center'; break;\r\n            case 'bottom': vAlign = 'align-items-end'; break;\r\n            case 'stretch': vAlign = 'align-items-stretch'; break;\r\n        }\r\n        let col:string = this.col + (label===undefined? '-12':'-9');\r\n        let cn = className(align, vAlign, col, 'd-flex');\r\n        return <div className={cn}>\r\n            {this.renderPropBody()}\r\n        </div>;\r\n    }\r\n    protected renderPropBody():any {\r\n        return <div className=\"form-control-plaintext\">\r\n            {this.renderPropContent()}\r\n        </div>;\r\n    }\r\n    protected renderPropContent():any {\r\n        return this.content;\r\n    }\r\n}\r\n\r\nexport class StringPropRow extends LabeledPropRow {\r\n    protected get prop(): StringProp {return this._prop as StringProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else this.content = values[this.prop.name];\r\n    }\r\n}\r\n\r\nexport class NumberPropRow extends LabeledPropRow {\r\n    protected get prop(): NumberProp {return this._prop as NumberProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else this.content = values[this.prop.name];\r\n    }\r\n}\r\n\r\nexport class ListPropRow extends LabeledPropRow {\r\n    protected get prop(): ListProp {return this._prop as ListProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else {\r\n            let list = this.prop.list;\r\n            if (typeof list === 'string') this.content = values[list];\r\n            else this.content = undefined;\r\n        }\r\n    }\r\n    protected renderPropBody() {\r\n        let {list, row} = this.prop;\r\n        let items:any[] = typeof list === 'string'? this.content : list;\r\n        if (items === undefined) return <div/>;\r\n        // new row(item)\r\n        return <div className=\"w-100\">\r\n            {\r\n                items.map((item, index) => <React.Fragment key={index}>\r\n                    {index===0? null: <div style={{width:'100%', borderBottom:'1px solid #f0f0f0'}} />}\r\n                    {React.createElement(row, item)}\r\n                </React.Fragment>)\r\n            }\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class ComponentPropRow extends LabeledPropRow {\r\n    protected get prop(): ComponentProp {return this._prop as ComponentProp;}\r\n    protected renderPropBody() {\r\n        let {component} = this.prop;\r\n        return component;\r\n    }\r\n    protected renderProp():any {\r\n        let {label, full} = this.prop;\r\n        let align, vAlign;\r\n        switch (this.gridProps.alignValue) {\r\n            case 'left': align = valueAlignStart; break;\r\n            case 'center': align = valueAlignCenter; break;\r\n            case 'right': align = valueAlignEnd; break;\r\n        }\r\n        switch (this.prop.vAlign) {\r\n            case 'top': vAlign = 'align-items-start'; break;\r\n            default:\r\n            case 'center': vAlign = 'align-items-center'; break;\r\n            case 'bottom': vAlign = 'align-items-end'; break;\r\n            case 'stretch': vAlign = 'align-items-stretch'; break;\r\n        }\r\n        let col:string;\r\n        if (full !== true)\r\n            col = this.col + (label===undefined? '-12':'-9');\r\n        else\r\n            col = 'w-100';\r\n        let cn = className(align, vAlign, col, 'd-flex');\r\n        return <div className={cn}>\r\n            {this.renderPropBody()}\r\n        </div>;\r\n    }\r\n}\r\n","import { PropGridProps } from './PropGrid';\r\nimport {\r\n    PropRow, PropBorder, PropGap, \r\n    StringPropRow, NumberPropRow, ListPropRow, ComponentPropRow\r\n} from './row';\r\n\r\nexport interface Format {\r\n\r\n}\r\n\r\nexport interface PropBase {\r\n    onClick?: () => void;\r\n}\r\n\r\nexport interface LabeledProp extends PropBase {\r\n    label?: string;\r\n    bk?: string;\r\n    vAlign?: 'top' | 'bottom' | 'center' | 'stretch';\r\n}\r\n\r\nexport interface StringProp extends LabeledProp {\r\n    type: 'string';\r\n    name: string;\r\n}\r\n\r\nexport interface NumberProp extends LabeledProp {\r\n    type: 'number';\r\n    name: string;\r\n\tisInt: boolean;\t\t// 整数\r\n\ttime: boolean;\t\t// 字段log的time可以客户端输入\r\n}\r\n\r\nexport interface FormatProp extends LabeledProp {\r\n    type: 'format';\r\n    format: Format;\r\n}\r\n\r\nexport interface ListProp extends LabeledProp {\r\n    type: 'list';\r\n    list: string | any[];  // string 表示名字，否则就是值\r\n    row: new (props: any) => React.Component;\r\n}\r\n\r\nexport interface ComponentProp extends LabeledProp {\r\n    type: 'component';\r\n    full?: boolean;\r\n    component: any; //JSX.Element;\r\n}\r\n\r\nexport type Prop = StringProp | NumberProp | FormatProp | ListProp | ComponentProp | string;\r\n\r\nexport class PropView {\r\n    private gridProps: PropGridProps\r\n    private props: Prop[];\r\n    //private values:any;\r\n    private rows: PropRow[];\r\n\r\n    constructor(gridProps: PropGridProps, props: Prop[]) {\r\n        this.gridProps = gridProps;\r\n        this.props = props;\r\n        //this.values = values;\r\n        this.buildRows();\r\n    }\r\n\r\n    private buildRows() {\r\n        this.rows = [];\r\n        let isGap: boolean = true;\r\n        for (let prop of this.props) {\r\n            if (typeof prop === 'string') {\r\n                this.rows.push(new PropGap(prop));\r\n                isGap = true;\r\n            }\r\n            else {\r\n                if (!isGap) this.rows.push(new PropBorder());\r\n                let row;\r\n                switch (prop.type) {\r\n                    default: continue;\r\n                    case 'string': row = new StringPropRow(this.gridProps, prop); break;\r\n                    case 'number': row = new NumberPropRow(this.gridProps, prop); break;\r\n                    case 'list': row = new ListPropRow(this.gridProps, prop); break;\r\n                    case 'component': row = new ComponentPropRow(this.gridProps, prop); break;\r\n                }\r\n                this.rows.push(row);\r\n                isGap = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    setValues(values: any) {\r\n        for (let r of this.rows) r.setValues(values);\r\n    }\r\n\r\n    render() {\r\n        return this.rows.map((row, index) => row.render(String(index)));\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, PropView} from './propView';\r\n\r\nexport interface PropGridProps {\r\n    className?: string;\r\n    rows: Prop[];\r\n    values: any;\r\n    alignValue?: 'left'|'center'|'right';\r\n    labelFixLeft?: boolean;\r\n}\r\n\r\n@observer\r\nexport class PropGrid extends React.Component<PropGridProps> {\r\n    render() {\r\n        let {className, rows, values} = this.props;\r\n        let propView = new PropView(this.props, rows);\r\n        propView.setValues(values);\r\n        let cn = classNames('container-fluid', className);\r\n        return <div className={cn}>\r\n            {propView.render()}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { Page, ItemSchema, UiSchema, StringSchema, UiTextItem, Edit, ImageSchema, nav, UiImageItem } from '../components';\r\nimport { userApi } from '../net';\r\n\r\nexport class EditMeInfo extends React.Component {\r\n    private schema:ItemSchema[] = [\r\n        {name:'nick', type:'string'} as StringSchema,\r\n        {name:'icon', type:'image'} as ImageSchema\r\n    ];\r\n    private uiSchema:UiSchema = {\r\n        items: {\r\n            nick: {widget:'text', label:'别名', placeholder:'好的别名更方便记忆'} as UiTextItem,\r\n            icon: {widget:'image', label:'头像'} as UiImageItem,\r\n        }\r\n    }\r\n    @observable private data:any;\r\n\r\n    constructor(props:any) {\r\n        super(props);\r\n        let {nick, icon} = nav.user;\r\n        this.data = {\r\n            nick: nick,\r\n            icon: icon,\r\n        }\r\n    }\r\n\r\n    private onItemChanged = async (itemSchema:ItemSchema, newValue:any, preValue:any) => {\r\n        let {name} = itemSchema;        \r\n        await userApi.userSetProp(name, newValue);\r\n        this.data[name] = newValue;\r\n        let user:any = nav.user;\r\n        user[name] = newValue;\r\n        nav.saveLocalUser();\r\n    }\r\n\r\n    render() {\r\n        return <Page header=\"个人信息\">\r\n            <Edit schema={this.schema} uiSchema={this.uiSchema}\r\n                data={this.data}\r\n                onItemChanged={this.onItemChanged} />\r\n        </Page>;\r\n    }\r\n}\r\n","import { observable } from 'mobx';\r\nimport _ from 'lodash';\r\nimport { LocalArr } from '../../tool';\r\nimport { BoxId } from './boxId';\r\nimport { TuidInner, TuidDiv } from './tuid';\r\n\r\nconst maxCacheSize = 1000;\r\n\r\nexport class IdCache {\r\n    private queue: number[] = [];               // 每次使用，都排到队头\r\n\tprivate cache = observable.map({}, {deep: false});    // 已经缓冲的\r\n\t//private loading:boolean = false;\r\n\t//private loadingIds: number[];\r\n\r\n    protected localArr:LocalArr;\r\n    protected waitingIds: number[] = [];          // 等待loading的\r\n    protected tuidInner: TuidInner;\r\n\r\n    constructor(tuidLocal: TuidInner) {\r\n        this.tuidInner = tuidLocal;\r\n        this.initLocalArr();\r\n    }\r\n\r\n    protected initLocalArr() {\r\n        this.localArr = this.tuidInner.cache.arr(this.tuidInner.name + '.ids');\r\n    }\r\n\r\n    useId(id:number, defer?:boolean) {\r\n        if (!id) return;\r\n        if (typeof id !== 'number') {\r\n\t\t\tconsole.error('id cache ' + id + ' is not number');\r\n\t\t\treturn;\r\n\t\t}\r\n        if (this.cache.has(id) === true) {\r\n            this.moveToHead(id);\r\n            return;\r\n        }\r\n        this.tuidInner.cacheTuids(defer===true?70:20);\r\n        this.cache.set(id, id);\r\n        if (this.waitingIds.findIndex(v => v === id) >= 0) {\r\n            this.moveToHead(id);\r\n            return;\r\n        }\r\n\r\n        if (this.queue.length >= maxCacheSize) {\r\n            // 缓冲已满，先去掉最不常用的\r\n            let r = this.queue.shift();\r\n            if (r === id) {\r\n                // 如果移除的，正好是现在用的，则插入\r\n                this.queue.push(r);\r\n                return;\r\n            }\r\n\r\n            //let rKey = String(r);\r\n            if (this.cache.has(r) === true) {\r\n                // 如果移除r已经缓存\r\n                this.cache.delete(r);\r\n            }\r\n            else {\r\n                // 如果移除r还没有缓存\r\n                let index = this.waitingIds.findIndex(v => v === r);\r\n                this.waitingIds.splice(index, 1);\r\n            }\r\n        }\r\n        this.waitingIds.push(id);\r\n        this.queue.push(id);\r\n\t\treturn;\r\n    }\r\n\t/*\r\n\tprotected removeWaiting(id:number) {\r\n\t\tlet index = this.waitingIds.findIndex(v => v === id);\r\n\t\tthis.waitingIds.splice(index, 1);\r\n\t}\r\n\t\r\n\tprotected clearWaiting() {\r\n\t\tthis.waitingIds.splice(0, this.waitingIds.length);\r\n\t}\r\n\t\r\n\tprotected removeLoading(id:number) {\r\n\t\tif (this.loadingIds === undefined) return;\r\n\t\tlet index = this.loadingIds.findIndex(v => v === id);\r\n\t\tthis.loadingIds.splice(index, 1);\r\n\t}\r\n\t*/\r\n    private moveToHead(id:number) {\r\n        let index = this.queue.findIndex(v => v === id);\r\n        this.queue.splice(index, 1);\r\n        this.queue.push(id);\r\n    }\r\n\r\n    getValue(id:number) {\r\n\t\treturn this.cache.get(id);\r\n    }\r\n\r\n    remove(id:number) {\r\n        this.cache.delete(id);\r\n        let index = this.queue.findIndex(v => v === id);\r\n\t\tthis.queue.splice(index, 1);\r\n\t\tthis.localArr.removeItem(id);\r\n    }\r\n\r\n    valueFromId(id:number|BoxId):any {\r\n        let _id:number;\r\n        switch (typeof id) {\r\n            case 'object': _id = (id as BoxId).id; break;\r\n            case 'number': _id = id as number; break;\r\n            default: return;\r\n        }\r\n        return this.getValue(_id);\r\n    }\r\n\r\n    resetCache(id:number) {\r\n        this.remove(id);\r\n        this.useId(id);\r\n    }\r\n\r\n    cacheValue(val:any):boolean {\r\n        if (val === undefined) return false;\r\n        let id = this.getIdFromObj(val);\r\n        if (id === undefined) return false;\r\n\t\t/*\r\n        let index = this.waitingIds.findIndex(v => v === id);\r\n        if (index>=0) this.waitingIds.splice(index, 1);\r\n\t\t*/\r\n\t\t//this.removeWaiting(id);\r\n\t\t//this.removeLoading(id);\r\n        this.cache.set(id, val);\r\n        return true;\r\n    }\r\n    protected getIdFromObj(val:any) {return this.tuidInner.getIdFromObj(val)}\r\n\r\n    async cacheIds():Promise<void> {\r\n        //if (this.waitingIds.length === 0) return;\r\n\t\tlet tuidValues = await this.loadIds();\r\n\t\t/*\r\n\t\tif (tuidValues === undefined || tuidValues.length === 0) {\r\n\t\t\t//this.waitingIds.splice(0, this.waitingIds.length);\r\n\t\t\tthis.clearWaiting();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t*/\r\n        this.cacheIdValues(tuidValues);\r\n    }\r\n\r\n    protected cacheIdValues(tuidValues: any[]) {\r\n        if (tuidValues === undefined) return;\r\n        let tuids = this.unpackTuidIds(tuidValues);\r\n        for (let tuidValue of tuids) {\r\n            if (this.cacheValue(tuidValue) === false) continue;\r\n            this.cacheTuidFieldValues(tuidValue);\r\n        }\r\n    }\r\n    async modifyIds(ids:any[]):Promise<void> {\r\n        let tuidValues:string[] = await this.loadTuidIdsOrLocal(ids);\r\n        let localedValues = tuidValues.filter(v => {\r\n            let p = v.indexOf('\\t');\r\n            if (p<0) p = v.length;\r\n            let id = Number(v.substr(0, p));\r\n            let val = this.localArr.getItem(id);\r\n            return (val !== undefined);\r\n        });\r\n        if (localedValues.length === 0) return;\r\n        this.cacheIdValues(localedValues);\r\n    }\r\n    protected async loadIds(): Promise<any[]> {\r\n\t\tif (this.waitingIds.length === 0) return;\r\n\t\t//if (this.loading === true) return;\r\n\t\t//this.loading = true;\r\n\t\tlet loadingIds = [...this.waitingIds];\r\n\t\t//this.clearWaiting();\r\n\t\tthis.waitingIds = [];\r\n\t\tlet ret = await this.loadTuidIdsOrLocal(loadingIds);\r\n\t\t//this.loading = false;\r\n\t\t//this.loadingIds = undefined;\r\n        return ret;\r\n    }\r\n    protected unpackTuidIds(values:string[]):any[] {\r\n        return this.tuidInner.unpackTuidIds(values);\r\n    }\r\n    protected cacheTuidFieldValues(tuidValue: any) {\r\n        this.tuidInner.cacheTuidFieldValues(tuidValue);\r\n    }\r\n\r\n    async assureObj(id:number):Promise<void> {\r\n        let val = this.cache.get(id);\r\n        switch (typeof val) {\r\n            case 'object': return val;\r\n            case 'number': this.cache.set(id, id); break;\r\n        }\r\n        let ret = await this.loadTuidIdsOrLocal([id]);\r\n        this.cacheIdValues(ret);\r\n    }\r\n\r\n\tprotected async loadTuidIds(netIds: number[]):Promise<any[]> {\r\n\t\tlet netRet = await this.tuidInner.loadTuidIds(undefined, netIds);\r\n\t\treturn netRet;\r\n\t}\r\n\r\n    private async loadTuidIdsOrLocal(ids:number[]):Promise<string[]> {\r\n        let ret:string[] = [];        \r\n        let netIds:number[] = [];\r\n        for (let id of ids) {\r\n            let value = this.localArr.getItem(id);\r\n            //if (value === undefined)\r\n            // 值不存在或者是空字符串，重新获取\r\n            if (!value)\r\n                netIds.push(id);\r\n            else\r\n                ret.push(value);\r\n        }\r\n        let len = netIds.length;\r\n        if (len === 0) return ret;\r\n\r\n\t\tlet netRet = await this.loadTuidIds(netIds);\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t//有些id可能没有内容，不会返回\r\n\t\t\t//let id = netIds[i]; \r\n\t\t\tlet row:string = netRet[i];\r\n\t\t\tif (!row) continue;\r\n\t\t\tlet p = row.indexOf('\\t');\r\n\t\t\tif (p < 0) p = row.length;\r\n\t\t\tlet id = Number(row.substr(0, p));\r\n\t\t\t_.remove(netIds, v => v === id);\r\n\t\t\tret.push(row);\r\n\t\t\tthis.localArr.setItem(id, row);\r\n\t\t}\r\n\t\tlen = netIds.length;\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tthis.localArr.setItem(netIds[i], '');\r\n\t\t}\r\n        return ret;\r\n    }\r\n}\r\n\r\nexport class IdDivCache extends IdCache {\r\n    private div: TuidDiv;\r\n    protected divName:string;\r\n\r\n    constructor(tuidLocal:TuidInner, div: TuidDiv) {\r\n        super(tuidLocal);\r\n        this.div = div;\r\n        this.divName = div.name;\r\n        this.localArr = tuidLocal.cache.arr(tuidLocal.name + '.ids.' + this.divName);\r\n    }\r\n\r\n    protected initLocalArr() {\r\n        // 这个不需要，必须去掉\r\n        // this.localArr = this.tuidInner.cache.arr(this.tuidInner.name + '.ids');\r\n    }\r\n\r\n    protected getIdFromObj(val:any) {return this.div.getIdFromObj(val)}\r\n    protected unpackTuidIds(values:string[]):any[] {\r\n        return this.div.unpackTuidIds(values);\r\n    }\r\n    protected cacheTuidFieldValues(tuidValue: any) {\r\n        this.div.cacheTuidFieldValues(tuidValue);\r\n    }\r\n\tprotected async loadTuidIds(netIds: number[]):Promise<any[]> {\r\n\t\tlet netRet = await this.tuidInner.loadTuidIds(this.divName, netIds);\r\n\t\treturn netRet;\r\n\t}\r\n}\r\n","import _ from 'lodash';\r\nimport { LocalArr } from '../../tool';\r\nimport { Entity } from '../entity';\r\nimport { UqMan, ArrFields, Field, SchemaFrom } from '../uqMan';\r\nimport { EntityCaller } from '../caller';\r\nimport { BoxId } from './boxId';\r\nimport { IdCache, IdDivCache } from './idCache';\r\n\r\nexport interface TuidSaveResult {\r\n    id: number;\r\n    inId: number;\r\n}\r\n\r\nexport interface TuidNOResult {\r\n\tdate: string;\r\n\tno: number;\r\n}\r\n\r\nexport abstract class UqTuid<M> extends Entity {\r\n    protected noCache: boolean;\r\n    readonly typeName:string = 'tuid';\r\n    protected idName: string;\r\n    cached: boolean;\r\n    unique: string[];\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {id} = schema;\r\n        this.idName = id;\r\n    }\r\n\r\n    buildTuidBox(): TuidBox {\r\n        return new TuidBox(this);\r\n    }\r\n\r\n    getIdFromObj(obj:any):number {return obj[this.idName]}\r\n    stopCache():void {this.noCache = true}\r\n    abstract useId(id:number):void;\r\n    abstract boxId(id:number):BoxId;\r\n    abstract valueFromId(id:number):any;\r\n\tabstract resetCache(id:number|BoxId):void;\r\n\tabstract assureBox<T> (id:number|BoxId): Promise<T>;\r\n\tstatic idValue(id: {id:number}|number):number {\r\n\t\tswitch (typeof id) {\r\n\t\t\tdefault: debugger; throw new Error('unknown id');\r\n\t\t\tcase 'object': return id.id;\r\n\t\t\tcase 'number': return id;\r\n\t\t}\r\n\t}\r\n    static equ(id1:{id:number}|number, ix:{id:number}|number): boolean {\r\n        if (id1 === undefined || id1 === null) return false;\r\n\t\tif (ix === undefined || ix === null) return false;\r\n\t\treturn Tuid.idValue(id1) === Tuid.idValue(ix);\r\n\t\t/*\r\n        if (typeof id1 === 'object') {\r\n\t\t\tlet id1Id = id1.id;\r\n            return typeof ix === 'object'? id1Id === ix.id : id1Id === ix;\r\n        }\r\n        if (typeof ix === 'object') {\r\n\t\t\tlet id2Id = ix.id;\r\n            return typeof id1 === 'object'? id2Id === id1.id : id2Id === id1;\r\n        }\r\n\t\treturn id1 === ix;\r\n\t\t*/\r\n    }\r\n    cacheIds() {}\r\n    async modifyIds(ids:any[]) {}\r\n    isImport = false;\r\n    abstract get hasDiv():boolean;// {return this.divs!==undefined}\r\n    abstract div(name:string):TuidDiv;\r\n    abstract loadMain(id:number|BoxId):Promise<M>;\r\n\tabstract load(id:number|BoxId):Promise<M>;\r\n    abstract all():Promise<M[]>;\r\n\tabstract save(id:number, props:M):Promise<TuidSaveResult>;\r\n\tabstract saveProp(id:number, prop:string, value:any):Promise<void>;\r\n    abstract search(key:string, pageStart:string|number, pageSize:number):Promise<M[]>;\r\n    abstract searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any>;\r\n    abstract loadArr(arr:string, owner:number, id:number):Promise<any>;\r\n    abstract saveArr(arr:string, owner:number, id:number, props:any):Promise<void>;\r\n\tabstract posArr(arr:string, owner:number, id:number, order:number):Promise<void>;\r\n\tabstract no():Promise<TuidNOResult>;\r\n}\r\n\r\nexport abstract class Tuid extends UqTuid<any> {\r\n}\r\n\r\nexport class TuidInner extends Tuid {\r\n    private divs: {[div:string]: TuidDiv};\r\n    protected cacheFields: Field[];\r\n    protected idCache: IdCache;\r\n    protected localArr:LocalArr;\r\n    constructor(uq:UqMan, name:string, typeId:number) {\r\n        super(uq, name, typeId);\r\n        this.idCache = new IdCache(this);\r\n        this.localArr = this.cache.arr(this.name + '.whole');\r\n        if (uq.newVersion === true) this.localArr.removeAll();\r\n    }\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {arrs} = schema;\r\n        if (arrs !== undefined) {\r\n            this.divs = {};\r\n            for (let arr of arrs) {\r\n                let {name} = arr;\r\n                let tuidDiv = new TuidDiv(this.uq, this, name);\r\n                this.divs[name] = tuidDiv;\r\n                tuidDiv.setSchema(arr);\r\n                tuidDiv.buildFieldsTuid();\r\n            }\r\n        }\r\n    }\r\n    \r\n    useId(id:number, defer?:boolean) {\r\n        if (this.noCache === true) return;\r\n        if (!id) return;\r\n        this.idCache.useId(id, defer);\r\n    }\r\n    boxId(id:number):BoxId {\r\n        if (!id) return;\r\n        if (typeof id === 'object') return id;\r\n        this.useId(id);\r\n        let {createBoxId} = this.uq;\r\n        if (!createBoxId) return {id: id} as BoxId;\r\n        return createBoxId(this, id);\r\n    }\r\n    valueFromId(id:number) {return this.idCache.getValue(id)}\r\n\tresetCache(id:number|BoxId):void {\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tthis.idCache.resetCache(id);\r\n\t}\r\n    async assureBox<T> (id:number|BoxId):Promise<T> {\r\n\t\tif (!id) return;\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tawait this.idCache.assureObj(id);\r\n\t\treturn this.idCache.getValue(id);\r\n    }\r\n\r\n    cacheIds() {\r\n        this.idCache.cacheIds();\r\n        if (this.divs === undefined) return;\r\n        for (let i in this.divs) this.divs[i].cacheIds();\r\n    }\r\n    async modifyIds(ids:any[]) {\r\n        await this.idCache.modifyIds(ids);\r\n    }\r\n    cacheTuids(defer:number) {this.uq.cacheTuids(defer)}\r\n    get hasDiv():boolean {return this.divs!==undefined}\r\n    div(name:string):TuidDiv {\r\n        return this.divs && this.divs[name];\r\n    }\r\n    async loadTuidIds(divName:string, ids:number[]):Promise<any[]> {\r\n        let ret:any[] = await new IdsCaller(this, {divName:divName, ids:ids}, false).request();\r\n        if (ret.length > 0) this.cached = true;\r\n        return ret;\r\n    }\r\n    async loadMain(id:number|BoxId):Promise<any> {\r\n        if (typeof id === 'object') id = id.id;\r\n        await this.idCache.assureObj(id);\r\n        return this.idCache.valueFromId(id);\r\n    }\r\n    async load(id:number|BoxId):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        //let cacheValue = this.idCache.valueFromId(id); \r\n        //if (typeof cacheValue === 'object') return cacheValue;\r\n        if (typeof id === 'object') id = id.id;\r\n        let valuesText = undefined; //this.localArr.getItem(id);\r\n        let values: any;\r\n        if (valuesText) {\r\n            values = JSON.parse(valuesText);\r\n        }\r\n        else {\r\n            values = await new GetCaller(this, id).request();\r\n            if (values !== undefined) {\r\n                // this.localArr.setItem(id, JSON.stringify(values));\r\n            }\r\n        }\r\n        if (values === undefined) return;\r\n        for (let f of this.schema.fields) {\r\n            let {tuid} = f;\r\n            if (tuid === undefined) continue;\r\n            let t = this.uq.getTuid(tuid);\r\n            if (t === undefined) continue;\r\n            let n = f.name;\r\n            values[n] = t.boxId(values[n]);\r\n        }\r\n        this.idCache.cacheValue(values);\r\n        this.cacheTuidFieldValues(values);\r\n        return values;\r\n    }\r\n\r\n    cacheTuidFieldValues(values:any) {\r\n        let {fields, arrs} = this.schema;\r\n        this.cacheFieldsInValue(values, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs as ArrFields[]) {\r\n                let {name, fields} = arr;\r\n                let arrValues = values[name];\r\n                if (arrValues === undefined) continue;\r\n                let tuidDiv = this.div(name);\r\n                for (let row of arrValues) {\r\n                    //row._$tuid = tuidDiv;\r\n                    //row.$owner = this.boxId(row.owner);\r\n                    tuidDiv.cacheValue(row);\r\n                    this.cacheFieldsInValue(row, fields);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public buildFieldsTuid() {\r\n        super.buildFieldsTuid();\r\n        let {mainFields, $create, $update, stampOnMain} = this.schema;\r\n\t\tif (mainFields === undefined) debugger;\r\n\t\tthis.cacheFields = mainFields || this.fields;\r\n\t\tif (stampOnMain === true) {\r\n\t\t\tif ($create === true) this.cacheFields.push({name: '$create', type: 'timestamp', _tuid: undefined});\r\n\t\t\tif ($update === true) this.cacheFields.push({name: '$update', type: 'timestamp', _tuid: undefined});\r\n\t\t}\r\n        this.uq.buildFieldTuid(this.cacheFields);\r\n    }\r\n\r\n    unpackTuidIds(values:string[]):any[] {\r\n        return this.unpackTuidIdsOfFields(values, this.cacheFields);\r\n    }\r\n\r\n    async save(id:number, props:any):Promise<TuidSaveResult> {\r\n        let ret = await new SaveCaller(this, {id:id, props:props}).request();\r\n        if (id !== undefined) {\r\n            this.idCache.remove(id);\r\n            this.localArr.removeItem(id);\r\n        }\r\n        return ret;\r\n\t}\r\n\tasync saveProp(id:number, prop:string, value:any):Promise<void> {\r\n\t\tawait new SavePropCaller(this, {id, prop, value}).request();\r\n\t\tthis.idCache.remove(id);\r\n\t\tawait this.idCache.assureObj(id);\r\n\t}\r\n    async all():Promise<any[]> {\r\n        let ret: any[] = await new AllCaller(this, {}).request();\r\n        return ret;\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any[]> {\r\n        let ret:any[] = await this.searchArr(undefined, key, pageStart, pageSize);\r\n        return ret;\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        //let api = this.uqApi;\r\n        //let ret = await api.tuidSearch(this.name, undefined, owner, key, pageStart, pageSize);\r\n        let params:any = {arr:undefined, owner:owner, key:key, pageStart:pageStart, pageSize:pageSize};\r\n        let ret = await new SearchCaller(this, params).request();\r\n        let {fields} = this.schema;\r\n        for (let row of ret) {\r\n            this.cacheFieldsInValue(row, fields);\r\n        }\r\n        return ret;\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        //let api = this.uqApi;\r\n        //return await api.tuidArrGet(this.name, arr, owner, id);\r\n        return await new LoadArrCaller(this, {arr:arr, owner:owner, id:id}).request();\r\n    }\r\n    async saveArr(arr:string, owner:number, id:number, props:any) {\r\n        //let params = _.clone(props);\r\n        //params[\"$id\"] = id;\r\n        //return await this.uqApi.tuidArrSave(this.name, arr, owner, params);\r\n        return await new SaveArrCaller(this, {arr:arr, owner:owner, id:id, props:props}).request();\r\n    }\r\n\r\n    async posArr(arr:string, owner:number, id:number, order:number) {\r\n        //return await this.uqApi.tuidArrPos(this.name, arr, owner, id, order);\r\n        return await new ArrPosCaller(this, {arr:arr, owner:owner, id:id, order:order}).request();\r\n\t}\r\n\tasync no():Promise<TuidNOResult> {\r\n\t\treturn await new TuidNoCaller(this, undefined).request();\r\n\t}\r\n}\r\n\r\nabstract class TuidCaller<T> extends EntityCaller<T> {\r\n    protected get entity(): Tuid {return this._entity as Tuid};\r\n}\r\n\r\n// 包含main字段的load id\r\n// 当前为了兼容，先调用的包含所有字段的内容\r\nclass GetCaller extends TuidCaller<number> {\r\n    method = 'GET';\r\n    get path():string {return `tuid/${this.entity.name}/${this.params}`}\r\n}\r\n\r\nclass IdsCaller extends TuidCaller<{divName:string, ids:number[]}> {\r\n    get path():string {\r\n        let {divName} = this.params;\r\n        return `tuidids/${this.entity.name}/${divName !== undefined?divName:'$'}`;\r\n    }\r\n    buildParams():any {return this.params.ids}\r\n    xresult(res:any):any {\r\n        return (res as string).split('\\n');\r\n    }\r\n}\r\n\r\n\r\nclass SaveCaller extends TuidCaller<{id:number, props:any}> {\r\n    get path():string {return `tuid/${this.entity.name}`}\r\n    buildParams():any {\r\n        let {fields, arrs} = this.entity.schema;\r\n        let {id, props} = this.params;\r\n        let params:any = {$id: id};\r\n        this.transParams(params, props, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let arrName = arr.name;\r\n                let arrParams = [];\r\n                let arrFields = arr.fields;\r\n                let arrValues = props[arrName];\r\n                if (arrValues !== undefined) {\r\n                    for (let arrValue of arrValues) {\r\n                        let row = {};\r\n                        this.transParams(row, arrValue, arrFields);\r\n                        arrParams.push(row);\r\n                    }\r\n                }\r\n                params[arrName] = arrParams;\r\n            }\r\n        }\r\n        return params;\r\n    }\r\n    private transParams(values:any, params:any, fields:Field[]) {\r\n        if (params === undefined) return;\r\n        for (let field of fields) {\r\n            let {name, tuid, type} = field;\r\n            let val = params[name];\r\n            if (tuid !== undefined) {\r\n                if (typeof val === 'object') {\r\n                    if (val !== null) val = val.id;\r\n                }\r\n            }\r\n            else {\r\n                switch (type) {\r\n                    case 'date':\r\n                        val = this.entity.buildDateParam(val); \r\n                        //val = (val as string).replace('T', ' ');\r\n                        //val = (val as string).replace('Z', '');\r\n                        break;\r\n                    case 'datetime':\r\n                        val = this.entity.buildDateTimeParam(val);\r\n                        //val = new Date(val).toISOString();\r\n                        //val = (val as string).replace('T', ' ');\r\n                        //val = (val as string).replace('Z', '');\r\n                        break;\r\n                }\r\n            }\r\n            values[name] = val;\r\n        }\r\n    }\r\n}\r\n\r\nclass SearchCaller extends TuidCaller<{arr:string, owner:number, key:string, pageStart:string|number, pageSize:number}> {\r\n    get path():string {return `tuids/${this.entity.name}`}\r\n}\r\n\r\nclass AllCaller extends TuidCaller<{}> {\r\n    method = 'GET';\r\n    get path():string {return `tuid-all/${this.entity.name}`}\r\n}\r\n\r\nclass LoadArrCaller extends TuidCaller<{arr:string, owner:number, id:number}> {\r\n    method = 'GET';\r\n    get path():string {\r\n        let {arr, owner, id} = this.params;\r\n        return `tuid-arr/${this.entity.name}/${owner}/${arr}/${id}`;\r\n    }\r\n}\r\nclass SavePropCaller extends TuidCaller<{id:number, prop:string, value:any}> {\r\n    get path():string {return `tuid-prop/${this.entity.name}/`;}\r\n}\r\nclass SaveArrCaller extends TuidCaller<{arr:string, owner:number, id:number, props:any}> {\r\n    get path():string {\r\n        let {arr, owner} = this.params;\r\n        return `tuid-arr/${this.entity.name}/${owner}/${arr}/`;\r\n    }\r\n    buildParams():any {\r\n        let {id, props} = this.params;\r\n        let params = _.clone(props);\r\n        params['$id'] = id;\r\n        return params;\r\n    }\r\n}\r\nclass ArrPosCaller extends TuidCaller<{arr:string, owner:number, id:number, order:number}> {\r\n    get path():string {\r\n        let {arr, owner} = this.params;\r\n        return `tuid-arr-pos/${this.entity.name}/${owner}/${arr}/`;\r\n    }\r\n    buildParams():any {\r\n        let {id, order} = this.params;\r\n        return { bid: id, $order: order}\r\n    }\r\n}\r\nclass TuidNoCaller extends TuidCaller<{}> {\r\n    get path():string {\r\n        return `tuid-no/${this.entity.name}/`;\r\n    }\r\n    buildParams():any {\r\n\t\tlet d = new Date();\r\n\t\tlet year = d.getFullYear();\r\n\t\tlet month = d.getMonth() + 1;\r\n\t\tlet date = d.getDate();\r\n        return {year, month, date};\r\n    }\r\n}\r\n\r\nexport class TuidImport extends Tuid {\r\n    private tuidLocal: TuidInner;\r\n\r\n    constructor(uq:UqMan, name:string, typeId:number, from: SchemaFrom) {\r\n        super(uq, name, typeId);\r\n        this.from = from;\r\n    }\r\n\r\n    setFrom(tuidLocal: TuidInner) {this.tuidLocal = tuidLocal}\r\n    \r\n    readonly from: SchemaFrom;\r\n    isImport = true;\r\n\r\n    useId(id:number) {this.tuidLocal.useId(id);}\r\n    boxId(id:number):BoxId {return this.tuidLocal.boxId(id);}\r\n    valueFromId(id:number) {return this.tuidLocal.valueFromId(id)}\r\n\tresetCache(id:number|BoxId):void {\r\n\t\tthis.tuidLocal.resetCache(id);\r\n\t}\r\n    async assureBox<T>(id:number):Promise<T> {\r\n        await this.tuidLocal.assureBox(id);\r\n\t\treturn this.tuidLocal.valueFromId(id);\r\n    }\r\n    get hasDiv():boolean {return this.tuidLocal.hasDiv}\r\n    div(name:string):TuidDiv {return this.tuidLocal.div(name)}\r\n    async loadMain(id:number|BoxId):Promise<any> {\r\n        let ret = await this.tuidLocal.loadMain(id);\r\n        return ret;\r\n    }\r\n    async load(id:number|BoxId):Promise<any> {\r\n        return await this.tuidLocal.load(id);\r\n    }\r\n    async save(id:number, props:any):Promise<TuidSaveResult> {\r\n        return await this.tuidLocal.save(id, props);\r\n\t}\r\n\tasync saveProp(id:number, prop:string, value:any):Promise<void> {\r\n\t\tawait this.tuidLocal.saveProp(id, prop, value);\r\n\t}\r\n    async all():Promise<any[]> {\r\n        return await this.tuidLocal.all();\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        return await this.tuidLocal.search(key, pageStart, pageSize);\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        return await this.tuidLocal.searchArr(owner, key, pageStart, pageSize);\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        return await this.tuidLocal.loadArr(arr, owner, id);\r\n    }\r\n    async saveArr(arr:string, owner:number, id:number, props:any):Promise<void> {\r\n        await this.tuidLocal.saveArr(arr, owner, id, props);\r\n    }\r\n    async posArr(arr:string, owner:number, id:number, order:number):Promise<void> {\r\n        await this.tuidLocal.posArr(arr, owner, id, order);\r\n    }\r\n\tasync no():Promise<TuidNOResult> {\r\n\t\treturn await this.tuidLocal.no();\r\n\t}\r\n}\r\n\r\n// field._tuid 用这个接口\r\n// Tuid, TuidDiv 实现这个接口\r\nexport class TuidBox {\r\n    tuid: Tuid;\r\n    ownerField:Field = undefined;\r\n    constructor(tuid: Tuid) {\r\n        this.tuid = tuid;\r\n    }\r\n\r\n    boxId(id:number):BoxId {\r\n        return this.tuid.boxId(id);\r\n    }\r\n    getIdFromObj(obj:any):number {\r\n        return this.tuid.getIdFromObj(obj);\r\n    }\r\n    useId(id:number):void {\r\n        return this.tuid.useId(id);\r\n    }\r\n    async showInfo() {\r\n        alert('showInfo not implemented');\r\n    }\r\n}\r\n\r\n\r\nexport class TuidDiv extends TuidInner /* Entity*/ {\r\n    readonly typeName:string = 'div';\r\n    protected cacheFields: Field[];\r\n    protected tuid: TuidInner;\r\n    protected idName: string;\r\n    protected idCache: IdDivCache;\r\n\r\n    //ui: React.StatelessComponent<any>;\r\n    //res: any;\r\n\r\n    constructor(uq: UqMan, tuid: TuidInner, name: string) {\r\n        super(uq, name, 0);\r\n        this.tuid = tuid;\r\n        this.idName = 'id';\r\n        this.idCache = new IdDivCache(tuid, this);\r\n    }\r\n\r\n    get owner() {return this.tuid}\r\n\r\n    /*\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        this.buildFieldsTuid();\r\n    }*/\r\n\r\n    /*\r\n    setUIRes(ui:any, res:any) {\r\n        this.ui = ui && ui.content;\r\n        this.res = res;\r\n    }\r\n    */\r\n\r\n    buildFieldsTuid() {\r\n        super.buildFieldsTuid();\r\n        let {mainFields} = this.schema;\r\n        if (mainFields === undefined) debugger;\r\n        this.uq.buildFieldTuid(this.cacheFields = mainFields);\r\n    }\r\n\r\n    buildTuidDivBox(ownerField: Field): TuidBoxDiv {\r\n        return new TuidBoxDiv(this.tuid, this, ownerField);\r\n    }\r\n\r\n    getIdFromObj(obj:any):number {return obj[this.idName]}\r\n    cacheValue(value:any):void {\r\n        this.idCache.cacheValue(value);\r\n    }\r\n\r\n    useId(id:number, defer?:boolean):void {\r\n        if (this.noCache === true) return;\r\n        this.idCache.useId(id, defer);\r\n    }\r\n\r\n    /*\r\n    boxId(id:number):BoxId {\r\n        if (typeof id === 'object') return id;\r\n        this.useId(id);\r\n        //return new BoxDivId(this.tuid, this, id);\r\n        return this.tuid.boxDivId(this, id);\r\n    }\r\n    */\r\n    valueFromId(id:number):any {\r\n        return this.idCache.getValue(id)\r\n    }\r\n\r\n    async assureBox<T>(id:number):Promise<T> {\r\n\t\tawait this.idCache.assureObj(id);\r\n\t\treturn this.idCache.getValue(id);\r\n    }\r\n\r\n    async cacheIds() {\r\n        await this.idCache.cacheIds();\r\n    }\r\n\r\n    cacheTuidFieldValues(values:any) {\r\n        let fields = this.schema.fields;\r\n        this.cacheFieldsInValue(values, fields);\r\n    }\r\n\r\n    unpackTuidIds(values:string[]):any[] {\r\n        return this.unpackTuidIdsOfFields(values, this.cacheFields);\r\n    }\r\n}\r\n\r\nexport class TuidBoxDiv extends TuidBox {\r\n    ownerField: Field;\r\n    private div: TuidDiv;\r\n    constructor(tuid: Tuid, div: TuidDiv, ownerField: Field) {\r\n        super(tuid);\r\n        this.div = div;\r\n        this.ownerField = ownerField;\r\n    }\r\n\r\n    boxId(id:number):BoxId {\r\n        return this.div.boxId(id);\r\n    }\r\n    getIdFromObj(obj:any):number {\r\n        return this.div.getIdFromObj(obj);\r\n    }\r\n    useId(id:number):void {\r\n        return this.div.useId(id);\r\n    }\r\n}\r\n","import fs from \"fs\";\r\nimport { capitalCase } from \"../../tool\";\r\nimport { FieldItem } from \"../../ui\";\r\nimport { ID, IDX, IX } from \"../ID\";\r\nimport { UqMan } from \"../uqMan\";\r\nimport { buildUQ } from \"./buildUQ\";\r\nimport { buildFieldItem } from \"./fieldItem\";\r\nimport { buildTsHeader, overrideTsFile, saveTsFileIfNotExists } from \"./tools\";\r\n\r\nexport function buildTsUqFolder(uq: UqMan, uqsFolder:string, uqAlias:string) {\r\n\tlet uqFolder = uqsFolder + '/' + uqAlias;\r\n\tif (fs.existsSync(uqFolder) === false) {\r\n\t\tfs.mkdirSync(uqFolder);\r\n\t}\r\n\tlet tsUq = buildTsHeader();\r\n\ttsUq += buildUQ(uq, uqAlias);\r\n\toverrideTsFile(`${uqFolder}/${uqAlias}.ts`, tsUq);\r\n\tsaveTsIndexAndRender(uqFolder, uq, uqAlias);\r\n}\r\n\r\nfunction saveTsIndexAndRender(uqFolder:string, uq: UqMan, uqAlias:string) {\r\n\tlet imports = '', sets = '';\r\n\tlet {idArr, idxArr, ixArr} = uq;\r\n\tfor (let i of [...idArr, ...idxArr, ...ixArr]) {\r\n\t\tlet cName = capitalCase(i.name);\r\n\t\timports += `\\nimport * as ${cName} from './${cName}.ui';`;\r\n\t\tsets += `\\n\tObject.assign(uq.${cName}, ${cName});`;\r\n\r\n\t\tlet tsUI = `import { Res, setRes, TFunc, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { ${cName} } from \"./${uqAlias}\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n};\r\n/*==fields==*/\r\n\r\nconst fieldArr: FieldItem[] = [\r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"${cName}\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nconst resRaw: Res<any> = {\r\n\tzh: {\r\n\t},\r\n\ten: {\r\n\t}\r\n};\r\nconst res: any = {};\r\nsetRes(res, resRaw);\r\n\r\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\r\n\treturn res[str as string] ?? str;\r\n}\r\n\r\nexport function render(item: ${cName}):JSX.Element {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n};\r\n`;\r\n\r\n\t\tlet path = `${uqFolder}/${cName}.ui.tsx`;\r\n\t\tsaveTsFileIfNotExists(path, tsUI);\r\n\r\n\t\tlet fields = buildFields(i);\r\n\t\tlet tsFieldArr:string = buildFieldArr(i);\r\n\r\n\t\treplaceTsFileFields(path, fields);\r\n\t\tlet tsImportFieldItemsBegin = 'import { FieldItem, ';\r\n\t\tlet tsImportFieldItemsEnd = ' } from \"tonva-react\";';\r\n\t\tlet tsImportFieldItems = 'FieldItemInt, FieldItemNum, FieldItemString, FieldItemId';\r\n\t\treplaceTsFileString(path, \r\n\t\t\t{\r\n\t\t\t\tbegin: tsImportFieldItemsBegin, \r\n\t\t\t\tend: tsImportFieldItemsEnd, \r\n\t\t\t\tcontent: tsImportFieldItemsBegin + tsImportFieldItems + tsImportFieldItemsEnd,\r\n\t\t\t}\r\n\t\t);\r\n\t\treplaceTsFileString(path, \r\n\t\t\t{begin:'export const fieldArr: FieldItem[] = [\\n', end: '\\n];\\n', content:tsFieldArr}\r\n\t\t);\r\n\t}\r\n\r\n\tlet tsIndex = `import { UqExt as Uq } from './${uqAlias}';${imports}\r\n\r\nexport function setUI(uq: Uq) {${sets}\r\n}\r\nexport * from './${uqAlias}';\r\n`;\r\n\toverrideTsFile(`${uqFolder}/index.ts`, tsIndex);\r\n}\r\n\r\nfunction buildFields(i:ID|IDX|IX):{[name:string]:FieldItem} {\r\n\tswitch (i.typeName) {\r\n\t\tcase 'id': return buildIDFields(i as ID);\r\n\t\tcase 'idx': return buildIDXFields(i);\r\n\t\tcase 'ix': return buildIXFields(i);\r\n\t}\r\n};\r\n\r\nfunction buildIDFields(ID:ID):{[name:string]:FieldItem} {\r\n\tlet ret:{[name:string]:FieldItem} = {};\r\n\tlet {schema} = ID;\r\n\tlet {keys, fields} = schema;\r\n\tfor (let f of fields) {\r\n\t\tlet {name} = f;\r\n\t\tlet isKey = (keys as any[])?.findIndex(v => v.name === name) >= 0;\r\n\t\tret[name] = buildFieldItem(f, isKey);\r\n\t}\r\n\treturn ret;\r\n}\r\nfunction buildIDXFields(IDX:IDX):{[name:string]:FieldItem} {\r\n\tlet ret:{[name:string]:FieldItem} = {};\r\n\tlet {schema} = IDX;\r\n\tlet {keys, fields} = schema;\r\n\tfor (let f of fields) {\r\n\t\tlet {name} = f;\r\n\t\tlet isKey = (keys as any[])?.findIndex(v => v.name === name) >= 0;\r\n\t\tret[name] = buildFieldItem(f, isKey);\r\n\t}\r\n\treturn ret;\r\n};\r\n\r\nfunction buildIXFields(IX:IX):{[name:string]:FieldItem} {\r\n\tlet ret:{[name:string]:FieldItem} = {};\r\n\tlet {schema} = IX;\r\n\tlet {keys, fields} = schema;\r\n\tfor (let f of fields) {\r\n\t\tlet {name} = f;\r\n\t\tlet isKey = (keys as any[])?.findIndex(v => v.name === name) >= 0;\r\n\t\tret[name] = buildFieldItem(f, isKey);\r\n\t}\r\n\treturn ret;\r\n};\r\n\r\nfunction buildFieldArr(i:ID|IDX|IX):string {\r\n\tlet ts = 'export const fieldArr: FieldItem[] = [\\n\\t';\r\n\tswitch (i.typeName) {\r\n\t\tcase 'id': ts += buildIDFieldArr(i as ID); break;\r\n\t\tcase 'idx': ts += buildIDXFieldArr(i); break;\r\n\t\tcase 'ix': ts += buildIXFieldArr(i); break;\r\n\t}\r\n\treturn ts += '\\n];\\n';\r\n}\r\nfunction buildIDFieldArr(i:ID):string {\r\n\tlet {schema} = i;\r\n\tlet ts = '';\r\n\tfor (let f of schema.fields) {\r\n\t\tlet {name} = f;\r\n\t\tif (name === 'id') continue;\r\n\t\tts += `fields.${name}, `;\r\n\t}\r\n\treturn ts;\r\n}\r\nfunction buildIDXFieldArr(i:IDX):string {\r\n\tlet {schema} = i;\r\n\tlet ts = '';\r\n\tfor (let f of schema.fields) {\r\n\t\tlet {name} = f;\r\n\t\tif (name === 'id') continue;\r\n\t\tts += `fields.${name}, `;\r\n\t}\r\n\treturn ts;\r\n}\r\nfunction buildIXFieldArr(i:IX):string {\r\n\tlet {schema} = i;\r\n\tlet ts = '';\r\n\tfor (let f of schema.fields) {\r\n\t\tlet {name} = f;\r\n\t\tif (name === 'ix') continue;\r\n\t\tif (name === 'id') continue;\r\n\t\tts += `fields.${name}, `;\r\n\t}\r\n\treturn ts;\r\n}\r\n\r\nfunction replaceTsFileFields(path: string, fields:{[name:string]:FieldItem}) {\r\n\tlet text = fs.readFileSync(path).toString();\r\n\tlet startStr = '\\n/*--fields--*/';\r\n\tlet endStr = '\\n/*==fields==*/\\n';\r\n\tlet start = text.indexOf(startStr);\r\n\tif (start > 0) {\r\n\t\tlet end = text.indexOf(endStr, start + startStr.length);\r\n\t\tif (end > 0) {\r\n\t\t\tlet lBrace = text.indexOf('{', start + startStr.length);\r\n\t\t\tlet rBrace = text.lastIndexOf('}', end);\r\n\t\t\tlet oldText = text.substring(lBrace, rBrace+1);\r\n\t\t\tlet fieldsText = buildFieldsFromOldText(fields, oldText);\r\n\t\t\ttext = text.substring(0, start)\r\n\t\t\t\t+ startStr + '\\nconst fields = {'\r\n\t\t\t\t+ fieldsText\r\n\t\t\t\t+ '\\n};'\r\n\t\t\t\t+ text.substring(end);\r\n\t\t\tfs.writeFileSync(path, text);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst fieldItemReplaceProps = ['label', 'placeholder', 'widget', 'type'];\r\nfunction buildFieldsFromOldText(fields:{[name:string]:FieldItem}, oldText:string):string {\r\n\tlet ret = '';\r\n\tfor (let i in fields) {\r\n\t\tlet field = fields[i];\r\n\t\tsetFieldOldProp(field, oldText);\r\n\t\tret += buildFieldText(field);\r\n\t}\r\n\treturn ret;\r\n}\r\n\r\nfunction setFieldOldProp(field:FieldItem, text:string) {\r\n\tlet fieldStart = field.name + ':';\r\n\tlet start = text.indexOf('\\t' + fieldStart);\r\n\tif (start < 0) start = text.indexOf('\\n' + fieldStart);\r\n\tif (start < 0) start = text.indexOf(' ' + fieldStart);\r\n\tif (start < 0) return;\r\n\t++start;\r\n\tlet end = text.indexOf('}', start + fieldStart.length);\r\n\tif (end < 0) return;\r\n\tlet fieldText = text.substring(start + fieldStart.length, end + 1);\r\n\t/* eslint no-eval: 0 */\r\n\tlet obj = eval('(' + fieldText + ')');\r\n\tfieldItemReplaceProps.forEach(v => {\r\n\t\tlet prop = obj[v];\r\n\t\tif (!prop) return;\r\n\t\tif (v === 'type') return; // 这个是由新的schema决定的\r\n\t\t(field as any)[v] = prop;\r\n\t});\r\n}\r\n\r\nfunction buildFieldText(field:FieldItem):string {\r\n\tlet {$FieldItemType} = field as any;\r\n\tdelete (field as any).$FieldItemType;\r\n\tlet ret = '\\n\\t' + field.name + ': ';\r\n\tlet json = JSON.stringify(field, null, '\\t\\t');\r\n\tjson = json.replace('}', '\\t}');\r\n\tret += json;\r\n\treturn ret + ' as ' + $FieldItemType + ',';\r\n}\r\n\r\ninterface ReplaceSection {\r\n\tbegin: string;\r\n\tend: string;\r\n\tcontent: string;\r\n};\r\nfunction replaceTsFileString(path:string, sec:ReplaceSection) {\r\n\tlet text = fs.readFileSync(path).toString();\r\n\tlet {begin, end, content} = sec;\r\n\tlet b = text.indexOf(begin);\r\n\tif (b < 0) return;\r\n\tlet e = text.indexOf(end, b + begin.length - 1);\r\n\tif (e < 0) return;\r\n\ttext = text.substring(0, b) + content + text.substr(e + end.length);\r\n\tfs.writeFileSync(path, text);\r\n}\r\n","import { camelCase, capitalCase } from \"../../tool\";\r\nimport { UqMan } from \"../uqMan\";\r\nimport { Action } from '../action';\r\nimport { Book } from '../book';\r\nimport { Query } from '../query';\r\nimport { Sheet } from '../sheet';\r\nimport { Tuid } from '../tuid';\r\nimport { UqEnum } from '../enum';\r\nimport { Map } from '../map';\r\nimport { History } from '../history';\r\nimport { Tag } from '../tag';\r\nimport { Pending } from '../pending';\r\nimport { Entity } from '../entity';\r\nimport { ID, IX, IDX } from '../ID';\r\nimport { ArrFields, Field } from '../uqMan';\r\nimport { entityName } from \"./tools\";\r\n\r\nexport function buildUQ(uq:UqMan, uqAlias:string) {\r\n\tlet tsImport = `\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { IDXValue, Uq`;\r\n\tlet ts:string = `\\n\\n`;\r\n\tts += '\\n//===============================';\r\n\tts += `\\n//======= UQ ${uq.name} ========`;\r\n\tts += '\\n//===============================';\r\n\tts += '\\n';\r\n\t\r\n\tuq.enumArr.forEach(v => ts += uqEntityInterface<UqEnum>(v, buildEnumInterface));\r\n\r\n\tuq.tuidArr.forEach(v => ts += uqEntityInterface<Tuid>(v, buildTuidInterface));\r\n    uq.actionArr.forEach(v => ts += uqEntityInterface<Action>(v, buildActionInterface));\r\n    uq.sheetArr.forEach(v => ts += uqEntityInterface<Sheet>(v, buildSheetInterface));\r\n    uq.queryArr.forEach(v => ts += uqEntityInterface<Query>(v, buildQueryInterface));\r\n    uq.bookArr.forEach(v => ts += uqEntityInterface<Book>(v, buildBookInterface));\r\n    uq.mapArr.forEach(v => ts += uqEntityInterface<Map>(v, buildMapInterface));\r\n    uq.historyArr.forEach(v => ts += uqEntityInterface<History>(v, buildHistoryInterface));\r\n    uq.pendingArr.forEach(v => ts += uqEntityInterface<Pending>(v, buildPendingInterface));\r\n\tuq.tagArr.forEach(v => ts += uqEntityInterface<Tag>(v, buildTagInterface));\r\n\tuq.idArr.forEach(v => ts += uqEntityInterface<ID>(v, buildIDInterface));\r\n\tuq.idxArr.forEach(v => ts += uqEntityInterface<IDX>(v, buildIDXInterface));\r\n\tuq.idxArr.forEach(v => ts += uqEntityInterface<IDX>(v, buildIDXActParamInterface));\t\r\n\tuq.ixArr.forEach(v => ts += uqEntityInterface<IX>(v, buildIXInterface));\r\n\r\n\tts += buildActsInterface(uq);\r\n\r\n\tts += `\r\n\\nexport interface UqExt extends Uq {\r\n\tActs(param:ParamActs): Promise<any>;\r\n`;\r\n\tfunction appendArr<T extends Entity>(arr:T[], type:string, tsBuild: (v:T) => string) {\r\n\t\tif (arr.length === 0) return;\r\n\t\tlet tsLen = ts.length;\r\n\t\tarr.forEach(v => ts += tsBuild(v));\r\n\t\tif (ts.length - tsLen > 0) {\r\n\t\t\ttsImport += ', Uq' + type;\r\n\t\t}\r\n\t}\r\n\tappendArr<Tuid>(uq.tuidArr, 'Tuid', v => uqBlock<Tuid>(v, buildTuid));\r\n\tappendArr<Action>(uq.actionArr, 'Action', v => uqBlock<Action>(v, buildAction));\r\n\tappendArr<Sheet>(uq.sheetArr, 'Sheet', v => uqBlock<Sheet>(v, buildSheet));\r\n\tappendArr<Book>(uq.bookArr, 'Book', v => uqBlock<Book>(v, buildBook));\r\n\tappendArr<Query>(uq.queryArr, 'Query', v => uqBlock<Query>(v, buildQuery));\r\n\tappendArr<Map>(uq.mapArr, 'Map', v => uqBlock<Map>(v, buildMap));\r\n\tappendArr<History>(uq.historyArr, 'History', v => uqBlock<History>(v, buildHistory));\r\n\tappendArr<Pending>(uq.pendingArr, 'Pending', v => uqBlock<Pending>(v, buildPending));\r\n\tappendArr<Tag>(uq.tagArr, 'Tag', v => uqBlock<Tag>(v, buildTag));\r\n\tappendArr<ID>(uq.idArr, 'ID', v => uqBlock<ID>(v, buildID));\r\n\tappendArr<IDX>(uq.idxArr, 'IDX', v => uqBlock<IDX>(v, buildIDX));\r\n\tappendArr<IX>(uq.ixArr, 'IX', v => uqBlock<IX>(v, buildIX));\r\n\tts += '\\n}\\n';\r\n\ttsImport += ' } from \"tonva-react\";';\r\n\treturn tsImport + ts;\r\n}\r\n\r\nfunction uqEntityInterface<T extends Entity>(entity: T, buildInterface: (entity: T)=>string) {\r\n\tlet {name} = entity;\r\n\tif (name.indexOf('$') > 0) return '';\r\n\tlet entityCode = buildInterface(entity);\r\n\tif (!entityCode) return '';\r\n\treturn '\\n' + entityCode + '\\n';\r\n}\r\n\r\nfunction uqBlock<T extends Entity>(entity: T, build: (entity: T)=>string) {\r\n\tlet {name} = entity;\r\n\tif (name.indexOf('$') > 0) return '';\r\n\tlet entityCode = build(entity);\r\n\tif (!entityCode) return '';\r\n\treturn '\\n' + entityCode;\r\n}\r\n\r\n\r\nfunction buildFields(fields: Field[], isInID:boolean = false, indent:number = 1) {\r\n\tif (!fields) return '';\r\n\tlet ts = '';\r\n\tfor (let f of fields) {\r\n\t\tts += buildField(f, isInID, indent);\r\n\t}\r\n\treturn ts;\r\n}\r\n\r\nconst fieldTypeMap:{[type:string]:string} = {\r\n\t\"char\": \"string\",\r\n\t\"text\": \"string\",\r\n\t\"id\": \"number\",\r\n\t\"textid\": \"string\",\r\n\t\"int\": \"number\",\r\n\t\"bigint\": \"number\",\r\n\t\"smallint\": \"number\",\r\n\t\"tinyint\": \"number\",\r\n\t\"dec\": \"number\",\r\n\t\"float\": \"number\",\r\n\t\"double\": \"number\",\r\n};\r\nconst sysFields = ['id', 'master', 'row', 'no', '$create', '$owner'];\r\nfunction buildField(field: Field, isInID:boolean, indent:number = 1) {\r\n\tlet {name, type} = field;\r\n\tlet s = fieldTypeMap[type];\r\n\tif (!s) s = 'any';\r\n\tlet q:string = (isInID === true && sysFields.indexOf(name) >= 0)? '?' : '';\r\n\treturn `\\n${'\\t'.repeat(indent)}${name}${q}: ${s};`;\r\n}\r\n\r\nfunction buildArrs(arrFields: ArrFields[]):string {\r\n\tif (!arrFields) return '';\r\n\tlet ts = '\\n';\r\n\tfor (let af of arrFields) {\r\n\t\tts += `\\t${camelCase(af.name)}: {`;\r\n\t\tts += buildFields(af.fields, false, 2);\r\n\t\tts += '\\n\\t}[];\\n';\r\n\t}\r\n\treturn ts;\r\n}\r\n\r\n/*\r\nconst typeMap:{[type:string]:string} = {\r\n\taction: 'Action',\r\n\tquery: 'Query',\r\n}\r\n*/\r\nfunction buildReturns(entity:Entity, returns:ArrFields[]):string {\r\n\tif (!returns) return;\r\n\t//let {typeName} = entity;\r\n\t//let type = typeMap[typeName] || typeName;\r\n\tlet {sName} = entity;\r\n\tsName = capitalCase(sName);\r\n\tlet ts = '';\r\n\tfor (let ret of returns) {\r\n\t\tlet retName = capitalCase(ret.name);\r\n\t\tts += `interface Return${sName}${retName} {`;\r\n\t\tts += buildFields(ret.fields);\r\n\t\tts += '\\n}\\n';\r\n\t}\r\n\r\n\tts += `interface Result${sName} {\\n`;\r\n\tfor (let ret of returns) {\r\n\t\tlet retName = capitalCase(ret.name);\r\n\t\tts += `\\t${ret.name}: Return${sName}${retName}[];\\n`;\r\n\t}\r\n\tts += '}';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildTuid(tuid: Tuid) {\r\n\tlet ts = `\\t${entityName(tuid.sName)}: UqTuid<Tuid${capitalCase(tuid.sName)}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildTuidInterface(tuid: Tuid) {\r\n\tlet ts = `export interface Tuid${capitalCase(tuid.sName)} {`;\r\n\tts += buildFields(tuid.fields);\r\n\tts += '\\n}';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildAction(action: Action) {\r\n\tlet ts = `\\t${entityName(action.sName)}: UqAction<Param${capitalCase(action.sName)}, Result${capitalCase(action.sName)}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildActionInterface(action: Action) {\r\n\tlet ts = `export interface Param${capitalCase(action.sName)} {`;\r\n\tts += buildFields(action.fields);\r\n\tts += buildArrs(action.arrFields);\r\n\tts += '\\n}\\n';\r\n\tts += buildReturns(action, action.returns);\r\n\treturn ts;\r\n}\r\n\r\nfunction buildEnumInterface(enm: UqEnum) {\r\n\tlet {schema} = enm;\r\n\tif (!schema) return;\r\n\tlet {values} = schema;\r\n\tlet ts = `export enum ${capitalCase(enm.sName)} {`;\r\n\tlet first:boolean = true;\r\n\tfor (let i in values) {\r\n\t\tif (first === false) {\r\n\t\t\tts += ',';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfirst = false;\r\n\t\t}\r\n\t\tlet v = values[i];\r\n\t\tts += '\\n\\t' + i + ' = ';\r\n\t\tif (typeof v === 'string') {\r\n\t\t\tts += '\"' + v + '\"';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tts += v;\r\n\t\t}\r\n\t}\r\n\treturn ts += '\\n}'\r\n}\r\n\r\nfunction buildQuery(query: Query) {\r\n\tlet {sName} = query;\r\n\tlet ts = `\\t${entityName(sName)}: UqQuery<Param${capitalCase(sName)}, Result${capitalCase(sName)}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildQueryInterface(query: Query) {\r\n\tlet ts = `export interface Param${capitalCase(query.sName)} {`;\r\n\tts += buildFields(query.fields);\r\n\tts += '\\n}\\n';\r\n\tts += buildReturns(query, query.returns);\r\n\treturn ts;\r\n}\r\n\r\nfunction buildSheet(sheet: Sheet) {\r\n\tlet {sName, verify} = sheet;\r\n\tlet cName = capitalCase(sName);\r\n\tlet v = verify? `Verify${cName}` : 'any';\r\n\tlet ts = `\\t${entityName(sName)}: UqSheet<Sheet${cName}, ${v}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildSheetInterface(sheet: Sheet) {\r\n\tlet {sName, fields, arrFields, verify} = sheet;\r\n\tlet ts = `export interface Sheet${capitalCase(sName)} {`;\r\n\tts += buildFields(fields);\r\n\tts += buildArrs(arrFields);\r\n\tts += '}';\r\n\r\n\tif (verify) {\r\n\t\tlet {returns} = verify;\r\n\t\tts += `\\nexport interface Verify${capitalCase(sName)} {`;\r\n\t\tfor (let item of returns) {\r\n\t\t\tlet {name:arrName, fields} = item;\r\n\t\t\tts += '\\n\\t' + arrName + ': {';\r\n\t\t\tts += buildFields(fields, false, 2);\r\n\t\t\tts += '\\n\\t}[];';\r\n\t\t}\r\n\t\tts += '\\n}';\r\n\t}\r\n\treturn ts;\r\n}\r\n\r\nfunction buildBook(book: Book):string {\r\n\tlet {sName} = book;\r\n\tlet ts = `\\t${entityName(sName)}: UqBook<Param${capitalCase(sName)}, Result${capitalCase(sName)}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildBookInterface(book: Book):string {\r\n\tlet {sName, fields, returns} = book;\r\n\tlet ts = `export interface Param${capitalCase(sName)} {`;\r\n\tts += buildFields(fields);\r\n\tts += '\\n}\\n';\r\n\tts += buildReturns(book, returns);\r\n\treturn ts;\r\n}\r\n\r\nfunction buildMap(map: Map):string {\r\n\tlet {sName} = map;\r\n\tlet ts = `\\t${entityName(sName)}: UqMap;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildMapInterface(map: Map):string {\r\n\t/*\r\n\tlet {sName, fields, returns} = map;\r\n\tlet ts = `export interface Param${capitalCaseString(sName)} {`;\r\n\tts += buildFields(fields);\r\n\tts += '\\n}\\n';\r\n\tts += buildReturns(map, returns);\r\n\treturn ts;\r\n\t*/\r\n\treturn '';\r\n}\r\n\r\nfunction buildHistory(history: History):string {\r\n\tlet {sName} = history;\r\n\tlet ts = `\\t${entityName(sName)}: UqHistory<Param${capitalCase(sName)}, Result${capitalCase(sName)}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildHistoryInterface(history: History):string {\r\n\tlet {sName, fields, returns} = history;\r\n\tlet ts = `export interface Param${capitalCase(sName)} {`;\r\n\tts += buildFields(fields);\r\n\tts += '\\n}\\n';\r\n\tts += buildReturns(history, returns);\r\n\treturn ts;\r\n}\r\n\r\nfunction buildPending(pending: Pending):string {\r\n\tlet {sName} = pending;\r\n\tlet ts = `\\t${entityName(sName)}: UqPending<any, any>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildPendingInterface(pending: Pending):string {\r\n\t/*\r\n\tlet {sName, fields, returns} = pending;\r\n\tlet ts = `export interface Param${capitalCaseString(sName)} {`;\r\n\tts += buildFields(fields);\r\n\tts += '\\n}\\n';\r\n\tts += buildReturns(pending, returns);\r\n\treturn ts;\r\n\t*/\r\n\treturn '';\r\n}\r\n\r\nfunction buildTag(tag: Tag):string {\r\n\tlet {sName} = tag;\r\n\tlet ts = `\\t${entityName(sName)}: UqTag;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildID(id: ID):string {\r\n\tlet {sName} = id;\r\n\tlet ts = `\\t${entityName(sName)}: UqID<any>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildIDX(idx: IDX):string {\r\n\tlet {sName} = idx;\r\n\tlet ts = `\\t${entityName(sName)}: UqIDX<any>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildIX(ix: IX):string {\r\n\tlet {sName} = ix;\r\n\tlet ts = `\\t${entityName(sName)}: UqIX<any>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildTagInterface(tag: Tag):string {\r\n\treturn;\r\n}\r\n\r\nfunction buildIDInterface(idEntity: ID):string {\r\n\tlet {sName, fields, schema} = idEntity;\r\n\tlet {keys:schemaKeys} = schema;\r\n\tlet keys:Field[] = [], others:Field[] = [];\r\n\tfor (let f of fields) {\r\n\t\tlet {name} = f;\r\n\t\tif (name === 'id') continue;\r\n\t\tif ((schemaKeys as any[]).find(v => v.name === name)) keys.push(f);\r\n\t\telse others.push(f);\r\n\t}\r\n\tlet ts = `export interface ${capitalCase(sName)} {`;\r\n\tts += `\\n\\tid?: number;`;\r\n\tts += buildFields(keys, true);\r\n\tts += buildFields(others, true);\r\n\tts += '\\n}';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildIDXInterface(idx: IDX):string {\r\n\tlet {sName, fields, schema} = idx;\r\n\tlet {exFields} = schema;\r\n\tlet ts = `export interface ${capitalCase(sName)} {`;\r\n\tlet indent = 1;\r\n\tfor (let field of fields) {\r\n\t\tlet {name, type} = field;\r\n\t\tlet s = fieldTypeMap[type];\r\n\t\tif (!s) s = 'any';\r\n\t\tts += `\\n${'\\t'.repeat(indent)}${name}`;\r\n\t\tif (name !== 'id') ts += '?';\r\n\t\tts += `: ${s};`;\r\n\t}\r\n\r\n\tlet hasTrack:boolean = false;\r\n\tlet hasMemo:boolean = false;\r\n\tif (exFields) {\r\n\t\tfor (let exField of exFields) {\r\n\t\t\tlet {track, memo} = exField;\r\n\t\t\tif (track === true) hasTrack = true;\r\n\t\t\tif (memo === true) hasMemo = true;\r\n\t\t}\r\n\t}\r\n\tif (hasTrack === true) {\r\n\t\tts += `\\n\\t$track?: number;`;\r\n\t}\r\n\tif (hasMemo === true) {\r\n\t\tts += `\\n\\t$memo?: string;`;\r\n\t}\r\n\tts += '\\n}';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildIDXActParamInterface(idx: IDX):string {\r\n\tlet {sName, fields, schema} = idx;\r\n\tlet {exFields} = schema;\r\n\tlet ts = `export interface ActParam${capitalCase(sName)} {`;\r\n\tlet indent = 1;\r\n\tfor (let field of fields) {\r\n\t\tlet {name, type} = field;\r\n\t\tlet s = fieldTypeMap[type];\r\n\t\tif (!s) s = 'any';\r\n\t\tts += `\\n${'\\t'.repeat(indent)}${name}`;\r\n\t\tif (name !== 'id') ts += '?';\r\n\t\t//let exField = (exFields as any[])?.find(v => v.name === name);\r\n\t\t//if (exField) {\r\n\t\t\tts += `: ${s}|IDXValue;`;\r\n\t\t//}\r\n\t\t//else {\r\n\t\t//\tts += `: ${s};`;\r\n\t\t//}\r\n\t}\r\n\r\n\tlet hasTrack:boolean = false;\r\n\tlet hasMemo:boolean = false;\r\n\tif (exFields) {\r\n\t\tfor (let exField of exFields) {\r\n\t\t\tlet {track, memo} = exField;\r\n\t\t\tif (track === true) hasTrack = true;\r\n\t\t\tif (memo === true) hasMemo = true;\r\n\t\t}\r\n\t}\r\n\tif (hasTrack === true) {\r\n\t\tts += `\\n\\t$track?: number;`;\r\n\t}\r\n\tif (hasMemo === true) {\r\n\t\tts += `\\n\\t$memo?: string;`;\r\n\t}\r\n\tts += '\\n}';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildIXInterface(ix: IX):string {\r\n\tlet {sName, fields} = ix;\r\n\tlet ts = `export interface ${capitalCase(sName)} {`;\r\n\tts += buildFields(fields);\r\n\tts += '\\n}';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildActsInterface(uq: UqMan) {\r\n\tlet ts = `\\nexport interface ParamActs {`;\r\n\tuq.idArr.forEach(v => {\r\n\t\tlet {sName} = v;\r\n\t\tts += `\\n\\t${camelCase(sName)}?: ${capitalCase(sName)}[];`;\r\n\t});\r\n\tuq.idxArr.forEach(v => {\r\n\t\tlet {sName} = v;\r\n\t\tts += `\\n\\t${camelCase(sName)}?: ActParam${capitalCase(sName)}[];`;\r\n\t});\r\n\tuq.ixArr.forEach(v => {\r\n\t\tlet {sName} = v;\r\n\t\tts += `\\n\\t${camelCase(sName)}?: ${capitalCase(sName)}[];`;\r\n\t});\r\n\tts += '\\n}\\n';\r\n\treturn ts;\r\n}\r\n","export * from './StockInfoType';\r\nexport { CStockInfo } from './CStockInfo';\r\nexport { VStockInfo } from './VStockInfo';","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport 'bootstrap/dist/css/bootstrap.css';\r\nimport './index.css';\r\nimport reportWebVitals from './reportWebVitals';\r\nimport { App } from 'uq-app';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}